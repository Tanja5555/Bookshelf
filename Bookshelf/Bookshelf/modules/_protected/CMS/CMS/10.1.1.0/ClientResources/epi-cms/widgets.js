//>>built
require({cache:{"epi-cms/layers/cms-widgets":function(){define(["dijit/form/ValidationTextBox","epi-cms/_ContentContextMixin","epi-cms/ApplicationSettings","epi-cms/CMSModule","epi-cms/compare/views/CompareView","epi-cms/compare/views/SideBySideCompareView","epi-cms/compare/views/AllPropertiesCompareView","epi-cms/component/ContextHistory","epi-cms/component/GlobalToolbar","epi-cms/component/MainNavigationComponent","epi-cms/component/Media","epi-cms/component/PageNavigationTree","epi-cms/component/RecentlyChanged","epi-cms/component/SharedBlocks","epi-cms/component/SiteTree","epi-cms/component/Tasks","epi-cms/component/Trash","epi-cms/component/Versions","epi-cms/content-approval/ApprovalComponent","epi-cms/contentediting/_Renderer","epi-cms/contentediting/ContentDetails","epi-cms/contentediting/CreateContent","epi-cms/contentediting/CreateLanguageBranch","epi-cms/contentediting/DateTimeNowEditor","epi-cms/contentediting/DialogEditorWrapper","epi-cms/contentediting/EditActionPanel","epi-cms/contentediting/EditingBase","epi-cms/contentediting/editors/CheckBoxListEditor","epi-cms/contentediting/editors/CollectionEditor","epi-cms/contentediting/editors/ContentAreaEditor","epi-cms/contentediting/editors/ItemCollectionEditor","epi-cms/contentediting/editors/PreviewableDateTimeEditor","epi-cms/contentediting/editors/PreviewableTextEditor","epi-cms/contentediting/editors/SelectionEditor","epi-cms/contentediting/editors/ShortcutEditor","epi-cms/contentediting/editors/TinyMCEEditor","epi-cms/contentediting/editors/TinyMCEOverlayItem","epi-cms/contentediting/editors/TinyMCEInlineEditor","epi-cms/contentediting/EditToolbar","epi-cms/contentediting/FloatingEditorWrapper","epi-cms/contentediting/FlyoutEditorWrapper","epi-cms/contentediting/FormEditing","epi-cms/contentediting/InlineEditorWrapper","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/OnPageEditing","epi-cms/contentediting/PageDataController","epi-cms/contentediting/PropertyRenderer","epi-cms/contentediting/PublishMenu","epi-cms/contentediting/SettingsPanel","epi-cms/contentediting/ValidationTextboxWithWarning","epi-cms/contentediting/viewmodel/ContentDetailsViewModel","epi-cms/conversion/PropertyContentAreaConverter","epi-cms/conversion/PropertyDateConverter","epi-cms/core/ContentReference","epi-cms/layout/CreateContentGroupContainer","epi-cms/layout/EditLayoutContainer","epi-cms/legacy/LegacyDialogPopup","epi-cms/legacy/LegacyFormEditor","epi-cms/project/Overview","epi-cms/project/ProjectComponent","epi-cms/project/ProjectModeToolbar","epi-cms/project/ProjectChangesComponent","epi-cms/version/LanguageSelector","epi-cms/widget/_GridWidgetBase","epi-cms/widget/CategorySelector","epi-cms/widget/ContentSelector","epi-cms/widget/HyperLinkSelector","epi-cms/widget/NotificationStatusBar","epi-cms/widget/NotificationStatusZone","epi-cms/widget/overlay/Block","epi-cms/widget/overlay/ContentArea","epi-cms/widget/overlay/ItemCollection","epi-cms/widget/overlay/overlayFactory","epi-cms/widget/ReadOnlyDateTimeEditor","epi-cms/widget/TooltipDialog","epi-cms/widget/UrlContentSelector","epi-cms/widget/UrlSelector","epi-cms/widget/XFormEditor"],1);},"epi-cms/_ContentContextMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/when","epi/dependency","epi/UriParser","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _1([_8],{ignoreVersionWhenComparingLinks:false,contentDataStore:null,_currentContentContext:null,postscript:function(){this.inherited(arguments);this.own(_3.after(this.getContentDataStore(),"onItemChanged",_2.hitch(this,this.itemChanged)));},getContentDataStore:function(){if(!this.contentDataStore){var _a=_6.resolve("epi.storeregistry");this.contentDataStore=_a.get("epi.cms.contentdata");}return this.contentDataStore;},getCurrentContent:function(){var _b=new _4();_5(this.getCurrentContext(),_2.hitch(this,function(_c){if(!this._isContentContext(_c)){_b.reject({message:"Not a content data",context:_c});return;}_5(this.getContentDataStore().get(_c.id),function(_d){_b.resolve(_d);});}));return _b;},contextChanged:function(_e,_f){this.inherited(arguments);if(!this._isContentContext(_e)){this._currentContentContext=null;return;}var _10=(_f&&_f.forceContextChange?_f.forceContextChange:false);if(!_10&&this._isSameAsCurrentContentContext(_e)){return;}this._currentContentContext=_e;this.contentContextChanged(_e,_f);},contextUpdated:function(ctx,_11){if(!this._isContentContext(ctx)){this._currentContentContext=null;return;}this._currentContentContext=ctx;this.contentContextUpdated(ctx,_11);},contentContextChanged:function(ctx,_12){},contentContextUpdated:function(ctx,_13){},itemChanged:function(id,_14){},_isContentContext:function(ctx){return ctx&&ctx.type==="epi.cms.contentdata";},_isSameAsCurrentContentContext:function(ctx){if(this._currentContentContext&&ctx){return this._currentContentContext.id===ctx.id&&(this._currentContentContext.languageContext&&ctx.languageContext&&this._currentContentContext.languageContext.preferredLanguage===ctx.languageContext.preferredLanguage);}else{return false;}},_isSameAsCurrentContext:function(uri){if(this._currentContext){return this._compareUris(uri,this._currentContext.uri);}else{return false;}},_compareUris:function(_15,_16){var _17=new _7(_15),_18=new _7(_16);if(this.ignoreVersionWhenComparingLinks&&_17.getType()==="epi.cms.contentdata"&&_18.getType()==="epi.cms.contentdata"&&_9.compareIgnoreVersion(_17.getId(),_18.getId())){return true;}else{if(_15===_16){return true;}}return false;}});});},"epi-cms/core/ContentReference":function(){define(["dojo/_base/declare","epi/epi"],function(_19,epi){var _1a=_19(null,{id:0,workId:0,providerName:null,isSelfReference:false,constructor:function(_1b){if(_1b){this._parse(_1b);}},_parse:function(_1c){if(typeof _1c==="object"){this.id=parseInt(_1c.ID||_1c.id||_1c.iD||_1c.Id||0,10);this.workId=parseInt(_1c.WorkID||_1c.workId||0,10);this.providerName=_1c.ProviderName||_1c.providerName||null;}else{if(typeof _1c==="string"){if(_1c==="-"){this.isSelfReference=true;this.id=0;this.workId=-1;}else{this.isSelfReference=false;var v=String();v.split("_");var _1d=_1c.split("_");this.id=parseInt(_1d[0],10);this.workId=parseInt(_1d[1],10)||0;this.providerName=_1d[2]||"";}}else{if(typeof _1c==="number"){this.id=_1c;this.workId=0;this.providerName="";}}}if(isNaN(this.id)){throw new Error("The id parameter of a content reference must be an integer");}if(isNaN(this.workId)&&!this.isSelfReference){throw new Error("The workId of a content reference must be an integer");}},toString:function(){if(this.isSelfReference){return "-";}var _1e=String(this.id);if(this.workId!==0){_1e+="_"+this.workId;}if(this.providerName){_1e+=(this.workId===0?"__":"_")+this.providerName;}return _1e;},createVersionUnspecificReference:function(){return new _1a({id:this.id,providerName:this.providerName});}});_1a.isContentReference=function(_1f){try{return !!(new _1a(_1f));}catch(error){return false;}};_1a.toContentReference=function(obj){if(obj instanceof _1a){return obj;}else{if(typeof obj==="string"||typeof obj==="number"){return new _1a(obj);}}return _1a.emptyContentReference;};_1a.compareIgnoreVersion=function(_20,_21){var c1=_1a.toContentReference(_20);var c2=_1a.toContentReference(_21);var _22=c1.createVersionUnspecificReference();var _23=c2.createVersionUnspecificReference();return epi.areEqual(_22,_23);};_1a.emptyContentReference=new _1a({id:-1,workId:-1});return _1a;});},"epi-cms/ApplicationSettings":function(){define("epi-cms/ApplicationSettings",[],function(){return {};});},"epi-cms/CMSModule":function(){define("epi-cms/CMSModule",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi","epi/_Module","epi/dependency","epi/shell/request/mutators","epi/routes","epi/shell/conversion/ObjectConverterRegistry","epi/shell/store/JsonRest","epi/shell/store/Throttle","epi/shell/TypeDescriptorManager","epi/shell/ViewSettings","epi-cms/ApplicationSettings","epi-cms/BackContextHistory","epi-cms/ContextSynchronizer","epi-cms/conversion/ContentFragmentConverter","epi-cms/conversion/ContentLightUriConverter","epi-cms/conversion/ContentReferenceConverter","epi-cms/conversion/PropertyDateConverter","epi-cms/core/ContentReference","epi-cms/store/configurableQueryEngine","epi-cms/store/PageVersionQueryEngine","epi-cms/project/ProjectActivitiesQueryEngine","epi-cms/component/command/GlobalToolbarCommandProvider","epi-cms/compare/command/CompareCommandProvider","epi-cms/notification/command/NotificationCommandProvider","epi-cms/command/ViewSettingsCommandProvider","epi-cms/contentediting/EditorFactory","epi-cms/contentediting/InUseNotificationManager","epi-cms/contentediting/ViewSettingsManager","epi-cms/content-approval/ApprovalService","epi-cms/project/ProjectService","epi-cms/project/ActivityService","epi-cms/notification/NotificationService","epi-cms/project/request/projectMode","epi-cms/request/contentLanguage","epi-cms/project/ProjectModeRequestInterceptor","epi-cms/project/ProjectItemQueryEngine","epi-cms/contentediting/command/Editing","epi-cms/contentediting/commandproviders/ContentDetails","epi-cms/contentediting/commandproviders/PublishMenu","epi-cms/contentediting/commandproviders/PublishMenuGlobal","epi-cms/contentediting/viewsettings/ChannelViewSetting","epi-cms/contentediting/viewsettings/ResolutionViewSetting","epi-cms/contentediting/viewsettings/ViewLanguageViewSetting","epi-cms/contentediting/viewsettings/VisitorGroupViewSetting","epi-cms/project/ProjectViewSetting","epi-cms/widget/ContentTypeService","epi-cms/Profile"],function(_24,_25,_26,_27,epi,_28,_29,_2a,_2b,_2c,_2d,_2e,_2f,_30,_31,_32,_33,_34,_35,_36,_37,_38,_39,_3a,_3b,_3c,_3d,_3e,_3f,_40,_41,_42,_43,_44,_45,_46,_47,_48,_49,_4a,_4b,_4c,_4d,_4e,_4f,_50,_51,_52,_53,_54,_55){return _25([_28],{_settings:null,_hashWrapper:null,_firstTimeHashUpdated:false,constructor:function(_56){this._settings=_56;},initialize:function(){this.inherited(arguments);_2a.add(_47);_2a.add(_48);_25.safeMixin(_31,this._settings);var _57=_29.resolve("epi.shell.Profile");return _27(_57.getContentLanguage()).then(_26.hitch(this,function(_58){_31.currentContentLanguage=_57.contentLanguage=_58;this.registerDependency("epi.cms.BackContextHistory",new _32());this.registerDependency("epi.cms.ContextSynchronizer",new _33(),undefined,function(_59){_59.destroy();});this.registerDependency("epi.cms.contentEditing.command.Editing",_4b);this._hashWrapper=_29.resolve("epi.shell.HashWrapper");var _5a=this.resolveDependency("epi.shell.ContextService");this.registerDependency("epi.cms.contentRepositoryDescriptors",this._settings.contentRepositoryDescriptors);_5a.registerRoute("epi.cms.contentdata",_26.hitch(this,this._redirectContentDataContext));_5a.registerRoute("epi.cms.project",_26.hitch(this,this._redirectContext));_5a.registerRoute("epi.cms.approval",_26.hitch(this,this._redirectContext));this._initializeEditorFactory();this._initializeStores();this.registerDependency("epi.cms.ApprovalService",new _43());this.registerDependency("epi.cms.ProjectService",new _44());this.registerDependency("epi.cms.ActivityService",new _45());this.registerDependency("epi.cms.NotificationService",new _46());this._projectModeRequestInterceptor=new _49();this.registerDependency("epi.cms.ContentTypeService",new _54());this._setupConverters();this._setupViewSettings(_5a);var _5b=_29.resolve("epi.globalcommandregistry");_5b.registerProvider("epi.cms.publishmenu",new _4e());_5b.registerProvider("epi.cms.globalToolbar",new _3c());_5b.registerProvider("epi.cms.globalToolbar",new _3d());_5b.registerProvider("epi.cms.globalToolbar",new _3f());_5b.registerProvider("epi.cms.globalToolbar",new _3e());this._setupInUseNotificationManager(_5b);}));},_redirectContentDataContext:function(_5c,_5d,uri){if(_30.viewName==="/episerver/dashboard"){var _5e=_2b.getActionPath({moduleArea:"CMS",controller:"Home",action:""});_5e=_5e.substring(0,_5e.length-1);var _5f=_5e+"#"+this._hashWrapper.extractHash(_5c,_5d);this._redirect(_5f);}else{if(_5c.hasSiteChanged){var _60=_5c.fullHomeUrl+"#"+this._hashWrapper.extractHash(_5c,_5d);this._redirect(_60);}else{if(_5d&&_5d.trigger==="internal"&&this._firstTimeHashUpdated){return;}this._firstTimeHashUpdated=true;this._hashWrapper.onContextChange(_5c,_5d);}}},_redirectContext:function(_61,_62){this._hashWrapper.onContextChange(_61,_62);},_redirect:function(url){window.location=url;},_setupConverters:function(){var _63=new _35(),_64=new _36(),_65=new _34(),_66=new _37(),_67=this.resolveDependency("epi.cms.contentRepositoryDescriptors"),key;for(key in _67){var _68=_67[key];if(_68.linkableTypes){_68.linkableTypes.forEach(function(_69){_2c.registerConverter(_69,_69+".link",_63);_2c.registerConverter(_69+".fragment",_69+".link",_63);_2c.registerConverter(_69,"link",_63);});}}for(key in _2f._uiDescriptors){var _6a=_2f._uiDescriptors[key].descriptor;_2c.registerConverter(_6a.typeIdentifier,_6a.typeIdentifier+".reference",_64);_2c.registerConverter(_6a.typeIdentifier+".fragment",_6a.typeIdentifier+".reference",_64);_2c.registerConverter(_6a.typeIdentifier,_6a.typeIdentifier+".light",_63);_2c.registerConverter(_6a.typeIdentifier,_6a.typeIdentifier+".fragment",_65);}_63.registerDefaultConverters(_2c);_66.registerDefaultConverters(_2c);},_setupViewSettings:function(_6b){var _6c=new _42({viewSettings:[new _50(),new _52(),new _4f(),new _53(_6b),new _51(_6b)]});this.registerDependency("epi.viewsettingsmanager",_6c);},_initializeStores:function(){var _6d=this.resolveDependency("epi.storeregistry"),_6e,_6f,_70;_6e=_6d.create("epi.cms.contentdata",this._getRestPath("contentdata"),{idProperty:"contentLink"});_6f=_6d.create("epi.cms.content.light",this._getRestPath("contentstructure"),{idProperty:"contentLink",queryEngine:_39});_70=_6d.create("epi.cms.contentversion",this._getRestPath("contentversion"),{idProperty:"contentLink",queryEngine:_3a});_6d.create("epi.cms.displayoptions",this._getRestPath("displayoptions"));_6d.create("epi.cms.category",this._getRestPath("categories"));_6d.create("epi.cms.inusenotification",this._getRestPath("inusenotification")).addDependentStore(_6e);_6d.create("epi.cms.visitorgroup",this._getRestPath("visitorgroup"));_6d.create("epi.cms.language",this._getRestPath("language"),{idProperty:"languageId"});_6d.create("epi.cms.sitestructure",this._getRestPath("sitestructure"),{idProperty:"url"});_6d.create("epi.cms.displaychannels",this._getRestPath("channel"));_6d.create("epi.cms.wastebasket",this._getRestPath("wastebasket"));_6d.create("epi.cms.xform",this._getRestPath("xform"));_6d.create("epi.cms.project",this._getRestPath("project"),{queryEngine:_39,realtimeInfo:{subscriptionKey:"/episerver/cms/project"}});_6d.create("epi.cms.project.item",this._getRestPath("project-item"),{queryEngine:_4a,realtimeInfo:{subscriptionKey:"/episerver/cms/project-item"}});_6d.create("epi.cms.activities",this._getRestPath("activities"),{queryEngine:_3b,realtimeInfo:{subscriptionKey:"/episerver/cms/activity"}});_6d.create("epi.cms.activities.comments",this._getRestPath("activities-comments"),{realtimeInfo:{subscriptionKey:"/episerver/cms/activity-comment"}});_6d.create("epi.cms.contenttype",this._getRestPath("contenttype")).query();_6d.create("epi.cms.notification",this._getRestPath("notification"),{queryEngine:_39,realtimeInfo:{subscriptionKey:"/episerver/cms/notification"}});_6d.create("epi.cms.notification.users",this._getRestPath("notification-users"),{idProperty:"userName"});_6d.add("epi.cms.approval.definition",new _2e(new _2d({idProperty:"contentLink",target:this._getRestPath("approval-definition"),preventCache:true})));_6d.add("epi.cms.approval",new _2e(new _2d({target:this._getRestPath("approval"),preventCache:true})));_6d.add("epi.cms.contentreferences",new _2e(new _2d({target:this._getRestPath("contentreferences"),idProperty:"contentLink",preventCache:true})));_6d.add("epi.cms.content.search",new _2e(new _2d({target:this._getRestPath("contentstructure"),idProperty:"contentLink"})));_6e.addDependentStore(_6f,{refreshOnPatch:true,refresh:function(_71){var id=_6e.getIdentity(_71);var _72=new _38(id).createVersionUnspecificReference().toString();_6f.refresh(_72);}});_6e.addDependentStore(_70,{transformDelegate:function(_73){if(_73.capabilities&&!_73.capabilities.versionable){return null;}if(!_73.properties){return null;}var _74={pageChangedBy:"savedBy",pageSaved:"savedDate",pageLanguageBranch:"language",pageName:"name",name:"name",icontent_name:"name"};var _75=_26.mixin({},_73);for(var p in _74){if(p in _75.properties){_75[_74[p]]=_75.properties[p];}}return _75;}});},_getRestPath:function(_76){return _2b.getRestPath({moduleArea:"cms",storeName:_76});},_initializeEditorFactory:function(){this.registerDependency("epi.cms.contentediting.EditorFactory",function(){var _77=new _40();_77.registerEditorWrapper("inline","epi-cms/contentediting/InlineEditorWrapper",function(_78,_79){});_77.registerEditorWrapper("richtextinline","epi-cms/contentediting/RichTextInlineEditorWrapper",function(_7a,_7b){});_77.registerEditorWrapper("flyout","epi-cms/contentediting/FlyoutEditorWrapper",function(_7c,_7d){});_77.registerEditorWrapper("floating","epi-cms/contentediting/FloatingEditorWrapper",function(_7e,_7f){});_77.registerEditorWrapper("contenteditable","epi-cms/contentediting/ContentEditableWrapper",function(_80,_81){});_77.registerEditorWrapper("legacyProperty","epi-cms/contentediting/DialogEditorWrapper",function(_82,_83){_82.closeOnChange=true;_82.showButtons=false;});return _77;});},_setupInUseNotificationManager:function(_84){var _85=new _41();this.registerDependency("epi.cms.contentediting.inUseNotificationManager",_85);_84.registerProvider("epi.cms.publishmenu",new _4d());_84.registerProvider("epi.cms.contentdetailsmenu",new _4c());}});});},"epi-cms/BackContextHistory":function(){define("epi-cms/BackContextHistory",["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/store/Memory","epi/shell/ContextHistory","epi/shell/ViewSettings"],function(_86,_87,_88,_89,_8a,_8b){return _86([_8a],{createStore:function(){return new _89({data:[],idProperty:"uri"});},onContextChanged:function(_8c,_8d,_8e){if(_8d&&_8d.trigger==="back"){this._removeLastItem();return;}this.inherited(arguments);},closeAndNavigateBack:function(_8f){var _90=this._getLastItem();var _91=this.store.data.filter(function(_92){return _90.typeIdentifier&&(_90.typeIdentifier===_92.typeIdentifier);});_91.forEach(function(_93){var _94=this.store.getIdentity(_93);this.store.remove(_94);},this);var _95=this._getLastItem();var uri=_95&&_95.uri?{uri:_95.uri}:{uri:_8b.settings.defaultContext};_88.publish("/epi/shell/context/request",uri,{sender:_8f});},getPrevious:function(){var _96=this.store.query({},{count:2,sort:[{attribute:"dateAdded",descending:true}]});return (_96&&_96.length>1)?_96[1]:null;},_updateStore:function(_97){var _98=this._getLastItem();if(_98&&_98.uri===_97.versionAgnosticUri){return;}this.inherited(arguments);},_getLastItem:function(){if(this.store&&this.store.data&&this.store.data.length>0){return this.store.data[this.store.data.length-1];}return null;},_removeLastItem:function(){var _99=this._getLastItem();if(_99){this.store.remove(this.store.getIdentity(_99));}}});});},"epi-cms/ContextSynchronizer":function(){define("epi-cms/ContextSynchronizer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/when","epi/shell/_ContextMixin","epi-cms/core/ContentReference"],function(_9a,_9b,_9c,_9d,_9e,_9f){return _9a([_9e],{_subscribeHandle:null,constructor:function(){this._subscribeHandle=_9c.subscribe("/epi/cms/contentdata/updated",this,this._updateCurrentContext);},_updateCurrentContext:function(_a0){var _a1=_a0.contentLink;_9d(this.getCurrentContext(),function(_a2){if(_a2&&_9f.compareIgnoreVersion(_a2.id,_a1)){var _a3={uri:"epi.cms.contentdata:///"+_a1};if(_a2.languageContext){_a3.epslanguage=_a2.languageContext.preferredLanguage;}_9c.publish("/epi/shell/context/updateRequest",_a3);}});},destroy:function(){_9c.unsubscribe(this._subscribeHandle);}});});},"epi-cms/conversion/ContentFragmentConverter":function(){define(["dojo/_base/declare"],function(_a4){return _a4([],{convert:function(_a5,_a6,_a7){if(!_a7){return null;}return {contentLink:_a7.contentLink,name:_a7.name,typeIdentifier:_a7.typeIdentifier};}});});},"epi-cms/conversion/ContentLightUriConverter":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/UriParser","epi-cms/core/ContentReference"],function(_a8,_a9,_aa,_ab,_ac,_ad){return _a8(null,{_contentStore:null,constructor:function(_ae){_a9.mixin(this,_ae);this._contentStore=this._contentStore||_ab.resolve("epi.storeregistry").get("epi.cms.content.light");},registerDefaultConverters:function(_af){},convert:function(_b0,_b1,_b2){if(!_b2||(!_b2.contentLink&&!_b2.uri)){return null;}var _b3=_b2.contentLink||new _ac(_b2.uri).getId();if(!_b3){return null;}_b3=new _ad(_b3).createVersionUnspecificReference().toString();return _aa(this._contentStore.get(_b3),function(_b4){return {url:_b4.publicUrl,previewUrl:_b4.previewUrl,permanentUrl:_b4.permanentLink,text:_b4.name,typeIdentifier:_b4.typeIdentifier};});}});});},"epi-cms/conversion/ContentReferenceConverter":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/UriParser","epi-cms/core/ContentReference"],function(_b5,_b6,_b7,_b8,_b9,_ba){return _b5(null,{convert:function(_bb,_bc,_bd){if(!_bd||(!_bd.uri&&!_bd.contentLink)){return null;}var _be;if(_bd.uri){var uri=new _b9(_bd.uri);_be=uri.getId();}else{_be=_bd.contentLink;}return new _ba(_be).createVersionUnspecificReference().toString();}});});},"epi-cms/conversion/PropertyDateConverter":function(){define(["dojo/_base/declare"],function(_bf){return _bf(null,{sourceDataType:"epi.cms.propertydate",targetDataType:"runtimeType",registerDefaultConverters:function(_c0){_c0.registerConverter(this.sourceDataType,this.targetDataType,this);},convert:function(_c1,_c2,_c3){if(_c3&&_c1===this.sourceDataType&&_c2===this.targetDataType){return new Date(_c3);}return null;}});});},"epi-cms/store/configurableQueryEngine":function(){define(["epi/shell/store/queryUtils"],function(_c4){return function(_c5,_c6){_c6=_c6||{};return _c4.createEngine(_c5,_c6);};});},"epi/shell/store/queryUtils":function(){define("epi/shell/store/queryUtils",[],function(){function _c7(_c8){return _c8 instanceof Array&&_c8.length>0;};var _c9={createFilter:function(_ca,_cb){var _cc;_cb=_cb||{};switch(typeof _ca){case "object":case "undefined":_cc=function(_cd){return !_ca||Object.keys(_ca).every(function(key){var _ce=_cb.ignore,_cf=_cb.comparers&&_cb.comparers[key],_d0=_ca[key];if(_ce&&_ce.indexOf(key)!==-1){return true;}if(_cf){return _cf(_d0,_cd);}return _d0===_cd[key];});};break;default:throw new Error("Can not query with a "+typeof _ca);}return _cc;},createSorter:function(_d1){if(!_c7(_d1)){throw new Error("Argument must be an array containing sortOptions");}return function(a,b){var _d2,_d3;for(var _d4,i=0;(_d4=_d1[i]);i++){_d2=a[_d4.attribute];_d3=b[_d4.attribute];if(typeof _d2==="string"&&typeof _d3==="string"){_d2=_d2.toLowerCase();_d3=_d3.toLowerCase();}if(_d2!==_d3){return _d4.descending===(_d2>_d3)?-1:1;}}return 0;};},createExecuter:function(_d5,_d6,_d7,_d8){var _d9=_d7||0,end=_d8?_d9+_d8:Infinity;return function(_da){var _db;_da=_d5?_da.filter(_d5):_da.slice(0);_d6&&_da.sort(_d6);if(_d7||_d8){_db=_da.length;_da=_da.slice(_d9,end);_da.total=_db;}return _da;};},createEngine:function(_dc,_dd){var _de,_df,_e0;_dd=_dd||{};_de=_c9.createFilter(_dc,_dd);_df=_c7(_dd.sort)?_c9.createSorter(_dd.sort):null;_e0=_c9.createExecuter(_de,_df,_dd.start,_dd.count);_e0.matches=_de;return _e0;}};return _c9;});},"epi-cms/store/PageVersionQueryEngine":function(){define(["dojo/_base/array","epi-cms/core/ContentReference"],function(_e1,_e2){return function(_e3,_e4){switch(typeof _e3){case "object":case "undefined":var _e5=_e3;_e3=function(_e6){for(var key in _e5){var _e7=_e5[key],_e8=_e7.toString();if(_e8!==_e6[key]&&(!_e2.isContentReference(_e8)||!_e2.compareIgnoreVersion(_e8,_e6[key]))){return false;}}return true;};break;case "string":if(!this[_e3]){throw new Error("No filter function "+_e3+" was found in store");}_e3=this[_e3];break;case "function":break;default:throw new Error("Can not query with a "+typeof _e3);}function _e9(_ea){var _eb=_e1.filter(_ea,_e3);if(_e4&&_e4.sort){_eb.sort(function(a,b){for(var _ec,i=0;(_ec=_e4.sort[i]);i++){var _ed=a[_ec.attribute];var _ee=b[_ec.attribute];if(_ed!==_ee){return _ec.descending===(_ed>_ee)?-1:1;}}return 0;});}if(_e4&&(_e4.start||_e4.count)){var _ef=_eb.length;_eb=_eb.slice(_e4.start||0,(_e4.start||0)+(_e4.count||Infinity));_eb.total=_ef;}return _eb;};_e9.matches=_e3;return _e9;};});},"epi-cms/project/ProjectActivitiesQueryEngine":function(){define(["dojo/_base/lang","epi/shell/store/queryUtils"],function(_f0,_f1){return function(_f2,_f3){_f3=_f0.mixin({comparers:{projectId:function(_f4,_f5){return !_f5.projectId||_f4===_f5.projectId;},contentReferences:function(_f6,_f7){return _f6&&_f6.some(function(_f8){return _f8===_f7.contentLink;});}}},_f3);return _f1.createEngine(_f2,_f3);};});},"epi-cms/component/command/GlobalToolbarCommandProvider":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dijit/Destroyable","dijit/form/ToggleButton","epi/dependency","epi/shell/command/ToggleCommand","epi/shell/ViewSettings","epi-cms/widget/command/CreateContentFromSelector","epi-cms/component/command/_GlobalToolbarCommandProvider","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_f9,_fa,_fb,_fc,_fd,_fe,_ff,_100,_101,_102,_103,_104){var _105=_fa([_100,_fd],{iconClass:"epi-iconTree",tooltip:_104.toolbar.buttons.togglenavigationpane,label:_104.toolbar.buttons.togglenavigationpane,order:-10000,canExecute:true,constructor:function(){this.own(_fc.subscribe("/epi/layout/pinnable/navigation/visibilitychanged",_fb.hitch(this,function(_106){this.set("active",_106);})));},_execute:function(){_fc.publish("/epi/layout/pinnable/navigation/toggle");}});var _107=_fa([_100,_fd],{iconClass:"epi-iconFolder",tooltip:_104.toolbar.buttons.toggleassetspane,label:_104.toolbar.buttons.toggleassetspane,order:10000,canExecute:true,constructor:function(){this.own(_fc.subscribe("/epi/layout/pinnable/tools/visibilitychanged",_fb.hitch(this,function(_108){this.set("active",_108);})));},_execute:function(){_fc.publish("/epi/layout/pinnable/tools/toggle");}});return _fa([_103],{contentRepositoryDescriptors:null,viewName:null,postscript:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_ff.resolve("epi.cms.contentRepositoryDescriptors");this.viewName=this.viewName||_101.viewName;this._addLeadingCommands();this._addCreateCommands();this._addTrailingCommands();},_addLeadingCommands:function(){this.addToLeading(new _105(),{widget:_fe,"class":"epi-leadingToggleButton epi-mediumButton"});},_addCreateCommands:function(){var _109=this.viewName;var _10a=[];var _10b=function(view){return view===_109;};for(var _10c in this.contentRepositoryDescriptors){var _10d=this.contentRepositoryDescriptors[_10c];if(_f9.some(_10d.mainViews,_10b)){_10a.push(_10d);}}_f9.forEach(_10a,function(_10e){_f9.forEach(_10e.creatableTypes,function(type){this.addCommand(this._createCommand(type),{category:"create"});},this);},this);},_createCommand:function(type){return new _102({creatingTypeIdentifier:type});},_addTrailingCommands:function(){this.addToTrailing(new _107(),{widget:_fe,"class":"epi-trailingToggleButton epi-mediumButton"});}});});},"epi-cms/widget/command/CreateContentFromSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/topic","dojo/when","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/ApplicationSettings","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/widget/ContentSelectorDialog","epi-cms/widget/ContentForestStoreModel","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.widget.createcontentselector"],function(_10f,_110,lang,_111,on,_112,when,_113,_114,_115,_116,_117,_118,_119,_11a,_11b,_11c,_11d){return _110([_114,_119],{canExecute:true,canSelectOwnerContent:false,showButtons:false,value:null,showRoot:false,roots:null,creatingTypeIdentifier:null,containerTypeIdentifiers:null,modelContent:null,confirmActionText:_11d.buttons.confirmation,description:null,title:null,createAsLocalAsset:false,autoPublish:false,addToParentsAssetsFolder:false,typeDescriptorManager:null,contentRepositoryDescriptors:null,allowedTypes:null,restrictedTypes:null,postscript:function(){this.inherited(arguments);this._initialize();},_initialize:function(){if(!this.creatingTypeIdentifier){throw "You need to specify a creatingTypeIdentifier";}if(this._initialized){return;}var _11e=_113.resolve("epi.storeregistry");this.contentStore=this.contentStore||_11e.get("epi.cms.content.light");this.contextService=this.contextService||_113.resolve("epi.shell.ContextService");this.contentTypeStore=this.contentTypeStore||_11e.get("epi.cms.contenttype");this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_113.resolve("epi.cms.contentRepositoryDescriptors");var _11f,_120=function(type){return type===this.creatingTypeIdentifier;};for(var _121 in this.contentRepositoryDescriptors){var _122=this.contentRepositoryDescriptors[_121];if(_10f.some(_122.containedTypes,_120,this)){_11f=_122;break;}}if(_11f){var _123=_115.getValue(this.creatingTypeIdentifier,"containerTypes");this.containerTypeIdentifiers=_123?_123:[this.creatingTypeIdentifier];this.roots=this.roots||_11f.roots;}this.modelContent=new _11b({roots:this.roots,additionalQueryOptions:{sort:[{attribute:"name",descending:false}]}});this.preventContextualContentFor=_11f.preventContextualContentFor;this.label=this.label||_115.getResourceValue(this.creatingTypeIdentifier,"create");this.title=this.title||_115.getResourceValue(this.creatingTypeIdentifier,"selectparent");this.description=this.description||_115.getResourceValue(this.creatingTypeIdentifier,"createdescription");this.iconClass=this.iconClass||_115.getValue(this.creatingTypeIdentifier,"commandIconClass");this._initialized=true;},contextChanged:function(ctx,_124){this.set("isAvailable",this._isContentContext(ctx));this.inherited(arguments);},_execute:function(){when(this.getCurrentContent(),lang.hitch(this,function(_125){if(!_125){return;}when(this.contextService.query({uri:"epi.cms.contentdata:///"+_125.contentLink}),lang.hitch(this,function(_126){if(!_126){return;}var _127=_126.languageContext;var _128=!_127||(_127.hasTranslationAccess&&_127.isPreferredLanguageAvailable);var _129=_117.compareIgnoreVersion(_125.contentLink,_118.wastebasketPage);var _12a=!(_129||_125.isDeleted)&&_128&&_11c.isActionAvailable(_125,_11c.action.Create,_11c.providerCapabilities.Create,true);when(this._getAvailableContentTypes(_125.contentLink),lang.hitch(this,function(_12b){var _12c=this._isContentTypeAllowedAsChildToCurrentContext(_12b,_125);if((!_12c&&!this.createAsLocalAsset)||!_12a){this._createDialog();this._setDialogButtonState(this.selector.get("value"));}else{this._switchView(_125);}}));}));}));},_getAvailableContentTypes:function(_12d){return this.contentTypeStore.query({query:"getavailablecontenttypes",localAsset:this.createAsLocalAsset,parentReference:_12d});},_isContentTypeAllowedAsChildToCurrentContext:function(_12e,_12f){var _130=_10f.some(_12e,function(_131){return _115.isBaseTypeIdentifier(_131.typeIdentifier,this.creatingTypeIdentifier);},this);var _132=_10f.some(this.containerTypeIdentifiers,function(type){return _115.isBaseTypeIdentifier(_12f.typeIdentifier,type);});return _130&&_132;},_createDialog:function(){this.selector=new _11a({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:this.showButtons,value:this.value,showRoot:this.showRoot,multiRootsMode:true,allowedTypes:this.containerTypeIdentifiers,model:this.modelContent,showContextualContent:true,preventContextualContentFor:this.preventContextualContentFor});this.dialog=new _116({confirmActionText:this.confirmActionText,description:this.description,title:this.title,content:this.selector});this.selector.on("change",lang.hitch(this,this._setDialogButtonState));this.dialog.own(_111.after(this.dialog,"hide",lang.hitch(this,function(_133){this.hideDeferred=_133;})));this.dialog.on("execute",lang.hitch(this,this._onContentSelected));this.dialog.show();},_onContentSelected:function(){var _134=this.selector.get("value");when(this.hideDeferred,lang.hitch(this,function(){when(this.contentStore.get(_134),lang.hitch(this,function(_135){this._switchView(_135);}));}));},_switchView:function(_136){when(this.getCurrentContent(),lang.hitch(this,function(_137){var _138=this.isPseudoContextualRoot(_136)||this.createAsLocalAsset;_112.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.creatingTypeIdentifier,parent:_138?_137:_136,editAllPropertiesOnCreate:this.editAllPropertiesOnCreate,addToDestination:this.model,createAsLocalAsset:_138,treatAsSecondaryView:this.createAsLocalAsset,view:_115.getValue(this.creatingTypeIdentifier,"createView"),autoPublish:this.autoPublish,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes});}));},_setDialogButtonState:function(_139){if(!_139){this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",true);return;}when(this.contentStore.get(_139),lang.hitch(this,function(_13a){when(this.isPseudoContextualRoot(_13a)?this.contextService.query({uri:"epi.cms.contentdata:///"+this._currentContext.id}):_13a,lang.hitch(this,function(_13b){var _13c=_11c.hasLanguageAccess(_13b),_13d=_13c&&_11c.hasAccess(_13a.accessMask,_11c.accessLevel.Create);this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",!_13d);}));}));}});});},"epi-cms/contentediting/_ContextualContentContextMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/_ContentContextMixin","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/contentediting/PseudoContextualCommandDecorator","epi-cms/core/ContentReference"],function(_13e,_13f,lang,when,_140,_141,_142,_143,_144){return _13f([_140],{_commandDecorator:null,postscript:function(){this.inherited(arguments);this._commandDecorator=this._commandDecorator||new _143();},destroy:function(){this._commandDecorator&&this._commandDecorator.destroy();this.inherited(arguments);},isTypeOfRoot:function(_145){var _146=this.inherited(arguments),_147=this.isContextualContent(_145);return _146!=null?!!(_146||_147):!!(_145&&_147);},isContextualContent:function(_148){return this.isContextualRoot(_148)||this.isPseudoContextualRoot(_148);},isContextualRoot:function(_149){return _149.parentLink==this._getPseudoContextualContent();},isPseudoContextualRoot:function(_14a){var _14b=_144.toContentReference(_14a.contentLink);return !_14b.providerName&&_14b.id==this._getPseudoContextualContent();},hasContextual:function(_14c){if(!(_14c instanceof Array)||_14c.length<=0){return false;}return _13e.some(_14c,this.isContextualContent,this);},canHaveContextualContent:function(_14d){var _14e=_144.toContentReference(_14d.contentLink);return !_13e.some(this.notSupportContextualContents,function(id){return !_14e.providerName&&_14e.id==id;});},getContextualRoot:function(_14f){if(typeof _14f!=="object"){return null;}var _150=lang.clone(_14f);_150.name=this.getContextualRootName(_150);if(this.isPseudoContextualRoot(_150)){_150.hasChildren=false;}return _150;},getContextualRootName:function(_151){var _152=_151&&_151.ownerTypeIdentifier,_153=_152||(this._currentContext&&this._currentContext.dataType)||"",_154=_141.getResourceValue(_153,"name",true);var _155=_141.getResourceValue(_153,"forthis",false);return _154?lang.replace(_155,[_154]):_155;},decoratePseudoContextualCommands:function(_156){when(this.getCurrentContent()).then(lang.hitch(this,function(_157){this._commandDecorator.decorateCommands(_156,_157,lang.hitch(this,this.isPseudoContextualRoot));})).otherwise(function(){});},_getPseudoContextualContent:function(){return _142.contentAssetsFolder;}});});},"epi-cms/contentediting/PseudoContextualCommandDecorator":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_158,_159,lang,_15a,_15b,_15c,_15d){return _159(null,{destroy:function(){this._clearContextualCommandHandlers();},decorateCommands:function(_15e,_15f,_160){this._clearContextualCommandHandlers();if(!(_15e instanceof Array)||_15e.length<=0||typeof _15f!=="object"){return;}this._decorateCommands(_15e,_15f,_160);},_decorateCommands:function(_161,_162,_163){_158.forEach(_161,function(_164){if(!this._isValidCommand(_164)){return;}if(typeof _163==="function"&&!_163(this._isNormalCommand(_164)?_164.model:_164.get("selectionData"))){return;}this._onAroundCommandExecute(_164,_162);},this);},_onAroundCommandExecute:function(_165,_166){var self=this;self._contextualCommandHandlers.push(_15a.around(_165,"execute",function(_167){return function(){var _168=self._decorateCommandBeforeExecute(_165,_166);_167.apply(_165,arguments);self._restoreCommandAfterExecute(_165,_168);};}));},_decorateCommandBeforeExecute:function(_169,_16a){var _16b=this._decorateCommand(_169);if(this._isNormalCommand(_169)){lang.mixin(_16b,this._decorateNormalCommand(_169,_16a));}else{if(_169.isInstanceOf(_15d)){lang.mixin(_16b,this._decorateSelectionCommand(_169,_16a));}}_169.set({canExecute:true,isAvailable:true,createAsLocalAsset:true});return _16b;},_decorateCommand:function(_16c){var _16d={createAsLocalAsset:_16c.get("createAsLocalAsset")};_16c.isInstanceOf(_15c)&&_16c.unwatchClipboardChange();_16c.isInstanceOf(_15d)&&_16c.unwatchSelectionChange();return _16d;},_decorateNormalCommand:function(_16e,_16f){var _170={model:_16e.get("model")};_16e.set("model",_16f);return _170;},_decorateSelectionCommand:function(_171,_172){var _173={data:_171.get("selectionData")};var _174=_171.get("model");if(_174&&typeof _174.refreshRoots=="function"){_171.onRefreshSelection=function(){return _174.refreshRoots();};}_171.selection.set("data",[{data:_172,type:_171.get("selectionType")}]);return _173;},_restoreCommandAfterExecute:function(_175,_176){this._restoreCommand(_175,_176);if(this._isNormalCommand(_175)){this._restoreNormalCommand(_175,_176);return;}if(_175.isInstanceOf(_15d)){this._restoreSelectionCommand(_175,_176);}},_restoreCommand:function(_177,_178){_177.set("createAsLocalAsset",_178.createAsLocalAsset);_177.isInstanceOf(_15c)&&_177.watchClipboardChange();_177.isInstanceOf(_15d)&&_177.watchSelectionChange();},_restoreNormalCommand:function(_179,_17a){_179.set("model",_17a.model);},_restoreSelectionCommand:function(_17b,_17c){_17b.selection.set("data",_17c.data);},_clearContextualCommandHandlers:function(){if(this._contextualCommandHandlers instanceof Array&&this._contextualCommandHandlers.length>0){_158.forEach(this._contextualCommandHandlers,function(_17d){typeof _17d.remove==="function"&&_17d.remove();});}this._contextualCommandHandlers=[];},_isNormalCommand:function(_17e){return !(_17e.isInstanceOf(_15d)||_17e.isInstanceOf(_15c));},_isValidCommand:function(_17f){return !!(_17f&&_17f.isInstanceOf(_15b)&&_17f.model);}});});},"epi/shell/command/_ClipboardCommandMixin":function(){define("epi/shell/command/_ClipboardCommandMixin",["dojo/_base/declare","dojo/_base/lang"],function(_180,lang){return _180(null,{clipboard:null,postscript:function(){this.inherited(arguments);this.watchClipboardChange();},onRefreshClipboard:function(){},watchClipboardChange:function(){this._clipboardChangeWatcher=this.clipboard.watch("data",lang.hitch(this,this._onModelChange));},unwatchClipboardChange:function(){this._clipboardChangeWatcher&&this._clipboardChangeWatcher.unwatch();},_clipboardDataGetter:function(){return this._getClipboardData();},_clipboardTypeGetter:function(){return this._getClipboardData().type;},_getClipboardData:function(){if(!this.clipboard||!(this.clipboard.data instanceof Array)){return null;}return this.clipboard.data;}});});},"epi/shell/command/_SelectionCommandMixin":function(){define("epi/shell/command/_SelectionCommandMixin",["dojo/_base/declare","dojo/_base/lang"],function(_181,lang){return _181(null,{selection:null,postscript:function(){this.inherited(arguments);this.watchSelectionChange();},onRefreshSelection:function(){},watchSelectionChange:function(){this._selectionChangeWatcher=this.selection.watch("data",lang.hitch(this,this._onModelChange));},unwatchSelectionChange:function(){this._selectionChangeWatcher&&this._selectionChangeWatcher.unwatch();},_selectionDataGetter:function(){var _182=this._getSelectionData();return _182&&_182.type==="epi.cms.contentdata"?_182.data:null;},_selectionTypeGetter:function(){return this._getSelectionData().type;},_getSelectionData:function(){if(!this.selection||!(this.selection.data instanceof Array)){return null;}return this.selection.data[0];}});});},"epi-cms/widget/ContentSelectorDialog":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/when","dijit/layout/_LayoutWidget","epi","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/widget/ContentTree","epi-cms/widget/ContextualContentForestStoreModel","epi-cms/widget/SearchBox","epi/shell/widget/_ActionProviderWidget","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselectordialog"],function(_183,_184,lang,_185,when,_186,epi,_187,_188,_189,_18a,_18b,_18c,_18d,_18e){return _184([_186,_18c],{_contentRef:null,res:_18e,baseClass:"epi-content-selector-dialog",roots:null,typeIdentifiers:null,showButtons:true,model:null,allowedTypes:null,restrictedTypes:null,canSelectOwnerContent:true,multiRootsMode:false,_typesToDisplay:null,showAllLanguages:false,selectedContentType:null,showSearchBox:true,searchArea:null,_searchBox:null,buildRendering:function(){this.inherited(arguments);var _18f=this._getTypesToDisplay(),_190=this.model,_191=this.roots||(_190&&_190.roots);this.preventContextualContentFor=this.preventContextualContentFor||this._getSettingFromContentType();if(!_190||this.showContextualContent){_190=new _18a({roots:_191,typeIdentifiers:_18f,notSupportContextualContents:this.preventContextualContentFor,showAllLanguages:this.showAllLanguages});}_190.set("view","contentselector");if(this.showSearchBox&&this.searchArea){this._searchBox=new _18b({innerSearchBoxClass:"epi-search--full-width",triggerContextChange:false,parameters:{allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes},onItemAction:lang.hitch(this,function(item){if(item&&item.metadata&&this._checkAcceptance(item.metadata.typeIdentifier)){this.set("value",item.metadata.id);}})});this._searchBox.set("area",this.searchArea);this._searchBox.set("searchRoots",this.roots);var _192=this._searchBox;_190.getRoots(true).then(function(_193){_192.set("searchRoots",_193.join(","));});this.addChild(this._searchBox);}this.tree=new _189({roots:_191,typeIdentifiers:_18f,allowManipulation:false,model:_190,allowedTypes:lang.clone(this.allowedTypes),restrictedTypes:lang.clone(this.restrictedTypes),disableRestrictedTypes:true,expandExtraNodeItems:_188.startPage});this.addChild(this.tree);this.connect(this.tree,"onClick","_onTreeNodeClick");},layout:function(){this.inherited(arguments);var _194=this._contentBox.h;if(this._searchBox){_194-=_185.getMarginBox(this._searchBox.domNode).h;}var _195=_185.getMarginBox(this.tree.domNode);_195.h=_194;_185.setMarginBox(this.tree.domNode,_195);},_getSettingFromContentType:function(){if(!this.selectedContentType){return null;}var _196=this.contentRepositoryDescriptors||_18d.resolve("epi.cms.contentRepositoryDescriptors");var _197,_198=function(type){return _187.isBaseTypeIdentifier(this.selectedContentType,type);};for(var _199 in _196){var _19a=_196[_199];if(_183.some(_19a.containedTypes,_198,this)){_197=_19a;break;}}return _197.preventContextualContentFor;},_getTypesToDisplay:function(){if(!this._typesToDisplay){var _19b=[];this._getContainerTypesRecursive(this.allowedTypes,_19b);this._typesToDisplay=_19b;}return this._typesToDisplay;},_getContainerTypesRecursive:function(_19c,_19d,_19e){if(!_19e){_19e=[];}_183.forEach(_19c,lang.hitch(this,function(type){if(_183.indexOf(_19e,type)===-1){_19e.push(type);if(_183.indexOf(_19d,type)===-1){_19d.push(type);}var _19f=_187.getValue(type,"containerTypes");if(_19f){this._getContainerTypesRecursive(_19f,_19d,_19e);}}}));},_setValueAttr:function(_1a0){if(_1a0){this._contentRef=_1a0;var _1a1=this._contentRef==="-"?null:this._contentRef;if(this.multiRootsMode){when(this.tree.onLoadDeferred,lang.hitch(this,function(){this.tree.selectContent(_1a1,true);}));}else{if(!epi.isEmpty(_1a1)){this.tree.selectContent(_1a1,true);}}}else{this._contentRef=null;this._clearSelectedContent();}},_getValueAttr:function(){this.inherited(arguments);if(this._contentRef){return this._contentRef.toString();}else{return "";}},_setAllowedTypesAttr:function(_1a2){this._typesToDisplay=null;this._set("allowedTypes",_1a2);},_clearSelectedContent:function(){this.tree.set("selectedNodes",[]);this.tree.set("selectedItems",[]);},getActions:function(){return this.canSelectOwnerContent?[{name:"selectpage",label:_18e.currentpage,settings:{type:"submit"},action:lang.hitch(this,function(){this._setValueOwnerContent();})}]:[];},_onTreeNodeClick:function(_1a3){var _1a4=_1a3.contentLink;if(!this._checkAcceptance(_1a3.typeIdentifier)){this.tree.lastFocused.setSelected(false);_1a4=null;}this.set("value",_1a4);this.onChange(this.get("value"));},_checkAcceptance:function(_1a5){var _1a6=_187.getValidAcceptedTypes([_1a5],this.allowedTypes,this.restrictedTypes);return !!_1a6.length;},_setValueOwnerContent:function(){this.set("value","-");},onChange:function(_1a7){},focus:function(){this.tree.focus();}});});},"epi-cms/widget/ContentTree":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/keys","dojo/promise/all","dojo/query","dojo/sniff","dojo/when","dijit/registry","epi/dependency","epi/shell/dnd/tree/dndSource","epi/shell/TypeDescriptorManager","epi/shell/widget/Tree","epi-cms/core/ContentReference","epi-cms/widget/_ContentTreeNode","epi-cms/widget/ContentTreeModelConfirmation","epi-cms/widget/ContentForestStoreModel","epi/i18n!epi/cms/nls/episerver.shared.header"],function(_1a8,_1a9,_1aa,lang,_1ab,_1ac,_1ad,_1ae,_1af,keys,_1b0,_1b1,_1b2,when,_1b3,_1b4,_1b5,_1b6,Tree,_1b7,_1b8,_1b9,_1ba,_1bb){return _1aa([Tree,_1af],{roots:null,expandExtraNodeItems:null,nodeConstructor:null,typeIdentifiers:null,allowManipulation:true,persist:false,expandOnDnd:true,showRoot:false,handleSelection:false,disableRestrictedTypes:false,postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=this._createTreeModel();}if(this.allowManipulation){this.dndController=_1b5;this.accept=this.model.containedTypes||this.containedTypes;}this.checkItemAcceptance=lang.hitch(this,this.checkItemAcceptance);this.nodeConstructor=this.nodeConstructor||_1b8;if(this.allowedTypes){var _1bc=_1a8.some(this.allowedTypes,function(item){return item==="episerver.core.contentfolder";});if(!_1bc){this.allowedTypes.push("episerver.core.contentfolder");}}},getItemType:function(item){return _1b6.getAndConcatenateValues(item.typeIdentifier,"dndTypes");},buildRendering:function(){this.model=this._wrapModel(this.model);this.inherited(arguments);},_wrapModel:function(_1bd){return _1b9(this.model);},postCreate:function(){this.inherited(arguments);this.own(this.connect(this.model,"onSelect",lang.hitch(this,this._onSelect)),_1ad.before(this.model,"onToggleContentDisplay",lang.hitch(this,function(_1be,_1bf){var _1c0=this.getNodesByItem(_1be)[0];if(_1c0){_1ac.set(_1c0.domNode,{display:_1bf===true?"":"none"});}})));},onLoad:function(){this.inherited(arguments);return when(this._expandRootNodes(),lang.hitch(this,this._expandExtraNodes));},_expandRootNodes:function(){var _1c1=this.showRoot?[this.rootNode]:this.rootNode.getChildren();return _1b0(_1a8.map(_1c1,this.tree._expandNode,this));},_expandExtraNodes:function(){if(!this.expandExtraNodeItems){return;}var _1c2=this.expandExtraNodeItems instanceof Array?this.expandExtraNodeItems:[this.expandExtraNodeItems];var _1c3=_1a8.map(_1c2,function(item){return this.tree.getNodesByItem(item)[0];},this);_1c3=_1a8.filter(_1c3,Boolean);return _1b0(_1a8.map(_1c3,this.tree._expandNode,this));},checkItemAcceptance:function(_1c4,_1c5,_1c6){var _1c7=true;var _1c8=_1b3.getEnclosingWidget(_1c4),_1c9=_1c8&&_1c8.item;if(!_1c9){return false;}_1c5.forInSelectedItems(function(item){if(!_1c7){return;}var data=item.data;if(data.dndData){data=data.dndData;}_1c7=this.model.canPaste(data,_1c9);},this);return _1c7;},_setAllowManipulationAttr:function(_1ca){this._set("allowManipulation",_1ca);if(_1ca){this.dndController=_1b5;}},_createTreeModel:function(){return new _1ba({roots:this.roots,typeIdentifiers:this.typeIdentifiers});},_onItemDelete:function(item,_1cb){function _1cc(node,_1cd){_1a8.forEach(node.getChildren(),function(_1ce){_1cd.push(_1ce.item);_1cc(_1ce,_1cd);});return _1cd;};if(_1cb){var _1cf=this._itemNodesMap[this.model.getIdentity(item)];if(_1cf){_1a8.forEach(_1cf,function(_1d0){_1a8.forEach(_1cc(_1d0,[]).reverse(),function(_1d1){this._onItemDelete(_1d1);},this);},this);}}this.inherited(arguments);},_setTypeIdentifiersAttr:function(_1d2){this._set("typeIdentifiers",_1d2);if(this.model){this.model.typeIdentifiers=_1d2;}},getTooltip:function(item){var _1d3=this.model.getTooltip||this.model.getLabel;var _1d4=new _1b7(item.contentLink),_1d5=_1d3?_1d3(item):this.inherited(arguments);return _1d5?_1d5+", "+_1bb.id+": "+_1d4.id+" ("+_1bb.type+": "+item.contentTypeName+")":_1d5;},buildNodeFromTemplate:function(args){return new this.nodeConstructor(args);},_createTreeNode:function(args){var _1d6=lang.mixin({},args,{dndData:args.item});return this.buildNodeFromTemplate(_1d6);},getIconClass:function(item,_1d7){if(!item){return this.inherited(arguments);}var _1d8=_1b6.getValue(item.typeIdentifier,"iconClass");if(this.model.isTypeOfRoot(item)){return this.model.getObjectIconClass(item,_1d8);}var _1d9=_1b6.getValue(item.typeIdentifier,"supportsOpenCssClass");if(_1d7&&!item.isSubRoot&&_1d9){_1d8=_1d8+"Open";}return _1d8+this._getItemDisableStyle(item);},getLabelClass:function(item,_1da){return this._getItemDisableStyle(item);},focus:function(){this.focusNode(this.get("selectedNode")||this.rootNode);},_getItemDisableStyle:function(item){if(this.disableRestrictedTypes){return this._isItemRestricted(item)?" is-disabled ":"";}return "";},_isItemRestricted:function(item){var _1db=_1b6.getValidAcceptedTypes([item.typeIdentifier],this.allowedTypes,this.restrictedTypes);return !_1db.length;},_getTargetPath:function(_1dc){var _1dd=this.model,_1de=new _1ae();_1dd.getAncestors(_1dc,function(_1df){_1df.push(_1dc);var _1e0=_1a8.map(_1df,function(item){return _1dd.getIdentity(item).toString();});if(typeof _1dd.filterAncestors==="function"){_1e0=_1dd.filterAncestors(_1e0);}_1de.resolve(_1e0);});return _1de.promise;},_isValidTargetContent:function(_1e1){if(!_1e1){return false;}return !_1e1.isDeleted&&!_1e1.isWastebasket;},_onSelect:function(id,_1e2,_1e3){var _1e4=this.get("selectedNode");this.tree.model.set("previousContextualSelection",{selectedContent:_1e4});this.selectContent(id,_1e2,true,_1e3).then(lang.hitch(this,function(){_1e4=this.get("selectedNode");if(_1e4&&_1e4.item&&_1e4.item.contentLink){this.emit("select",_1e4.item,_1e4);}}));},selectContent:function(_1e5,_1e6,_1e7,_1e8){var self=this,_1e9=self.model,_1ea=new _1ae(),_1eb=function(_1ec){self._preparePathNodes(_1ec);self._setRecursivePaths(_1ec,_1ea,_1e6,_1e8);};when(_1e9.store.get(_1e5),function(_1ed){if(!self._isValidTargetContent(_1ed)){self.set("paths",[]);_1ea.resolve(null);}else{self._getTargetPath(_1ed).then(function(_1ee){self._onSetTargetPath();_1eb(_1ee);});}});return _1ea.promise;},_onSetTargetPath:function(){this.model.set("handleSelection",this.handleSelection);if(!this.handleSelection){return;}var _1ef=this.get("selectedNode");if(_1ef){_1ef=this.getNodesByItem(_1ef.item)[0];if(_1ef){this.model.set("previousSelection",{selectedContent:_1ef,selectedAncestors:_1ef.getTreePath()});}}},_preparePathNodes:function(_1f0){},_setRecursivePaths:function(_1f1,_1f2,_1f3,_1f4){if(!_1f1||_1f1.length===0){return;}this.set("paths",[_1f1]).then(lang.hitch(this,function(){var _1f5=this.get("selectedNode");if(!_1f5){this._setRecursivePaths(_1f1.slice(0,-1),_1f2,_1f3,_1f4);return;}if(_1f3){this.focus();}if(_1f4){_1f4(_1f5);}_1f2.resolve(_1f5);},_1f2.reject));},_onKeyDown:function(item,e){this.inherited(arguments);if(!this.allowManipulation){return;}if(_1a9.isCopyKey(e)){var _1f6=e.keyCode?String.fromCharCode(e.keyCode).toLowerCase():"";switch(_1f6){case "c":this.emit("copyOrCut",true);break;case "x":this.emit("copyOrCut",false);break;case "v":this.emit("paste");break;default:break;}}if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey){return;}if(e.keyCode===keys.DELETE){this.emit("delete");}},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);if(_1b2("ie")){_1a8.forEach(_1b1(".dijitTreeRow.dijitTreeRowHover",this.tree.domNode),function(node){_1ab.remove(node,"dijitTreeRowHover");});}}});});},"epi/shell/dnd/tree/dndSource":function(){define("epi/shell/dnd/tree/dndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","dojo/when","dijit/tree/dndSource","../_DndDataMixin","epi/shell/TypeDescriptorManager"],function(_1f7,_1f8,_1f9,_1fa,_1fb,lang,on,_1fc,_1fd,_1fe,when,_1ff,_200,_201){return _1f9([_1ff,_200],{generateText:false,singular:true,constructor:function(){var _202=this.reject;if(_202){var _203=[];for(var key in this.accept){_203.push(key);}this.accept={};_203=_201.removeIntersectingTypes(_203,this.reject);_1f7.forEach(_203,function(_204){this.accept[_204]=1;},this);for(var i=0;i<_202.length;++i){this.accept[_202[i]]=0;}}},deleteSelectedNodes:function(){},userSelect:function(node){this.inherited(arguments,[node,false,false]);},onDndDrop:function(_205,_206,copy,_207){if(this.containerState==="Over"){var tree=this.tree,_208=tree.model,_209=this.targetAnchor;this.isDragging=false;var _20a;var _20b=(_209&&_209.item)||tree.item;if(this.dropPosition==="Before"||this.dropPosition==="After"){_20b=(_209.getParent()&&_209.getParent().item)||tree.item;_20a=_209.getIndexInParent();if(this.dropPosition==="After"){_20a=_209.getIndexInParent()+1;}}var _20c=this.itemCreator(_206,_209.rowNode,_205,_207);if(_205===this){if(_208.pasteItems){_208.pasteItems(_20c,_20b,copy,_20a);}else{_1f7.forEach(_20c,function(item){if(item.dndData){var _20d=item.dndData.options;var _20e=_20d?_20d.oldParentItem:null;var _20f=_20d?_20d.indexInParent:0;if(typeof _20a=="number"){if(_20b===_20e&&_20f<_20a){_20a-=1;}}_208.pasteItem(item.dndData.data,_20e,_20b,copy,_20a);}});}}else{if(_208.newItems){_208.newItems(_20c,_20b,_20a);}else{_1f7.forEach(_20c,function(item){_208.newItem(item,_20b,_20a);});}}if(!_205.isDragging&&!_207.isDragging){this.onDndEnd();}}if(this===_207&&_205!==_207&&!copy&&_205.onDndItemRemoved){var _210=_1f7.map(_206,function(node){return this._getDndData(_205.getItem(node.id),this.accept,false);},this);_205.onDndItemRemoved(_210,_205,_206,copy,_207);}this.onDndCancel();},onMouseOut:function(){this.inherited(arguments);if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}},_onDragMouse:function(e,_211){this.inherited(arguments);var m=_1fe.manager();if(m.canDropFlag){when(this.checkItemAcceptance(this.current.rowNode,m.source,this.dropPosition.toLowerCase()),function(_212){m.canDrop(_212);});}if(this._expandOnDndTimeout){clearTimeout(this._expandOnDndTimeout);}if(this.tree&&this.tree.expandOnDnd===true&&this.targetAnchor){this._expandOnDndTimeout=setTimeout(lang.hitch(this,function(){this.isDragging&&this.tree._expandNode(this.targetAnchor);}),500);}},onDndEnd:function(){},onDndItemRemoved:function(_213,_214,_215,copy,_216){},itemCreator:function(_217,_218,_219,_21a){return _1f7.map(_217,function(node){return {id:node.id,name:node.textContent||node.innerText||"",dndData:this._getDndData(_219.getItem(node.id),this.accept,this===_219)};},this);},getItem:function(key){var item=this.inherited(arguments);if(this.tree.getItemType&&item&&item.data&&item.data.item){item.type=this.tree.getItemType(item.data.item);}item.options=this.getItemOptions(item);return item;},getItemOptions:function(item){var opts={};if(item.data){if(item.data.getParent){var _21b=item.data.getParent();opts.oldParentItem=_21b?_21b.item:null;}if(item.data.getIndexInParent){opts.indexInParent=item.data.getIndexInParent();}}return opts;},onMouseDown:function(e){var _21c=_1fa.contains(e.target,"dojoDndContainerOver");if(_21c){return;}this.inherited(arguments);},checkAcceptance:function(_21d,_21e){if(this.readOnly){return false;}var _21f=_1f7.map(_21e,function(node){return _21d.getItem(node.id);});return this._checkAcceptanceForItems(_21f,this.accept);}});});},"dijit/tree/dndSource":function(){define("dijit/tree/dndSource",["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/on","dojo/touch","dojo/topic","dojo/dnd/Manager","./_dndSelector"],function(_220,_221,_222,_223,_224,lang,on,_225,_226,_227,_228){var _229=_222("dijit.tree.dndSource",_228,{isSource:true,accept:["text","treeNode"],copyOnly:false,dragThreshold:5,betweenThreshold:0,generateText:true,constructor:function(tree,_22a){if(!_22a){_22a={};}lang.mixin(this,_22a);var type=_22a.accept instanceof Array?_22a.accept:["text","treeNode"];this.accept=null;if(type.length){this.accept={};for(var i=0;i<type.length;++i){this.accept[type[i]]=1;}}this.isDragging=false;this.mouseDown=false;this.targetAnchor=null;this.targetBox=null;this.dropPosition="";this._lastX=0;this._lastY=0;this.sourceState="";if(this.isSource){_223.add(this.node,"dojoDndSource");}this.targetState="";if(this.accept){_223.add(this.node,"dojoDndTarget");}this.topics=[_226.subscribe("/dnd/source/over",lang.hitch(this,"onDndSourceOver")),_226.subscribe("/dnd/start",lang.hitch(this,"onDndStart")),_226.subscribe("/dnd/drop",lang.hitch(this,"onDndDrop")),_226.subscribe("/dnd/cancel",lang.hitch(this,"onDndCancel"))];},checkAcceptance:function(){return true;},copyState:function(_22b){return this.copyOnly||_22b;},destroy:function(){this.inherited(arguments);var h;while(h=this.topics.pop()){h.remove();}this.targetAnchor=null;},_onDragMouse:function(e,_22c){var m=_227.manager(),_22d=this.targetAnchor,_22e=this.current,_22f=this.dropPosition;var _230="Over";if(_22e&&this.betweenThreshold>0){if(!this.targetBox||_22d!=_22e){this.targetBox=_224.position(_22e.rowNode,true);}if((e.pageY-this.targetBox.y)<=this.betweenThreshold){_230="Before";}else{if((e.pageY-this.targetBox.y)>=(this.targetBox.h-this.betweenThreshold)){_230="After";}}}if(_22c||_22e!=_22d||_230!=_22f){if(_22d){this._removeItemClass(_22d.rowNode,_22f);}if(_22e){this._addItemClass(_22e.rowNode,_230);}if(!_22e){m.canDrop(false);}else{if(_22e==this.tree.rootNode&&_230!="Over"){m.canDrop(false);}else{var _231=false;if(m.source==this){for(var _232 in this.selection){var _233=this.selection[_232];if(_233.item===_22e.item){_231=true;break;}}}if(_231){m.canDrop(false);}else{if(this.checkItemAcceptance(_22e.rowNode,m.source,_230.toLowerCase())&&!this._isParentChildDrop(m.source,_22e.rowNode)){m.canDrop(true);}else{m.canDrop(false);}}}}this.targetAnchor=_22e;this.dropPosition=_230;}},onMouseMove:function(e){if(this.isDragging&&this.targetState=="Disabled"){return;}this.inherited(arguments);var m=_227.manager();if(this.isDragging){this._onDragMouse(e);}else{if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>=this.dragThreshold||Math.abs(e.pageY-this._lastY)>=this.dragThreshold)){var _234=this.getSelectedTreeNodes();if(_234.length){if(_234.length>1){var seen=this.selection,i=0,r=[],n,p;nextitem:while((n=_234[i++])){for(p=n.getParent();p&&p!==this.tree;p=p.getParent()){if(seen[p.id]){continue nextitem;}}r.push(n);}_234=r;}_234=_220.map(_234,function(n){return n.domNode;});m.startDrag(this,_234,this.copyState(_221.isCopyKey(e)));this._onDragMouse(e,true);}}}},onMouseDown:function(e){this.mouseDown=true;this.mouseButton=e.button;this._lastX=e.pageX;this._lastY=e.pageY;this.inherited(arguments);},onMouseUp:function(e){if(this.mouseDown){this.mouseDown=false;this.inherited(arguments);}},onMouseOut:function(){this.inherited(arguments);this._unmarkTargetAnchor();},checkItemAcceptance:function(){return true;},onDndSourceOver:function(_235){if(this!=_235){this.mouseDown=false;this._unmarkTargetAnchor();}else{if(this.isDragging){var m=_227.manager();m.canDrop(false);}}},onDndStart:function(_236,_237,copy){if(this.isSource){this._changeState("Source",this==_236?(copy?"Copied":"Moved"):"");}var _238=this.checkAcceptance(_236,_237);this._changeState("Target",_238?"":"Disabled");if(this==_236){_227.manager().overSource(this);}this.isDragging=true;},itemCreator:function(_239){return _220.map(_239,function(node){return {"id":node.id,"name":node.textContent||node.innerText||""};});},onDndDrop:function(_23a,_23b,copy){if(this.containerState=="Over"){var tree=this.tree,_23c=tree.model,_23d=this.targetAnchor;this.isDragging=false;var _23e;var _23f;var _240;_23e=(_23d&&_23d.item)||tree.item;if(this.dropPosition=="Before"||this.dropPosition=="After"){_23e=(_23d.getParent()&&_23d.getParent().item)||tree.item;_23f=_23d.getIndexInParent();if(this.dropPosition=="After"){_23f=_23d.getIndexInParent()+1;_240=_23d.getNextSibling()&&_23d.getNextSibling().item;}else{_240=_23d.item;}}else{_23e=(_23d&&_23d.item)||tree.item;}var _241;_220.forEach(_23b,function(node,idx){var _242=_23a.getItem(node.id);if(_220.indexOf(_242.type,"treeNode")!=-1){var _243=_242.data,_244=_243.item,_245=_243.getParent().item;}if(_23a==this){if(typeof _23f=="number"){if(_23e==_245&&_243.getIndexInParent()<_23f){_23f-=1;}}_23c.pasteItem(_244,_245,_23e,copy,_23f,_240);}else{if(_23c.isItem(_244)){_23c.pasteItem(_244,_245,_23e,copy,_23f,_240);}else{if(!_241){_241=this.itemCreator(_23b,_23d.rowNode,_23a);}_23c.newItem(_241[idx],_23e,_23f,_240);}}},this);this.tree._expandNode(_23d);}this.onDndCancel();},onDndCancel:function(){this._unmarkTargetAnchor();this.isDragging=false;this.mouseDown=false;delete this.mouseButton;this._changeState("Source","");this._changeState("Target","");},onOverEvent:function(){this.inherited(arguments);_227.manager().overSource(this);},onOutEvent:function(){this._unmarkTargetAnchor();var m=_227.manager();if(this.isDragging){m.canDrop(false);}m.outSource(this);this.inherited(arguments);},_isParentChildDrop:function(_246,_247){if(!_246.tree||_246.tree!=this.tree){return false;}var root=_246.tree.domNode;var ids=_246.selection;var node=_247.parentNode;while(node!=root&&!ids[node.id]){node=node.parentNode;}return node.id&&ids[node.id];},_unmarkTargetAnchor:function(){if(!this.targetAnchor){return;}this._removeItemClass(this.targetAnchor.rowNode,this.dropPosition);this.targetAnchor=null;this.targetBox=null;this.dropPosition=null;},_markDndStatus:function(copy){this._changeState("Source",copy?"Copied":"Moved");}});return _229;});},"epi/shell/widget/Tree":function(){define("epi/shell/widget/Tree",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom","dijit/focus","dijit/Tree"],function(_248,_249,lang,dom,_24a,Tree){return _249(Tree,{dndParams:["accept","reject"].concat(Tree.prototype.dndParams),postCreate:function(){this.inherited(arguments);this.connect(this.model,"onItemChildrenReload","_onChildrenReload");},_onChildrenReload:function(_24b){var _24c=this.model.getIdentity(_24b),_24d=this._itemNodesMap[_24c];if(_24d){if(_248.some(_24d,function(node){return node.state==="LOADED";})){this.model.getChildren(_24b,lang.hitch(this,function(_24e){_248.forEach(_24d,function(_24f){_24f.setChildItems(_24e);});_248.forEach(_24e,function(_250){this.model.onChange(_250);this._onChildrenReload(_250);},this);}));}else{_248.forEach(_24d,function(node){node.isExpandable=this.model.mayHaveChildren(node.item);node._setExpando(false);},this);}}},_onItemChildrenChange:function(){var _251=null;if(_24a.curNode&&dom.isDescendant(_24a.curNode,this.domNode)){_251=_24a.curNode;}this.inherited(arguments);if(_251){if(dom.isDescendant(_251,this.domNode)){_251.focus();}else{var node=this._getRootOrFirstNode();if(node){this.focusNode(node);}}}}});});},"epi-cms/widget/_ContentTreeNode":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/string","dijit/Tree","dijit/_TemplatedMixin","dojox/html/ellipsis","epi-cms/widget/_ContentTreeNodeMixin","dojo/text!./templates/_ContentTreeNode.html"],function(_252,_253,_254,_255,Tree,_256,_257,_258,_259){return _252([Tree._TreeNode,_256,_258],{templateString:_259,buildRendering:function(){this.inherited(arguments);_253.add(this.labelNode,"dojoxEllipsis");},_setItemAttr:function(item){this._set("item",item);this.set("dndData",item);if(item&&item.thumbnailUrl){var _25a=_254.create("img",{src:item.thumbnailUrl+_255.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"});this.thumbnailNode.appendChild(_25a);_253.add(this.contentNode,"epi-mediaContent");}this.inherited(arguments);}});});},"dojox/html/ellipsis":function(){define("dojox/html/ellipsis",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/Color","dojo/colors"],function(d){if(d.isFF<7){var _25b=1;if("dojoxFFEllipsisDelay" in d.config){_25b=Number(d.config.dojoxFFEllipsisDelay);if(isNaN(_25b)){_25b=1;}}try{var _25c=(function(){var sNS="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";var xml=document.createElementNS(sNS,"window");var _25d=document.createElementNS(sNS,"description");_25d.setAttribute("crop","end");xml.appendChild(_25d);return function(n){var x=xml.cloneNode(true);x.firstChild.setAttribute("value",n.textContent);n.innerHTML="";n.appendChild(x);};})();}catch(e){}var _25e=d.create;var dd=d.doc;var dp=d.place;var _25f=_25e("iframe",{className:"dojoxEllipsisIFrame",src:"javascript:'<html><head><script>if(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}</script></head><body></body></html>'",style:{display:"none"}});var _260=function(r,cnt){if(r.collapsed){return;}if(cnt>0){do{_260(r);cnt--;}while(cnt);return;}if(r.endContainer.nodeType==3&&r.endOffset>0){r.setEnd(r.endContainer,r.endOffset-1);}else{if(r.endContainer.nodeType==3){r.setEndBefore(r.endContainer);_260(r);return;}else{if(r.endOffset&&r.endContainer.childNodes.length>=r.endOffset){var _261=r.endContainer.childNodes[r.endOffset-1];if(_261.nodeType==3){r.setEnd(_261,_261.length-1);}else{if(_261.childNodes.length){r.setEnd(_261,_261.childNodes.length);_260(r);return;}else{r.setEndBefore(_261);_260(r);return;}}}else{r.setEndBefore(r.endContainer);_260(r);return;}}}};var _262=function(n){var c=_25e("div",{className:"dojoxEllipsisContainer"});var e=_25e("div",{className:"dojoxEllipsisShown",style:{display:"none"}});n.parentNode.replaceChild(c,n);c.appendChild(n);c.appendChild(e);var i=_25f.cloneNode(true);var ns=n.style;var es=e.style;var _263;var _264=function(){ns.display="";es.display="none";if(n.scrollWidth<=n.offsetWidth){return;}var r=dd.createRange();r.selectNodeContents(n);ns.display="none";es.display="";var done=false;do{var _265=1;dp(r.cloneContents(),e,"only");var sw=e.scrollWidth,ow=e.offsetWidth;done=(sw<=ow);var pct=(1-((ow*1)/sw));if(pct>0){_265=Math.max(Math.round(e.textContent.length*pct)-1,1);}_260(r,_265);}while(!r.collapsed&&!done);};i.onload=function(){i.contentWindow.onresize=_264;_264();};c.appendChild(i);};var hc=d.hasClass;var doc=d.doc;var s,fn,opt;if(doc.querySelectorAll){s=doc;fn="querySelectorAll";opt=".dojoxEllipsis";}else{if(doc.getElementsByClassName){s=doc;fn="getElementsByClassName";opt="dojoxEllipsis";}else{s=d;fn="query";opt=".dojoxEllipsis";}}fx=function(){d.forEach(s[fn].apply(s,[opt]),function(n){if(!n||n._djx_ellipsis_done){return;}n._djx_ellipsis_done=true;if(_25c&&n.textContent==n.innerHTML&&!hc(n,"dojoxEllipsisSelectable")){_25c(n);}else{_262(n);}});};d.addOnLoad(function(){var t=null;var c=null;var _266=function(){if(c){d.disconnect(c);c=null;}if(t){clearTimeout(t);}t=setTimeout(function(){t=null;fx();c=d.connect(d.body(),"DOMSubtreeModified",_266);},_25b);};_266();});}});},"dojo/colors":function(){define("dojo/colors",["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(dojo,lang,_267,_268){var _269={};lang.setObject("dojo.colors",_269);var _26a=function(m1,m2,h){if(h<0){++h;}if(h>1){--h;}var h6=6*h;if(h6<1){return m1+(m2-m1)*h6;}if(2*h<1){return m2;}if(3*h<2){return m1+(m2-m1)*(2/3-h)*6;}return m1;};dojo.colorFromRgb=_267.fromRgb=function(_26b,obj){var m=_26b.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(m){var c=m[2].split(/\s*,\s*/),l=c.length,t=m[1],a;if((t=="rgb"&&l==3)||(t=="rgba"&&l==4)){var r=c[0];if(r.charAt(r.length-1)=="%"){a=_268.map(c,function(x){return parseFloat(x)*2.56;});if(l==4){a[3]=c[3];}return _267.fromArray(a,obj);}return _267.fromArray(c,obj);}if((t=="hsl"&&l==3)||(t=="hsla"&&l==4)){var H=((parseFloat(c[0])%360)+360)%360/360,S=parseFloat(c[1])/100,L=parseFloat(c[2])/100,m2=L<=0.5?L*(S+1):L+S-L*S,m1=2*L-m2;a=[_26a(m1,m2,H+1/3)*256,_26a(m1,m2,H)*256,_26a(m1,m2,H-1/3)*256,1];if(l==4){a[3]=c[3];}return _267.fromArray(a,obj);}}return null;};var _26c=function(c,low,high){c=Number(c);return isNaN(c)?high:c<low?low:c>high?high:c;};_267.prototype.sanitize=function(){var t=this;t.r=Math.round(_26c(t.r,0,255));t.g=Math.round(_26c(t.g,0,255));t.b=Math.round(_26c(t.b,0,255));t.a=_26c(t.a,0,1);return this;};_269.makeGrey=_267.makeGrey=function(g,a){return _267.fromArray([g,g,g,a]);};lang.mixin(_267.named,{"aliceblue":[240,248,255],"antiquewhite":[250,235,215],"aquamarine":[127,255,212],"azure":[240,255,255],"beige":[245,245,220],"bisque":[255,228,196],"blanchedalmond":[255,235,205],"blueviolet":[138,43,226],"brown":[165,42,42],"burlywood":[222,184,135],"cadetblue":[95,158,160],"chartreuse":[127,255,0],"chocolate":[210,105,30],"coral":[255,127,80],"cornflowerblue":[100,149,237],"cornsilk":[255,248,220],"crimson":[220,20,60],"cyan":[0,255,255],"darkblue":[0,0,139],"darkcyan":[0,139,139],"darkgoldenrod":[184,134,11],"darkgray":[169,169,169],"darkgreen":[0,100,0],"darkgrey":[169,169,169],"darkkhaki":[189,183,107],"darkmagenta":[139,0,139],"darkolivegreen":[85,107,47],"darkorange":[255,140,0],"darkorchid":[153,50,204],"darkred":[139,0,0],"darksalmon":[233,150,122],"darkseagreen":[143,188,143],"darkslateblue":[72,61,139],"darkslategray":[47,79,79],"darkslategrey":[47,79,79],"darkturquoise":[0,206,209],"darkviolet":[148,0,211],"deeppink":[255,20,147],"deepskyblue":[0,191,255],"dimgray":[105,105,105],"dimgrey":[105,105,105],"dodgerblue":[30,144,255],"firebrick":[178,34,34],"floralwhite":[255,250,240],"forestgreen":[34,139,34],"gainsboro":[220,220,220],"ghostwhite":[248,248,255],"gold":[255,215,0],"goldenrod":[218,165,32],"greenyellow":[173,255,47],"grey":[128,128,128],"honeydew":[240,255,240],"hotpink":[255,105,180],"indianred":[205,92,92],"indigo":[75,0,130],"ivory":[255,255,240],"khaki":[240,230,140],"lavender":[230,230,250],"lavenderblush":[255,240,245],"lawngreen":[124,252,0],"lemonchiffon":[255,250,205],"lightblue":[173,216,230],"lightcoral":[240,128,128],"lightcyan":[224,255,255],"lightgoldenrodyellow":[250,250,210],"lightgray":[211,211,211],"lightgreen":[144,238,144],"lightgrey":[211,211,211],"lightpink":[255,182,193],"lightsalmon":[255,160,122],"lightseagreen":[32,178,170],"lightskyblue":[135,206,250],"lightslategray":[119,136,153],"lightslategrey":[119,136,153],"lightsteelblue":[176,196,222],"lightyellow":[255,255,224],"limegreen":[50,205,50],"linen":[250,240,230],"magenta":[255,0,255],"mediumaquamarine":[102,205,170],"mediumblue":[0,0,205],"mediumorchid":[186,85,211],"mediumpurple":[147,112,219],"mediumseagreen":[60,179,113],"mediumslateblue":[123,104,238],"mediumspringgreen":[0,250,154],"mediumturquoise":[72,209,204],"mediumvioletred":[199,21,133],"midnightblue":[25,25,112],"mintcream":[245,255,250],"mistyrose":[255,228,225],"moccasin":[255,228,181],"navajowhite":[255,222,173],"oldlace":[253,245,230],"olivedrab":[107,142,35],"orange":[255,165,0],"orangered":[255,69,0],"orchid":[218,112,214],"palegoldenrod":[238,232,170],"palegreen":[152,251,152],"paleturquoise":[175,238,238],"palevioletred":[219,112,147],"papayawhip":[255,239,213],"peachpuff":[255,218,185],"peru":[205,133,63],"pink":[255,192,203],"plum":[221,160,221],"powderblue":[176,224,230],"rosybrown":[188,143,143],"royalblue":[65,105,225],"saddlebrown":[139,69,19],"salmon":[250,128,114],"sandybrown":[244,164,96],"seagreen":[46,139,87],"seashell":[255,245,238],"sienna":[160,82,45],"skyblue":[135,206,235],"slateblue":[106,90,205],"slategray":[112,128,144],"slategrey":[112,128,144],"snow":[255,250,250],"springgreen":[0,255,127],"steelblue":[70,130,180],"tan":[210,180,140],"thistle":[216,191,216],"tomato":[255,99,71],"turquoise":[64,224,208],"violet":[238,130,238],"wheat":[245,222,179],"whitesmoke":[245,245,245],"yellowgreen":[154,205,50]});return _267;});},"epi-cms/widget/_ContentTreeNodeMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","epi-cms/ContentLanguageHelper"],function(_26d,lang,when,_26e,_26f,_270,_271){return _26d(null,{_missingLanguageCssClass:"epi-ct-missingLanguageRow",_updateItemClasses:function(item){this.inherited(arguments);this._updateLayout();},_updateLayout:function(){this.inherited(arguments);this._updateLanguageIndicator();this._updateIndividualLayout();},_updateIndividualLayout:function(){},_addLanguageIndicator:function(){var _272=this.item.missingLanguageBranch;if(this.iconNodeLanguage){this.iconNodeLanguage.innerHTML=_272.language||"";when(_271.getMissingLanguageMessage(this.item),lang.hitch(this,function(_273){_26e.set(this.iconNodeLanguage,"title",_273||"");}));}_26f.add(this.rowNode,this._missingLanguageCssClass);},_removeLanguageIndicator:function(){if(this.iconNodeLanguage){_270.empty(this.iconNodeLanguage);_26e.remove(this.iconNodeLanguage,"title");}_26f.remove(this.rowNode,this._missingLanguageCssClass);},_updateLanguageIndicator:function(){if(!this._isTypeOfRoot()&&this.item.missingLanguageBranch){this._addLanguageIndicator();}else{this._removeLanguageIndicator();}},_isTypeOfRoot:function(){if(!this.tree.model||typeof this.tree.model.isTypeOfRoot!=="function"){return false;}return this.tree.model.isTypeOfRoot(this.item);}});});},"epi-cms/ContentLanguageHelper":function(){define("epi-cms/ContentLanguageHelper",["dojo/_base/lang","dojo/_base/declare","dojo/_base/Deferred","dojo/promise/all","epi/dependency","epi/shell/TypeDescriptorManager"],function(lang,_274,_275,all,_276,_277){return {getMissingLanguageMessage:function(_278){if(!_278||!_278.missingLanguageBranch){return "";}this._languageStore=this._languageStore||_276.resolve("epi.storeregistry").get("epi.cms.language");var def=new _275();var _279=_278.missingLanguageBranch;all([this._languageStore.get(_279.preferredLanguage),this._languageStore.get(_279.language)]).then(lang.hitch(this,function(_27a){var _27b=_279.reason;var _27c="languagenotifications.";if(_27b===6){_27c+="missing";}else{if(_27b===3||_27b===5){_27c+="replacement";}else{if(_27b===4){_27c+="fallback";}}}var _27d=_277.getResourceValue(_278.typeIdentifier,_27c);_27d=lang.replace(_27d,[_27a[0].name,_27a[1].name]);def.resolve(_27d);}),function(){def.resolve("");});return def;}};});},"url:epi-cms/widget/templates/_ContentTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\n    <a href=\"#\" tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>            \n            <span data-dojo-attach-point=\"thumbnailNode\" class=\"epi-thumbnailIcon\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-pt-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\n            </span>\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\n        </span>\n    </a>\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\n</div>","epi-cms/widget/ContentTreeModelConfirmation":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/string","dojo/when","dojo/_base/json","dojox/html/entities","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Alert","epi/shell/widget/dialog/Confirmation","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree","epi/i18n!epi/cms/nls/episerver.cms.components.project"],function(_27e,lang,_27f,_280,_281,when,json,_282,_283,_284,_285,_286,_287,_288,_289,res,_28a){return function(_28b){var _28c=function(_28d){return _28d&&typeof _28d=="function";};var _28e=function(_28f,_290){var _291=new _286({description:_284.toHTML(_28f),onAction:function(){if(_28c(_290)){_290();}}});_291.show();};var _292=function(_293,_294){var _295=new _280();when(_294,function(_296){var _297=new _287({description:_284.toHTML(_296),title:_293,onAction:function(_298){_298?_295.resolve():_295.cancel();}});_297.show();});return _295;};var _299=function(_29a,_29b){when(_29a,function(_29c){if(_29c&&(_29c.message||_29c.statusDescription)){var _29d=_29c.message||_29c.statusDescription;_28e(_29d,_29b);}else{if(_28c(_29b)){_29b();}}},function(e){_28e(_282.encode(json.fromJson(e.xhr.responseText)));});return _29a;};_27f.around(_28b,"pasteItem",function(_29e){return function(_29f,_2a0,_2a1,copy,_2a2){var _2a3=_285.getResourceValue(_29f.typeIdentifier,"move");var _2a4=true;if(_2a1.isWastebasket){_2a4=_289({contentData:_29f});}else{if(_2a2!==undefined&&(_2a1.properties.pageChildOrderRule!==_288.sortOrder.Index)){var _2a5=_281.substitute(res.changepeerorderconfirmation,[_28b.getLabel(_2a1)]);_2a4=_292(_2a3,_2a5);}else{if(!copy){if(!_28b.canCut(_29f)){_28e(_285.getResourceValue(_29f.typeIdentifier,"moverequiresdeleteaccess"),function(){return false;});return;}var _2a6="{0}<br/><br/>{1}",_2a7=lang.replace(_2a6,[_285.getResourceValue(_29f.typeIdentifier,"moveconfirmation"),_285.getResourceValue(_29f.typeIdentifier,"movedescription")]);var _2a8=_283.resolve("epi.cms.ProjectService");if(_2a8.isProjectModeEnabled){_2a7=lang.replace(_2a6,[_2a7,_28a.moveconfirmation]);}_2a4=_292(_2a3,_2a7);}else{if(!_28b.canCopy(_29f)){_28e(_285.getResourceValue(_29f.typeIdentifier,"copynotsupported"));return;}}}}var _2a9=arguments;return when(_2a4,function(){return _29e.apply(_28b,_2a9);},function(){return false;});};});_27f.after(_28b,"pasteItem",function(_2aa){return _2aa&&_299(_2aa);});_27f.after(_28b,"remove",function(_2ab){return _2ab&&_299(_2ab);});return _28b;};});},"epi-cms/contentediting/ContentActionSupport":function(){define(["epi/i18n!epi/cms/nls/episerver.cms.versionstatus"],function(res){var _2ac={},_2ad;if(res){_2ac={0:res.notcreated,1:res.rejected,2:res.checkedout,3:res.checkedin,4:res.published,5:res.previouslypublished,6:res.delayedpublish,7:res.awaitingapproval,100:res.expired};}_2ad={versionStatus:{NotCreated:0,Rejected:1,CheckedOut:2,CheckedIn:3,Published:4,PreviouslyPublished:5,DelayedPublish:6,AwaitingApproval:7,Expired:100},versionLocalizations:_2ac,getVersionStatus:function(_2ae){return this.versionLocalizations[_2ae];},action:{Create:"Create",Edit:"Edit",Delete:"Delete",CheckIn:"CheckIn",Save:"Save",Reject:"Reject",Publish:"Publish",Administer:"Administer"},accessLevel:{NoAccess:0,Read:1,Create:2,Edit:4,CheckIn:4,Delete:8,Publish:16,Administer:32,FullAccess:63},saveAction:{None:0,Save:1,CheckIn:2,Publish:3,Reject:4,RequestApproval:5,CheckOut:6,Schedule:7,ForceNewVersion:128,ForceCurrentVersion:256,SkipValidation:512,DelayedPublish:1024},sortOrder:{None:0,CreatedDescending:1,CreatedAscending:2,Alphabetical:3,Index:4,ChangedDescending:5,Rank:6,PublishedAscending:7,PublishedDescending:8},providerCapabilities:{None:0,Create:1,Edit:2,Delete:4,Move:8,Copy:16,MultiLanguage:32,Security:64,Search:128,PageFolder:256,Wastebasket:512},isActionAvailable:function(_2af,_2b0,_2b1,_2b2,_2b3){return _2ad.hasAccessToAction(_2af,_2b0,_2b1,_2b2,_2b3)&&_2ad.canPerformAction(_2af,_2b0);},hasAccessToAction:function(_2b4,_2b5,_2b6,_2b7,_2b8){var _2b9;if(!_2b4){return false;}if(!_2b7&&_2b4.capabilities&&_2b4.capabilities.language&&_2b4.missingLanguageBranch&&_2b4.missingLanguageBranch.isTranslationNeeded){return false;}if(_2b6&&!_2ad.hasProviderCapability(_2b4.providerCapabilityMask,_2b6)){return false;}_2b9=_2b8?_2b4.accessRights:_2b4.accessMask;return _2ad.hasAccess(_2b9,_2ad.accessLevel[_2b5]);},canPerformAction:function(_2ba,_2bb){var _2bc=_2ba.status,_2bd=_2ad.versionStatus;if(_2bc===_2bd.DelayedPublish&&(_2bb===_2ad.action.Edit||_2bb===_2ad.action.Publish)){return false;}if(_2bb===_2ad.action.Publish){return !(_2bc===_2bd.Published||_2bc===_2bd.Expired);}if(_2bb===_2ad.action.CheckIn){return _2bc===_2bd.CheckedOut||_2bc===_2bd.Rejected;}if(_2bb===_2ad.action.Edit){var _2be=(_2bc===_2bd.Published&&!_2ba.isCommonDraft)||(_2bc===_2bd.Expired&&!_2ba.isCommonDraft)||_2bc===_2bd.PreviouslyPublished||(_2bc===_2bd.CheckedIn&&!_2ba.isPartOfAnotherProject)||_2bc===_2bd.DelayedPublish||_2bc===_2bd.AwaitingApproval;return !(_2be||_2ba.isDeleted||_2ba.isWastebasket);}return true;},hasAccess:function(_2bf,_2c0){return (_2bf&_2c0)===_2c0;},hasLanguageAccess:function(item){if(!item){return false;}var _2c1=item.languageContext||item.missingLanguageBranch||item;return !_2c1||(_2c1.hasTranslationAccess&&_2c1.isPreferredLanguageAvailable);},getPermissionMap:function(_2c2){var map={};for(var al in _2ad.accessLevel){map[al]=_2ad.hasAccess(_2c2,_2ad.accessLevel[al]);}return map;},hasProviderCapability:function(_2c3,_2c4){return (_2c3&_2c4)===_2c4;}};return _2ad;});},"epi-cms/widget/sharedContentDialogHandler":function(){define(["dojo/_base/lang","dojo/Deferred","dojo/when","dojox/html/entities","epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/widget/DelayableStandby","epi-cms/widget/ContentReferences","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences"],function(lang,_2c5,when,_2c6,epi,_2c7,_2c8,_2c9,_2ca,_2cb,_2cc){var _2cd=function(_2ce){var _2cf=new _2c5(),_2d0=_2ce.contentData.contentLink,_2d1=_2c7.resolve("epi.storeregistry"),_2d2=_2d1.get("epi.cms.content.search"),_2d3=new _2ca({target:document.body,zIndex:999}).placeAt(document.body);_2d3.show(50,0);when(_2d2.get(_2d0),function(_2d4){var mode=_2ce.mode||_2cd.mode.confirm,_2d5=mode===_2cd.mode.confirm,_2d6=new _2cb({model:{contentData:_2d4,mode:mode}});var _2d7=_2d6.watch("numberOfReferences",function(_2d8,_2d9,_2da){_2d7.remove();var _2db;if(_2d5){var key=_2d4.hasChildren?"movetotrashwithsubcontentdescription":"movetotrashdescription";_2db=_2c8.getResourceValue(_2d4.typeIdentifier,key);}else{_2db=_2c8.getResourceValue(_2d4.typeIdentifier,"referencesdescription");}_2db=lang.replace(_2db,[_2c6.encode(_2d4.name)]);var _2dc=_2ce.title;if(!_2dc){var _2dd=_2d5?"movetotrash":"references";_2dc=_2c8.getResourceValue(_2d4.typeIdentifier,_2dd);}var _2de=new _2c9({focusActionsOnLoad:true,defaultActionsVisible:_2d5,dialogClass:"epi-dialog-contentReferences",title:_2dc,description:_2db,cancelActionText:epi.resources.action.cancel,confirmActionText:_2da===0?_2cc.buttons.movetotrash:_2cc.buttons.movetotrashanyway,setFocusOnConfirmButton:_2da===0});if(!_2d5){_2de.definitionConsumer.add({name:"close",label:epi.resources.action.close,action:_2de.onCancel});}_2de.connect(_2de,"onExecute",_2cf.resolve);_2de.connect(_2de,"onCancel",_2cf.cancel);_2de.set("content",_2d6);var _2df=_2d6.on("viewReference",function(){_2de.hide();_2df.remove();});_2d3.hide();_2de.show();});_2d6.startup();});return _2cf.promise;};_2cd.mode={confirm:"confirm",show:"show"};return _2cd;});},"epi-cms/widget/ContentReferences":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/keys","dojo/when","epi-cms/dgrid/formatters","epi/shell/TypeDescriptorManager","epi/dependency","./_GridWidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/Evented","dojo/text!./templates/ContentReferences.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences","dijit/form/Button"],function(_2e0,lang,_2e1,_2e2,_2e3,keys,when,_2e4,_2e5,_2e6,_2e7,_2e8,_2e9,_2ea,_2eb,_2ec){return _2e0([_2e7,_2e8,_2e9,_2ea],{res:_2ec,templateString:_2eb,storeKeyName:"epi.cms.contentreferences",contextChangeEvent:"dblclick",trackActiveItem:false,ignoreVersionWhenComparingLinks:false,_setTotalLinksAttr:{node:"totalLinksNode",type:"innerText"},_setNotificationAttr:{node:"contentReferencesNotificationNode",type:"innerText"},_setNotificationBarStyleAttr:function(_2ed){switch(_2ed){case 1:_2e1.add(this.contentReferencesNotificationBar,"epi-statusIndicator epi-statusIndicatorOk");break;case 2:_2e1.add(this.contentReferencesNotificationBar,"epi-statusIndicator epi-statusIndicatorWarning");break;}},_setNumberOfReferencesAttr:function(_2ee){var _2ef=this.model.contentData,_2f0=_2ee>0;var _2f1=lang.hitch(this,function(_2f2,_2f3){var text=_2e5.getResourceValue(_2ef.typeIdentifier,_2f2);this.set("notification",text);this.set("notificationBarStyle",_2f3);});if(_2f0){if(_2ef.hasChildren){_2f1("referenceswithsubcontentwarning",2);}else{_2f1("referenceswarning",2);}}else{if(_2ef.hasChildren){_2f1("noreferenceswithsubcontentwarning",null);}else{if(_2ef.publicUrl){_2f1("publicreferencesnote",null);}else{_2f1("noreferencesnote",1);}}}if(_2f0){var _2f4=_2ee===1?_2ec.totallink:_2ec.totallinks;var _2f5=lang.replace(_2f4,[_2ee]);this.set("totalLinks",_2f5);}this._set("numberOfReferences",_2ee);},_setShowToolbarAttr:function(_2f6){_2e3.set(this.captionPanelNode,"display",_2f6?"":"none");},buildRendering:function(){var _2f7=this._getLinkTemplate();var _2f8=lang.mixin({columns:{name:{renderCell:lang.hitch(this,"_renderContentItem")},language:{className:"epi-width10",renderCell:function(obj,_2f9,node){when(_2e6.resolve("epi.shell.Profile").getContentLanguage(),function(_2fa){if(_2f9!==_2fa){node.textContent=_2f9;}});}},treePath:{className:"epi-width50",get:function(item){return item.treePath.join("<span class=\"epi-breadCrumbsSeparator\">&gt;</span>");},ellipsisNoTooltip:true},view:{className:"epi-width10",label:" ",formatter:function(){return _2f7;},sortable:false}},store:this.store,query:{id:this.model.contentData.contentLink},showHeader:false},this.defaultGridMixin);this.inherited(arguments);this.grid=new this._gridClass(_2f8,this.gridNode);_2e1.toggle(this.contentReferencesNotificationBar,"dijitHidden",this.model.mode==="show");},startup:function(){this.inherited(arguments);this.grid.on(".dgrid-column-view a:click",lang.hitch(this,"_onChangeContext"));this.grid.on("dgrid-refresh-complete",lang.hitch(this,"_afterDataFetched"));},fetchData:function(){this.grid.refresh();},_afterDataFetched:function(e){when(e.results.total,lang.hitch(this,function(_2fb){this.set("numberOfReferences",_2fb);this.set("showToolbar",_2fb>0);_2e3.set(this.grid.domNode,"visibility",(_2fb>0)?"visible":"hidden");}));},_onChangeContext:function(e){var row=this.grid.row(e),_2fc={uri:row.data.uri};this._requestNewContext(_2fc,{sender:this});this.emit("viewReference");},_getLinkTemplate:function(){var node=_2e2.create("a",{"class":"epi-visibleLink",innerHTML:_2ec.view.label,title:_2ec.view.tooltip});return node.outerHTML;}});});},"epi-cms/dgrid/formatters":function(){define(["dojo/_base/lang","dojo/dom-class","epi/datetime","epi/username","epi/string","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(lang,_2fd,_2fe,_2ff,_300,_301,misc,_302,_303,_304){var _305={defaultIconClass:"epi-iconObjectUnknown",thumbnail:function(_306){var _307="<image src=\"{0}?{1}\" class=\"epi-floatLeft epi-thumbnail\"/>";return _306?lang.replace(_307,[_306,new Date().getTime()]):"";},contentIcon:function(_308,_309){var _30a=_302.getValue(_308,"iconClass");var _30b=_30a+" epi-objectIcon";if(_309){_30b+=" "+_309;}return misc.icon(_30b);},contentTypeDescription:function(_30c){return _302.getResourceValue(_30c,"name",false);},languageBranch:function(_30d){return _30d?"<span class=\"epi-missingLanguageIndicator\">"+_30d.language+"</span>":"";},menu:function(_30e){return lang.replace("<span class=\"dijitInline dijitIcon epi-iconContextMenu epi-floatRight\" title=\"{title}\">&nbsp;</span>",_30e);},path:function(path){if(path&&path.length){var _30f=misc.attributeEncode(path.join(" > "));path=_300.truncateMiddle(path,40,"…");var text=path.map(misc.htmlEncode).join("<span class=\"epi-breadCrumbsSeparator\">&gt;</span>");return lang.replace("<span class=\"dgrid-column-treePath dojoxEllipsis\" title=\"{title}\">{text}</span>",{title:_30f,text:text});}return "";},userName:function(_310){return _2ff.toUserFriendlyHtml(_310);},localizedDate:function(date){return _2fe.toUserFriendlyHtml(date);},friendlyBoolean:function(_311){var _312=_311?"epi-iconCheckmark":"epi-iconStop";return "<div class=\""+_312+"\" />";},versionStatus:function(_313){return _303.getVersionStatus(_313);},commonDraft:function(item,_314,node){if(item.isCommonDraft){node.innerHTML="<span class=\"dijitReset dijitInline dijitIcon epi-iconPrimary epi-floatRight\" title=\""+_304.primarydraft+"\"></span>";}node.innerHTML+=_305.versionStatus(_314);},visibleLink:function(_315,_316){if(!_315){return "";}var text=!_316?misc.htmlEncode(_315):_315;return "<span class=\"epi-visibleLink\">"+text+"</span>";},secondaryText:function(_317,_318){if(!_317){return "";}var text=!_318?misc.htmlEncode(_317):_317;return "<span class=\"epi-secondaryText\">"+text+"</span>";},contentItemFactory:function(_319,_31a,_31b,_31c,_31d,_31e,_31f){return function(_320,_321,node,_322){var _323,_324,text,_325,_326,_327,_328;function get(name){if(typeof _321.get==="function"){return _321.get(name);}return _321[name];};function _329(_32a){if(_32a){if(typeof _32a==="function"){return _32a(_321);}else{return get(_32a);}}return _320;};_327=typeof _320==="string";_324=_329(_31b||(_327?false:"typeIdentifier"));text=_329(_319||(_327?false:"text"));_325=_329(_31a||(_327?false:"title"));_326=(_31e&&_329(_31e))||_321.missingLanguageBranch;_328=_31d&&_329(_31d);_323=_305.contentItem(_324,_326,text,_325,_31c,_328,_31f);node.innerHTML=_323;if(node.nodeName!=="TD"&&_326){_2fd.add(node,"epi-ct-missingLanguageRow");}return _323;};},contentItem:function(_32b,_32c,text,_32d,_32e,_32f,_330){var menu=(_32e&&_32e.hasMenu)?_305.menu(_32e.settings):"",_331=_305.languageBranch(_32c);_330=(_330===null||_330===undefined)?true:_330;_32d=_330?misc.attributeEncode(_32d||text):(_32d||text);text=_330?misc.htmlEncode(text):text;return (_32f?_305.thumbnail(_32f):_305.contentIcon(_32b))+menu+_331+misc.ellipsis(text,_32d);}};_301.addFormatter("contentIcon",_305.contentIcon);_301.addFormatter("userName",_305.userName);_301.addFormatter("versionStatus",_305.versionStatus);_301.addFormatter("localizedDate",_305.localizedDate);_301.addFormatter("contentItem",_305.contentItemFactory,true);return _305;});},"epi/username":function(){define("epi/username",["dojox/html/entities","epi/dependency","epi/i18n!epi/shell/ui/nls/episerver.shared.text"],function(_332,_333,_334){return {toUserFriendlyString:function(_335,_336,_337,_338,_339){if(!_336){_336=this._getCurrentUsername();}var _33a=_338?"":_334.installer,_33b=_339?_334.yousubject:_334.youobject,_33c=_335&&_336.toLowerCase()===_335.toLowerCase()?_33b:_335||_33a;if(_337){_33c=_33c.charAt(0).toUpperCase()+_33c.slice(1);}return _33c;},toUserFriendlyHtml:function(_33d,_33e,_33f,_340,_341){var _342=this.toUserFriendlyString(_33d,_33e,_33f,_340,_341);if(_342===""){return _342;}return "<span class='epi-username'>"+_332.encode(_342)+"</span>";},_getCurrentUsername:function(){if(!this.currentUsername){var _343=_333.resolve("epi.shell.Profile");this.currentUsername=_343.get("userName");}return this.currentUsername;}};});},"epi/shell/dgrid/Formatter":function(){define("epi/shell/dgrid/Formatter",["dojo/_base/declare","dojo/_base/array","dojo/when","dgrid/Grid","epi/shell/dgrid/TemplateColumn"],function(_344,_345,when,Grid,_346){var _347=_344(null,{_isGrid:false,configStructure:function(){this.inherited(arguments);this._isGrid=this instanceof Grid;if(this._isGrid){this._setupTemplateColumns();}else{this._setupList();}},_setupTemplateColumns:function(){if(!this.subRows){return;}var _348;_345.forEach(this.subRows,function(_349){_345.forEach(_349,function(_34a){_348=[];_345.forEach(_347.shorthands,function(_34b){var _34c=_34a[_34b],_34d=_347.formatters[_34b];if(!!_34c){if(_34d){_348.push(_34d.isFactory?_34d.handler(_34c):_34d.handler);}else{throw new Error("Formatter with key "+_34b+" not found");}}});if(_34a.formatters){this._findFormatters(_34a.formatters,_348);}if(_348.length>0){_34a=_346(_34a,_348);}},this);},this);},_setupList:function(){if(this.formatters){this._resolvedFormatters=this._findFormatters(this.formatters);}else{if(this.field){this._resolvedFormatters=[function(data,_34e,row){return data;}];}}},renderRow:function(_34f,_350){if(this._isGrid){return this.inherited(arguments);}var row=this.inherited(arguments,["",_350]),data=this.field?_34f[this.field]:_34f,_351=this._resolvedFormatters,i=-1;function _352(_353){var _354=_351[i],_355;if(_354){row.innerHTML=_353;data=_353;}i++;if(_351.length>i){_354=_351[i];_355=_354(data,_34f,row);when(_355,_352);}};if(_351.length>0){_352();}return row;},_findFormatters:function(_356,_357){_357=_357||[];_345.forEach(_356,function(_358){var type=typeof _358,item,_359;if(type==="string"){item=_347.formatters[_358];if(item){_359=item.isFactory?item.handler():item.handler;_359.allParameters=item.allParameters;}}else{if(type==="function"){_359=_358;}}if(_359){_357.push(_359);}else{throw new Error("Formatter with key "+_358+"not found");}});return _357;}});_347.formatters={};_347.shorthands=[];_347.addFormatter=function(name,_35a,_35b,_35c){_347.formatters[name]={handler:_35a,isFactory:!!_35b};if(_35c){_347.shorthands.push(name);}};return _347;});},"epi/shell/dgrid/TemplateColumn":function(){define("epi/shell/dgrid/TemplateColumn",["dojo/_base/array"],function(_35d){return function(_35e,_35f){var _360=_35e.renderCell;_35e.formatters=_35f||_35e.formatters;if(_35e.formatters&&_35e.formatters.length>0){_35e.renderCell=function(_361,_362,cell,_363){_35d.forEach(_35e.formatters,function(_364){_362=_364(_362,_361,cell,_363);});if(_362){cell.innerHTML=_362;}};}return _360?_360.call(_35e):_35e;};});},"epi/shell/dgrid/util/misc":function(){require({cache:{"url:dojox/html/resources/ellipsis.css":".dojoxEllipsis,.dojoxEllipsisShown {white-space: nowrap; width: 100%; overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; -webkit-text-overflow: ellipsis;}.dojoxEllipsis window {width:100%; -moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsis description{-moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsisIFrame{white-space: normal; border: none; width: 100%; display: block; height: 1px; margin-top: -1px; clear: both;}.dojoxEllipsisContainer{width: 100%;}.dojoxEllipsisShown:after{content: \"\\2026\"}"}});define("epi/shell/dgrid/util/misc",["dojo/_base/declare","dojo/_base/lang","dojox/html/entities","epi/shell/dgrid/Formatter","dojo/text!dojox/html/resources/ellipsis.css"],function(_365,lang,_366,_367,_368){var _369={_attributeEncodeMap:[["&","amp"],["\"","quot"]],htmlEncode:function(text){return _366.encode(text);},attributeEncode:function(text){return _366.encode(text,_369._attributeEncodeMap);},ellipsis:function(text,_36a){if(!_36a||!lang.isString(_36a)){_36a=text;}return lang.replace("<div class=\"dojoxEllipsis\" title=\"{0}\">{1}</div>",[_36a,text]);},ellipsisNoTooltip:function(text){return lang.replace("<div class=\"dojoxEllipsis\">{0}</div>",[text]);},icon:function(icon,text){text=text||"";return lang.replace("<span class=\"dijitInline dijitIcon {0}\"></span>{1}",[icon,text]);}};_367.addFormatter("htmlEncode",_369.htmlEncode,false,true);_367.addFormatter("icon",function(icon){return function(_36b){return _369.icon(icon,_36b);};},true,true);_367.addFormatter("ellipsis",_369.ellipsis,false,true);_367.addFormatter("ellipsisNoTooltip",_369.ellipsisNoTooltip,false,true);return _369;});},"url:dojox/html/resources/ellipsis.css":".dojoxEllipsis,.dojoxEllipsisShown {white-space: nowrap; width: 100%; overflow: hidden; text-overflow: ellipsis; -o-text-overflow: ellipsis; -webkit-text-overflow: ellipsis;}.dojoxEllipsis window {width:100%; -moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsis description{-moz-user-focus:normal; -moz-user-select:text;}.dojoxEllipsisIFrame{white-space: normal; border: none; width: 100%; display: block; height: 1px; margin-top: -1px; clear: both;}.dojoxEllipsisContainer{width: 100%;}.dojoxEllipsisShown:after{content: \"\\2026\"}","epi-cms/widget/_GridWidgetBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/keys","dojo/topic","dojo/when","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dijit/layout/_LayoutWidget","epi","epi/datetime","epi/UriParser","epi/username","epi/shell/dgrid/Formatter","epi/shell/TypeDescriptorManager","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi/dependency"],function(_36c,lang,_36d,_36e,keys,_36f,when,_370,_371,_372,_373,epi,_374,_375,_376,_377,_378,_379,_37a,DnD,_37b,_37c,_37d){return _36c([_373,_379],{_gridClass:_36c([_371,_377,_372,DnD,_370,_37c]),storeKeyName:null,grid:null,store:null,ignoreVersionWhenComparingLinks:true,trackActiveItem:true,defaultGridMixin:null,currentItem:null,contextChangeEvent:"click",postMixInProperties:function(){this.inherited(arguments);this.defaultGridMixin={selectionMode:"single",dndParams:{creator:lang.hitch(this,this._dndNodeCreator),copyOnly:true,selfAccept:false}};if(!this.store&&this.storeKeyName){var _37e=_37d.resolve("epi.storeregistry");this.store=_37e.get(this.storeKeyName);}},startup:function(){this.inherited(arguments);if(this.contextChangeEvent){var _37f=lang.hitch(this,"_onChangeContext");this.grid.on(".dgrid-row:"+this.contextChangeEvent,_37f);if(typeof this.grid.addKeyHandler=="function"){this.grid.addKeyHandler(keys.ENTER,_37f);this.grid.addKeyHandler(keys.SPACE,_37f);}}this.grid.on("dgrid-select",lang.hitch(this,"_onSelect"));this.grid.on("dgrid-error",lang.hitch(this,"_onError"));if(this.trackActiveItem){this.own(_36d.after(this.grid,"insertRow",lang.hitch(this,this._selectActiveItem)));}this.own(this.connect(this,"layout",lang.hitch(this,function(){this.grid.resize();})));this.grid.startup();},destroy:function(){if(this.grid){this.grid.destroy();}this.inherited(arguments);},select:function(item){this.grid.clearSelection();if(item){var _380=(item instanceof _37a?item:new _37a(item.id)).createVersionUnspecificReference().toString();this.grid.select(_380);}},_forceKeepContext:function(uri){return this._isSameAsCurrentContext(uri);},_onChangeContext:function(e){this._onChangeContextInternal(e);},_onChangeContextInternal:function(e){var row=this.grid.row(e),uri=row.data.uri,_381={uri:uri};if(this._forceKeepContext(uri)){return;}this._requestNewContext(_381,{sender:this});},_onSelect:function(e){},_onError:function(e){var _382=this.grid.errorMessage;var _383=e.error;if(_383.status&&_383.status===403){_382=epi.resources.messages.nopermissiontoviewdata;}this._showErrorMessage(_382);},_requestNewContext:function(_384,_385){_36f.publish("/epi/shell/context/request",_384,_385);},restore:function(){this.resize();},_isActiveItem:function(row){return when(this.getCurrentContext(),lang.hitch(this,function(_386){var _387=row.data.uri;return _386&&this._compareUris(_387,_386.uri);}));},_selectActiveItem:function(node){var row=this.grid.row(node);if(!row){return node;}when(this._isActiveItem(row),lang.hitch(this,function(_388){if(_388){if(this.grid.selectionMode==="single"){this.grid.clearSelection();}this.grid.select(row,null);}}));return node;},contextChanged:function(_389,_38a){this.inherited(arguments);if(_389.type!=="epi.cms.contentdata"){return;}if(!_38a||_38a.sender!==this){this.onContextChanged(_389);}},onContextChanged:function(_38b){this.fetchData();},fetchData:function(){},_showErrorMessage:function(_38c){this.grid.cleanup();this.grid.contentNode.innerHTML=_38c||"";},contextChangeFailed:function(_38d,_38e,_38f){this.inherited(arguments);if(_38f&&_38f.sender===this){this._selectActiveItem();}},_renderContentItem:function(_390,_391,node,_392){node.innerHTML=_37b.contentItem(_390.typeIdentifier,_390.missingLanguageBranch,_391);},_localizeDate:function(_393){return _37b.localizedDate(_393);},_createUserFriendlyUsername:function(name){return _37b.userName(name);},_dndNodeCreator:function(item,hint){var _394=_378.getAndConcatenateValues(item.typeIdentifier,"dndTypes");if(!_394&&this.dndTypes){_394=this.dndTypes;}var node=_36e.create("div").appendChild(document.createTextNode(item.name));return {node:node,type:_394,data:item};},_aroundInsertRow:function(_395){return lang.hitch(this,function(_396,_397,_398,i,_399){var row=_395.apply(this.grid,arguments);var _39a=this.get("currentItem");if(_39a){var _39b=(_39a instanceof _37a?_39a:new _37a(_39a.id)).createVersionUnspecificReference().toString();if(_39b===_396.contentLink){this.select(_39a);}}return row;});},_getCurrentItem:function(){return when(this.getCurrentContext(),function(_39c){return {id:(new _37a(_39c.id)).id};});}});});},"epi-cms/dgrid/DnD":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/NodeList","epi/shell/dnd/Source","dojo/dom-construct","epi/dependency","epi/shell/TypeDescriptorManager","put-selector/put"],function(_39d,lang,_39e,_39f,_3a0,_3a1,_3a2,put){var _3a3=_39d(_39f,{_legalMouseDown:function(evt){var _3a4=this.inherited(arguments);return _3a4&&evt.target!==this.grid.bodyNode;},getSelectedNodes:function(){var grid=this.grid;var _3a5=this.inherited(arguments);if(!grid.selection||Object.keys(grid.selection).length===0){if(_3a5.length){grid.select(_3a5[0]);}return _3a5;}var _3a6=false;var _3a7=new _39e();for(var id in grid.selection){if(grid.row(id).element!==_3a5[0]){_3a7.push(grid.row(id).element);}else{_3a6=true;_3a7.push(_3a5[0]);}}if(_3a6){return _3a7;}grid.clearSelection();if(_3a5.length){grid.select(_3a5[0]);}return _3a5;},destroy:function(){this.grid=null;this.inherited(arguments);}});return _39d([],{dndSourceTypes:null,dndParams:null,dndConstructor:_3a3,dndDisabled:false,dndFormatSuffix:null,postCreate:function(){this.inherited(arguments);if(!this.dndDisabled){this._setupDnD();}},destroy:function(){this.inherited(arguments);this.dndSource&&this.dndSource.destroy();this.dndParams=this.dndSource=null;},insertRow:function(_3a8){var row=this.inherited(arguments);if(this.dndDisabled){return row;}put(row,".dojoDndItem");this._setupDnD();var opts={};if(this.query){opts.oldParentItem={contentLink:this.query.referenceId};}this.dndSource.setItem(row.id,{data:_3a8,type:this._getDndType(_3a8),options:opts});return row;},_getDndType:function(_3a9){var _3aa=_3a2.getAndConcatenateValues(_3a9.typeIdentifier,"dndTypes");if((!_3aa||_3aa.length<=0)&&this.dndSourceTypes){_3aa=this.dndSourceTypes;}if(this.dndFormatSuffix){_3aa=_3aa.map(lang.hitch(this,function(type){return type+"."+this.dndFormatSuffix;}));}return _3aa;},_setupDnD:function(){if(this.dndSource){return;}if(!this.dndParams.creator){this.dndParams.creator=lang.hitch(this,this._dndNodeCreator);}this.dndSource=new this.dndConstructor(this.bodyNode,lang.mixin(this.dndParams,{grid:this,dropParent:this.contentNode}));this.dndSource.singular=true;},_dndNodeCreator:function(item,hint){var _3ab,node;_3ab=this._getDndType(item);if(!_3ab&&this.dndTypes){_3ab=this.dndTypes;}node=_3a0.create("div").appendChild(document.createTextNode(item.name));return {node:node,type:_3ab,data:item};}});});},"epi-cms/dgrid/WithContextMenu":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/query","dgrid/extensions/DijitRegistry","epi/shell/DestroyableByKey","epi/shell/widget/ContextMenu","epi-cms/extension/events"],function(_3ac,_3ad,_3ae,_3af,on,_3b0,_3b1,_3b2,_3b3,_3b4){return _3ac([_3b2,_3b1],{contextMenu:null,commandCategory:"context",stopPropagation:false,_contextMenuClass:"epi-iconContextMenu",postCreate:function(){this.inherited(arguments);this.contextMenu=this.contextMenu||new _3b3({category:this.commandCategory,popupParent:this});this.own(this.contextMenu,this.on("."+this._contextMenuClass+":click",this._contextMouseHandler.bind(this)),this.on(on.selector(".dgrid-row",_3b4.keys.shiftf10),this._contextKeyHandler.bind(this)));},startup:function(){this.inherited(arguments);this.contextMenu.startup();},onContextMenuClick:function(e){on.emit(e.target,"dgrid-contextmenu",{bubbles:true});this.contextMenu.scheduleOpen(this.domNode,null,{x:e.pageX,y:e.pageY});},_extendedSelectionHandler:function(e,_3b5){var _3b6=new RegExp("\\b"+this._contextMenuClass+"\\b");if(_3b6.test(e.target.className)&&this.isSelected(_3b5)){return;}this.inherited(arguments);},_isNodeVisible:function(_3b7){if(!_3b7){return false;}var _3b8=_3af.get(_3b7);return _3b8.display!=="none"&&_3b8.visibility!=="hidden";},_contextMouseHandler:function(e){if(this.stopPropagation){e.stopImmediatePropagation();e.stopPropagation();}this.onContextMenuClick(e);},_contextKeyHandler:function(e){var _3b9=_3b0("."+this._contextMenuClass,e.target)[0],_3ba;if(!this._isNodeVisible(_3b9)){return;}e.stopPropagation();e.preventDefault();_3ba=_3ae.position(_3b9);this.onContextMenuClick({target:_3b9,pageX:_3ba.x,pageY:_3ba.y});}});});},"epi/shell/widget/ContextMenu":function(){define("epi/shell/widget/ContextMenu",["dojo/_base/declare","dojo/aspect","dijit/Menu","dijit/popup","epi/shell/command/_CommandConsumerMixin","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/MenuBuilder","epi/shell/command/builder/MenuWithSeparatorBuilder"],function(_3bb,_3bc,Menu,_3bd,_3be,_3bf,_3c0,_3c1){var _3c2;_3bc.before(_3bd,"open",function(args){var _3c3=args.popup;if(_3c3&&_3c3 instanceof _3c2&&_3c3.popupParent){args.parent=_3c3.popupParent;return [args];}});return _3c2=_3bb([Menu,_3be],{category:null,leftClickToOpen:true,postCreate:function(){this.inherited(arguments);var _3c4={builder:new _3c0(),target:this,category:this.category},_3c5;var _3c6=[_3c4,{builder:new _3c1(),target:this,category:"menuWithSeparator"},{builder:new _3c0(),target:this,category:"popup"}];_3c5=new _3bf({configuration:_3c6,commandSource:this});_3c5.build();},scheduleOpen:function(_3c7,_3c8,_3c9,_3ca){this._scheduleOpen(_3c7,_3c8,_3c9,_3ca);}});});},"epi/shell/command/builder/MenuWithSeparatorBuilder":function(){define("epi/shell/command/builder/MenuWithSeparatorBuilder",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/MenuSeparator","./MenuBuilder"],function(_3cb,_3cc,lang,on,_3cd,_3ce){return _3cc([_3ce],{_addToContainer:function(_3cf,_3d0){this.inherited(arguments,[_3cf,_3d0]);var _3d1=new _3cd({_command:{order:_3cf._command.order}});this.inherited(arguments,[_3d1,_3d0]);}});});},"epi-cms/extension/events":function(){define(["dojo/keys","dojo/on"],function(keys,on){function _3d2(e){return e.keyCode===keys.DELETE;};function _3d3(e){return e.shiftKey;};function _3d4(e){return e.keyCode===keys.F10;};function _3d5(e){return _3d3(e)&&_3d4(e);};function _3d6(type,_3d7){var _3d8=function(node,_3d9){return on(node,type,function(evt){if(_3d7){return _3d7(evt,_3d9);}return _3d9.call(this,evt);});};return _3d8;};return {selector:on.selector,contextmenu:_3d6("contextmenu",function(e,_3da){_3da.call(this,e);}),keys:{shiftf10:_3d6("keyup",function(e,_3db){if(_3d5(e)){_3db.call(this,e);}}),del:_3d6("keydown",function(e,_3dc){if(_3d2(e)){_3dc.call(this,e);}})}};});},"url:epi-cms/widget/templates/ContentReferences.html":"<div class=\"epi-contentReferences\">\n    <div data-dojo-attach-point=\"contentReferencesNotificationBar\" class=\"epi-notificationBar epi-notificationBarWithBorders epi-notificationBarItem\">\n        <div data-dojo-attach-point=\"contentReferencesNotificationNode\" class=\"epi-notificationBarText\" ></div>\n    </div>\n    <div class=\"epi-captionPanel\" data-dojo-attach-point=\"captionPanelNode\">\n        <strong data-dojo-attach-point=\"totalLinksNode\"></strong>\n        <div class=\"epi-floatRight\">\n            <button class=\"epi-chromelessButton\"\n                    data-dojo-type=\"dijit/form/Button\"\n                    data-dojo-attach-event=\"onClick:fetchData\"\n                    data-dojo-props=\"iconClass:'epi-iconReload'\">${res.buttons.refresh}</button>\n        </div>\n    </div>\n    <div data-dojo-attach-point=\"gridNode\"></div>\n</div>\n","epi-cms/widget/ContentForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi-cms/widget/ContentTreeStoreModel"],function(_3dd,_3de,lang,_3df,when,_3e0){return _3de([_3e0],{root:null,constructor:function(){this.root={id:"0",name:"ROOT"};},isRoot:function(_3e1){var _3e2=this.inherited(arguments);return _3e2||!!(_3e1&&this.roots&&(_3dd.indexOf(this.roots,this.getIdentity(_3e1))>=0));},getRoot:function(_3e3){_3e3(this.root);},mayHaveChildren:function(item){return item===this.root||this.inherited(arguments);},getChildren:function(_3e4,_3e5,_3e6){if(_3e4===this.root){var _3e7=_3dd.map(this.roots,function(item){return this.store.get(item);},this);when(_3df(_3e7),_3e5,_3e6);}else{this.inherited(arguments);}},getAncestors:function(item,_3e8){if(this.roots.some(function(_3e9){return this.getIdentity(item)===_3e9;},this)){_3e8([this.root]);return;}var root=this.root,_3ea=lang.hitch(this,function(_3eb){if(_3dd.some(this.roots,function(_3ec){return this.getIdentity(_3eb[0])===_3ec;},this)){_3eb.unshift(root);}_3e8(_3eb);});this.inherited(arguments,[item,_3ea]);},getIdentity:function(item){return (item===this.root)?this.root.id:this.inherited(arguments);},canCopy:function(item){return !this.isRoot(item)&&this.inherited(arguments);},canCut:function(item){return !this.isRoot(item)&&this.inherited(arguments);},canDelete:function(item){return !this.isTypeOfRoot(item)&&this.inherited(arguments);},canEdit:function(item){return !this.isRoot(item)&&this.inherited(arguments);}});});},"epi-cms/widget/ContentTreeStoreModel":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/promise/all","dojo/when","dojo/topic","epi","epi/dependency","epi/shell/_StatefulGetterSetterMixin","epi/shell/TypeDescriptorManager","epi/shell/_ContextMixin","epi/shell/ViewSettings","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/_HierarchicalModelMixin","epi-cms/widget/viewmodel/_UpdateableStoreModelMixin"],function(_3ed,_3ee,_3ef,lang,_3f0,_3f1,_3f2,when,_3f3,epi,_3f4,_3f5,_3f6,_3f7,_3f8,_3f9,_3fa,_3fb,_3fc,_3fd){return _3ef([_3f5,_3fc,_3fd,_3f7],{store:null,root:null,notAllowToDelete:null,notAllowToCopy:null,typeIdentifiers:null,showAllLanguages:true,getChildrenQuery:"getchildren",getRootChildrenQuery:null,_observers:null,_defaultDataStoreName:"epi.cms.content.light",additionalQueryOptions:{},createAsLocalAsset:false,autoSelectPastedItem:true,constructor:function(args){_3ef.safeMixin(this,args);this._observers={};this.store=this.store||_3f4.resolve("epi.storeregistry").get(this._defaultDataStoreName);this._queryOptions=lang.mixin({ignore:["query"],comparers:{typeIdentifiers:lang.hitch(this,function(_3fe,_3ff){return _3ed.some(_3fe,lang.hitch(this,function(item){return item===_3ff.typeIdentifier||_3f6.isBaseTypeIdentifier(_3ff.typeIdentifier,item);}));}),referenceId:function(_400,_401){return _3fb.compareIgnoreVersion(_400,_401.parentLink);},allLanguages:function(_402,_403){if(_402||!_403.currentLanguageBranch){return true;}return epi.areEqual(_3f9.currentContentLanguage,_403.currentLanguageBranch.languageId);}},sort:this._getSortSettings(this.typeIdentifiers)},this.additionalQueryOptions);var _404=_3ee.subscribe("/epi/cms/contentdata/updated",this,function(_405){this.store.refresh(_405.contentLink).then(lang.hitch(this,function(){if(_405.recursive){this.onItemChildrenReload(_405);}}));});var _406=_3ee.subscribe("/epi/cms/contentdata/childrenchanged",lang.hitch(this,this._childrenChanged));var _407=_3ee.subscribe("/epi/cms/contentdata/restored",this,function(_408){this._childrenChanged(_408);});var _409=_3f0.after(this.store,"onItemChanged",lang.hitch(this,function(id,item){this.onChange(item);}),true);this._handles=[_404,_406,_407,_409];},destroy:function(){for(var id in this._observers){this._observers[id].cancel();this._observers[id]=null;}if(this._handles){_3ed.forEach(this._handles,function(_40a){_40a.remove();});this._handles=null;}},isSupportedType:function(_40b){return _3ed.some(this.typeIdentifiers,function(type){return type===_40b||_3f6.isBaseTypeIdentifier(_40b,type);});},_setShowAllLanguagesAttr:function(_40c){this._set("showAllLanguages",_40c);this.onItemChildrenReload(this.root);},getRoot:function(_40d,_40e){if(lang.isArray(this.root)){_40d({});}else{when(this.store.get(this.root),_40d,_40e);}},mayHaveChildren:function(item){return item.hasChildren;},getChildren:function(_40f,_410){var id=this.getIdentity(_40f),_411=id===this.root,_412=_411&&this.getRootChildrenQuery?this.getRootChildrenQuery:this.getChildrenQuery,_413=this._createQuery({referenceId:id,query:_412}),_414=this.store.query(_413,this._queryOptions),_415=lang.hitch(this,function(item){this.onChange(item);when(this.store.query(_413,this._queryOptions),lang.hitch(this,function(_416){this.onChildrenChange(_40f,_416);}));});var _417=this._observers[id];if(_417){_417.cancel();delete this._observers[id];}this._observers[id]=_414.observe(_415,true);when(_414,_410);},_getSortSettings:function(_418){if(!_418){return {};}if(_418 instanceof String){_418=[_418];}var self=this,_419,_41a=[];_418.map(function(type){_419=_3f6.getValue(type,"sortKey");if(_419){_41a.push(_419.sortDescending?{attribute:_419.columnName,descending:true}:{attribute:_419.columnName});}});return _41a;},_createQuery:function(_41b,_41c){var _41d=this.typeIdentifiers&&(lang.isArray(this.typeIdentifiers)?this.typeIdentifiers:this.typeIdentifiers.split(","));var _41e=this.showAllLanguages?{allLanguages:true}:{},_41f=_41c?{}:{typeIdentifiers:_41d};var _420=lang.mixin(_41b,_41f,_41e);return _420;},_createChildrenQuery:function(_421,_422){var _423=lang.mixin(_421,{query:"getchildren"});return this._createQuery(_423,_422);},move:function(_424,_425){if(!_425.contentLink){_425=this.store.get(_425);}var _426=_3ed.map(_424,function(item){return when(this.store.get(item.data.parentLink),lang.hitch(this,function(_427){return this.pasteItem(item.data,_427,_425,false);}));},this);return _3f2(_426).then(lang.hitch(this,function(_428){if(_425.contentLink===_3f9.wastebasketPage){var _429=_424.filter(function(i,_42a){return !!_428[_42a];});if(_429.length){this.onDeleted(_429);}}}));},remove:function(_42b){var _42c=_42b.map(function(item){return this.store.remove(item.data.contentLink);},this);return _3f2(_42c).then(lang.hitch(this,function(){this.onDeleted(_42b);}));},copy:function(_42d,_42e){var _42f=_3ed.map(_42d,function(item){return when(this.store.get(item.data.parentLink),lang.hitch(this,function(_430){return this.pasteItem(item.data,_430,_42e,true);}));},this);return _3f2(_42f);},pasteItem:function(_431,_432,_433,copy,_434){var id=this.getIdentity(_431),_435=_433&&_433.isWastebasket,_436=copy?this.store.copy:this.store.move,_437={targetId:this.getIdentity(_433),createAsLocalAsset:this.createAsLocalAsset,sortIndex:_434};return _436.call(this.store,id,_437).then(lang.hitch(this,function(_438){if(_435){this.onDelete(_431,true);}else{_3f3.publish("/epi/cms/contentdata/childrenchanged",_433.contentLink);}var _439=copy?_438.extraInformation:_431.contentLink;var _43a=_3fb.toContentReference(_439).createVersionUnspecificReference().toString();return when(this.store.refresh(_43a),lang.hitch(this,function(item){this._onPasteComplete(item,copy,_435,_432,_433);return _438;}));}));},onPasteComplete:function(){},_onPasteComplete:function(item,copy,_43b,_43c,_43d){this.onPasteComplete();this._selectItemOnPasteComplete(item,copy,_43b,_43c,_43d);this.inherited(arguments);},_selectItemOnPasteComplete:function(item,copy,_43e,_43f,_440){if(this.autoSelectPastedItem&&item&&item.contentLink&&!_43e){this.onSelect(item.contentLink,true);}},newItem:function(args,_441){if(args.dndData&&args.dndData.data){var _442=this.getParentItem(args.dndData);this._pasteNewItem(args.dndData.data,_442,_441);}},getParentItem:function(_443){if(_443&&_443.data){var _444=_443.data["parentLink"];if(_444){_444=new _3fb(_444).createVersionUnspecificReference().toString();}return {contentLink:_444};}},_pasteNewItem:function(_445,_446,_447){this.pasteItem(_445,_446,_447,false);},_updateItemChanged:function(_448){when(this.store.refresh(_448),lang.hitch(this,function(_449){this._childrenChanged(_449);}));},_childrenChanged:function(_44a){var dfd=new _3f1();this.getChildren(_44a,lang.hitch(this,function(_44b){this.onChildrenChange(_44a,_44b);dfd.resolve(_44b);}));return dfd;},_isNodeAContextAncestor:function(_44c,_44d){var dfd=new _3f1();this.getAncestors(_44d,function(arr){var _44e=arr.map(function(e){return e.contentLink;});var _44f=_44e.indexOf(_44c)!==-1||_3fb.compareIgnoreVersion(_44c,_44d.id);dfd.resolve(_44f);});return dfd;},getIdentity:function(item){if(lang.isObject(item)){return this.store.getIdentity(item);}return item;},getObjectIconClass:function(item,_450){var _451=_3f6.getValue(item.typeIdentifier,"iconClass");if(!_451){return _450;}var _452="";switch(parseInt(item.contentLink,10)){case _3f9.globalAssetsFolder:_452="AllSites";break;case _3f9.siteAssetsFolder:_452="ThisSite";break;default:break;}return (_452===""&&_451===_450)?_451:(_450+" "+_451+_452);},getLabel:function(item){return item.name;},canExpandTo:function(item){var _453=new _3f1();this.getAncestors(item,lang.hitch(this,function(_454){_453.resolve(this.getIdentity(_454[0])===this.root.id);}));return _453.promise;},canCopy:function(item){if(!item){return false;}var _455=item.contentLink,_456=_455===this.root||(_3ed.indexOf(this.notAllowToCopy,_455)>=0);return !_456&&_3fa.hasAccess(item.accessMask,_3fa.accessLevel.Read)&&_3fa.hasProviderCapability(item.providerCapabilityMask,_3fa.providerCapabilities.Copy);},canCut:function(item){if(!item){return false;}var _457=item.contentLink,_458=_457===this.root||(_3ed.indexOf(this.notAllowToDelete,_457)>=0);return !_458&&_3fa.isActionAvailable(item,_3fa.action.Delete,_3fa.providerCapabilities.Move,true);},canDelete:function(item){if(!item){return false;}var _459=item.contentLink,_45a=_459===this.root||(_3ed.indexOf(this.notAllowToDelete,_459)>=0);return !_45a&&_3fa.isActionAvailable(item,_3fa.action.Delete,_3fa.providerCapabilities.Delete,true);},canPaste:function(item,_45b,_45c){if(!item||!_45b){return false;}var _45d=_45c&&_45b.isWastebasket,_45e=!_45c&&(this.getIdentity(item)===this.getIdentity(_45b)),_45f=!_45c&&(item.parentLink===this.getIdentity(_45b)),_460=_3fa.isActionAvailable(_45b,_3fa.action.Create,_3fa.providerCapabilities.Create,true);return !_45b.isDeleted&&!_45d&&!_45e&&!_45f&&_460;},canEdit:function(item){if(!item){return false;}var _461=item.contentLink,_462=_461===this.root;return !_462&&_3fa.hasAccess(item.accessMask,_3fa.accessLevel.Edit);},onItemChildrenReload:function(_463){},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onDeleted:function(_464){var item=_464[0].data;if(item){when(this.getCurrentContext(),lang.hitch(this,function(ctx){var _465=item.capabilities.isPage;when(this._isNodeAContextAncestor(item.contentLink,ctx),lang.hitch(this,function(_466){if(_465&&!_466){return;}if(!_465&&_466){_3f3.publish("/epi/shell/context/request",{uri:_3f8.settings.defaultContext});return;}this.onSelect(item.parentLink,true);}));}));}},onSelect:function(item,_467,_468){}});});},"epi-cms/widget/_HierarchicalModelMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/_HierarchicalModelMixin"],function(_469,lang,_46a){return _469([_46a],{isTypeOfRoot:function(_46b){return !!(_46b&&(this.isRoot(_46b)||_46b.isSubRoot));},isRoot:function(_46c){return !!(_46c&&this.root&&_46c===this.root);}});});},"epi/shell/_HierarchicalModelMixin":function(){define("epi/shell/_HierarchicalModelMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when"],function(_46d,_46e,lang,_46f,all,when){return _46e([],{parentProperty:"parentLink",store:null,constructor:function(_470){_46e.safeMixin(this,_470);},getParentIdentity:function(item){return lang.getObject(this.parentProperty,false,item);},isAncestor:function(_471,_472){var _473=this.store.getIdentity(_471),_474=this.store.getIdentity(_472),_475=this.getParentIdentity(_472);if(_473==_474||(_472.parentLink&&_471.contentLink==_472.parentLink)){return true;}if(_475){return false;}return when(this.store.get(_475),lang.hitch(this,function(_476){return this.isAncestor(_471,_476);}));},getAncestors:function(item,_477){if(!this.store){_477([]);return;}var obj=typeof item==="object"?item:this.store.get(item);when(obj,lang.hitch(this,function(_478){when(this._getAncestors([_478]),_477);}));},_getAncestors:function(_479){if(this._hasRoot(_479)){return _479.slice(0,-1);}var _47a=this.getParentIdentity(_479[0]);if(!_47a){return _479.slice(0,-1);}return when(this.store.get(_47a),lang.hitch(this,function(_47b){if(_47b){_479.unshift(_47b);return this._getAncestors(_479);}return _479.slice(0,-1);}));},_hasRoot:function(_47c){var _47d=this.roots||[this.root];if(!_47c.length||!_47d.length||typeof this.getIdentity!=="function"){return false;}var _47e=this.getIdentity(_47c[0]);return _46d.some(_47d,function(root){return root==_47e;},this);},refreshAncestors:function(item,_47f){var _480=this.store,_481=new _46f(),_482=[],_483=[];this.getAncestors(item,function(_484){_46d.forEach(_484,function(_485){if(!_47f||_47f(_485)){_482.push(when(_480.refresh(_480.getIdentity(_485)),function(item){_483.push(item);}));}});all(_482).then(function(){_481.resolve(_483);});});return _481.promise;}});});},"epi-cms/widget/viewmodel/_UpdateableStoreModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/Evented","dojo/json","dojo/topic","dojo/when","epi/dependency","epi-cms/ApplicationSettings","epi-cms/_ContentContextMixin","epi-cms/core/ContentReference"],function(_486,_487,lang,_488,_489,json,_48a,when,_48b,_48c,_48d,_48e){return _487(_489,{updateableStore:null,updateableStoreKey:"epi.cms.contentdata",currentContentService:null,propertyNames:{name:"icontent_name",nameInUrl:"iroutable_routesegment"},refreshTranslatedAncestors:true,onAddDelegate:null,postscript:function(){this._setupStore();this.currentContentService=new _48d();},_setupStore:function(){if(!this.updateableStore&&this.updateableStoreKey){this.updateableStore=_48b.resolve("epi.storeregistry").get(this.updateableStoreKey);}},rename:function(id,name){var self=this,_48f=new _488();when(self.patch(id,{name:name,nameInUrl:null}),function(item){when(self.refreshTranslated(id),function(){_48f.resolve(item);},function(e){_48f.reject(e);});},function(e){_48f.reject(e);});return _48f;},translate:function(item){var self=this,id=self.getIdentity(item),_490={masterLanguageVersionId:id,name:item.name,contentTypeId:item.contentTypeID};return when(self.updateableStore.put(_490),function(){when(self.store.refresh(id),function(){when(self.refreshTranslated(id),function(){self.onSelect(id,true,self.onAddDelegate);});});});},add:function(item,_491){var self=this;var def=new _488();when(self.updateableStore.add(item),function(_492){var id=self.getContentId(_492),_493=self.getParentIdentity(item),_494=null;when(self.updateableStore.get(id),function(_495){if(self.getParentIdentity(_495)!==_493){_494=typeof _491=="function"&&_491();}when(_494,function(){when(self._childrenChanged(_493),function(){when(self.refreshTranslated(id),function(){self.onSelect(id,true,self.onAddDelegate);def.resolve(_495);});});});});});return def.promise;},patch:function(id,_496){var self=this,_497=new _488(),_498={id:id,properties:{}};for(var key in _496){if(_496.hasOwnProperty(key)){_498.properties[this._convertPropertyName(key)]=json.stringify(_496[key]);}}when(self.updateableStore.patch(_498,{id:_498.id}),function(item){if(item&&item.successful){var _499={contentLink:id,properties:_498.properties,capabilities:{supportsVersions:false}};lang.mixin(_499,_496);when(self.updateableStore.patchCache(_499),_497.resolve,_497.reject);}else{return _497.reject(item&&item.validationErrors);}});return _497;},_convertPropertyName:function(name){return this.propertyNames[name]||name;},refreshTranslated:function(_49a){var self=this,_49b=new _488(),_49c;function _49d(item){var id=self.getIdentity(item),_49e=self.getParentIdentity(item);if(_49e===self.root||id===self.root||!item.missingLanguageBranch){return false;}return true;};if(!self.refreshTranslatedAncestors){return _49b.resolve();}when(self.refreshAncestors(_49a,_49d),function(_49f){if(!(_49f instanceof Array)||_49f.length===0){_49b.resolve();return;}_49f.reverse();var _4a0=_486.some(_49f,function(item){if(!!item.missingLanguageBranch){_49c=self.getLabel(item);return true;}return false;});when(self.store.get(_49a),function(_4a1){if(_4a0&&_4a1&&!_4a1.missingLanguageBranch){self.emit("translationFailed",_49c);}_49b.resolve();});});return _49b;},getContentId:function(_4a2){return _48e.toContentReference(_4a2).id.toString();},_onPasteComplete:function(item,copy,_4a3,_4a4,_4a5){if(!item){return;}if(!_4a3){this.refreshTranslated(this.getIdentity(item));}else{this.currentContentService.getCurrentContent().then(lang.hitch(this,function(_4a6){var _4a7=_48e.compareIgnoreVersion(item,_4a6)&&_4a6.isDeleted;if(!_4a7){return;}var _4a8=this._createQuery({referenceId:this.getIdentity(_4a4),query:this.getChildrenQuery},true);when(this.store.query(_4a8,this._queryOptions),lang.hitch(this,function(_4a9){var _4aa=_4a4?_4a4.contentLink:null;if(!_4a9||!(_4a9 instanceof Array)||_4a9.length<=0){_4aa=_48c.startPage;}if(_4aa){var _4ab={uri:"epi.cms.contentdata:///"+_4aa};_48a.publish("/epi/shell/context/request",_4ab);}}));})).otherwise(function(){});}}});});},"epi-cms/widget/ContextualContentForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/promise/all","dojo/topic","dojo/when","epi/shell/TypeDescriptorManager","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel"],function(_4ac,_4ad,lang,_4ae,_4af,_4b0,_4b1,when,_4b2,_4b3,_4b4,_4b5){return _4ad([_4b5,_4b3],{handleSelection:null,previousSelection:null,postscript:function(){this.inherited(arguments);this._handles.push(_4b1.subscribe("/epi/cms/action/createlocalasset",lang.hitch(this,this.refreshRoots)));this._handles.push(_4b1.subscribe("/epi/cms/action/togglecreatemode",lang.hitch(this,this._toggleContextualContent)));this._handles.push(_4ae.around(this,"pasteItem",lang.hitch(this,this._aroundPasteItem)));this._handles.push(_4ae.after(this.store,"get",lang.hitch(this,this._afterStoreGet)));},contextChanged:function(_4b6,_4b7){this.inherited(arguments);this.refreshRoots();},getChildren:function(_4b8,_4b9,_4ba){if(_4b8===this.root){when(this._getRootItems(),_4b9,_4ba);}else{if(this.isPseudoContextualRoot(_4b8)){_4b9([]);return;}this.inherited(arguments);}},getAncestors:function(item,_4bb){var _4bc=this.getInherited(arguments),_4bd=_4bb;when(this.getCurrentContent()).then(lang.hitch(this,function(_4be){var _4bf=this.roots.concat(_4be.assetsFolderLink),_4c0=lang.hitch(this,function(_4c1){var _4c2;for(var i=_4c1.length-1;i>=0;i--){_4c2=_4c1[i];if(this.isContextualRoot(_4c2)){_4c1[i]=this.getContextualRoot(_4c2);}if(_4ac.indexOf(_4bf,this.getIdentity(_4c2))>=0){_4c1=_4c1.slice(i);_4c1.unshift(this.root);_4bb(_4c1);return;}}_4bb([this.root]);});if(_4ac.indexOf(_4bf,this.getIdentity(item))>=0){_4bb([this.root]);}_4bd=_4c0;})).always(lang.hitch(this,function(){_4bc.apply(this,[item,_4bd]);}));},getObjectIconClass:function(_4c3,_4c4){var _4c5=this._currentContext&&this._currentContext.dataType;if(!_4c5){return this.inherited(arguments);}var _4c6=_4b2.getValue(_4c5,"iconClass");return this.isContextualContent(_4c3)?(_4c6?_4c4+" "+_4c6+"Contextual":_4c4):this.inherited(arguments);},onToggleContentDisplay:function(_4c7,_4c8){},onRefreshRoots:function(_4c9){},refreshRoots:function(_4ca){if(_4ca===this){return true;}var self=this;return when(self._getRootItems(),function(_4cb){self.onChildrenChange(self.root,_4cb);if(self.get("handleSelection")===true){return self._setSelection(lang.clone(_4cb).pop());}});},canCopy:function(item){return this.isContextualContent(item)?false:this.inherited(arguments);},canCut:function(item){return this.isContextualContent(item)?false:this.inherited(arguments);},canPaste:function(item,_4cc,_4cd){var self=this,_4ce=this.inherited(arguments),_4cf=new _4af();if(_4cd){_4cf.resolve(_4ce);}else{self.getAncestors(_4cc,function(_4d0){var _4d1=self.isContextualContent(_4cc)||self.hasContextual(_4d0);if(_4d1){when(self.getCurrentContent()).then(function(_4d2){if(_4b4.compareIgnoreVersion(item.contentLink,_4d2.contentLink)){_4cf.resolve(false);}else{self.getAncestors(_4d2.contentLink,function(_4d3){var _4d4=_4ac.some(_4d3,function(_4d5){return item.contentLink===_4d5.contentLink;},this);_4cf.resolve(_4d4?false:_4ce);});}}).otherwise(function(){_4cf.resolve(false);});}else{_4cf.resolve(_4ce);}});}return _4cf.promise;},filterAncestors:function(_4d6){if(!(_4d6 instanceof Array)){return _4d6;}var _4d7=_4d6.indexOf(this._getPseudoContextualContent().toString());if(_4d7!==-1&&_4d7<_4d6.length-1){_4d6.splice(_4d7,1);}return _4d6;},_toggleContextualContent:function(_4d8){when(this.getCurrentContent(),lang.hitch(this,function(_4d9){this.onToggleContentDisplay(_4d9.assetsFolderLink,!_4d8);this._setSelection(null);}));},_setSelection:function(_4da){var _4db=this.roots.length>0?this.roots[0].toString():(!_4da?null:_4da.assetsFolderLink),_4dc=_4da!=null?_4da.contentLink:_4db,_4dd=this.get("previousSelection"),_4de=this.get("previousContextualSelection"),_4df=_4de&&_4de.selectedContent,_4e0=new _4af();if(!(_4dc&&_4dd)){_4e0.resolve();return _4e0.promise;}var _4e1=false,_4e2=_4dd.selectedContent,_4e3=_4dd.selectedAncestors,_4e4=_4e2.item&&!_4e2.item.contentLink;var _4e5=function(){_4e0.resolve();};if(_4e4||this.hasContextual(_4e3)){this.onSelect(_4dc,_4e1,_4e5);}else{if(_4e2.item.contentLink===_4db&&_4df&&_4df.item&&_4df.item.contentLink){this.onSelect(_4df.item.contentLink,_4e1,_4e5);}else{_4e0.resolve();}}return _4e0.promise;},getRoots:function(_4e6){var def=new _4af();var _4e7=this._getPseudoContextualContent().toString();var _4e8=function(_4e9){if(!_4e6){return true;}return _4e9!==_4e7;};var _4ea=function(_4eb){return _4eb.contentLink;};when(this._getRootItems(),function(_4ec){def.resolve(_4ec.map(_4ea).filter(_4e8));},def.reject);return def.promise;},_getRootItems:function(){var self=this,_4ed=self.store,_4ee=_4ac.map(self.roots,function(item){return _4ed.get(item);});var _4ef=when(_4b0([self.getCurrentContent(),self.getCurrentContext()]),function(_4f0){var _4f1=_4f0[0],_4f2=_4f0.length>1?_4f0[1]:null;var _4f3=new _4b4(_4f1.contentLink).createVersionUnspecificReference().toString();return when(_4ed.get(_4f3),function(_4f4){var _4f5=_4f2&&_4f2.currentMode==="create";if((_4f5&&self.get("view")==="contentselector")||!self.canHaveContextualContent(_4f4)){return null;}var _4f6=_4f4.assetsFolderLink;if(_4f6){var _4f7=function(_4f8){return when(_4ed.get(_4f8),function(_4f9){var _4fa={id:_4f9.contentLink,typeIdentifiers:self.typeIdentifiers,allLanguages:self.showAllLanguages};return when(_4ed.query(_4fa),function(_4fb){if(typeof self.isSupportedType==="function"&&!self.isSupportedType(_4fb.typeIdentifier)){return null;}if(!self.isPseudoContextualRoot(_4fb)){return self.getContextualRoot(_4fb);}else{return when(self.onRefreshRoots(_4fb),function(){return self._modifyContentAccess(_4fb,_4f4);});}});});};if(_4f6===self._getPseudoContextualContent().toString()){return when(_4ed.refresh(_4f3),function(_4fc){return _4f7(_4fc.assetsFolderLink);});}else{return _4f7(_4f6);}}return null;});},function(){return null;});_4ee.push(_4ef);return when(_4b0(_4ee),function(_4fd){return _4ac.filter(_4fd,Boolean);});},_aroundPasteItem:function(_4fe){var self=this;return function(_4ff,_500,_501,copy,_502){var _503=_501,_504=self.get("createAsLocalAsset");return when(self.getCurrentContent()).then(function(_505){if(!_504){_504=self.isPseudoContextualRoot(_503);self.set("createAsLocalAsset",_504);}_504&&(_503=_505);}).always(function(){return when(_4fe.apply(self,[_4ff,_500,_503,copy,_502]),function(_506){if(_504){self.set("createAsLocalAsset",false);return when(self.refreshRoots(),function(){_4b1.publish("/epi/cms/action/createlocalasset",self);return _506;});}else{return _506;}});});};},_afterStoreGet:function(_507){var self=this;return when(_507,function(_508){return when(self.getCurrentContent(),function(_509){return self._modifyContentAccess(_508,_509);},function(_50a){return _508;});});},_modifyContentAccess:function(_50b,_50c){if(this.isContextualContent(_50b)){var _50d=this.getContextualRoot(_50b);return this.isPseudoContextualRoot(_50b)?lang.mixin(_50d,{isPreferredLanguageAvailable:_50c.isPreferredLanguageAvailable,hasTranslationAccess:_50c.hasTranslationAccess,accessMask:_50c.accessRights}):_50d;}return _50b;}});});},"epi-cms/widget/SearchBox":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/json","dojo/_base/lang","dojo/when","dojo/dom-construct","dijit/_Widget","epi/shell/SearchManager","epi-cms/widget/ContentSearchBox"],function(_50e,_50f,json,lang,when,_510,_511,_512,_513){return _50e([_511],{area:null,searchRoots:null,filterOnCulture:null,triggerContextChange:true,_searchBox:null,_searchManager:null,innerSearchBoxClass:"",parameters:null,postCreate:function(){this.inherited(arguments);this._searchManager=new _512();when(this._searchManager.getStore(),lang.hitch(this,function(_514){this._searchBox=new _513({baseClass:this.innerSearchBoxClass,searchAttr:"searchQuery",store:_514});var _515=lang.mixin({filterOnDeleted:true},this.parameters);lang.mixin(this._searchBox.query,{parameters:json.toJson(_515)});this._searchBox.on("select",lang.hitch(this,function(_516){this._searchBox.set("value","");this._searchBox.focus();this._searchBox.toggleClearButton();this.onItemAction(_516);}));this.set("filterOnCulture",false);_510.place(this._searchBox.domNode,this.domNode);}));},_setAreaAttr:function(_517){this._set("area",_517);if(this._searchBox){when(this._searchManager.getProviderQuery(_517),lang.hitch(this,function(_518){lang.mixin(this._searchBox.query,_518);}));}},_setSearchRootsAttr:function(_519){this._set("searchRoots",_519);if(this._searchBox){lang.mixin(this._searchBox.query,{searchRoots:_519});}},_setFilterOnCultureAttr:function(_51a){this._set("filterOnCulture",_51a);if(this._searchBox){lang.mixin(this._searchBox.query,{filterOnCulture:_51a});}},onItemAction:function(item){if(this.triggerContextChange){var _51b={uri:"epi.cms.contentdata:///"+item.metadata.id};if(item.metadata.isUntranslatedContent==="false"){_51b.epslanguage=item.metadata.languageBranch;}_50f.publish("/epi/shell/context/request",[_51b,{sender:null}]);}}});});},"epi/shell/SearchManager":function(){define("epi/shell/SearchManager",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/array","dojo/_base/lang","dojo/DeferredList","epi/dependency"],function(_51c,_51d,_51e,lang,_51f,_520){return _51c(null,{_providersStore:null,_resultsStore:null,constructor:function(){this._setupStores();},getProviderQuery:function(area){var _521=new _51d();_51d.when(this.getProviders(area),lang.hitch(this,function(_522){if(_522&&_522.length>0){_521.resolve(this._getQuery(_522[0],{}));}else{_521.resolve();}}));return _521;},getProviders:function(area){var _523=new _51d();_51d.when(this._providersStore.query({searchArea:area}),function(_524){if(_524&&_524.length>0){_523.resolve(_524);}else{_523.resolve();}});return _523;},getStore:function(){return this._resultsStore;},search:function(area,_525){var _526=new _51d();_51d.when(this.getProviders(area),lang.hitch(this,function(_527){if(_527&&_527.length>0){var _528=[];_51e.forEach(_527,function(_529,_52a){_528.push(this._getData(_529,_525));},this);var _52b=new _51f(_528),data=[];_52b.then(function(_52c){_51e.forEach(_52c,function(item){if(lang.isArray(item[1])){data=data.concat(item[1]);}});_526.resolve(data);});}}));return _526;},_setupStores:function(){var _52d=_520.resolve("epi.storeregistry");this._providersStore=_52d.get("epi.shell.searchproviders");this._resultsStore=_52d.get("epi.shell.searchresults");},_getQuery:function(_52e,_52f){var _530={providerId:_52e.id};lang.mixin(_530,_52f||{});return _530;},_getData:function(_531,_532){var _533=new _51d();_51d.when(this._resultsStore.query(this._getQuery(_531,_532)),function(_534){if(_534&&_534.length>0){_533.resolve(_534);}else{_533.resolve();}});return _533;}});});},"epi-cms/widget/ContentSearchBox":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/aspect","dojo/Evented","dojo/keys","dojo/dom-attr","dojo/dom-style","epi/shell/widget/SuggestionBox","epi-cms/widget/SearchResultList","epi/i18n!epi/cms/nls/episerver.cms.widget.contentlist"],function(_535,lang,_536,_537,_538,keys,_539,_53a,_53b,_53c,_53d){return _535([_53b,_538],{res:_53d,autoComplete:false,dropDownClass:_53c,queryExpr:"${0}",minimumNumberOfChar:1,postCreate:function(){this.inherited(arguments);this.searchDelay=this.defaultDelay;this.on("beforeSearch",lang.hitch(this,function(){if(this.dropDown){this.dropDown.showStandby(true);}}));this.on("searchComplete",lang.hitch(this,function(_53e){if(this.dropDown){this.dropDown.showStandby(false);}}));_537.before(this,"_startSearch",function(_53f,args){this.emit("beforeSearch",{});return [_53f,args];});},_openResultList:function(_540,_541,_542){this.emit("searchComplete",_540);this._fetchHandle=null;this.dropDown.clearResultList();var _543=_540.length>0||_542.start!==0;this.dropDown.showErrorMessage(!_543,this.res.contentnotfound);this.dropDown.showGrid(_543);if(_543){this.dropDown.createOptions(_540,_542,lang.hitch(this,"_getMenuLabelFromItem"));}this._showResultList();},_onDropDownMouseDown:function(e){e.stopPropagation();},_onKey:function(evt){switch(evt.keyCode){case keys.ENTER:if(this.dropDown&&this.dropDown.selected){this.dropDown.handleKey(evt);this.closeDropDown();}else{if(!this._fetchHandle){this._startSearchFromInput();_536.stop(evt);}}break;case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:if(this.dropDown){this.dropDown.handleKey(evt);}_536.stop(evt);break;case keys.LEFT_ARROW:case keys.RIGHT_ARROW:break;default:this.inherited(arguments);}},_startSearchFromInput:function(){var key=this.focusNode.value;if(!key||key.length<this.minimumNumberOfChar){this.closeDropDown();return;}if(!this.dropDown){var _544=this.id+"_popup",_545=lang.isString(this.dropDownClass)?lang.getObject(this.dropDownClass,false):this.dropDownClass;this.dropDown=new _545({id:_544,dir:this.dir,textDir:this.textDir});_539.remove(this.textbox,"aria-activedescendant");_539.set(this.textbox,"area-owns",_544);this.dropDown.on("select",lang.hitch(this,function(_546){this.closeDropDown();this.emit("select",_546);}));_53a.set(this.dropDown.domNode,"width",this.textbox.clientWidth+"px");}this._showResultList();this._startSearch(key);},_startSearchAll:function(){}});});},"epi/shell/widget/SuggestionBox":function(){define("epi/shell/widget/SuggestionBox",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dijit/_HasDropDown","dijit/form/_ComboBoxMenu","dijit/form/_AutoCompleterMixin","epi/shell/widget/SearchBox"],function(_547,lang,_548,_549,_54a,_54b,_54c){return _547([_54c,_549,_54b],{dropDownClass:_54a,buildRendering:function(){this.inherited(arguments);_548.set(this.textbox,"autocomplete","off");_548.set(this.textbox,"aria-haspopup","true");},postCreate:function(){this.inherited(arguments);this.connect(this.clearButton,"onclick",lang.hitch(this,function(){this.closeDropDown();}));}});});},"epi/shell/widget/SearchBox":function(){require({cache:{"url:epi/shell/widget/templates/SearchBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox epi-searchInput epi-contentSearchBox\" id=\"widget_${id}\">\n    <span data-dojo-attach-point=\"clearButton\" class=\"dijitReset dijitRight epi-clearButton\" role=\"presentation\"></span>\n    <div class=\"dijitReset dijitInputField dijitInputContainer\">\n        <input data-dojo-attach-point=\"textbox,focusNode\" type=\"text\" class=\"dijitReset dijitInputInner\" role=\"textbox\" />\n        <span class=\"dijitPlaceHolder dijitInputField\" data-dojo-attach-point=\"_phspan,placeHolderNode\"></span>\n    </div>\n</div>"}});define("epi/shell/widget/SearchBox",["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/keys","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/focus","dijit/form/TextBox","dojox/html/entities","dgrid/util/misc","epi","dojo/text!./templates/SearchBox.html","epi/i18n!epi/shell/ui/nls/EPiServer.Shell.UI.Resources.SearchBox"],function(_54d,lang,_54e,_54f,_550,keys,_551,_552,_553,_554,_555,_556,_557,epi,_558,_559){return _54d([_555],{templateString:_558,placeHolder:epi.resources.action.search,commonRes:epi.resources,defaultDelay:500,encodeSearchText:false,triggerChangeOnEnter:true,postCreate:function(){this.inherited(arguments);_54e.set(this.clearButton,"title",_559.clear);this.connect(this.clearButton,"onclick",lang.hitch(this,this.clearValue));this.toggleClearButton();this.connect(this,"_onInput",_557.debounce(lang.hitch(this,function(_55a){this.toggleClearButton();this._valueChanged(_55a);}),null,this.defaultDelay));},clearValue:function(){this.set("value","");this.focus();this.toggleClearButton();this._valueChanged();},toggleClearButton:function(){_550.set(this.clearButton,"visibility",this.textbox.value?"visible":"hidden");},focus:function(){_554.focus(this.textbox);},_valueChanged:function(_55b){if(_55b&&_55b.charOrCode){switch(_55b.charOrCode){case keys.ESCAPE:this.clearValue();return;case keys.PAGE_DOWN:case keys.DOWN_ARROW:case keys.PAGE_UP:case keys.UP_ARROW:case keys.LEFT_ARROW:case keys.RIGHT_ARROW:case keys.TAB:return;}if(!this.triggerChangeOnEnter&&_55b.charOrCode===keys.ENTER){return;}}this.onSearchBoxChange(this.encodeSearchText?_556.encode(this.textbox.value):this.textbox.value);},onSearchBoxChange:function(_55c){}});});},"url:epi/shell/widget/templates/SearchBox.html":"<div class=\"dijit dijitReset dijitInline dijitLeft dijitTextBox epi-searchInput epi-contentSearchBox\" id=\"widget_${id}\">\n    <span data-dojo-attach-point=\"clearButton\" class=\"dijitReset dijitRight epi-clearButton\" role=\"presentation\"></span>\n    <div class=\"dijitReset dijitInputField dijitInputContainer\">\n        <input data-dojo-attach-point=\"textbox,focusNode\" type=\"text\" class=\"dijitReset dijitInputInner\" role=\"textbox\" />\n        <span class=\"dijitPlaceHolder dijitInputField\" data-dojo-attach-point=\"_phspan,placeHolderNode\"></span>\n    </div>\n</div>","epi-cms/widget/SearchResultList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojox/widget/Standby","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/form/_ListMouseMixin","dijit/form/_ComboBoxMenuMixin","epi/dependency","epi-cms/widget/_ContentListKeyMixin","epi-cms/widget/_ContentListMouseMixin","epi-cms/dgrid/formatters","epi/shell/dgrid/Formatter","dgrid/OnDemandList","dgrid/Selection","dgrid/Keyboard","dojo/text!./templates/SearchResultList.html"],function(_55d,lang,_55e,_55f,_560,_561,_562,_563,_564,_565,_566,_567,_568,_569,_56a,_56b,_56c,_56d,_56e,_56f){return _55d([_563,_564,_55e,_565,_566,_568,_569],{templateString:_56f,_standby:null,_messages:{nextMessage:"",previousMessage:""},postCreate:function(){this.inherited(arguments);var self=this,_570=_567.resolve("epi.shell.Profile"),_571=_55d([_56c,_56d,_56e,_56b]),_572=function(item){return item.title;},_573=function(item){return item.metadata.typeIdentifier;},_574=function(item){var _575=self.grid.domNode,_576="epi-thumbnailContentList";(item.metadata.thumbnailUrl&&!_560.contains(_575,_576))&&_560.add(_575,_576);return item.metadata.thumbnailUrl;},_577=function(item){if(item.metadata&&item.metadata.languageBranch!==_570.contentLanguage){return {language:item.metadata.languageBranch};}};this.grid=new _571({formatters:[_56a.contentItemFactory("title",_572,_573,null,_574,_577,false)],selectionMode:"single",cellNavigation:false});this.grid.set("showHeader",false);_55f.place(this.grid.domNode,this.containerNode);this.grid.on(".dgrid-row:click",lang.hitch(this,function(_578){var row=this.grid.row(_578);if(row){this._onSelect(row.data);}}));this._standby=new _562({target:this.domNode,color:"#fff"}).placeAt(document.body);this.own(this._standby);this.containerNode=this._getGridContainer();},startup:function(){this.inherited(arguments);this._standby.startup();},showStandby:function(show){if(!this._standby){return;}if(show){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},showGrid:function(show){_561.set(this.grid.domNode,"display",show?"block":"none");},_onSelect:function(_579){this.emit("select",_579);},_getGridContainer:function(){return this.grid.contentNode;},createOptions:function(_57a,_57b,_57c){this.grid.renderArray(_57a);return this.containerNode.childNodes;},clearResultList:function(){this.grid.refresh();},getHighlightedOption:function(){return null;},showErrorMessage:function(show,_57d){this.clearResultList();this.showStandby(false);if(show&&_57d){this.errorMessage.innerHTML=_57d;}_561.set(this.errorMessage,"display",show?"block":"none");}});});},"epi-cms/widget/_ContentListKeyMixin":function(){define(["dojo/_base/declare","dojo/keys"],function(_57e,keys){return _57e(null,{handleKey:function(evt){switch(evt.keyCode){case keys.DOWN_ARROW:this.selectNextNode();return false;case keys.UP_ARROW:this.selectPreviousNode();return false;case keys.ENTER:if(this.selected&&this.grid.row(this.selected)){this._onSelect(this.grid.row(this.selected).data);}return false;default:return true;}}});});},"epi-cms/widget/_ContentListMouseMixin":function(){define(["dojo/_base/declare","dojo/dom-class"],function(_57f,_580){return _57f(null,{onHover:function(node){},onUnhover:function(node){},onSelect:function(node){_580.add(node,"dgrid-selected ui-state-active dgrid-focus");},onDeselect:function(node){_580.remove(node,"dgrid-selected ui-state-active dgrid-focus");}});});},"url:epi-cms/widget/templates/SearchResultList.html":"<div class=\"epi-searchResultList\">\n    <div data-dojo-attach-point=\"containerNode\">\n        <div data-dojo-attach-point=\"errorMessage\" class=\"epi-searchResultListEmptyMessage\"></div>\n    </div>\n    <div class=\"dijitReset epi-searchResultListNavigation\">\n        <div data-dojo-attach-point=\"previousButton\" role=\"option\"></div>\n        <div data-dojo-attach-point=\"nextButton\" role=\"option\"></div>\n    </div>\n</div>","epi-cms/component/command/_GlobalToolbarCommandProvider":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/form/Button","epi/shell/command/_CommandProviderMixin"],function(_581,lang,_582,_583){return _581([_583],{addToLeading:function(_584,_585){this.addCommand(_584,_585);},addToCenter:function(_586,_587){_587=lang.mixin({category:"center"},_587);this.addCommand(_586,_587);},addToTrailing:function(_588,_589){_589=lang.mixin({category:"trailing"},_589);this.addCommand(_588,_589);},addCommand:function(_58a,_58b){_58b=lang.mixin({iconClass:_58a.iconClass,category:"leading",label:_58a.label,tooltip:_58a.tooltip,showLabel:false,widget:_582,model:_58a},_58b);_58a=lang.delegate(_58a,{settings:_58b});this.add("commands",_58a);}});});},"epi-cms/compare/command/CompareCommandProvider":function(){define(["dojo/_base/declare","epi-cms/component/command/_GlobalToolbarCommandProvider","./CompareSettingsModel","./CompareViewSelection","epi/shell/command/ToggleCommand","epi-cms/command/_NonEditViewCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.compare.command"],function(_58c,_58d,_58e,_58f,_590,_591,_592){var _593=_58c([_590,_591]);return _58c([_58d],{postscript:function(){this.inherited(arguments);var _594=new _58e();var _595={category:"compare"};this.add("commands",new _593({category:"compare",settings:_595,label:_592.togglecompare.label,iconClass:"epi-iconCompare",model:_594,property:"enabled"}));this.add("commands",new _58f({category:"compare",settings:_595,model:_594,label:_592.compareviewselection.label,optionsLabel:_592.compareviewselection.label,optionsProperty:"modeOptions",property:"mode"}));}});});},"epi-cms/compare/command/CompareSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/i18n!epi-cms/nls/episerver.cms.compare.mode"],function(_596,lang,_597,_598,when,_599,_59a,res){return _596([_598,_599],{enabled:false,mode:"allpropertiescompare",_selectedCompareModeProfileKey:"epi.selected-comparemode-id",modeOptions:[{label:res.allpropertiescompare,value:"allpropertiescompare",iconClass:"epi-iconForms"},{label:res.sidebysidecompare,value:"sidebysidecompare",iconClass:"epi-iconLayout"}],constructor:function(){var self=this;this.profile=this.profile||_59a.resolve("epi.shell.Profile");when(this._loadSelectedModeFromProfile(),lang.hitch(this,function(mode){if(mode){this.set("mode",mode);}}));this.own(_597.subscribe("/epi/shell/action/viewchanged",function(type,args,data){var view=data&&(data.viewName||(data.sender&&data.sender.viewName));var _59b=self.modeOptions.some(function(_59c){return _59c.value===view;});self.set("enabled",_59b,false);}),_597.subscribe("/epi/cms/action/switcheditmode",function(){self.set("enabled",false,false);}),_597.subscribe("/epi/cms/action/eyetoggle",function(_59d){if(_59d){self.set("enabled",false,false);_597.publish("/epi/shell/action/changeview/updatestate",{viewName:null});}}));},_enabledSetter:function(_59e,_59f){if(this.enabled!==_59e){this.enabled=_59e;(_59f!==false)&&this._onChange();}},_modeSetter:function(_5a0){if(this.mode!==_5a0){this.mode=_5a0;this.get("enabled")&&this._onChange();this.profile.set(this._selectedCompareModeProfileKey,_5a0,{location:"server"});}},_onChange:function(){_597.publish("/epi/shell/action/changeview",this.get("enabled")?this.get("mode"):null,null,{forceReload:true});},_loadSelectedModeFromProfile:function(){return when(this.profile.get(this._selectedCompareModeProfileKey),function(mode){if(!mode){return null;}return mode;});}});});},"epi-cms/compare/command/CompareViewSelection":function(){define(["dojo/_base/declare","epi/shell/command/OptionCommand"],function(_5a1,_5a2){return _5a1([_5a2],{_selectedSetter:function(_5a3){this.inherited(arguments);this.get("options").some(function(_5a4){if(_5a4.value===_5a3){this.set("iconClass",_5a4.iconClass);return true;}},this);}});});},"epi/shell/command/OptionCommand":function(){define("epi/shell/command/OptionCommand",["dojo/_base/declare","epi/shell/command/_Command","dijit/Destroyable"],function(_5a5,_5a6,_5a7){return _5a5([_5a6,_5a7],{options:null,optionsLabel:"",optionsProperty:null,selected:null,property:null,_execute:function(){this.model.set(this.property,this.selected);},_onModelChange:function(){var self=this,_5a8=this.model;this.set("canExecute",!!_5a8);if(_5a8){this.set("selected",this.model.get(this.property));this.own(_5a8.watch(this.property,function(name,_5a9,_5aa){self.set("selected",_5aa);}));}},_optionsGetter:function(){return this.options||(this.model&&this.optionsProperty&&this.model.get(this.optionsProperty));},_selectedSetter:function(_5ab){var _5ac=this.selected;this.selected=_5ab;if(_5ac!==_5ab){this.execute();}}});});},"epi-cms/command/_NonEditViewCommandMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dijit/Destroyable"],function(_5ad,lang,_5ae,_5af){return _5ad([_5af],{constructor:function(){this.own(_5ae.subscribe("/epi/shell/action/viewchanged",lang.hitch(this,"_viewChanged")));},_viewChanged:function(type,args,data){this.set("isAvailable",type==="epi-cms/contentediting/PageDataController"||type==="epi-cms/compare/views/CompareView");}});});},"epi-cms/notification/command/NotificationCommandProvider":function(){define(["dojo/_base/declare","epi-cms/component/command/_GlobalToolbarCommandProvider","epi-cms/notification/NotificationButton","epi-cms/notification/command/ViewNotifications"],function(_5b0,_5b1,_5b2,_5b3){return _5b0([_5b1],{postscript:function(){this.inherited(arguments);var _5b4={widget:_5b2,"class":"epi-chromeless"};this.addToTrailing(new _5b3(),_5b4);}});});},"epi-cms/notification/NotificationButton":function(){define(["dojo/_base/declare","dojo/on","epi/shell/widget/DeferredDropDownButton","epi/shell/widget/_ButtonBadgeMixin","./NotificationList"],function(_5b5,on,_5b6,_5b7,_5b8){return _5b5([_5b6,_5b7],{dropDownPosition:["below-alt","below"],showLabel:false,postMixInProperties:function(){this.inherited(arguments);if(this.modelBindingMap){this.modelBindingMap.badgeValue=["badgeValue"];}this.dropDown=this.dropDown||new _5b8();this.own(on(this.dropDown,"change",function(){this.closeDropDown(true);}.bind(this),true));}});});},"epi/shell/widget/DeferredDropDownButton":function(){define("epi/shell/widget/DeferredDropDownButton",["dojo/_base/declare","dijit/form/DropDownButton","epi/shell/widget/_HasDeferredDropDown"],function(_5b9,_5ba,_5bb){return _5b9([_5ba,_5bb]);});},"epi/shell/widget/_HasDeferredDropDown":function(){define("epi/shell/widget/_HasDeferredDropDown",["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","dijit/_HasDropDown"],function(_5bc,lang,_5bd,on,_5be){return _5bc([_5be],{_loaded:false,loadEvent:"loaded",isLoaded:function(){return this._loaded&&!!this.dropDown;},loadDropDown:function(){var self=this,_5bf=this.dropDown,_5c0=new _5bd();on.once(_5bf,this.loadEvent,function(){self._loaded=true;_5c0.resolve();});_5bf.startup();return _5c0.promise;},loadAndOpenDropDown:function(){var self=this,_5c1=this.dropDown;if(this.isLoaded()){return new _5bd().resolve(this.openDropDown());}return this.loadDropDown().then(function(){self.openDropDown();if(_5c1.focus){self.defer(lang.hitch(_5c1,"focus"),1);}});}});});},"epi/shell/widget/_ButtonBadgeMixin":function(){define("epi/shell/widget/_ButtonBadgeMixin",["dojo/_base/declare","dojo/dom-class","dojo/dom-attr"],function(_5c2,_5c3,_5c4){return _5c2(null,{badgeClass:"epi-badge-node",badgeValue:null,_setBadgeValueAttr:function(_5c5){this._set("badgeValue",_5c5);if(_5c5||_5c5===0){_5c3.add(this.iconNode,this.badgeClass);_5c4.set(this.iconNode,"badge-value",_5c5);}else{_5c3.remove(this.iconNode,this.badgeClass);}}});});},"epi-cms/notification/NotificationList":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/keys","dojo/on","./viewmodels/NotificationListViewModel","./notificationFormatter","dojo/text!./templates/NotificationList.html","epi/i18n!epi/cms/nls/episerver.cms.notification.list","dgrid/OnDemandList","dgrid/Keyboard","dgrid/Selection","epi/shell/dgrid/Focusable","epi/shell/dgrid/Formatter","epi-cms/dgrid/WithContextMenu","epi-cms/ApplicationSettings","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/MenuAssembler","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/Toolbar"],function(_5c6,_5c7,keys,on,_5c8,_5c9,_5ca,res,_5cb,_5cc,_5cd,_5ce,_5cf,_5d0,_5d1,_5d2,_5d3,_5d4,_5d5,_5d6){return _5c7([_5d4,_5d5,_5d6],{templateString:_5ca,_listClass:_5c7([_5cb,_5cf,_5cd,_5cc,_5d0,_5ce]),_list:null,res:res,postMixInProperties:function(){this.inherited(arguments);_5c9.contentLanguage=_5d1.currentContentLanguage;if(!this.model){this.own(this.model=new _5c8());}},buildRendering:function(){this.inherited(arguments);this._setupToolbar();this._setupList();},startup:function(){if(this._started){return;}this.inherited(arguments);this.model.initialize().then(function(){this._list.startup();this._list.set("store",this.model.store,this.model.query,this.model.queryOptions);this.own(on(this.model,"notification-allread",this._list.refresh.bind(this._list)),on(this.domNode,_5c6._keypress,this._onKeypress.bind(this)));this.emit("loaded");}.bind(this));},focus:function(){var _5d7;if(this._list){_5d7=this._list.getScrollPosition();this._list.focus();this._list.scrollTo(_5d7);}},layout:function(){this.inherited(arguments);this._list.resize();},_setupList:function(){var _5d8=this._readNotification.bind(this);this._list=new this._listClass({className:"epi-notification-list__item-list epi-card-list epi-grid-max-height--300",cleanEmptyObservers:false,commandCategory:"itemContext",deselectOnRefresh:false,formatters:_5c9.card,keepScrollPosition:true,noDataMessage:res.nodatamessage,stopPropagation:true,sort:this.model.queryOptions&&this.model.queryOptions.sort},this.listNode);this._list.contextMenu.addProvider(this.model);this.own(this._list,this._list.on("dgrid-select",this._selected.bind(this)),this._list.on(".dgrid-row:click",_5d8),this._list.addKeyHandler(keys.ENTER,_5d8),on.once(this._list,"dgrid-refresh-complete",this.focus.bind(this)));},_readNotification:function(){this.model.readSelectedNotification();this.emit("change",{});},_selected:function(e){var _5d9=e&&e.rows&&e.rows[0].data;this.model.set("selectedNotification",_5d9);},_setupToolbar:function(){var _5da=new _5d2({settings:{"class":"epi-chromeless epi-visibleLink"}});var _5db=[{builder:_5da,category:"toolbarContext",target:this.toolbarGroupNode}];this.own(new _5d3({configuration:_5db,commandSource:this.model}));},_onKeypress:function(e){if(e.charOrCode!==keys.TAB){return;}this.toolbar.focused?this._list.focus():this.toolbar.focus();e.preventDefault();e.stopPropagation();}});});},"epi-cms/notification/viewmodels/NotificationListViewModel":function(){define(["dojo/_base/declare","dojo/Evented","dojo/Stateful","dojo/topic","dojo/when","dijit/Destroyable","epi/dependency","../command/MarkNotificationAsRead","../command/MarkAllNotificationsAsRead"],function(_5dc,_5dd,_5de,_5df,when,_5e0,_5e1,_5e2,_5e3){return _5dc([_5de,_5dd,_5e0],{store:null,service:null,query:null,queryOptions:null,commands:null,selectedNotification:null,postscript:function(){this.inherited(arguments);this.queryOptions=this.queryOptions||{sort:[{attribute:"posted",descending:true}]};this.store=this.store||_5e1.resolve("epi.storeregistry").get("epi.cms.notification");this.service=this.service||_5e1.resolve("epi.cms.NotificationService");this.query=this.query||{};this._createCommands();},initialize:function(){return when(null);},readSelectedNotification:function(){this.markSelectedNotificationAsRead();this.gotoSelectedNotificationOrigin();},getCommands:function(){return this.commands;},gotoSelectedNotificationOrigin:function(){if(!this.selectedNotification||!this.selectedNotification.link){return;}var _5e4=this.selectedNotification.link;_5df.publish("/epi/shell/context/request",{uri:_5e4},{sender:this});},markSelectedNotificationAsRead:function(){if(!this.selectedNotification){return;}this.service.markAsRead(this.selectedNotification.id).then(this.set.bind(this,"selectedNotification"));},markAllAsRead:function(){this.service.markAllAsRead().then(this.emit.bind(this,"notification-allread",{}));},_createCommands:function(){var _5e5=[new _5e2({model:this,order:10}),new _5e3({model:this})];this.own.apply(this,_5e5);this.set({commands:_5e5});}});});},"epi-cms/notification/command/MarkNotificationAsRead":function(){define(["dojo/_base/declare","epi/shell/command/_PropertyWatchCommand","epi/i18n!epi/cms/nls/episerver.cms.notification.command"],function(_5e6,_5e7,res){return _5e6([_5e7],{category:"itemContext",label:res.markasread,canExecute:false,propertiesToWatch:["selectedNotification"],_execute:function(){return this.model.markSelectedNotificationAsRead();},_onPropertyChanged:function(){var _5e8=this.model.selectedNotification;var _5e9=!!_5e8&&!_5e8.hasRead;this.set("canExecute",_5e9);}});});},"epi/shell/command/_PropertyWatchCommand":function(){define("epi/shell/command/_PropertyWatchCommand",["dojo/_base/declare","epi/shell/DestroyableByKey","epi/shell/command/_Command"],function(_5ea,_5eb,_5ec){return _5ea([_5ec,_5eb],{propertiesToWatch:null,_onModelChange:function(){var _5ed=this.model;this.destroyByKey("propertyWatchHandle");if(_5ed){this._onPropertyChanged();this.propertiesToWatch.forEach(function(_5ee){this.ownByKey("propertyWatchHandle",_5ed.watch(_5ee,this._onPropertyChanged.bind(this)));},this);}else{this.set("canExecute",false);}},_onPropertyChanged:function(){var _5ef=this.propertiesToWatch.every(function(_5f0){return !!this.model[_5f0];},this);this.set("canExecute",_5ef);}});});},"epi-cms/notification/command/MarkAllNotificationsAsRead":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.notification.list"],function(_5f1,_5f2,res){return _5f1(_5f2,{showLabel:true,isAvailable:true,canExecute:true,category:"toolbarContext",label:res.markallasread,_execute:function(){this.model.markAllAsRead();}});});},"epi-cms/notification/notificationFormatter":function(){define(["dojo/dom-class","dojo/string","dojox/html/entities","epi/shell/TypeDescriptorManager","epi-cms/dgrid/formatters","epi/shell/dgrid/util/misc","dojo/text!./templates/card.html","epi/i18n!epi/nls/episerver.shared"],function(_5f3,_5f4,_5f5,_5f6,_5f7,misc,_5f8,_5f9){var _5fa;function _5fb(){function _5fc(item){if(!item.contentLanguage){return "";}return item.contentLanguage!==_5fa.contentLanguage?item.contentLanguage:"";};function _5fd(_5fe){if(_5fe.subject){return _5f5.encode(_5fe.subject);}return "";};function _5ff(_600){if(_600&&_600!=="projectIcon"){var _601=_5f6.getValue(_600,"iconClass");if(_601){return misc.icon(_601+" epi-objectIcon");}else{return "";}}else{if(_600==="projectIcon"){return misc.icon("epi-iconObjectProject epi-objectIcon");}}return "";};return function formatter(_602,_603,node,_604){var _605=_5fc(_603);var map={title:_5fd(_603),languageBranch:_5f5.encode(_605),languageBranchClass:_605?"epi-card__language-branch":"epi-card__language-branch--hidden",contentIcon:_5ff(_603.iconKey),message:_603.content,postedAt:_5f7.localizedDate(_603.posted),menu:_5f7.menu({title:_5f9.action.options})};var _606=(_603.hasRead?"":" epi-card--unread");_5f3.add(node,"epi-card epi-card--compact"+_606);return _5f4.substitute(_5f8,map);};};_5fa={card:[_5fb()]};return _5fa;});},"url:epi-cms/notification/templates/card.html":"<div class=\"epi-event\">\n    ${contentIcon}${menu}<span class=\"dijitInline epi-floatRight epi-lozenge ${languageBranchClass}\">${languageBranch}</span><h3 class=\"epi-event__title dojoxEllipsis\">${title}</h3>\n    <div class=\"epi-event__message\">${message}</div>\n    <div class=\"epi-event__timestamp\">${postedAt}</div>\n</div>\n","url:epi-cms/notification/templates/NotificationList.html":"<div class=\"epi-notification-list epi-menu--inverted\">\n    <div class=\"epi-menuInverted epi-invertedTooltip\">\n        <div class=\"epi-tooltipDialogTop\">\n            <span data-dojo-attach-point=\"headerNode\">${res.header}</span>\n            <div class=\"dijitTooltipConnector\"></div>\n        </div>\n        <div data-dojo-type=\"dijit/Toolbar\"\n             data-dojo-attach-point=\"toolbar\"\n             class=\"epi-flatToolbar\">\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\n        </div>\n        <div data-dojo-attach-point=\"listNode\"></div>\n    </div>\n</div>\n","epi/shell/dgrid/Focusable":function(){define("epi/shell/dgrid/Focusable",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dijit/focus"],function(_607,lang,_608,_609){return _607([],{postCreate:function(){this.inherited(arguments);this._listeners.push(_608.around(this,"_restoreFocus",function(_60a){return function(row){var _60b=this._removedFocus;_60a.apply(this,arguments);if(!this._focusedNode){row=row&&this.row(row);var _60c=row&&row.element&&row.id===_60b.rowId?row:typeof _60b.siblingId!=="undefined"&&this.row(_60b.siblingId);if(_60c){this._focusedNode=_60c.element;}}};}));},hasFocus:function(){return this._focusedNode&&this._focusedNode===_609.curNode;},isFocusable:function(){return !!this._focusedNode;},focus:function(_60d){if(typeof _60d=="string"){_60d=null;}this.inherited(arguments,[_60d]);},refresh:function(_60e){var _60f=_60e&&_60e.refocus,_610=function(_611){if(this._refocusNode){this.focus(this.row(this._refocusNode).element);this._refocusNode=null;}return _611;};if(typeof _60f==="undefined"){_60f=this.refocusOnRefresh;}if(_60f&&this.hasFocus()){this._refocusNode=this.row(this._focusedNode).id;}var _612=this.inherited(arguments);if(_612){return _612.then(_610.bind(this));}}});});},"epi-cms/notification/command/ViewNotifications":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/dependency","dijit/Destroyable","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.notification.command"],function(_613,lang,on,_614,_615,_616,res){return _613([_616,_615],{iconClass:"epi-iconBell epi-icon--medium",label:"",isAvailable:true,canExecute:true,badgeValue:"",_unreadCount:0,postscript:function(){this.inherited(arguments);this.service=this.service||_614.resolve("epi.cms.NotificationService");this.own(this.service.on("notification-updated",function(_617){if(!_617.hasRead){this.set("_unreadCount",this._unreadCount+1);}}.bind(this)));this._updateUnreadCount();},_execute:function(){this.set("_unreadCount",0);},_updateUnreadCount:function(){this.service.getUnreadNotificationCount().then(function(_618){this.set("_unreadCount",_618);}.bind(this));},__unreadCountSetter:function(_619){var _61a=_619>0?"("+_619+")":"";this._unreadCount=_619;this.set({badgeValue:_619>0?_619:null,label:lang.replace(res.viewnotifications,{unreadcount:_61a})});}});});},"epi-cms/command/ViewSettingsCommandProvider":function(){define(["dojo/_base/declare","epi/dependency","epi-cms/command/TogglePreviewMode","epi-cms/command/ToggleViewSettings","epi-cms/visitorgroups/command/VisitorGroupViewSettingsCommand","epi-cms/project/ProjectPreviewButton","epi-cms/contentediting/command/LanguageSelection","epi-cms/contentediting/viewmodel/LanguageSettingsModel","./DeviceSelection","epi-cms/component/command/_GlobalToolbarCommandProvider","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.togglepreviewmode"],function(_61b,_61c,_61d,_61e,_61f,_620,_621,_622,_623,_624,_625){return _61b([_624],{postscript:function(){this.inherited(arguments);var _626={category:"view"};this.projectService=this.projectService||_61c.resolve("epi.cms.ProjectService");var _627=new _622();this.add("commands",new _61e({settings:_626,category:_626.category}));this.add("commands",new _621({category:_626.category,showLabel:true,settings:_626,optionsProperty:"availableLanguages",property:"selectedLanguage",model:_627}));this.add("commands",new _61f({category:_626.category,settings:_626}));this.add("commands",new _623({settings:_626,category:_626.category}));if(!this.projectService.isProjectModeEnabled){this.add("commands",{settings:_626,category:_626.category,widget:new _620({showLabel:false})});}this.add("commands",new _61d({settings:_626,category:_626.category,innerText:_625.message}));}});});},"epi-cms/command/TogglePreviewMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.togglepreviewmode","epi/shell/command/ToggleCommand","epi-cms/command/_NonEditViewCommandMixin","epi-cms/_SidePanelsToggleMixin","dijit/Destroyable"],function(_628,lang,_629,_62a,_62b,_62c,_62d,_62e){return _628([_62b,_62c,_62d,_62e],{iconClass:"epi-iconPreview",tooltip:_62a.label,label:_62a.label,canExecute:true,constructor:function(){this.own(_629.subscribe("/epi/cms/action/disablepreview",lang.hitch(this,"_deactivate")));},_execute:function(){this.set("active",!this.active);if(this.active){_629.publish("/epi/shell/action/changeview","view");this._hideSidePanels();}else{this._restoreSidePanels();_629.publish("/epi/shell/action/changeview",null);}},_deactivate:function(){if(this.active){this.set("active",false);this._restoreSidePanels();}},_viewChanged:function(type,args,data){this.inherited(arguments);var view=data&&data.viewName;if(view!=="view"){this._deactivate();}}});});},"epi-cms/_SidePanelsToggleMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dojo/topic","epi/dependency"],function(_62f,lang,all,when,_630,_631){return _62f([],{_profile:null,_isNavigationVisible:null,_isToolsVisible:null,constructor:function(){if(!this._profile){this._profile=_631.resolve("epi.shell.Profile");}this._storePanelVisibility();},_restoreSidePanels:function(){_630.publish("/epi/layout/pinnable/navigation/toggle",this._isNavigationVisible);_630.publish("/epi/layout/pinnable/tools/toggle",this._isToolsVisible);},_hideSidePanels:function(){this._storePanelVisibility().then(function(){_630.publish("/epi/layout/pinnable/navigation/toggle",false);_630.publish("/epi/layout/pinnable/tools/toggle",false);});},_storePanelVisibility:function(){return all([when(this._profile.get("navigation"),lang.hitch(this,function(_632){this._isNavigationVisible=_632?_632.visible:false;})),when(this._profile.get("tools"),lang.hitch(this,function(_633){this._isToolsVisible=_633?_633.visible:false;}))]);}});});},"epi-cms/command/ToggleViewSettings":function(){define(["dojo/_base/declare","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.viewsetting","epi/shell/command/ToggleCommand","epi/dependency","epi-cms/command/_NonEditViewCommandMixin"],function(_634,_635,_636,_637,_638,_639){return _634([_637,_639],{iconClass:"epi-iconEye",canExecute:true,property:"enabled",label:_636.viewsettingbutton,postscript:function(){this.inherited(arguments);if(!this.model){this.set("model",_638.resolve("epi.viewsettingsmanager"));}},_execute:function(){this.inherited(arguments);_635.publish("/epi/cms/action/eyetoggle",this.model.get(this.property));},_viewChanged:function(type,args,data){this.inherited(arguments);var view=data&&data.viewName;if(this.active&&view&&view.indexOf("compare")!==-1){this.execute();}}});});},"epi-cms/visitorgroups/command/VisitorGroupViewSettingsCommand":function(){define(["dojo/_base/declare","dijit/Destroyable","epi/shell/command/OptionCommand","./VisitorGroupViewSettingsModel","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupselector"],function(_63a,_63b,_63c,_63d,res){return _63a([_63c,_63b],{iconClass:"epi-iconUsers",model:null,optionsProperty:"options",property:"selectedGroup",optionsLabel:res.header,postscript:function(){this.inherited(arguments);this.set("model",this.model||new _63d());this.set("label",this.model.tooltip);this.set("active",!!this.model.selectedGroup);var self=this;this.own(this.model.watch("tooltip",function(_63e,_63f,_640){self.set("label",_640);}));this.own(this.model.watch("selectedGroup",function(_641,_642,_643){self.set("active",!!_643);}));}});});},"epi-cms/visitorgroups/command/VisitorGroupViewSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupsbutton","epi/i18n!epi/cms/nls/episerver.cms.widget.visitorgroupselector"],function(_644,lang,_645,_646,when,_647,_648,_649,res){return _644([_646,_647],{selectedGroup:null,tooltip:_649.defaulttooltip,defaultItem:{value:null,label:res.defaultitem},options:[],postscript:function(){this.inherited(arguments);if(!this._store){var _64a=_648.resolve("epi.storeregistry");this._store=_64a.get("epi.cms.visitorgroup");}if(!this._viewSettingsManager){this._viewSettingsManager=_648.resolve("epi.viewsettingsmanager");}var _64b=this._viewSettingsManager.getSettingProperty("visitorgroup");var self=this;when(this._store.query()).then(function(_64c){if(!(_64c instanceof Array)){_64c=[];}var _64d=_64c.map(function(item){return {label:item.name,value:item.id};});_64d.unshift(self.defaultItem);self.set("options",_64d);self.set("selectedGroup",_64b,false);});},_selectedGroupSetter:function(_64e,_64f){if(this.selectedGroup===_64e){return;}this.selectedGroup=_64e;this._setTooltip();if(_64f===false){return;}_645.publish("/epi/cms/action/viewsettingvaluechanged","visitorgroup",this.selectedGroup);},_setTooltip:function(){var _650=this._getGroup(this.selectedGroup);if(_650){this.set("tooltip",lang.replace(_649.tooltip,{visitorgroup:_650.label}));}else{this.set("tooltip",_649.defaulttooltip);}},_getGroup:function(id){if(id===this.defaultItem.value){return null;}for(var idx in this.options){if(this.options[idx].value===id){return this.options[idx];}}return null;}});});},"epi-cms/project/ProjectPreviewButton":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Deferred","dojo/topic","epi/dependency","epi/i18n!epi/nls/episerver.cms.components.project.preview","epi/shell/widget/DeferredDropDownButton","epi-cms/project/ProjectSelectorList"],function(_651,lang,_652,_653,_654,_655,_656,_657,_658){return _651([_657],{iconClass:"epi-icon--medium epi-iconProject",baseClass:"",postMixInProperties:function(){this.inherited(arguments);this.store=this.store||_655.resolve("epi.storeregistry").get("epi.cms.project");},buildRendering:function(){this.inherited(arguments);_652.add(this.domNode,["epi-chromeless","epi-mediumButton"]);if(!this.dropDown){this.dropDown=new _658({baseClass:"dijitMenu",enableDefaultValue:true,defaultValueText:_656.defaultoption,store:this.store,header:_656.header});}},postCreate:function(){this.inherited(arguments);var self=this,_659=_655.resolve("epi.viewsettingsmanager").getSettingProperty("project"),_65a=_659?this.store.get(parseInt(_659)):new _653().resolve();_65a.then(function(_65b){self.dropDown.set("selectedProject",_65b);self._updateButtonState(_65b);}).always(function(){self.own(self.dropDown.watch("selectedProject",lang.hitch(self,"_selectedProjectChanged")));});},loadAndOpenDropDown:function(){if(this.isLoaded()){return this.inherited(arguments).then(lang.hitch(this,function(){return this.dropDown.refresh();}));}return this.inherited(arguments);},_selectedProjectChanged:function(name,_65c,_65d){var _65e=_65d?_65d.id:null;_654.publish("/epi/cms/action/viewsettingvaluechanged","project",_65e);this._updateButtonState(_65d);},_updateButtonState:function(_65f){var _660=_656.defaulttooltip;if(_65f){_660=lang.replace(_656.tooltip,{project:_65f.name});}this.set("title",_660);_652.toggle(this.iconNode,"epi-icon--active",!!_65f);}});});},"epi-cms/project/ProjectSelectorList":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/keys","dojo/when","dojo/dom-class","dojox/html/entities","dijit/form/RadioButton","dijit/Menu","epi/epi","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/ExpandoMenuBuilder","epi/shell/command/builder/OptionsBuilderMixin","epi/datetime","epi/username","./viewmodels/ProjectSelectorListViewModel","dojo/text!./templates/ProjectSelectorList.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","epi/i18n!epi/cms/nls/episerver.cms.components.project","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/Selection","dgrid/util/mouse","put-selector/put","epi/shell/dgrid/Focusable","epi/shell/dgrid/selection/Exclusive","epi/shell/dgrid/util/misc","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_KeyNavContainer","dijit/Toolbar"],function(_661,_662,lang,keys,when,_663,_664,_665,Menu,epi,_666,_667,_668,_669,_66a,_66b,_66c,_66d,_66e,res,_66f,_670,_671,_672,_673,put,_674,_675,misc,_676,_677,_678,_679){return _661([_676,_677,_678,_679,_666],{templateString:_66d,store:null,query:null,selectedProject:null,enableDefaultValue:false,defaultValueText:res.preview.defaultoption,header:res.title,_setHeaderAttr:{node:"headerNode",type:"innerText"},_optionsMenuClass:_661([Menu,_669]),postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.own(this.model=new _66c());}},buildRendering:function(){this.inherited(arguments);this._setupProjectSortMenu();this.list=new (_661([_66f,_670,_672,_671,_674,_675]))({sort:[{attribute:"created",descending:true}],className:"epi-grid--no-alternating-rows epi-grid-max-height--300",cleanEmptyObservers:false,deselectOnRefresh:false,selectionMode:"exclusive",selectionEvents:"click",query:this.get("query"),renderRow:this.renderRow},this.listNode);this.own(this.list,this.list.on("dgrid-select",lang.hitch(this,"_projectSelected")),this.list.on("dgrid-refresh-complete",lang.hitch(this,"_refreshComplete")),this.list.addKeyHandler(keys.ENTER,lang.hitch(this,"_listEnterKeypress")),this.model.watch("projectSortOrder",lang.hitch(this,"_sortChanged")),this.list.addKeyHandler(keys.UP_ARROW,lang.hitch(this,"_listNavigateUp")),this.list.addKeyHandler(keys.PAGE_UP,lang.hitch(this,"_listNavigateUp")),this.list.on(_673.enterRow,lang.hitch(this,"_listMouseover")),this.defaultOption.on("click",lang.hitch(this,"_defaultOptionSelected")),this.defaultOption.on("keypress",lang.hitch(this,"_defaultOptionKeypress")),this.defaultOption.on("mouseover",lang.hitch(this,"_defaultOptionMouseover")));if(this.enableDefaultValue){this.list.keyMap[keys.HOME]=lang.hitch(this,"_listNavigateHome");}else{_663.add(this.defaultOption.domNode,"dijitHidden");}this.defaultOption.set({iconClass:"dijitRadioIcon",label:_664.encode(this.defaultValueText)});},startup:function(){if(this._started){return;}this.inherited(arguments);this.model.initialize();this.list.startup();this.list.set("store",this.store);},focus:function(){if(this.enableDefaultValue){this.defaultOption.focus();}else{this.list.focus();}},resize:function(){this.inherited(arguments);this.list.resize();},renderRow:function(item,_67a){var _67b=put("div.epi-selector-list__type-wrapper",put("span.dijit.dijitReset.dijitInline.dijitRadio"));var _67c=put("label.epi-selector-list__title.dojoxEllipsis",put("strong[title='"+item.name+"']",item.name));var _67d=put("div.epi-selector-list__description.dojoxEllipsis",_66a.toUserFriendlyString(new Date(item.created))+", "+_66b.toUserFriendlyString(item.createdBy));return put("div",[_67b,_67c,_67d]);},refresh:function(){if(!this._started){return;}return this.list.refresh().then(lang.hitch(this,function(_67e){var _67f=this.get("selectedProject"),_680=_67f&&_67e.some(function(item){if(item.id===_67f.id){_67f=item;return true;}return false;},this);this.set("selectedProject",_680?_67f:null);}));},_projectSelected:function(e){var _681=e&&e.rows&&e.rows[0].data;if(!epi.areEqual(_681,this.get("selectedProject"))){this.set("selectedProject",_681);this.emit("change",{value:_681});}this._updateView();},_refreshComplete:function(evt){when(evt.results.total,lang.hitch(this,function(_682){this.emit("loaded");_663.toggle(this.separatorNode,"dijitHidden",!_682||!this.enableDefaultValue);}));},_defaultOptionSelected:function(){this.set("selectedProject",null);this.emit("change",null);},_defaultOptionKeypress:function(e){var _683;switch(e.keyCode){case keys.DOWN_ARROW:_683=_671.moveFocusHome;break;case keys.PAGE_DOWN:_683=_671.moveFocusPageDown;break;case keys.END:_683=_671.moveFocusEnd;break;default:return;}_683.apply(this.list,[e]);},_defaultOptionMouseover:function(){this.defaultOption.focus();},_listEnterKeypress:function(e){this.list.clearSelection();this.list.select(e);},_listNavigateUp:function(e){var list=this.list,row=list.row(e),_684=list.up(row,1,true);if(row.id===_684.id){this.defaultOption.focus();}},_listNavigateHome:function(){this.defaultOption.focus();},_listMouseover:function(e){var row=this.list.row(e);this.list.focus(row);},_sortChanged:function(evt){var _685=this.model[evt];if(this.list.get("sort")!==_685){this.list.set("sort",_685);}},_setSelectedProjectAttr:function(_686){this._set("selectedProject",_686);this.list.clearSelection();if(_686){this.list.select(_686.id);}this._updateView();},_updateView:function(){this.defaultOption.set("checked",!this.selectedProject);},_setupProjectSortMenu:function(){var _687=[{builder:new _668({settings:{"class":"epi-flat epi-chromeless",iconClass:"epi-iconSort",showLabel:false,label:res.command.sort.label}}),category:"context",target:this.toolbarGroupNode}];this.own(new _667({configuration:_687,commandSource:this.model}));}});});},"epi/shell/command/_WidgetCommandBinderMixin":function(){define("epi/shell/command/_WidgetCommandBinderMixin",["dojo/_base/declare","epi/shell/command/_CommandConsumerMixin"],function(_688,_689){return _688(null,{commandProvider:null,_consumerHandle:null,startup:function(){if(this._started){return;}this.inherited(arguments);var _68a=this.getConsumer();if(!_68a){return;}this._consumerHandle=_68a.addProvider(this.commandProvider||this);this.commandProvider.initializeCommandProviders&&this.commandProvider.initializeCommandProviders();},getConsumer:function(){if(this.isInstanceOf(_689)){return this;}var _68b=this.getParent();while(_68b){if(_68b.isInstanceOf(_689)){return _68b;}_68b=_68b.getParent();}},destroy:function(){this._consumerHandle&&this._consumerHandle.removeProvider();this.inherited(arguments);}});});},"epi/shell/command/builder/ExpandoMenuBuilder":function(){define("epi/shell/command/builder/ExpandoMenuBuilder",["dojo/_base/declare","dojo/_base/lang","../_CommandModelBindingMixin","./ButtonBuilder","epi/shell/widget/ExpandoMenuButton"],function(_68c,lang,_68d,_68e,_68f){return _68c([_68e],{_expandoClass:_68c([_68f,_68d]),_expandoMenu:null,_create:function(_690){var _691,_692;if(_690.widget){return _690.widget;}_691=_690.get("options") instanceof Array;_692=typeof _690.active==="boolean";if(!_691&&_692){return this._expandoMenu=new this._expandoClass(this._createOptions(_690));}return this.inherited(arguments);},_createOptions:function(_693){return lang.mixin({innerText:_693.innerText,showLabel:!!_693.showLabel},this.inherited(arguments));},_addToContainer:function(_694,_695){if(!(_694 instanceof _68f)&&this._expandoMenu){_695=this._expandoMenu;}this.inherited(arguments,[_694,_695]);}});});},"epi/shell/widget/ExpandoMenuButton":function(){require({cache:{"url:epi/shell/widget/templates/ExpandoMenuButton.html":"<span class=\"dijit dijitReset dijitInline epi-mediumButton epi-expandoMenuButton\"><!--\n --><button data-dojo-attach-point=\"toggleButton\" data-dojo-type=\"dijit/form/ToggleButton\" class=\"epi-chromelessButton\"\n        data-dojo-attach-event=\"onChange: _toggleButtonChange, onClick:_toggleButtonClick\" showlabel=\"false\">${label}</button><!--\n    --><ul data-dojo-attach-point=\"expandoNode\" class=\"dijitHidden\"><li data-dojo-attach-point=\"innerTextContainerNode\" class=\"epi-expandoMenuButton--no-children\"><span class=\"epi-expandoMenuButton--no-children-text\" data-dojo-attach-point=\"innerTextNode\"></span></li></ul><!--\n--></span>\n"}});define("epi/shell/widget/ExpandoMenuButton",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/on","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/dom-construct","dojo/has","dojo/text!./templates/ExpandoMenuButton.html","dijit/registry","dijit/_WidgetBase","dijit/_WidgetsInTemplateMixin","dijit/_TemplatedMixin","dgrid/util/has-css3","dijit/form/ToggleButton"],function(_696,lang,_697,on,_698,_699,_69a,_69b,has,_69c,_69d,_69e,_69f,_6a0){return _696([_69e,_6a0,_69f],{templateString:_69c,label:"",innerText:"",iconClass:"",postCreate:function(){this.inherited(arguments);if(has("css-transitions")){this.own(on(this.expandoNode,has("transitionend"),lang.hitch(this,this._onTransitionEnd)));}},_setLabelAttr:function(_6a1){this.toggleButton.set("label",_6a1);this._set("label",_6a1);},_setInnerTextAttr:function(_6a2){this._set("innerText",_6a2);if(_6a2){this.innerTextNode.textContent=_6a2;}_698.toggle(this.innerTextContainerNode,"dijitHidden",!_6a2);},_setIconClassAttr:function(_6a3){this._set("iconClass",_6a3);this._updateToggleButtonIcon();},_setCheckedAttr:function(_6a4){this.toggleButton.set("checked",_6a4);this._set("checked",_6a4);this._updateToggleButtonIcon();this._showChildren(_6a4);},addChild:function(_6a5){if(this.innerTextContainerNode){_698.add(this.innerTextContainerNode,"dijitHidden");}var li=_69b.create("li",{},this.expandoNode);_6a5.placeAt(li);},onClick:function(){},onChange:function(val){},getChildren:function(){return _69d.findWidgets(this.expandoNode);},_toggleButtonClick:function(){this.onClick();},_toggleButtonChange:function(val){this.set("checked",val);this.onChange(val);},_updateToggleButtonIcon:function(){var _6a6=["epi-icon--medium"];if(this.iconClass){_6a6.push(this.iconClass);}if(this.checked){_6a6.push("epi-icon--active");}this.toggleButton.set("iconClass",_6a6.join(" "));},_showChildren:function(show){var node=this.expandoNode;if(show){_698.toggle(node,"dijitHidden",false);_69a.set(node,"width",this._childrenWidth()+"px");}else{_69a.set(node,"width",this._childrenWidth()+"px");node.offsetWidth;_69a.set(node,"width","0px");}},_onTransitionEnd:function(){var _6a7=this.get("checked");_698.toggle(this.expandoNode,"dijitHidden",!_6a7);if(_6a7){_69a.set(this.expandoNode,"width","");}},_childrenWidth:function(){var _6a8=0;_697.forEach(this.expandoNode.childNodes,function(_6a9){_6a8+=_699.getMarginBox(_6a9).w;});return _6a8;}});});},"url:epi/shell/widget/templates/ExpandoMenuButton.html":"<span class=\"dijit dijitReset dijitInline epi-mediumButton epi-expandoMenuButton\"><!--\n --><button data-dojo-attach-point=\"toggleButton\" data-dojo-type=\"dijit/form/ToggleButton\" class=\"epi-chromelessButton\"\n        data-dojo-attach-event=\"onChange: _toggleButtonChange, onClick:_toggleButtonClick\" showlabel=\"false\">${label}</button><!--\n    --><ul data-dojo-attach-point=\"expandoNode\" class=\"dijitHidden\"><li data-dojo-attach-point=\"innerTextContainerNode\" class=\"epi-expandoMenuButton--no-children\"><span class=\"epi-expandoMenuButton--no-children-text\" data-dojo-attach-point=\"innerTextNode\"></span></li></ul><!--\n--></span>\n","epi-cms/project/viewmodels/ProjectSelectorListViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/Stateful","dojo/when","dijit/Destroyable","epi/dependency","epi/shell/command/OptionCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.sort"],function(_6aa,lang,_6ab,_6ac,when,_6ad,_6ae,_6af,_6b0){return _6aa([_6ac,_6ad,_6ab],{namedCommands:null,profile:null,projectSortOrder:null,_commands:null,_sortOrderProfileKey:"epi.project-sort-order",constructor:function(){this.projectSortOrder=[{attribute:"name",descending:false}];},postscript:function(){this.inherited(arguments);this.profile=this.profile||_6ae.resolve("epi.shell.Profile");this._createCommands();},initialize:function(){return when(this.profile.get(this._sortOrderProfileKey),lang.hitch(this,function(sort){var _6b1=this._findSortOption("key",sort)||this.namedCommands.sortProject.options[0];this._changeAttrValue("projectSortOrder",_6b1.value);}));},getCommands:function(){return this._commands;},_projectSortOrderSetter:function(_6b2){var _6b3,key;if(_6b2===null||(_6b2&&_6b2===this.projectSortOrder)){return;}this.projectSortOrder=_6b2;_6b3=this._findSortOption("value",_6b2);key=_6b3&&_6b3.key||null;this.profile.set(this._sortOrderProfileKey,key,{location:"server"});},_findSortOption:function(key,term){var _6b4=this.namedCommands.sortProject.options,_6b5=null;term&&_6b4.some(function(item){if(term===item[key]){_6b5=item;return true;}});return _6b5;},_createCommands:function(){var _6b6=new _6af({model:this,category:"context",label:"label",property:"projectSortOrder",options:[{label:_6b0.nameascending,key:"+Name",value:[{attribute:"name",descending:false}]},{label:_6b0.namedescending,key:"-Name",value:[{attribute:"name",descending:true}]},{label:_6b0.createddescending,key:"-DateCreated",value:[{attribute:"created",descending:true},{attribute:"name",descending:false}]},{label:_6b0.createdascending,key:"+DateCreated",value:[{attribute:"created",descending:false},{attribute:"name",descending:false}]}]});this.set("_commands",[_6b6]);this.set("namedCommands",{sortProject:_6b6});}});});},"url:epi-cms/project/templates/ProjectSelectorList.html":"<div class=\"epi-selector-list epi-menu--inverted\">\n    <div class=\"epi-menuInverted epi-invertedTooltip\">\n        <div class=\"epi-tooltipDialogTop\">\n            <span data-dojo-attach-point=\"headerNode\"></span><div class=\"dijitTooltipConnector\"></div>\n        </div>\n        <div data-dojo-type=\"dijit/Toolbar\" data-dojo-attach-point=\"toolbar\" class=\"epi-flatToolbar\">\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\n        </div>\n        <button class=\"epi-selector-list-btn epi-chromeless\" data-dojo-attach-point=\"defaultOption\" data-dojo-type=\"dijit/form/ToggleButton\" data-dojo-props=\"iconClass:'dijitRadioIcon'\"></button>\n        <div data-dojo-attach-point=\"separatorNode\" class=\"epi-selector-list__separator dijitHidden\"></div>\n        <div data-dojo-attach-point=\"listNode\"></div>\n    </div>\n</div>\n","dgrid/util/mouse":function(){define(["dojo/on","dojo/dom","dojo/query"],function(on,dom){function _6b7(_6b8,type){return function(node,_6b9){return on(node,_6b8+":"+type,function(evt){if(!dom.isDescendant(evt.relatedTarget,this)){return _6b9.call(this,evt);}});};};return {enterRow:_6b7(".dgrid-content .dgrid-row","mouseover"),enterCell:_6b7(".dgrid-content .dgrid-cell","mouseover"),enterHeaderCell:_6b7(".dgrid-header .dgrid-cell","mouseover"),leaveRow:_6b7(".dgrid-content .dgrid-row","mouseout"),leaveCell:_6b7(".dgrid-content .dgrid-cell","mouseout"),leaveHeaderCell:_6b7(".dgrid-header .dgrid-cell","mouseout"),createDelegatingHandler:_6b7};});},"epi/shell/dgrid/selection/Exclusive":function(){define("epi/shell/dgrid/selection/Exclusive",["dojo/_base/declare"],function(_6ba){return _6ba([],{_exclusiveSelectionHandler:function(_6bb,_6bc){if(this._lastSelected!==_6bc){this.clearSelection();this.select(_6bc);this._lastSelected=_6bc;}}});});},"epi-cms/contentediting/command/LanguageSelection":function(){define(["dojo/_base/declare","epi/shell/command/OptionCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_6bd,_6be,_6bf){return _6bd([_6be],{optionsLabel:_6bf.contentdetails.existinglanguages,active:false,selected:"",_selectedSetter:function(_6c0){this.inherited(arguments);if(typeof (_6c0)=="string"&&_6c0!==""){this.set("label",_6c0.toUpperCase());if(_6c0!==this.model.get("documentLanguage")){this.set("active",true);}else{this.set("active",false);}}}});});},"epi-cms/contentediting/viewmodel/LanguageSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dojo/Deferred","epi/dependency","epi-cms/component/SiteTreeModel","dijit/Destroyable"],function(_6c1,lang,_6c2,_6c3,when,_6c4,_6c5,_6c6,_6c7){return _6c1([_6c3,_6c7],{enabled:false,documentLanguage:"",selectedLanguage:"",availableLanguages:[],profile:null,siteTreeModel:null,postscript:function(){this.inherited(arguments);var self=this;if(!this.siteTreeModel){var _6c8=_6c5.resolve("epi.storeregistry"),_6c9=_6c8.get("epi.cms.sitestructure");this.siteTreeModel=new _6c6({store:_6c9});}this.profile=this.profile||_6c5.resolve("epi.shell.Profile");this.siteTreeModel.getCurrentSite().then(lang.hitch(this,"_setAvailableLanguages")).then(lang.hitch(this,function(){when(this.profile.getContentLanguage(),lang.hitch(this,function(_6ca){this.set("documentLanguage",_6ca);this.set("selectedLanguage",_6ca,false);}));}));},_setAvailableLanguages:function(site){if(site){var def=new _6c4();this.siteTreeModel.getChildren({url:site.currentSite},lang.hitch(this,function(_6cb){var obj=_6cb.filter(function(item){return (item.languageId&&item.name);}).map(function(item){return {label:item.name,value:item.languageId};});this.set("availableLanguages",obj);def.resolve();}));return def.promise;}else{return new _6c4().resolve();}},_enabledSetter:function(_6cc){if(this.enabled!==_6cc){this.enabled=_6cc;_6c2.publish("/epi/cms/action/eyetoggle",_6cc);}},_selectedLanguageSetter:function(_6cd,_6ce){if(_6ce!==false){_6c2.publish("/epi/cms/action/viewsettingvaluechanged","viewlanguage",_6cd);}}});});},"epi-cms/component/SiteTreeModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dojo/Deferred","dojo/when","dojo/_base/lang","dojo/_base/connect","dojo/cookie","epi/dependency","epi/string"],function(_6cf,_6d0,_6d1,_6d2,when,lang,_6d3,_6d4,_6d5,_6d6){return _6d0([_6d1],{query:null,showAllLanguages:true,location:document.location,profile:null,store:null,constructor:function(){this.query={allLanguages:this.showAllLanguages};},postscript:function(){this.inherited(arguments);this.profile=this.profile||_6d5.resolve("epi.shell.Profile");_6d3.subscribe("/epi/cms/contentdata/updated",lang.hitch(this,function(){when(this.getCurrentSite(),lang.hitch(this,function(_6d7){this.onItemChildrenReload({siteUrl:_6d7.currentSite});}));}));},getRoot:function(_6d8,_6d9){_6d8({});},getIdentity:function(item){var id=this.store.getIdentity(item);if(!id&&!item.isLanguageNode){id="root";}return id;},onItemChildrenReload:function(_6da){},mayHaveChildren:function(item){if(!item.isLanguageNode){return true;}return false;},getLabel:function(item){return item.name;},getChildren:function(_6db,_6dc){when(this.store.query(lang.mixin({siteUrl:_6db.url},this.query)),_6dc);},_setQuery:function(q){this.query=q;this.onItemChildrenReload({});},_showAllLanguagesSetter:function(_6dd){this.showAllLanguages=_6dd;this._setQuery({allLanguages:_6dd});},getCurrentSite:function(){var def=new _6d2();when(this.profile.getContentLanguage(),lang.hitch(this,function(_6de){if(_6de){when(this.store.get(),lang.hitch(this,function(_6df){var _6e0=null;var _6e1=null;_6cf.some(_6df,function(site){return _6cf.some(site.hosts,function(host){if(host==="*"){_6e1=site;return true;}});});var _6e2=this.location.host.toLowerCase();var _6e3=_6cf.some(_6df,function(site){return _6cf.some(site.hosts,function(host){if(_6e2===host.toLowerCase()){_6e0={currentSite:site.url,currentEditLanguageId:site.url+_6de};return true;}});});if(!_6e3&&_6e1){_6e0={currentSite:_6e1.url,currentEditLanguageId:_6e1.url+_6de};}if(_6e0){def.resolve(_6e0);}else{def.cancel();}}),function(){def.reject(null);});}else{def.reject(null);}}));return def;},getAllLanguagesForSite:function(_6e4){var def=new _6d2();when(this.store.query({siteUrl:_6e4,allLanguages:true}),function(_6e5){def.resolve(_6e5);});return def;},getAllLanguagesForCurrentSite:function(){var def=new _6d2();when(this.getCurrentSite(),lang.hitch(this,function(_6e6){this.getAllLanguagesForSite(_6e6.currentSite).then(function(_6e7){def.resolve(_6e7);});}),function(_6e8){def.reject(_6e8);});return def;}});});},"epi-cms/command/DeviceSelection":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/DestroyableByKey","epi/shell/command/OptionCommand","epi-cms/contentediting/viewmodel/DeviceSelectionSettingsModel"],function(_6e9,lang,_6ea,_6eb,_6ec){return _6e9([_6eb,_6ea],{iconClass:"epi-iconDevice",optionsProperty:"options",canExecute:true,active:false,postscript:function(){this.inherited(arguments);if(!this.model){this.set("model",new _6ec());}},_updateFromModel:function(){this.set("label",this.model.get("label"));this.set("active",!!(this.model.get("resolution")||this.model.get("channel")));},_onModelChange:function(){this.inherited(arguments);var _6ed="_ChannelCommandModelWatch";this.destroyByKey(_6ed);if(this.model){this._updateFromModel();this.ownByKey(_6ed,this.model.watch(lang.hitch(this,function(name,_6ee,_6ef){if(["label","resolution","channel"].indexOf(name)!==-1){this._updateFromModel();}})));}}});});},"epi-cms/contentediting/viewmodel/DeviceSelectionSettingsModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/topic","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/OptionGroup","epi/i18n!epi/cms/nls/episerver.cms.widget"],function(_6f0,lang,_6f1,_6f2,_6f3,_6f4,_6f5,_6f6){return _6f0([_6f1],{resolution:null,channel:null,postscript:function(){this.inherited(arguments);this._updateLabel();if(!this.get("viewSettingsManager")){this.set("viewSettingsManager",_6f3.resolve("epi.viewsettingsmanager"));}if(!this.get("channelStore")){var _6f7=_6f3.resolve("epi.storeregistry");this.set("channelStore",_6f7.get("epi.cms.displaychannels"));}},_resolutionSetter:function(_6f8){if(_6f8!==this.resolution){this.resolution=_6f8;this._onChange();}},_channelSetter:function(_6f9){if(_6f9!==this.channel){this.channel=_6f9;this.set("resolution",this._getDefaultResolutionForChannel(_6f9));this._onChange();}},_viewSettingsManagerSetter:function(_6fa){this.viewSettingsManager=_6fa;this.set("resolution",_6fa.getSettingProperty("resolution"));this.set("channel",_6fa.getSettingProperty("epichannel"));},_channelStoreSetter:function(_6fb){this.channelStore=_6fb;this._initialize();},_onChange:function(){this._updateLabel(this.get("resolution"),this.get("channel"));var _6fc=[{key:"resolution",value:this.get("resolution")},{key:"epichannel",value:this.get("channel")}];_6f2.publish("/epi/cms/action/viewsettingvaluechanged",_6fc);},_updateLabel:function(_6fd,_6fe){var _6ff=_6f6.channelbutton.defaulttooltip;if(_6fd||_6fe){_6ff=lang.replace(_6f6.channelbutton.tooltip,{channel:this._getOptionLabel(this._availableChannels,_6fe),resolution:this._getOptionLabel(this._availableResolutions,_6fd)});}this.set("label",_6ff);},_getOptionLabel:function(_700,_701){var _702=this._find(_700,function(item){return item.value===_701;});return _702&&_702.label||"";},_initialize:function(){this.channelStore.query({query:"getallregistered"}).then(lang.hitch(this,function(_703){this._availableResolutions=this._getAvailableResolutions();this._availableChannels=[{value:null,label:_6f6.channelselector.defaultitem}].concat(_703.map(function(_704){return {value:_704.channelName,label:_704.name,resolutionId:_704.resolutionId};}));this.set("options",[new _6f5({property:"channel",model:this,label:_6f6.channelselector.header,options:this._availableChannels}),new _6f5({property:"resolution",model:this,label:_6f6.resolutionselector.header,options:this._availableResolutions})]);}));},_getAvailableResolutions:function(){var _705=[{value:null,label:_6f6.channelselector.defaultitem}];if(_6f4.displayResolutions){_705=_705.concat(_6f4.displayResolutions.map(function(r){return {value:r.width+"x"+r.height,label:r.name,id:r.id};}));}return _705;},_getDefaultResolutionForChannel:function(_706){var _707=this._availableResolutions;if(!(_706&&lang.isArray(_707))){return null;}_706=this._find(this._availableChannels,function(c){return c.value===_706;});var _708=this._find(_707,function(r){return (r.id===_706.resolutionId);});return _708?_708.value:null;},_find:function(_709,_70a){var _70b=null;if(!lang.isArray(_709)){return null;}_709.some(function(_70c){if(_70a(_70c)){_70b=_70c;return true;}});return _70b;}});});},"epi-cms/contentediting/EditorFactory":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","epi-cms/ApplicationSettings"],function(_70d,_70e,lang,_70f){return _70d(null,{defaultWrapperType:null,_registeredEditorWrappers:null,onEditorCreated:function(_710){},onEditorResolved:function(data,_711){},constructor:function(){var _712=_70f.uiDefaults;this._registeredEditorWrappers={};this.defaultWrapperType=(_712&&_712.defaultEditorWrapper)||"floating";},registerEditorWrapper:function(_713,_714,_715){this._registeredEditorWrappers[_713]={wrapperClassType:_714,initializer:_715};},_getWrapperAndEditor:function(_716){var type=_716.type;var name=_716.name;var _717=_716.wrapperType;var _718=_716.editorParams||{};var _719=_716.editorWidgetType;if(!_717){if(_716.metadata.customEditorSettings&&_716.metadata.customEditorSettings.uiWrapperType){_717=_716.metadata.customEditorSettings.uiWrapperType;}else{_717=this.defaultWrapperType;}}if(!_719){if(_716.metadata.customEditorSettings&&_716.metadata.customEditorSettings.uiType){_719=_716.metadata.customEditorSettings.uiType;}else{if(_716.metadata.uiType){_719=_716.metadata.uiType;}else{_719="epi/shell/widget/FormContainer";lang.mixin(_718,{metadata:_716.metadata,onFieldCreated:function(_71a,_71b){}});}}}if(!_719){throw ("Could not resolve editor widget for property: "+_716.name);}if(_716.metadata.customEditorSettings&&_716.metadata.customEditorSettings.uiParams){lang.mixin(_718,_716.metadata.customEditorSettings.uiParams);}var _71c=this._registeredEditorWrappers[_717];if(!_71c){throw ("No suitable editor wrapper found for type: "+_717);}var data={wrapperInitializer:_71c.initializer,wrapperType:_71c.wrapperClassType,editorWidgetType:_719,editorParams:_718};this.onEditorResolved(data,_716);if(_717){return data;}throw ("No suitable editor found");},createEditor:function(_71d,node,_71e,_71f){var def=new _70e();var _720=this._getWrapperAndEditor(_71d);var _721=_720.wrapperType;var _722=_720.editorWidgetType;require([_721,_722],lang.hitch(this,function(_723){var _724=_71f||{};if(_71d.metadata){lang.mixin(_724,_71d.metadata.settings);lang.mixin(_724,_720.editorParams);_724.selections=_71d.metadata.selections;}var _725={wrapperType:_720.wrapperType,editorWidgetType:_720.editorWidgetType,editorParams:_724,blockDisplayNode:node,overlayItem:_724.overlayItem,property:_71d,propertyName:_71d.name,propertyDisplayName:_71d.metadata.displayName,value:_71e,contentModel:_71d.contentModel};var _726=new _723(_725);var _727=_720.wrapperInitializer;if(_727){lang.mixin(_725.editorParams,{parent:_726});_727(_726,_725);}this.onEditorCreated(_726.getEditorWidget());def.resolve(_726);}));return def;}});});},"epi-cms/contentediting/InUseNotificationManager":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","dojo/when","dojo/date","dojo/aspect","epi","epi/username","epi/dependency","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.contentediting.permanenteditindication"],function(lang,_728,_729,when,_72a,_72b,epi,_72c,_72d,_72e,_72f,res){return _729([],{contextTypeName:"",_postFlag:false,_inUseNotificationStore:null,_currentUsername:null,_messageService:null,currentModel:null,_eventHandlers:null,ignoreOthersNotifications:null,constructor:function(_730){this.inherited(arguments);lang.mixin(this,_730);this._inUseNotificationStore=this.store||_72d.resolve("epi.storeregistry").get("epi.cms.inusenotification");this._currentUsername=this.username||_72e.userName;this._messageService=this.messageService||_72d.resolve("epi.shell.MessageService");this._eventHandlers=[];},updateCommandModel:function(_731){this.inherited(arguments);if(this.currentModel&&!_72f.compareIgnoreVersion(this.currentModel.contentData.contentLink,_731.contentData.contentLink)){this.ignoreOthersNotifications=false;}this.currentModel=_731;_728.forEach(this._eventHandlers,function(_732){_732.remove();});this.updateMessageService(this.currentModel.contentData);this._eventHandlers=[_72b.after(_731,"suspend",lang.hitch(this,this._onViewModelSuspended)),_72b.after(_731,"destroyed",lang.hitch(this,this._onViewModelSuspended)),_72b.after(_731,"onPropertyEdited",lang.hitch(this,this._onPropertyEdited)),_72b.around(_731,"canChangeContent",lang.hitch(this,this._canChangeContentAdvisor))];},_canChangeContentAdvisor:function(_733){return lang.hitch(this,function(){if(!this.ignoreOthersNotifications){var _734=this.getOtherUsersInUseNotifications(this.currentModel.contentData.inUseNotifications);if(_734&&_734.length){return false;}}return _733.apply(this.currentModel,arguments);});},_onViewModelSuspended:function(){var _735=this.currentModel.contentData;this.removeAutomaticInUseNotification(_735);},_onPropertyEdited:function(){var _736=this.currentModel.contentData;this.ensureAutomaticInUseNotification(_736);},ensureAutomaticInUseNotification:function(_737){var _738;_728.some(_737.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()){_738=item;return true;}},this);if(!_738){return this.put(this._createNotification(_737,false),_737.inUseNotifications);}else{if(_738.addedManually){return;}else{var _739=new Date(_738.modified);if(_72a.difference(_739,new Date(),"minute")>30){return this.put(_738,_737.inUseNotifications);}}}},removeAutomaticInUseNotification:function(_73a){_728.forEach(_73a.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&!item.addedManually){this.remove(item,_73a.inUseNotifications);}},this);},_createNotification:function(_73b,_73c){var _73d=(new Date()).toISOString();return {contentLink:_73b.contentLink,languageBranch:_73b.currentLanguageBranch&&_73b.currentLanguageBranch.languageId,addedManually:_73c,created:_73d,modified:_73d};},put:function(_73e,_73f){_73e.modified=(new Date()).toISOString();if(!this._postFlag){this._postFlag=true;return when(this._inUseNotificationStore.put(_73e),lang.hitch(this,function(_740){var _741;var _742=_728.some(_73f,function(item,_743){if(_740.id===item.id){_741=_743;return true;}return false;});if(_742&&_741>=0){_73f[_741]=_740;}else{_73f.push(_740);}this._updateDependentStores(_73e.contentLink,_73f);this._postFlag=false;}));}},remove:function(_744,_745){return when(this._inUseNotificationStore.remove(_744.id),lang.hitch(this,function(){var _746=_728.indexOf(_745,_744);_745.splice(_746,1);this._updateDependentStores(_744.contentLink,_745);}));},_updateDependentStores:function(_747,_748){var _749={contentLink:_747,inUseNotifications:_748};this._inUseNotificationStore.updateDependentStores(_749);},togglePermanentEditIndication:function(_74a,_74b){var _74c;var _74d=_728.some(_74a.inUseNotifications,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()){_74c=item;if(item.addedManually){return true;}}},this);if(_74d){if(_74b&&_74c.convertedFromAutomaticNotification){_74c.addedManually=false;return this.put(_74c,_74a.inUseNotifications);}else{return this.remove(_74c,_74a.inUseNotifications);}}else{if(_74c&&_74b){_74c.convertedFromAutomaticNotification=true;_74c.addedManually=true;}else{_74c=this._createNotification(_74a,true);}return this.put(_74c,_74a.inUseNotifications);}},updateMessageService:function(_74e){var _74f=_74e.contentLink+"_permanentEdit";this._messageService.remove({externalItemId:_74f});var _750=this._getManualInUseNotification(_74e.inUseNotifications);if(_750){this._notificationHandlerId=this._messageService.put("note",res.permanenteditison,this.contextTypeName,_74e.contentLink,_74f,null);}},_getManualInUseNotification:function(_751){var _752;var _753=_728.forEach(_751,function(item){if(item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&item.addedManually){_752=item;}},this);return _752;},currentUserHasInUseNotification:function(_754,_755){return _728.some(_754,function(item){return item.userName.toLowerCase()===this._currentUsername.toLowerCase()&&(!_755||item.addedManually);},this);},getOtherUsersInUseNotifications:function(_756){var _757=[];_728.forEach(_756,function(item){if(item.userName.toLowerCase()!==this._currentUsername.toLowerCase()){var _758=_72c.toUserFriendlyString(item.userName,this._currentUsername);_757.push(_758);}},this);return _757;},hasInUseNotificationWarning:function(_759){if(this.ignoreOthersNotifications){return false;}return this.getOtherUsersInUseNotifications(_759).length;}});});},"epi-cms/contentediting/ViewSettingsManager":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/topic","dojo/Stateful","epi/epi","epi/dependency","epi/UriParser"],function(_75a,_75b,lang,_75c,_75d,epi,_75e,_75f){return _75a([_75d],{_hashWrapper:null,viewSettings:null,_viewSettingsMap:null,viewSettingsHashValue:null,_activeKey:"active",enabled:false,previewParams:null,postscript:function(){this.inherited(arguments);this._hashWrapper=this._hashWrapper||_75e.resolve("epi.shell.HashWrapper");this.previewParams={};this.viewSettingsHashValue=[];this._viewSettingsMap={};_75b.forEach(this.viewSettings,lang.hitch(this,function(_760){if(!this._viewSettingsMap[_760.key]){this._viewSettingsMap[_760.key]=_760;}else{throw "Duplicated view settings key.";}}));_75c.subscribe("/epi/cms/action/viewsettingvaluechanged",lang.hitch(this,this._viewSettingChanged));_75c.subscribe("/epi/cms/action/eyetoggle",lang.hitch(this,this._viewSettingEnabledChanged));var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){this.viewSettingsHashValue=this._toObjects(obj.viewsetting);}this.enabled=this._loadProperty(this._activeKey)==="true";_75b.forEach(this.viewSettingsHashValue,lang.hitch(this,function(item){var _761=this._viewSettingsMap[item.type];if(_761){_761.set("enabled",this.get("enabled"));_761.value=item.id;_761.beforePreviewLoad(this.previewParams,this.get("enabled"));}}));},onPreviewReady:function(_762){this._preview=_762;_75b.forEach(this.viewSettings,lang.hitch(this,function(_763){_763.afterPreviewLoad(_762,this.get("enabled"));}));},getSettingProperty:function(_764){var _765=_75b.filter(this.viewSettingsHashValue,function(_766){return _766.type===_764;});return _765.length>0?_765[0].id:null;},hasVisitorGroup:function(){return this.getSettingProperty("visitorgroup")!==null&&this.getSettingProperty("visitorgroup").id!==null;},_enabledGetter:function(){return this.enabled;},_enabledSetter:function(_767){this.enabled=_767;var _768={};_75b.forEach(this.viewSettings,lang.hitch(this,function(_769){_769.set("enabled",_767);_769.beforePreviewLoad(_768,_767);}));if(!epi.areEqual(this.previewParams,_768)){this.previewParams=_768;}else{_75b.forEach(this.viewSettings,lang.hitch(this,function(_76a){_76a.afterPreviewLoad(this._preview,_767);}));}},_applyViewSettingValue:function(key,_76b){var _76c,_76d=this._viewSettingsMap[key];if(_76d){_76c=lang.clone(this.previewParams);_76d.value=_76b;_76d.beforePreviewLoad(_76c,true);if(!epi.areEqual(this.previewParams,_76c)){this.previewParams=_76c;}else{_76d.afterPreviewLoad(this._preview,true);}}},_viewSettingChanged:function(key,_76e){var self=this;this._commitToHash(function(){var _76f=key;if(!(key instanceof Array)){_76f=[{key:key,value:_76e}];}_76f.forEach(function(_770){self._saveProperty(_770.key,_770.value);self._applyViewSettingValue(_770.key,_770.value);});});},_viewSettingEnabledChanged:function(_771){var self=this;this._commitToHash(function(){var _772=self._hasSetting();if(_771){self._saveProperty(self._activeKey,"true");}else{self._saveProperty(self._activeKey,_772?false:null);}self.set("enabled",_771);});},_addProperty:function(_773,_774){this.viewSettingsHashValue.push({type:_773,id:_774});},_updateProperty:function(_775,_776){var _777=-1;_75b.forEach(this.viewSettingsHashValue,function(item,_778){if(item.type===_775){_777=_778;return;}});if(_777>-1){this.viewSettingsHashValue[_777].id=_776;}else{this._addProperty(_775,_776);}},_toObjects:function(url){var _779=[];_75b.forEach(url.split("|"),function(item,_77a){var uri=new _75f(item);_779.push({type:uri.getType(),id:uri.getId()});});return _779;},_deleteProperty:function(_77b){var _77c=-1;_75b.forEach(this.viewSettingsHashValue,function(item,_77d){if(item.type===_77b){_77c=_77d;return;}});if(_77c>-1){this.viewSettingsHashValue.splice(_77c,1);}},_commitToHash:function(_77e){var obj=this._hashWrapper.getHash();var _77f=[];if(obj&&obj.viewsetting){this.set("viewSettingsHashValue",this._toObjects(obj.viewsetting));}else{this.set("viewSettingsHashValue",[]);}_77e();_75b.forEach(this.viewSettingsHashValue,function(item,_780){_77f.push(item.type+":///"+item.id);});if(_77f.length>0){obj.viewsetting=_77f.join("|");}else{delete obj.viewsetting;}this._hashWrapper.setHash(obj);},_saveProperty:function(_781,_782){if(this.get("viewSettingsHashValue")){if(_782!=null){this._updateProperty(_781,_782);}else{this._deleteProperty(_781);}}else{if(_782!=null){this._updateProperty(_781,_782);}}},_loadProperty:function(_783){var obj=this._hashWrapper.getHash();var _784=null;if(obj&&obj.viewsetting){var _785=this._toObjects(obj.viewsetting);var _786=_75b.filter(_785,function(item){return item.type===_783;})[0];if(_786){_784=_786.id;}}return _784;},_hasSetting:function(){var obj=this._hashWrapper.getHash();if(obj&&obj.viewsetting){if(obj.viewsetting.split("|").length>1){return true;}}return false;},getRenderingViewSettings:function(){return _75b.filter(this.viewSettings,lang.hitch(this,function(_787){return _787.usedForRendering;}));}});});},"epi-cms/content-approval/ApprovalService":function(){define(["dojo/_base/declare","dojo/when","dojo/Deferred","dojo/Stateful","epi/shell/xhr/errorHandler","epi/dependency"],function(_788,when,_789,_78a,_78b,_78c){return _788([_78a],{approvalStore:null,approvalDefinitionStore:null,postscript:function(){this.inherited(arguments);this.approvalStore=this.approvalStore||_78c.resolve("epi.storeregistry").get("epi.cms.approval");this.approvalDefinitionStore=this.approvalDefinitionStore||_78c.resolve("epi.storeregistry").get("epi.cms.approval.definition");},getApproval:function(_78d){return when(this.approvalStore.get(_78d)).otherwise(function(){return null;});},approveChanges:function(_78e){return _78b.wrapXhr(this.approvalStore.executeMethod("ApproveChanges",_78e.id,{activeStepIndex:_78e.activeStepIndex}));},forceCompleteApproval:function(_78f){var _790=this.approvalStore.executeMethod("ForceComplete",_78f.id);return _78b.wrapXhr(_790);},rejectChanges:function(_791){return _78b.wrapXhr(this.approvalStore.executeMethod("RejectChanges",_791.id,{activeStepIndex:_791.activeStepIndex}));},cancelChanges:function(_792){return _78b.wrapXhr(this.approvalStore.executeMethod("CancelChanges",_792.id));},getDefinition:function(_793){return when(this.approvalDefinitionStore.get(_793)).otherwise(function(){return null;});},hasDefinition:function(_794){return this.getDefinition(_794).then(function(_795){return _795!==null&&_795.id!==0;});},saveDefinition:function(_796){if(!_796){return new _789().reject();}return _78b.wrapXhr(this.approvalDefinitionStore.put(_796));},deleteDefinition:function(_797){return _78b.wrapXhr(this.approvalDefinitionStore.remove(_797));},inheritDefinition:function(_798){return _78b.wrapXhr(this.approvalDefinitionStore.executeMethod("Inherit",_798));}});});},"epi/shell/xhr/errorHandler":function(){define("epi/shell/xhr/errorHandler",["dojo/_base/declare","dojo/when","dojo/_base/json","dgrid/List","dgrid/extensions/DijitRegistry","../widget/dialog/Alert","../widget/dialog/ErrorDialog"],function(_799,when,json,List,_79a,_79b,_79c){var _79d=_799([List,_79a]),_79e;function _79f(_7a0){if(typeof _7a0==="string"){try{return json.fromJson(_7a0);}catch(e){console.warn("Failed to parse responseText as json",e);}}return {};};_79e={forXhr:function(_7a1){var data,_7a2,list;if(_7a1.status>=500){_79c.showXmlHttpError(_7a1,_7a1);}else{data=_79f(_7a1.responseText);_7a2={description:data.message||_7a1.message};if(data.additionalInformation instanceof Array){list=new _79d({className:"epi-grid-max-height--300"});list.renderArray(data.additionalInformation);list.startup();_7a2.content=list;}new _79b(_7a2).show();}},wrapXhr:function(_7a3){_7a3=when(_7a3);_7a3.otherwise(_79e.forXhr);return _7a3;}};return _79e;});},"epi/shell/widget/dialog/ErrorDialog":function(){define("epi/shell/widget/dialog/ErrorDialog",["dojo","dijit/Dialog"],function(dojo,_7a4){return function(){var _7a5=null;var _7a6="/shell/cms/errordialog/";var _7a7={title:"A background request has failed",reloadtext:"Reload",heading:"An unhandled error has occured in a background request.",description:"The page may not function properly unless it's reloaded. Press the button below to reload the page now."};var _7a8="        <div style=\"padding-bottom:10px; width:600px\">             <h1>${heading}</h1>             <div style=\"background-color:#FFF; border:1px solid #000; padding:3px\">${errorMessage}</div>             <p>${description}</p>             <input type=\"button\" onclick=\"document.location.reload()\" value=\"${reloadtext}\" />         </div>     ";function _7a9(){if(!_7a5){_7a5=new _7a4();}return _7a5;};function _7aa(_7ab,_7ac){var _7ad=dojo.create("div",{innerHTML:dojo.string.substitute(_7a8,dojo.mixin({errorMessage:_7ab},_7a7))});var _7ae=dojo.create("iframe",{style:"width:100%; height:400px; border:inset 1px #CCC",frameborder:"0",width:"600",height:"400",src:"about:blank"});if(_7ae.attachEvent){var _7af=function(){_7ae.detachEvent("onload",_7af);_7ae.contentWindow.document.write(_7ac);};_7ae.attachEvent("onload",_7af);}else{var _7b0=dojo.connect(_7ae,"load",null,function(){dojo.disconnect(_7b0);_7ae.contentWindow.document.write(_7ac);});}dojo.place(_7ae,_7ad);return _7ad;};var pub={getTextResourceKeys:function(){var _7b1=[];for(var p in _7a7){_7b1.push(_7a6+p);}return _7b1;},setTextResources:function(keys){if(!dojo.isArray(keys)){return;}dojo.forEach(keys,function(item){if(dojo.isString(item.key)&&dojo.isString(item.text)){_7a7[item.key.replace(_7a6,"")]=item.text;}});},showXmlHttpError:function(_7b2,_7b3){var _7b4=_7a9();var _7b5="";var _7b6="";if(_7b3&&_7b3.xhr){_7b5=_7b3.xhr.responseText;}if(dojo.isObject(_7b2)&&dojo.isString(_7b2.message)){_7b6=_7b2.message;}else{_7b6=_7b2;}var _7b7=_7aa(_7b6,_7b5);_7b4.set("title",_7a7.title);_7b4.set("content",_7b7);_7b4.show();}};return pub;}();});},"epi-cms/project/ProjectService":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","dojo/promise/all","dojo/Evented","dojo/aspect","dijit/Destroyable","epi/dependency","epi/shell/xhr/errorHandler","epi-cms/ApplicationSettings","epi-cms/core/ContentReference"],function(_7b8,lang,when,_7b9,all,_7ba,_7bb,_7bc,_7bd,_7be,_7bf,_7c0){return _7b8([_7ba,_7bc],{isProjectModeEnabled:false,projectItemStore:null,projectStore:null,_currentProjectProfileKey:"epi.current-project-id",constructor:function(_7c1){_7b8.safeMixin(this,_7c1);this.projectItemStore=this.projectItemStore||_7bd.resolve("epi.storeregistry").get("epi.cms.project.item");this.projectStore=this.projectStore||_7bd.resolve("epi.storeregistry").get("epi.cms.project");this.profile=this.profile||_7bd.resolve("epi.shell.Profile");this.isProjectModeEnabled=_7bf.isProjectModeEnabled;this.own(this.projectItemStore.on("update",this._onProjectItemUpdated.bind(this)),this.projectItemStore.on("delete",this._onProjectItemRemoved.bind(this)),this.projectStore.on("update",this._onProjectUpdated.bind(this)),this.projectStore.on("delete",this._onProjectRemoved.bind(this)));},hasScheduledProjectItems:function(_7c2){return _7be.wrapXhr(this.projectStore.refresh(_7c2)).then(function(_7c3){return _7c3.itemStatusCount.delayedpublish>0||_7c3.itemStatusCount.delayedpublish_nopublishaccess>0;}.bind(this));},getProjectItemsForContent:function(_7c4){if(!(_7c4 instanceof Array)){_7c4=[_7c4];}return when(this.projectItemStore.query({contentLinks:_7c4}));},getProjectItemForContent:function(_7c5){var _7c6=new _7c0(_7c5);if(_7c6.workId===0){return new _7b9().reject("The content link needs to be version specific");}return this.getProjectItemsForContent(_7c5).then(function(_7c7){for(var i=0;i<_7c7.length;i++){if(_7c7[i].contentLink===_7c5){return _7c7[i];}}return null;});},getProjectsForContent:function(_7c8){var self=this;if(!(_7c8 instanceof Array)){_7c8=[_7c8];}return this.getProjectItemsForContent(_7c8).then(function(_7c9){if(_7c9.length===0){return new _7b9().resolve([]);}return self.getProjects(_7c9);});},canAddContent:function(_7ca,_7cb){var _7cc=_7cb.filter(function(elem,pos){return _7cb.indexOf(elem)===pos;});return this.projectStore.executeMethod("CanAddContent",_7ca,{contentReferences:_7cc});},getProjects:function(_7cd){var _7ce=this.projectStore;var _7cf=_7cd.map(function(_7d0){return _7ce.get(_7d0.projectId);});return all(_7cf);},exists:function(_7d1){return _7be.wrapXhr(this.projectStore.executeMethod("exists",_7d1));},addProjectItems:function(_7d2,_7d3){_7d3=_7d3.filter(function(_7d4,pos){if(_7c0.isContentReference(_7d4)&&_7d3.indexOf(_7d4)===pos){return true;}});var _7d5=this.projectItemStore,_7d6=_7d3.map(function(_7d7){return _7d5.add({contentLink:_7d7,projectId:_7d2});});return _7be.wrapXhr(all(_7d6));},removeProjectItems:function(_7d8){var _7d9=_7d8.map(function(item){return item.id;});return _7be.wrapXhr(this.projectItemStore.removeRange(_7d9));},markAsReadyForReview:function(_7da){return _7be.wrapXhr(this.projectItemStore.executeMethod("ReadyForReview","",_7da));},markAsReadyToPublish:function(_7db){return _7be.wrapXhr(this.projectItemStore.executeMethod("ReadyToPublish","",_7db));},isPartOfDelayedPublishedProject:function(_7dc){return this.getProjectsForContent([_7dc]).then(function(_7dd){return _7dd.some(function(_7de){return _7de.status==="delayedpublished";});});},publishProject:function(_7df,_7e0){var _7e1=this.projectStore;if(isNaN(_7df)){throw new Error("projectId is not a number");}return _7be.wrapXhr(_7e1.executeMethod("Publish",_7df,{delayPublishUntil:_7e0})).then(_7e1.patchCache.bind(_7e1));},reactivateProject:function(_7e2){var _7e3=this.projectStore;if(isNaN(_7e2)){throw new Error("The given project ID is not a number.");}return _7be.wrapXhr(_7e3.executeMethod("Reactivate",_7e2)).then(_7e3.patchCache.bind(_7e3));},getCurrentProjectId:function(){if(!this.isProjectModeEnabled){return new _7b9().resolve(null);}return when(this.profile.get(this._currentProjectProfileKey));},getCurrentProject:function(){var _7e4=this.projectStore;var that=this;return this.getCurrentProjectId().then(function(_7e5){if(!_7e5){return null;}return when(_7e4.get(_7e5)).otherwise(function(ex){if(ex.status===404){that.setCurrentProject(null);}return null;});});},setCurrentProject:function(_7e6){this.emit("currentProjectChanged",_7e6);return this.profile.set(this._currentProjectProfileKey,_7e6&&_7e6.id,{location:"server"});},_onProjectItemUpdated:function(_7e7){this.emit("project-item-updated",_7e7.target);},_onProjectItemRemoved:function(_7e8){this.emit("project-item-removed",_7e8.id);},_onProjectUpdated:function(_7e9){this.emit("project-updated",_7e9.target);},_onProjectRemoved:function(_7ea){this.emit("project-removed",_7ea.id);}});});},"epi-cms/project/ActivityService":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","dijit/Destroyable","epi/dependency"],function(_7eb,lang,_7ec,_7ed,_7ee){return _7eb([_7ec,_7ed],{activityStore:null,activityCommentStore:null,constructor:function(_7ef){_7eb.safeMixin(this,_7ef);this.activityStore=this.activityStore||_7ee.resolve("epi.storeregistry").get("epi.cms.activities");this.activityCommentStore=this.activityCommentStore||_7ee.resolve("epi.storeregistry").get("epi.cms.activities.comments");this.own(this.activityCommentStore.on("update",this._onActivityCommentUpdated.bind(this)));},addMessage:function(_7f0,_7f1,_7f2){var obj={projectId:_7f0,contentLink:_7f1,message:_7f2};return this.activityStore.add(obj);},saveMessage:function(_7f3,_7f4){var obj={id:_7f3,message:_7f4};return this.activityStore.put(obj);},addComment:function(_7f5,_7f6){var obj={activityId:_7f5,message:_7f6};return this.activityCommentStore.add(obj);},saveComment:function(_7f7,_7f8){var obj={id:_7f7,message:_7f8};return this.activityCommentStore.put(obj);},_onActivityCommentUpdated:function(_7f9){this.emit("activity-comment-updated",_7f9.target);}});});},"epi-cms/notification/NotificationService":function(){define(["dojo/_base/declare","dojo/when","dojo/Deferred","dojo/Stateful","dojo/Evented","dijit/Destroyable","epi/shell/xhr/errorHandler","epi/dependency"],function(_7fa,when,_7fb,_7fc,_7fd,_7fe,_7ff,_800){return _7fa([_7fc,_7fd,_7fe],{notificationStore:null,postscript:function(){this.inherited(arguments);this.notificationStore=this.notificationStore||_800.resolve("epi.storeregistry").get("epi.cms.notification");this.own(this.notificationStore.on("add",this._onNotificationUpdated.bind(this)),this.notificationStore.on("update",this._onNotificationUpdated.bind(this)));},_onNotificationUpdated:function(_801){this.emit("notification-updated",_801.target);},getUnreadNotificationCount:function(){return _7ff.wrapXhr(this.notificationStore.executeMethod("GetUnreadCount"));},markAsRead:function(_802){if(!_802){return new _7fb().reject();}return _7ff.wrapXhr(this.notificationStore.executeMethod("MarkAsRead",_802)).then(this.notificationStore.refresh.bind(this.notificationStore,_802));},markAllAsRead:function(){return _7ff.wrapXhr(this.notificationStore.executeMethod("MarkAllAsRead"));}});});},"epi-cms/project/request/projectMode":function(){define(["dojo/Deferred","dojo/when","epi/dependency"],function(_803,when,_804){return {_getCurrentProjectId:function(){var _805="epi.cms.ProjectService";if(_804.exists(_805)){var _806=_804.resolve(_805);return _806.getCurrentProjectId();}return when(null);},beforeSend:function(_807){var _808=_807.options;if(_808.isProfileRequest){return when(_807);}var _809=new _803();this._getCurrentProjectId().then(function(_80a){if(_80a){_808.headers["X-EPiCurrentProject"]=_80a;}}).otherwise(function(err){console.error("Failed to get current project id from project service",err);}).always(function(){_809.resolve(_807);});return _809.promise;}};});},"epi-cms/request/contentLanguage":function(){define(["dojo/Deferred","dojo/when","epi/dependency"],function(_80b,when,_80c){return {beforeSend:function(_80d){var _80e=new _80b();var _80f=_80d.options;if(!(_80f.preventLocalizationHeader||_80f.isProfileRequest)){var _810=_80c.resolve("epi.shell.Profile");when(_810.getContentLanguage()).then(function(_811){if(_811){_80f.headers["X-EPiContentLanguage"]=_811;}_80e.resolve(_80d);});return _80e.promise;}_80e.resolve(_80d);return _80e.promise;}};});},"epi-cms/project/ProjectModeRequestInterceptor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dijit/Destroyable","epi/dependency"],function(_812,lang,_813,_814,_815){return _812([_814],{constructor:function(_816){_812.safeMixin(this,_816);this.projectService=this.projectService||_815.resolve("epi.cms.ProjectService");this.contextService=this.contextService||_815.resolve("epi.shell.ContextService");this.own(this.contextService.registerRequestInterceptor(lang.hitch(this,this._onInterceptRequest)));},_onInterceptRequest:function(_817){var dfd=new _813();if(!this.projectService.isProjectModeEnabled){dfd.resolve();}else{this.projectService.getCurrentProject().then(function(_818){if(_818){_817.epiprojects=_818.id;_817.epieditmode=true;}}).always(dfd.resolve);}return dfd.promise;}});});},"epi-cms/project/ProjectItemQueryEngine":function(){define(["epi-cms/core/ContentReference","epi/shell/store/queryUtils"],function(_819,_81a){return function(_81b,_81c){_81c=_81c||{};_81c.comparers={contentLinks:function(_81d,_81e){return _81d.some(function(link){return _819.compareIgnoreVersion(link,_81e.contentLink);});}};return _81a.createEngine(_81b,_81c);};});},"epi-cms/contentediting/command/Editing":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi/shell/command/withConfirmation","epi/shell/_StatefulGetterSetterMixin","epi-cms/command/TranslateContent","epi-cms/contentediting/command/RevertToPublished","epi-cms/contentediting/command/SendForReview","epi-cms/contentediting/command/Publish","epi-cms/contentediting/command/CreateDraft","epi-cms/contentediting/command/Withdraw","epi-cms/contentediting/command/ManageExpiration","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_81f,lang,_820,_821,_822,_823,_824,_825,_826,_827,_828,_829,_82a){var _82b=_81f([_820,_822],{model:null,revertToPublished:null,translate:null,createDraft:null,sendForReview:null,publish:null,withdraw:null,manageExpiration:null,constructor:function(_82c){lang.mixin(this,_82c);this.revertToPublished=_821(new _824(),null,{title:_82a.reverttopublishconfirmation.dialogtitle,heading:_82a.reverttopublishconfirmation.confirmquestion,description:_82a.reverttopublishconfirmation.description});this.translate=new _823();this.createDraft=new _827();this.sendForReview=new _825();this.publish=new _826();this.withdraw=new _828();this.manageExpiration=new _829();},_setModelAttr:function(_82d){this._set("model",_82d);this.revertToPublished.set("model",_82d);this.translate.set("model",_82d);this.createDraft.set("model",_82d);this.sendForReview.set("model",_82d);this.publish.set("model",_82d);this.withdraw.set("model",_82d);this.manageExpiration.set("model",_82d);}});return new _82b();});},"epi/shell/command/withConfirmation":function(){define("epi/shell/command/withConfirmation",["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","epi/shell/widget/dialog/Confirmation"],function(_82e,lang,when,_82f,_830){function _831(_832){var _833=new _82f(),_834=new _830(_832);_834.connect(_834,"onAction",function(_835){if(_835){_833.resolve();}else{_833.cancel();}});_834.show();return _833.promise;};return function(_836,_837,_838){var _839=_836._execute;_836._execute=function(){var _83a=new _82f();function _83b(){when(_839.apply(_836,arguments),_83a.resolve,_83a.cancel);};_837=_837||_831;when(_837(_838),_83b,_83a.cancel);return _83a;};return _836;};});},"epi-cms/command/TranslateContent":function(){define(["dojo/_base/declare","dojo/topic","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.translate","epi/shell/command/_Command"],function(_83c,_83d,_83e,_83f){return _83c([_83f],{label:_83e.label,executingLabel:_83e.executinglabel,tooltip:_83e.title,category:"context",_execute:function(){var _840=this._getNormalizedModel();if(typeof this.executeDelegate==="function"){this.executeDelegate(this.model);}else{var data={contentData:_840.content,languageBranch:_840.language.preferredLanguage};_83d.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateLanguageBranch",null,data);}},_onModelChange:function(){var _841=this._getNormalizedModel(),_842=_841&&_841.language,_843=_841&&_841.content.isDeleted,_844=_842&&_842.isTranslationNeeded&&!_843,_845=_844&&_842.hasTranslationAccess&&_842.isPreferredLanguageAvailable;if(_841&&typeof _841.content.canTranslateContent==="function"){var _846=_841.content.canTranslateContent();_844=_844&&_846;_845=_845&&_846;}this.set("isAvailable",!!_844);this.set("canExecute",!!_845);},_getNormalizedModel:function(){var _847=this.model;if(_847){return {content:_847.contentData||_847,language:_847.languageContext||_847.missingLanguageBranch};}}});});},"epi-cms/contentediting/command/RevertToPublished":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_848,lang,_849,_84a,_84b){return _848([_849],{name:"reverttopublished",tooltip:_84b.reverttopublished.title,label:_84b.reverttopublished.label,iconClass:"epi-iconRevert",_hasPendingChangeWatch:null,_execute:function(){this.model.revertToPublished();},_onModelChange:function(){this.inherited(arguments);var _84c=this.model.contentData,_84d=_84c.status,_84e=_84a.versionStatus;var _84f=_84d===_84e.CheckedOut||_84d===_84e.Rejected;this.set("isAvailable",_84f);if(this._hasPendingChangeWatch){this._hasPendingChangeWatch.unwatch();}this._hasPendingChangeWatch=this.model.watch("hasPendingChanges",lang.hitch(this,function(name,_850,_851){var _852=this._getCanExecute(_84c,_84e);this.set("canExecute",!_851&&_852);}));this.set("canExecute",_84f&&this._getCanExecute(_84c,_84e));},_getCanExecute:function(_853,_854){return _853.publishedBy!==null&&_853.publishedBy!==undefined&&_853.status!==_854.Published&&_853.status!==_854.Expired&&this.model.canChangeContent()&&_84a.hasAccess(_853.accessMask,_84a.accessLevel.Delete);}});});},"epi-cms/contentediting/command/_ContentCommandBase":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_Command"],function(_855,lang,_856){return _855([_856],{_isChangingContentStatusHandle:null,checkDeleted:true,_defaultCanExecute:this.canExecute,destroy:function(){if(this._isChangingContentStatusHandle){this._isChangingContentStatusHandle.unwatch();}this.inherited(arguments);},_canExecuteGetter:function(){if(!this.model||!this.model.contentData){return false;}var _857=this.model.contentData;return this.canExecute&&(!this.checkDeleted||(_857&&!_857.isDeleted));},_onModelChange:function(){this.inherited(arguments);if(this._isChangingContentStatusHandle){this._isChangingContentStatusHandle.unwatch();}var _858=this._defaultCanExecute;this._isChangingContentStatusHandle=this.model.watch("isChangingContentStatus",lang.hitch(this,function(name,_859,_85a){if(_85a){_858=this.canExecute;this.set("canExecute",false);}else{this.set("canExecute",_858);}}));}});});},"epi-cms/contentediting/command/SendForReview":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_85b,_85c,_85d,_85e,_85f){return _85b([_85e],{label:_85f.sendforreview.label,executingLabel:_85f.sendforreview.executinglabel,tooltip:_85f.sendforreview.title,iconClass:"epi-iconCheckmark",action:_85d.saveAction.CheckIn,_execute:function(){_85c.publish("/epi/cms/action/disableundoredoactions");return this.inherited(arguments);}});});},"epi-cms/contentediting/command/_ChangeContentStatus":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/command/_ContentCommandBase"],function(_860,_861,_862){return _860([_862],{action:null,canExecute:true,forceReload:false,viewName:null,_defaultCanExecute:true,_execute:function(){return this.model.changeContentStatus(this.action).then(this._onContentStatusChange.bind(this));},_onContentStatusChange:function(_863){var _864={uri:"epi.cms.contentdata:///"+_863.id};var _865={sender:this,trigger:"internal",forceContextChange:true,forceReload:this.forceReload};if(this.viewName){_865.viewName=this.viewName;}_861.publish("/epi/shell/context/request",_864,_865);}});});},"epi-cms/contentediting/command/Publish":function(){define(["dojo/_base/declare","dojo/topic","dojo/when","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_866,_867,when,_868,_869,_86a,_86b,_86c){return _866([_86b],{label:_86c.publish.label,executingLabel:_86c.publish.executinglabel,tooltip:_86c.publish.title,iconClass:"epi-iconPublished",action:_86a.saveAction.Publish,forceReload:true,_execute:function(){return when(this.inherited(arguments)).then(function(_86d){var _86e=new _869(_86d.oldId).createVersionUnspecificReference().toString();_867.publish("/epi/cms/contentdata/childrenchanged",_86e);});},_onModelChange:function(){this.inherited(arguments);var _86f=this.model.contentData,res=null;switch(_86f.status){case _86a.versionStatus.PreviouslyPublished:res=_86c.republish;break;case _86a.versionStatus.CheckedOut:if(_86f.isMasterVersion){res=_86c.publish;}else{res=_86c.publishchanges;}break;default:res=_86c.publishchanges;}var _870=_868.getValue(_86f.typeIdentifier,"publishView");this.set("label",res.label);this.set("title",res.title);this.set("executingLabel",res.executinglabel);this.set("viewName",_870);}});});},"epi-cms/contentediting/command/CreateDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_871,_872,_873,_874){return _871([_872],{name:"createdraft",label:_874.createdraft.label,tooltip:_874.createdraft.title,iconClass:"epi-iconPage",ignoreContentStatus:false,_execute:function(){this.model.createDraft();},_onModelChange:function(){var _875=this.model.contentData,_876=_875.status,_877=_873.versionStatus,_878,_879;this.inherited(arguments);_878=_873.hasAccessToAction(_875,_873.action.Edit,_873.providerCapabilities.Edit);_879=this.ignoreContentStatus||_876===_877.DelayedPublish||(_876===_877.Published||_876===_877.PreviouslyPublished)&&!_875.isCommonDraft;this.set({canExecute:_878&&_879,isAvailable:_878&&_879});}});});},"epi-cms/contentediting/command/Withdraw":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_87a,_87b,_87c,_87d){return _87a([_87c],{label:_87d.withdraw.label,tooltip:_87d.withdraw.title,iconClass:"epi-iconPen",action:_87b.saveAction.CheckOut|_87b.saveAction.ForceCurrentVersion});});},"epi-cms/contentediting/command/ManageExpiration":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","epi","epi/datetime","epi-cms/contentediting/ExpirationDialog","epi-cms/contentediting/viewmodel/ExpirationDialogViewModel","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/nls/episerver.shared"],function(_87e,_87f,_880,lang,epi,_881,_882,_883,_884,_885,_886,_887,_888){return _87f([_885],{label:_887.dialogtitle,tooltip:_887.dialogtitle,viewModel:null,cssClass:"epi-chromelessButton epi-visibleLink",_execute:function(){var _889=this.createDialog();_889.on("execute",lang.hitch(this,this._onExecute));_889.show();},createDialog:function(){var _88a=this.get("viewModel");var _88b=new _882({model:_88a});return new _886({defaultActionsVisible:false,confirmActionText:_888.action.save,content:_88b,title:_887.dialogtitle});},_onModelChange:function(){var _88c=this.get("model");if(!_88c||!_88c.contentData){this.set("canExecute",false);return;}var _88d=_88c.contentData.properties,_88e=_88d.iversionable_expire;var _88f=_88c.canChangeContent()&&_884.hasAccess(_88c.contentData.accessMask,_884.accessLevel.Publish);this.set("canExecute",false);_880.when(_88c.getPropertyMetaData("iversionable_expire"),lang.hitch(this,function(_890){this.set("viewModel",new _883({metadata:_890,contentLink:_88c.contentLink,contentName:_88c.contentData.name,value:_88e,minimumExpireDate:_88d.iversionable_startpublish}));this.set("canExecute",_88f);}));},_onExecute:function(_891){var _892=this.get("model");_892.saveAndPublishProperty("iversionable_expire",_891);}});});},"epi-cms/contentediting/ExpirationDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dijit/_CssStateMixin","epi-cms/widget/Breadcrumb","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/ExpirationDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/nls/episerver.shared"],function(_893,lang,_894,_895,_896,_897,_898,_899,_89a,_89b,res,_89c){return _893([_898,_89a,_897,_895,_899],{templateString:_89b,res:res,contentLink:null,contentName:null,baseClass:"epi-statusIndicator",modelBindingMap:{contentLink:["contentLink"],contentName:["contentName"],infoText:["infoText"],state:["state"],enableSaveButton:["enableSaveButton"],showRemoveButton:["showRemoveButton"]},postMixInProperties:function(){this.inherited(arguments);this.set("metadata",this.model.metadata);this.set("value",this.model.value);this.doLayout=false;},_archiveLinkSelector:null,_setContentLinkAttr:function(_89d){this.breadcrumb.set("contentLink",_89d);},_setContentNameAttr:{node:"contentNameNode",type:"innerText"},_setInfoTextAttr:{node:"infoTextNode",type:"innerText"},_setEnableSaveButtonAttr:function(_89e){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!_89e);}},_setShowRemoveButtonAttr:function(_89f){_894.set(this.removeButton.domNode,"display",_89f?"":"none");},_onRemoveButtonClick:function(){var _8a0={stopPublish:null,archiveLink:null};this.set("value",_8a0);this.onChange(_8a0);},onFieldCreated:function(_8a1,_8a2){if(_8a1==="stopPublish"){_8a2.set("minimumValue",this.model.get("minimumExpireDate"));_8a2.set("minimumValueMessage",this.model.get("minimumExpireDateMessage"));}else{if(_8a1==="archiveLink"){this._archiveLinkSelector=_8a2;if(this._archiveLinkSelector.readOnly){this._archiveLinkSelector._keepReadOnly=true;}this._archiveLinkSelector.set("contentLink",this.model.get("contentLink"));}}},onChange:function(_8a3){this.inherited(arguments);this.model.set("intermediateValue",_8a3);},getActions:function(){this._actions=[{name:"save",label:_89c.action.save,settings:{type:"button",disabled:true},action:lang.hitch(this,function(){if(this.validate()){this.model.save();this.executeDialog(this.model.get("value"));}})},{name:"cancel",label:_89c.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.model.reset();this.cancelDialog();})}];return this._actions;}});});},"epi-cms/widget/Breadcrumb":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/when","dojo/query","dojo/NodeList-manipulate","dojo/topic","dijit/_Widget","dijit/layout/_LayoutWidget","epi/dependency","epi-cms/core/ContentReference","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/widget/_HierarchicalModelMixin"],function(_8a4,_8a5,lang,_8a6,_8a7,_8a8,_8a9,_8aa,_8ab,on,when,_8ac,_8ad,_8ae,_8af,_8b0,_8b1,_8b2,_8b3,_8b4){return _8a5([_8b0,_8b4,_8b3],{contentLink:null,store:null,showCurrentNode:true,showLastBracket:false,displayAsText:true,minimumItemCount:null,baseClass:"epi-breadCrumbs",_resizeListener:null,_visibleItems:[],_currentContent:null,_ancestors:null,postMixInProperties:function(){var _8b5=_8b1.resolve("epi.storeregistry");this.store=this.store||_8b5.get("epi.cms.content.light");this.minimumItemCount=this.minimumItemCount||2;},buildRendering:function(){this.domNode=this.ownerDocument.createElement("ul");this.inherited(arguments);},startup:function(){this._addResizeListener();},destroy:function(){if(this._resizeListener){this._resizeListener.remove();}this.destroyDescendants();this.inherited(arguments);},_addResizeListener:function(){if(this._resizeListener){return;}var _8b6=this.getParent(),_8b7=_8b6;while(_8b7&&!_8b7.isLayoutContainer&&_8b7.getParent()){_8b7=_8b7.getParent();}if(_8b7&&_8b7!==_8b6){this._resizeListener=_8a6.after(_8b7,"resize",lang.hitch(this,function(){var _8b8=_8aa.getMarginBox(this.domNode);this.resize(_8b8);}));}},resize:function(_8b9){if(!_8b9&&this._resizeListener){return;}else{this.layout();}},layout:function(){this._visibleItems=[];when(this._buildPath(),lang.hitch(this,function(){var _8ba=_8aa.getContentBox(this.domNode).w;if(_8ba>this._availableWidth){var _8bb=this._leadingItem?_8aa.getMarginBox(this._leadingItem.domNode).w:0;var _8bc=this._availableWidth-_8bb;this._ellipsisize(0,_8bc);}}));},_setContentLinkAttr:function(_8bd){this._set("contentLink",_8bd);this._currentContent=null;this._ancestors=null;this.layout();},_buildPath:function(){var _8be=this.get("contentLink"),def=new _8a7(),path="";if(this._currentContent&&this._ancestors){this._createAllItems();def.resolve(path);}else{if(_8be){var _8bf=new _8b2(_8be);var _8c0=_8bf.createVersionUnspecificReference().toString();when(this.getCurrentContext(),lang.hitch(this,function(ctx){when(this.store.get(_8c0),lang.hitch(this,function(_8c1){this.getAncestors(_8c0,lang.hitch(this,function(_8c2){this._currentContent=_8c1;this._ancestors=_8c2;this._createAllItems();def.resolve(path);}));}));}));}else{def.resolve(path);}}return def.promise;},_createAllItems:function(){this._cleanUp();if(!this.isTypeOfRoot(this._currentContent)){var _8c3=[],_8c4=null;for(var i=this._ancestors.length-1;i>=0;i--){_8c4=this._ancestors[i];if(!_8c4.parentLink){continue;}_8c3.push(_8c4);if(this.isTypeOfRoot(_8c4)){break;}}_8c3.reverse();var _8c5=_8aa.getContentBox(this.domNode).w;this._availableWidth=_8c5>=0?_8c5:0;_8a4.forEach(_8c3,lang.hitch(this,function(_8c6){this._createItem(_8c6,true);}));}if(this.showCurrentNode){this._createItem(this._currentContent,this.showLastBracket);}},_cleanUp:function(){this.destroyDescendants();this._leadingItem=null;this._visibleItems=[];},_createItem:function(_8c7,_8c8){var node,_8c9=_8a9.create("li"),_8ca=this.displayAsText||!_8c7.hasTemplate;if(_8ca){node=_8a9.create("span",null,_8c9);}else{node=_8a9.create("a",{href:"#"},_8c9);this.own(on(node,"click",lang.hitch(this,function(e){this.onNodeClick(e,_8c7);})));}node.textContent=this.isContextualContent(_8c7)?this.getContextualRootName(_8c7):_8c7.name;if(_8c8){_8a9.create("span",{innerHTML:"&gt;","class":"epi-breadCrumbsSeparator"},_8c9);}this._addAndLayout(_8c9);},onNodeClick:function(e,_8cb){e.preventDefault();_8ae.publish("/epi/shell/context/request",{uri:_8cb.uri},{sender:this});},_addAndLayout:function(node){var _8cc=new _8af({},node);this._visibleItems.push(_8cc);this.addChild(_8cc);var _8cd=this._getTotalVisibleItemsSize();if(_8cd>this._availableWidth){this._ensureLeadingItem();while(_8cd>this._availableWidth&&this._visibleItems.length>this.minimumItemCount){var _8ce=this._visibleItems.splice(0,1)[0];_8ab.set(_8ce.domNode,"display","none");_8cd=this._getTotalVisibleItemsSize();}}},_getTotalVisibleItemsSize:function(){var _8cf=0;if(this._leadingItem){_8cf+=_8aa.getMarginBox(this._leadingItem.domNode).w;}_8a4.forEach(this._visibleItems,function(item){_8cf+=_8aa.getMarginBox(item.domNode).w;});return _8cf;},_ensureLeadingItem:function(){if(this._leadingItem){return;}var _8d0=_8a9.create("li"),_8d1=_8a9.create("span",{innerHTML:"..."}),_8d2=_8a9.create("span",{innerHTML:" &gt; ","class":"epi-breadCrumbsSeparator"});_8a9.place(_8d1,_8d0,"last");_8a9.place(_8d2,_8d0,"last");this._leadingItem=new _8af({},_8d0);this.addChild(this._leadingItem,0);},_ellipsisize:function(_8d3,_8d4){if(_8d3>=this._visibleItems.length){return;}var _8d5=this._visibleItems.length-_8d3,_8d6=Math.floor(_8d4/_8d5),item=this._visibleItems[_8d3],_8d7=_8aa.getMarginBox(item.domNode).w;if(_8d7<=_8d6){this._ellipsisize(_8d3+1,_8d4-_8d7);}else{var _8d8=_8ac(this.displayAsText?"span":"a",item.domNode)[0],_8d9=_8ac("span.epi-breadCrumbsSeparator",item.domNode)[0],_8da=_8d6-_8aa.getMarginBox(_8d9).w;if(_8da<0){_8da=0;}_8ab.set(_8d8,"width",_8da+"px");_8a8.add(_8d8,"dojoxEllipsis");this._ellipsisize(_8d3+1,_8d4-_8d6);}}});});},"dojo/NodeList-manipulate":function(){define("dojo/NodeList-manipulate",["./query","./_base/lang","./_base/array","./dom-construct","./NodeList-dom"],function(_8db,lang,_8dc,_8dd){var _8de=_8db.NodeList;function _8df(node){var text="",ch=node.childNodes;for(var i=0,n;n=ch[i];i++){if(n.nodeType!=8){if(n.nodeType==1){text+=_8df(n);}else{text+=n.nodeValue;}}}return text;};function _8e0(node){while(node.childNodes[0]&&node.childNodes[0].nodeType==1){node=node.childNodes[0];}return node;};function _8e1(html,_8e2){if(typeof html=="string"){html=_8dd.toDom(html,(_8e2&&_8e2.ownerDocument));if(html.nodeType==11){html=html.childNodes[0];}}else{if(html.nodeType==1&&html.parentNode){html=html.cloneNode(false);}}return html;};lang.extend(_8de,{_placeMultiple:function(_8e3,_8e4){var nl2=typeof _8e3=="string"||_8e3.nodeType?_8db(_8e3):_8e3;var _8e5=[];for(var i=0;i<nl2.length;i++){var _8e6=nl2[i];var _8e7=this.length;for(var j=_8e7-1,item;item=this[j];j--){if(i>0){item=this._cloneNode(item);_8e5.unshift(item);}if(j==_8e7-1){_8dd.place(item,_8e6,_8e4);}else{_8e6.parentNode.insertBefore(item,_8e6);}_8e6=item;}}if(_8e5.length){_8e5.unshift(0);_8e5.unshift(this.length-1);Array.prototype.splice.apply(this,_8e5);}return this;},innerHTML:function(_8e8){if(arguments.length){return this.addContent(_8e8,"only");}else{return this[0].innerHTML;}},text:function(_8e9){if(arguments.length){for(var i=0,node;node=this[i];i++){if(node.nodeType==1){_8dd.empty(node);node.appendChild(node.ownerDocument.createTextNode(_8e9));}}return this;}else{var _8ea="";for(i=0;node=this[i];i++){_8ea+=_8df(node);}return _8ea;}},val:function(_8eb){if(arguments.length){var _8ec=lang.isArray(_8eb);for(var _8ed=0,node;node=this[_8ed];_8ed++){var name=node.nodeName.toUpperCase();var type=node.type;var _8ee=_8ec?_8eb[_8ed]:_8eb;if(name=="SELECT"){var opts=node.options;for(var i=0;i<opts.length;i++){var opt=opts[i];if(node.multiple){opt.selected=(_8dc.indexOf(_8eb,opt.value)!=-1);}else{opt.selected=(opt.value==_8ee);}}}else{if(type=="checkbox"||type=="radio"){node.checked=(node.value==_8ee);}else{node.value=_8ee;}}}return this;}else{node=this[0];if(!node||node.nodeType!=1){return undefined;}_8eb=node.value||"";if(node.nodeName.toUpperCase()=="SELECT"&&node.multiple){_8eb=[];opts=node.options;for(i=0;i<opts.length;i++){opt=opts[i];if(opt.selected){_8eb.push(opt.value);}}if(!_8eb.length){_8eb=null;}}return _8eb;}},append:function(_8ef){return this.addContent(_8ef,"last");},appendTo:function(_8f0){return this._placeMultiple(_8f0,"last");},prepend:function(_8f1){return this.addContent(_8f1,"first");},prependTo:function(_8f2){return this._placeMultiple(_8f2,"first");},after:function(_8f3){return this.addContent(_8f3,"after");},insertAfter:function(_8f4){return this._placeMultiple(_8f4,"after");},before:function(_8f5){return this.addContent(_8f5,"before");},insertBefore:function(_8f6){return this._placeMultiple(_8f6,"before");},remove:_8de.prototype.orphan,wrap:function(html){if(this[0]){html=_8e1(html,this[0]);for(var i=0,node;node=this[i];i++){var _8f7=this._cloneNode(html);if(node.parentNode){node.parentNode.replaceChild(_8f7,node);}var _8f8=_8e0(_8f7);_8f8.appendChild(node);}}return this;},wrapAll:function(html){if(this[0]){html=_8e1(html,this[0]);this[0].parentNode.replaceChild(html,this[0]);var _8f9=_8e0(html);for(var i=0,node;node=this[i];i++){_8f9.appendChild(node);}}return this;},wrapInner:function(html){if(this[0]){html=_8e1(html,this[0]);for(var i=0;i<this.length;i++){var _8fa=this._cloneNode(html);this._wrap(lang._toArray(this[i].childNodes),null,this._NodeListCtor).wrapAll(_8fa);}}return this;},replaceWith:function(_8fb){_8fb=this._normalize(_8fb,this[0]);for(var i=0,node;node=this[i];i++){this._place(_8fb,node,"before",i>0);node.parentNode.removeChild(node);}return this;},replaceAll:function(_8fc){var nl=_8db(_8fc);var _8fd=this._normalize(this,this[0]);for(var i=0,node;node=nl[i];i++){this._place(_8fd,node,"before",i>0);node.parentNode.removeChild(node);}return this;},clone:function(){var ary=[];for(var i=0;i<this.length;i++){ary.push(this._cloneNode(this[i]));}return this._wrap(ary,this,this._NodeListCtor);}});if(!_8de.prototype.html){_8de.prototype.html=_8de.prototype.innerHTML;}return _8de;});},"epi/shell/widget/dialog/_DialogContentMixin":function(){define("epi/shell/widget/dialog/_DialogContentMixin",["dojo/_base/declare"],function(_8fe){return _8fe(null,{executeDialog:function(){},cancelDialog:function(){}});});},"url:epi-cms/contentediting/templates/ExpirationDialog.html":"<div class=\"epi-formContainer\">\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumb\" data-dojo-props=\"showCurrentNode: false\"></div>\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\n    <div data-dojo-attach-point=\"stateNode\" class=\"epi-notificationBar epi-notificationBarItem\">\n        <div class=\"epi-notificationBarText\" data-dojo-attach-point=\"infoTextNode\"></div>\n        <div class=\"epi-notificationBarButtonContainer\">\n            <button data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"removeButton\" data-dojo-attach-event=\"onClick: _onRemoveButtonClick\">${res.removebutton}</button>\n        </div>\n    </div>\n    <div data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\"></div>\n</div>\n","epi-cms/contentediting/viewmodel/ExpirationDialogViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/epi","epi/datetime","epi/shell/_StatefulGetterSetterMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_8ff,_900,_901,epi,_902,_903,_904,_905){return _8ff([_900,_903],{value:null,intermediateValue:null,contentLink:null,contentName:null,enableSaveButton:null,showRemoveButton:null,infoText:null,state:null,postscript:function(){this.inherited(arguments);this.set("intermediateValue",this.value);this.set("minimumExpireDate",this.minimumExpireDate);},_setIntermediateValueAttr:function(_906){this._set("intermediateValue",_906);this.set("enableSaveButton",!epi.areEqual(this.intermediateValue,this.value));if(_906&&_906.stopPublish){var _907=_906.stopPublish instanceof Date?_906.stopPublish:new Date(_906.stopPublish);this.set("showRemoveButton",true);this.set("infoText",_907<_902.serverTime()?_905.expired:_901.substitute(_904.expiretimetext,[_902.timeToGo(_907)]));this.set("state","Expiring");}else{this.set("showRemoveButton",false);this.set("infoText",_904.neverexpiretext);this.set("state","NotExpiring");}},_setValueAttr:function(_908){this._set("value",_908);this.set("enableSaveButton",false);},_setMinimumExpireDateAttr:function(_909){var date=new Date(_909);this._set("minimumExpireDate",_902.isDateValid(date)?date:null);this._set("minimumExpireDateMessage",_904.minimumdatevalidation);},save:function(){this.set("value",this.intermediateValue);},reset:function(){this.set("intermediateValue",this.value);}});});},"epi-cms/contentediting/commandproviders/ContentDetails":function(){define(["dojo","dojo/_base/declare","epi/shell/command/_CommandProviderMixin","../command/PermanentInUseToggle"],function(dojo,_90a,_90b,_90c){return _90a([_90b],{constructor:function(){this.inherited(arguments);this.add("commands",new _90c());}});});},"epi-cms/contentediting/command/PermanentInUseToggle":function(){define(["dojo/_base/declare","epi/dependency","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.permanenteditindication"],function(_90d,_90e,_90f,_910){return _90d([_90f],{name:"PermanentInUseNotification",label:_910.title,tooltip:_910.tooltip,inUseNotificationManager:null,postscript:function(){this.inherited(arguments);if(this.inUseNotificationManager===null){this.inUseNotificationManager=_90e.resolve("epi.cms.contentediting.inUseNotificationManager");}this.set("canExecute",true);this.set("isAvailable",true);},_execute:function(){this.inherited(arguments);var _911=this.model.contentData;this.inUseNotificationManager.togglePermanentEditIndication(_911,true);this._updateCanExecute();},_onModelChange:function(){var _912=this.model.contentData,_913=this.model.canChangeContent(),_914=this.inUseNotificationManager.currentUserHasInUseNotification(_912.inUseNotifications,true);this.set("active",_914);this._updateCanExecute();},_updateCanExecute:function(){this.set("canExecute",this.active||this.model.canChangeContent());}});});},"epi-cms/contentediting/commandproviders/PublishMenu":function(){define(["dojo","dojo/_base/declare","epi/shell/command/_CommandProviderMixin","epi-cms/contentediting/command/ForPublishMenu","epi-cms/contentediting/command/IgnoreInUseNotification"],function(dojo,_915,_916,_917,_918){return _915([_916],{constructor:function(){this.inherited(arguments);this.add("commands",_917(new _918(),{priority:10000}));}});});},"epi-cms/contentediting/command/ForPublishMenu":function(){define(["dojo/_base/lang"],function(lang){return function(_919,_91a){_91a=lang.mixin({isMain:false,priority:0,resetLabelAfterExecution:true,mainButtonClass:null,keepMenuOpen:false,successStatus:null},_91a);_919.options=_91a;return _919;};});},"epi-cms/contentediting/command/IgnoreInUseNotification":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_91b,_91c,_91d,_91e,_91f){return _91b([_91e],{name:"IgnoreInUseNotification",label:_91f.ignoreinusenotification.label,tooltip:_91f.ignoreinusenotification.title,iconClass:"epi-iconPen",inUseNotificationManager:null,postscript:function(){this.inherited(arguments);if(this.inUseNotificationManager===null){this.inUseNotificationManager=_91d.resolve("epi.cms.contentediting.inUseNotificationManager");}this.set("canExecute",true);this.set("isAvailable",true);},_execute:function(){this.inUseNotificationManager.ignoreOthersNotifications=true;this.model.viewName=null;this._requestContextChange(this.model.contentData.uri,true);},_onModelChange:function(){var _920=this.model.contentData,_921=this.inUseNotificationManager.hasInUseNotificationWarning(_920.inUseNotifications),_922,_923;_922=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_923=this.model.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_922;this.set("isAvailable",_921&&_923);},_requestContextChange:function(uri,_924){var _925={uri:uri};var _926={sender:this,forceContextChange:_924};_91c.publish("/epi/shell/context/request",_925,_926);}});});},"epi-cms/contentediting/commandproviders/PublishMenuGlobal":function(){define(["dojo/_base/declare","epi/shell/command/withConfirmation","epi/shell/command/_CommandProviderMixin","epi-cms/command/TranslateContent","epi-cms/contentediting/command/ForPublishMenu","epi-cms/contentediting/command/RevertToPublished","epi-cms/contentediting/command/SendForReview","epi-cms/contentediting/command/Publish","epi-cms/contentediting/command/CreateDraft","epi-cms/contentediting/command/EditCommonDraft","epi-cms/contentediting/command/Withdraw","epi-cms/contentediting/command/ScheduleForPublish","epi-cms/contentediting/command/CancelAndEdit","epi-cms/content-approval/command/ApproveChanges","epi-cms/content-approval/command/CancelReview","epi-cms/content-approval/command/ForceCompleteApproval","epi-cms/content-approval/command/RejectChanges","epi-cms/content-approval/command/ReadyForReview","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_927,_928,_929,_92a,_92b,_92c,_92d,_92e,_92f,_930,_931,_932,_933,_934,_935,_936,_937,_938,res){return _927([_929],{commandMap:null,constructor:function(){this.commandMap={approvechanges:_92b(new _934(),{isMain:true,priority:10000,mainButtonClass:"epi-success"}),cancelreview:_92b(new _935()),forcecompleteapproval:_92b(new _936()),publish:_92b(new _92e(),{resetLabelAfterExecution:true,isMain:true,priority:9000,mainButtonClass:"epi-success",keepMenuOpen:true,successStatus:res.successfullypublished}),readyforreview:_92b(new _938(),{isMain:true,priority:10000,mainButtonClass:"epi-success"}),readytopublish:_92b(new _92d(),{isMain:true,priority:8000,mainButtonClass:"epi-success",keepMenuOpen:true}),rejectchanges:_92b(new _937()),removescheduling:_92b(new _933()),scheduleforpublish:_92b(new _932()),withdraw:_92b(new _931(),{resetLabelAfterExecution:false,keepMenuOpen:true})};},updateCommandModel:function(_939){var _93a=[];_939.contentData.transitions.forEach(function(_93b){var _93c=this.commandMap[_93b.name];if(_93c){_93a.push(_93c);}},this);_93a.push(_92b(new _92a(),{isMain:true,priority:10000,mainButtonClass:"epi-primary"}));_93a.push(_92b(new _930()));_93a.push(_92b(new _92f()));_93a.push(_92b(_928(new _92c(),null,{title:res.reverttopublishconfirmation.dialogtitle,heading:res.reverttopublishconfirmation.confirmquestion,description:res.reverttopublishconfirmation.description})));this.set("commands",_93a);this.inherited(arguments);}});});},"epi-cms/contentediting/command/EditCommonDraft":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentCommandBase","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_93d,_93e,_93f,_940){return _93d([_93e],{name:"editcommondraft",label:_940.editcommondraft.label,tooltip:_940.editcommondraft.title,iconClass:"epi-iconPen",contentActionSupport:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_93f;},_execute:function(){this.model.editCommonDraft();},_onModelChange:function(){this.inherited(arguments);var _941=this.model.contentData,_942=_941.status,_943=_93f.versionStatus,_944=this.contentActionSupport.hasAccess(_941.accessMask,_93f.accessLevel.Edit),_945=(_942===_943.Published||_942===_943.PreviouslyPublished)&&!_941.isCommonDraft&&_944&&this.contentActionSupport.hasProviderCapability(_941.providerCapabilityMask,_93f.providerCapabilities.Edit);this.set("canExecute",_945&&this.model.canEditCurrentLanguage());this.set("isAvailable",_945);}});});},"epi-cms/contentediting/command/ScheduleForPublish":function(){define(["dojo/_base/declare","epi/shell/widget/dialog/Dialog","epi-cms/contentediting/command/_ChangeContentStatus","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/ScheduledPublishSelector","epi-cms/contentediting/ScheduledPublishSelectorViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_946,_947,_948,_949,_94a,_94b,_94c,_94d){return _946([_948],{label:_94c.scheduleforpublish.label,tooltip:_94c.scheduleforpublish.title,iconClass:"epi-iconClock",action:_949.saveAction.Schedule,_execute:function(){var _94e=new _94b();_94e.set("contentData",this.model.contentData);var _94f=new _94a({model:_94e});var _950=this.getInherited(arguments);var _951=new _947({content:_94f,title:_94d.title,defaultActionsVisible:false});_951.on("execute",function(){this.model.forceSaveProperty("iversionable_startpublish",_94e.dateValue).then(_950.bind(this));}.bind(this));_951.show(true);}});});},"epi-cms/contentediting/ScheduledPublishSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/_DialogContentMixin","./ScheduledPublishSelectorViewModel","dojo/text!./templates/ScheduledPublishSelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector","epi/i18n!epi/nls/episerver.shared","epi/shell/widget/DateTimeSelectorDropDown","epi-cms/project/ContentReferenceGrid","epi-cms/widget/Breadcrumb"],function(_952,lang,_953,_954,_955,_956,_957,_958,_959,_95a,_95b,_95c,_95d){return _952([_954,_955,_956,_958,_957,_959],{templateString:_95b,modelData:null,_setTitleAttr:{node:"contentNameNode",type:"innerText"},_setDateLabelAttr:{node:"publishChangesCaptionNode",type:"innerHTML"},_setDateValueAttr:function(date){this.dateTimeSelector.set("value",date);},_setBreadcrumbModelAttr:function(_95e){this.breadcrumbNode.set("contentLink",_95e);},_setScheduleButtonEnabledAttr:function(_95f){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!_95f);}},_setModelAttr:function(_960){this.inherited(arguments);this.referenceGrid.set("model",_960);if(_960){this.own(_960.watch("totalItems",lang.hitch(this,"_onGridItemsChange")));}},modelBindingMap:{title:["title"],dateLabel:["dateLabel"],dateValue:["dateValue"],breadcrumbModel:["breadcrumbModel"],scheduleButtonEnabled:["scheduleButtonEnabled"]},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _95a(this.modelData);},postCreate:function(){this.inherited(arguments);this.connect(this.dateTimeSelector,"onChange","dateTimeSelectorChanged");this.addActions([{name:"save",label:_95c.confirmtext,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.dateTimeSelector.validate()){this.executeDialog();}})},{name:"cancel",label:_95d.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}]);},_onGridItemsChange:function(_961,_962,_963){var _964=_963>0;if(this.referenceGrid){_953.toggle(this.referenceGrid.domNode,"dijitHidden",!_964);}this.setActionProperty("save","label",_964?_95c.scheduleanyway:_95c.confirmtext);this.setActionProperty("save","class",_964?"":"Salt");},dateTimeSelectorChanged:function(_965){this.model.set("dateValue",_965);}});});},"epi-cms/contentediting/ScheduledPublishSelectorViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_966,_967,_968){return _966([_967],{breadcrumbModel:null,title:"",dateLabel:"",dateValue:null,scheduleButtonEnabled:false,constructor:function(){var _969=new Date();_969.setDate(_969.getDate()+1);_969.setHours(12,0,0,0);this.set("dateValue",_969);},_isPublishedSetter:function(_96a){this.set("dateLabel",_96a?_968.publishchangeson:_968.publishon);},_contentDataSetter:function(_96b){this.set("title",_96b.name);this.set("isPublished",!_96b.isPendingPublish);this.set("breadcrumbModel",_96b.contentLink);var _96c=new Date(_96b.properties.iversionable_startpublish);if(!isNaN(_96c)&&_96c>new Date()){this.set("dateValue",_96c);}},_dateValueSetter:function(_96d){this.dateValue=_96d;this.set("scheduleButtonEnabled",!!(_96d&&_96d>new Date()));}});});},"url:epi-cms/contentediting/templates/ScheduledPublishSelector.html":"<div>\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumbNode\" data-dojo-props=\"showCurrentNode: false\"></div>\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\n    <div data-dojo-attach-point=\"publishChangesCaptionNode\"></div>\n    <div data-dojo-type=\"epi/shell/widget/DateTimeSelectorDropDown\" data-dojo-attach-point=\"dateTimeSelector\" data-dojo-props=\"required:true\"></div>\n    <div data-dojo-attach-point=\"referenceGrid\" data-dojo-type=\"epi-cms/project/ContentReferenceGrid\" class=\"dijitHidden push-margin--top\"></div>\n</div>","epi-cms/project/ContentReferenceGrid":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/keys","dojo/on","dojo/when","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dgrid/OnDemandGrid","dgrid/Keyboard","dgrid/Selection","epi/shell/dgrid/Formatter","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ContentReferenceGrid.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences","dijit/form/Button"],function(_96e,lang,_96f,keys,on,when,_970,_971,_972,_973,_974,_975,_976,_977,_978,_979){function _97a(prop){return function(_97b){if(this._grid){this._grid.set(prop,_97b);}};};return _96e([_970,_971,_972,_977],{res:_979,templateString:_978,model:null,_gridClass:_96e([_973,_974,_975,_976]),_grid:null,_loadCompleteEmitted:false,modelBindingMap:{query:["query"],store:["store"],columns:["columns"],notificationText:["notificationText"],resultSummary:["resultSummary"]},_setResultSummaryAttr:{node:"resultSummaryNode",type:"innerText"},_setQueryAttr:_97a("query"),_setColumnsAttr:_97a("columns"),_setStoreAttr:_97a("store"),_setNotificationTextAttr:function(text){var _97c=text&&text.length;_96f.toggle(this.notificationBar,"dijitHidden",!_97c);this.notificationNode.textContent=text||"";},_onRowClicked:function(e){if(this.model&&typeof this.model.onItemClicked==="function"){var data=this._grid.row(e).data;this.model.onItemClicked(data);}},buildRendering:function(){this.inherited(arguments);var _97d=this.model&&this.model.get("columns");this._grid=new this._gridClass({"class":"epi-plain-grid epi-plain-grid--no-border epi-plain-grid--no-header epi-plain-grid--margin-bottom",columns:_97d,showHeader:false,cellNavigation:false,selectionMode:"single"},this.gridNode);this._grid.addKeyHandler(keys.ENTER,lang.hitch(this,"_onRowClicked"));this._grid.addKeyHandler(keys.SPACE,lang.hitch(this,"_onRowClicked"));this._grid.on(".dgrid-cell a:click",lang.hitch(this,"_onRowClicked"));this.own(this._grid,on(this._grid,"dgrid-refresh-complete",lang.hitch(this,"_onGridRefreshComplete")));},startup:function(){this.inherited(arguments);this._grid.startup();if(!this._grid.store){this._emitLoadComplete();}},_onGridRefreshComplete:function(data){var _97e=data.results;when(_97e.total,lang.hitch(this,function(_97f){this.model.set("totalItems",_97f);this._emitLoadComplete();}));},_emitLoadComplete:function(){if(!this._loadCompleteEmitted){this.emit("contentreferencegrid-loading-complete",{});this._loadCompleteEmitted=true;}},_refresh:function(){this._grid.refresh();}});});},"url:epi-cms/project/templates/ContentReferenceGrid.html":"<div class=\"epi-contentReferences\">\n    <div data-dojo-attach-point=\"notificationBar\" class=\"dijitHidden epi-notificationBar epi-notificationBarWithBorders epi-notificationBarItem\">\n        <div data-dojo-attach-point=\"notificationNode\" class=\"epi-notificationBarText\"></div>\n    </div>\n    <div class=\"epi-captionPanel\" data-dojo-attach-point=\"captionPanelNode\">\n        <strong data-dojo-attach-point=\"resultSummaryNode\"></strong>\n        <div class=\"epi-floatRight\">\n            <button class=\"epi-chromelessButton\"\n                    data-dojo-type=\"dijit/form/Button\"\n                    data-dojo-attach-event=\"onClick:_refresh\"\n                    data-dojo-props=\"iconClass:'epi-iconReload'\">${res.buttons.refresh}</button>\n        </div>\n    </div>\n    <div data-dojo-attach-point=\"gridNode\"></div>\n</div>\n","epi-cms/contentediting/command/CancelAndEdit":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.cancelandedit"],function(_980,lang,_981,_982,_983){return _980([_982],{label:_983.label,tooltip:_983.title,iconClass:"epi-iconPen",action:_981.saveAction.CheckOut|_981.saveAction.ForceCurrentVersion,_execute:function(){this.inherited(arguments).then(lang.hitch(this,function(){var _984=this.model.contentData;this.model.setProperty("iversionable_startpublish",_984.isPendingPublish?_984.created:_984.lastPublished);}));}});});},"epi-cms/content-approval/command/ApproveChanges":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.contentapproval.command.approvechanges","epi-cms/content-approval/command/_ApprovalTransitionCommand"],function(_985,_986,_987){return _985([_987],{label:_986.label,executingLabel:_986.label,executeMethod:"approveChanges"});});},"epi-cms/content-approval/command/_ApprovalTransitionCommand":function(){define(["dojo/_base/declare","epi/dependency","epi/i18n!epi/nls/episerver.cms.contentapproval.command.rejectchanges","epi-cms/contentediting/command/_ChangeContentStatus"],function(_988,_989,_98a,_98b){return _988([_98b],{approval:null,executeMethod:null,postscript:function(){this.inherited(arguments);this.approvalService=this.approvalService||_989.resolve("epi.cms.ApprovalService");},_onModelChange:function(){this.set("canExecute",false);if(!this.model){return;}return this.approvalService.getApproval(this.model.contentLink).then(function(_98c){this.set({canExecute:!!_98c,approval:_98c});}.bind(this));},_execute:function(){return this.approvalService[this.executeMethod](this.approval).then(function(){this._onContentStatusChange({id:this.model.contentLink});}.bind(this));}});});},"epi-cms/content-approval/command/CancelReview":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.contentapproval.command.cancelreview","epi-cms/content-approval/command/_ApprovalTransitionCommand"],function(_98d,_98e,_98f){return _98d([_98f],{label:_98e.label,iconClass:"epi-iconPen",executeMethod:"cancelChanges"});});},"epi-cms/content-approval/command/ForceCompleteApproval":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.contentapproval.command.forcecompleteapproval","epi-cms/content-approval/command/_ApprovalTransitionCommand"],function(_990,_991,_992){return _990([_992],{label:_991.label,executeMethod:"forceCompleteApproval"});});},"epi-cms/content-approval/command/RejectChanges":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.contentapproval.command.rejectchanges","epi-cms/content-approval/command/_ApprovalTransitionCommand"],function(_993,_994,_995){return _993([_995],{label:_994.label,iconClass:"epi-iconStop",executeMethod:"rejectChanges"});});},"epi-cms/content-approval/command/ReadyForReview":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_ChangeContentStatus","epi/i18n!epi/nls/episerver.cms.contentapproval.command.requestapproval"],function(_996,_997,_998,_999){return _996([_998],{label:_999.label,executingLabel:_999.label,action:_997.saveAction.RequestApproval});});},"epi-cms/contentediting/viewsettings/ChannelViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/_ViewSetting"],function(_99a,lang,_99b){return _99a([_99b],{key:"epichannel",usedForRendering:true,isTagItem:false,beforePreviewLoad:function(_99c,_99d){this.inherited(arguments);if(_99d&&this.value){_99c.epichannel=this.value;}else{delete _99c.epichannel;}}});});},"epi-cms/contentediting/_ViewSetting":function(){define(["dojo/_base/declare","epi/shell/_StatefulGetterSetterMixin"],function(_99e,_99f){return _99e(_99f,{key:null,value:null,enabled:null,beforePreviewLoad:function(_9a0,_9a1){},afterPreviewLoad:function(_9a2,_9a3){}});});},"epi-cms/contentediting/viewsettings/ResolutionViewSetting":function(){define(["dojo/_base/declare","epi-cms/contentediting/_ViewSetting"],function(_9a4,_9a5){return _9a4([_9a5],{key:"resolution",usedForRendering:false,afterPreviewLoad:function(_9a6,_9a7){this.inherited(arguments);if(_9a6){var size=_9a7?this._getPreviewResolution():null;_9a6.set("previewSize",size);_9a6.set("devicePreviewClass",this.value?"epi-editorViewport--device-preview epi-viewPort-"+this.value:"");}return null;},_getPreviewResolution:function(){var size=null;var _9a8=this.value;if(_9a8){var _9a9=_9a8.split("x");if(_9a9.length===2){size={w:_9a9[0],h:_9a9[1]};}}return size;}});});},"epi-cms/contentediting/viewsettings/ViewLanguageViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dijit/Destroyable","epi-cms/contentediting/_ViewSetting"],function(_9aa,lang,_9ab,_9ac,_9ad){return _9aa([_9ac,_9ad],{key:"viewlanguage",usedForRendering:true,isTagItem:false,constructor:function(_9ae){this.own(_9ae.registerRequestInterceptor(lang.hitch(this,this._onContextChange)));},_onContextChange:function(_9af,_9b0){var dfd=new _9ab();dfd.resolve();if(this.get("enabled")&&this.value){_9af.epslanguage=this.value;}return dfd;}});});},"epi-cms/contentediting/viewsettings/VisitorGroupViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/_ViewSetting"],function(_9b1,lang,_9b2){return _9b1([_9b2],{key:"visitorgroup",usedForRendering:true,isTagItem:false,beforePreviewLoad:function(_9b3,_9b4){this.inherited(arguments);if(_9b4&&this.value){_9b3.visitorgroupsByID=this.value;}else{delete _9b3.visitorgroupsByID;}}});});},"epi-cms/project/ProjectViewSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dijit/Destroyable","epi-cms/contentediting/_ViewSetting"],function(_9b5,lang,_9b6,_9b7,_9b8){return _9b5([_9b7,_9b8],{key:"project",usedForRendering:true,isTagItem:false,constructor:function(_9b9){this.own(_9b9.registerRequestInterceptor(lang.hitch(this,this._onContextChange)));},beforePreviewLoad:function(_9ba,_9bb){this.inherited(arguments);if(_9bb&&this.value){_9ba.epiprojects=this.value;}else{delete _9ba.epiprojects;}},_onContextChange:function(_9bc,_9bd){var dfd=new _9b6();if(this.get("enabled")&&this.value){_9bc.epiprojects=this.value;_9bc.epieditmode=true;}dfd.resolve();return dfd.promise;}});});},"epi-cms/widget/ContentTypeService":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/when","dojo/promise/all","epi/dependency","epi/shell/TypeDescriptorManager"],function(_9be,_9bf,lang,when,all,_9c0,_9c1){return _9be(null,{contentTypeStore:null,_getavailabletypesQuery:"getavailablecontenttypes",constructor:function(){this.contentTypeStore=this.contentTypeStore||_9c0.resolve("epi.storeregistry").get("epi.cms.contenttype");},getAcceptedChildTypes:function(_9c2,_9c3,_9c4,_9c5,_9c6){var _9c7=this.contentTypeStore.query({query:this._getavailabletypesQuery,localAsset:_9c3,parentReference:_9c2,requestedTypes:_9c4});return this.filterQueryResult(_9c7,_9c5,_9c6);},filterQueryResult:function(_9c8,_9c9,_9ca){return when(_9c8).then(function(_9cb){var _9cc=_9bf.map(_9cb,function(type){return type.typeIdentifier;});_9cc=_9c1.getValidAcceptedTypes(_9cc,_9c9,_9ca);_9cb=_9bf.filter(_9cb,function(type){return _9bf.some(_9cc,function(_9cd){return type.typeIdentifier===_9cd;});});return _9cb;});}});});},"epi-cms/Profile":function(){define("epi-cms/Profile",["dojo/_base/lang","dojo/Deferred","dojo/when","epi/dependency","epi/shell/Profile","epi-cms/ApplicationSettings"],function(lang,_9ce,when,_9cf,_9d0,_9d1){var _9d2=function(host){return "editlanguage_"+host.replace(":","");};lang.extend(_9d0,{getContentLanguage:function(host){host=host||window.location.host;return when(this.get(_9d2(host)),function(_9d3){return _9d3||_9d1.currentContentLanguage;});},setContentLanguage:function(_9d4,host){return this.set(_9d2(host),_9d4,{location:"server"});}});return _9d0;});},"epi-cms/compare/views/CompareView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi-cms/contentediting/PageDataController","epi-cms/compare/CompareToolbar","epi-cms/compare/viewmodels/CompareViewModel"],function(_9d5,lang,_9d6,_9d7,_9d8,_9d9){return _9d5([_9d7],{buildRendering:function(){this.inherited(arguments);var _9da=new _9d9(),_9db=this.mainLayoutContainer,_9dc=new _9d8({region:"top",splitter:false,model:_9da.compareToolbarViewModel});_9db.addChild(_9dc);this.set("compareModel",_9da);this.own(_9da,_9da.watch("leftVersionUri",lang.hitch(this,function(name,_9dd,uri){this._changeContext(uri);})),_9dc,_9dc.on("versionInformationUpdated",function(){_9db.layout();}));},setView:function(_9de,_9df){_9df=lang.mixin({model:this.compareModel},_9df);return this.inherited(arguments,[_9de,_9df]);},_changeContext:function(uri){if(uri&&this._currentViewModel&&uri!==this._currentViewModel.contentData.uri){_9d6.publish("/epi/shell/context/request",{uri:uri},{sender:this});}},_refreshModel:function(_9e0,_9e1){this.inherited(arguments);this.compareModel.set({contentLink:_9e0.contentLink,typeIdentifier:_9e0.typeIdentifier,languages:_9e0.existingLanguageBranches});},_switchEditMode:function(){if(this.isActive){_9d6.publish("/epi/shell/action/changeview","formedit");}}});});},"epi-cms/contentediting/PageDataController":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/Deferred","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/layout/BorderContainer","epi/dependency","epi/Url","epi/shell/layout/CardContainer","epi/shell/layout/PreserveRatioBorderContainer","epi/shell/widget/IframeWithOverlay","epi-cms/_ContentContextMixin","epi-cms/contentediting/EditNotifications","epi-cms/contentediting/ContentViewModel","epi-cms/contentediting/EditToolbar","epi-cms/contentediting/NotificationBar","epi-cms/contentediting/ShortcutNotification","epi-cms/contentediting/ViewSettingsNotification","epi-cms/project/ProjectNotification","epi-cms/contentediting/command/Editing","epi/i18n!epi/cms/nls/episerver.cms.contentediting","dojo/text!./templates/PageDataController.html"],function(_9e2,_9e3,lang,_9e4,_9e5,_9e6,_9e7,when,_9e8,_9e9,_9ea,_9eb,_9ec,Url,_9ed,_9ee,_9ef,_9f0,_9f1,_9f2,_9f3,_9f4,_9f5,_9f6,_9f7,_9f8,res,_9f9){return _9e3([_9e9,_9e8,_9ea,_9f0],{templateString:_9f9,contextTypeName:"epi.cms.contentdata",pendingNotificationTimeOutId:null,isActive:true,defaultEditCssRules:[{selector:".epi-injected-minSize",css:"min-height: 30px;"},{selector:".epi-injected-minSize-inline",css:"min-height: 30px; min-width: 100px; display: inline-block !important;"},{selector:"[contenteditable=true]:focus",css:"outline: 3px #b4c600 solid;"}],_currentViewComponent:null,_viewModels:null,_notificationHandlerId:null,_messageService:null,_editingCommands:null,_currentViewModel:null,_pageDataStore:null,_shortcutNotification:null,_projectNotification:null,_availableViews:null,_previewQueryParameters:null,_viewSettingsManager:null,_inUseNotificationManager:null,_ensurePreviewReadyPromise:null,postMixInProperties:function(){this.inherited(arguments);var _9fa=_9ec.resolve("epi.storeregistry");this._viewSettingsManager=_9ec.resolve("epi.viewsettingsmanager");this._messageService=this._messageService||_9ec.resolve("epi.shell.MessageService");this._profile=this._profile||_9ec.resolve("epi.shell.Profile");this._pageDataStore=_9fa.get("epi.cms.contentdata");this._editingCommands=_9f8;if(!this._viewModels){this._viewModels=[];}this._inUseNotificationManager=this.inUseNotificationManager||_9ec.resolve("epi.cms.contentediting.inUseNotificationManager");this._shortcutNotification=new _9f5();this._viewSettingsNotification=new _9f6();this._projectNotification=new _9f7();this._editNotifications=this._editNotifications||new _9f1();this.own(this._editNotifications,this._editNotifications.on("changed",function(e){this._defaultNotificationWatchHandler("",e.oldValue,e.newValue);}.bind(this)));},postCreate:function(){var cs;this.inherited(arguments);this.subscribe("/epi/cms/action/switcheditmode",lang.hitch(this,this._switchEditMode));cs=_9ec.resolve("epi.shell.ContextService");this._interceptorHandle=cs.registerRequestInterceptor(lang.hitch(this,this._interceptRequestContext));this.notificationBar.on("notificationsChanged",lang.hitch(this,function(){this.mainLayoutContainer.layout();}));this.own(_9e7.subscribe("/epi/cms/action/undo",this._undoAction.bind(this)),_9e7.subscribe("/epi/cms/action/redo",this._redoAction.bind(this)),_9e7.subscribe("/epi/cms/action/save",this._saveAction.bind(this)),this._shortcutNotification.watch("notification",lang.hitch(this,this._defaultNotificationWatchHandler)),this._viewSettingsNotification.watch("notification",lang.hitch(this,this._defaultNotificationWatchHandler)),this._projectNotification.watch("notification",lang.hitch(this,this._projectNotificationWatchHandler)));},startup:function(){if(this._started){return;}this.inherited(arguments);var url=new Url(window.location.href),_9fb=url.getQueryParameterValue("view");this.iFrame=this.iframeWithOverlay.iframe;this.connect(this.iFrame,"onLoad","_iFrameLoaded");this.connect(this.iFrame,"onUnload","_iFrameUnLoaded");_9e4.add(this.toolbar.domNode,"epi-localToolbar epi-viewHeaderContainer");this._injectCssRules();when(this.getCurrentContext(),lang.hitch(this,function(_9fc){this.contextChanged(_9fc);}));},destroy:function(){this._interceptorHandle.remove();this._destroyCurrentViewComponent();this._viewModels=null;this.inherited(arguments);},_defaultNotificationWatchHandler:function(name,_9fd,_9fe){if(_9fd){this.notificationBar.remove(_9fd);}if(_9fe&&_9fe.content){this.notificationBar.add(_9fe);}},_projectNotificationWatchHandler:function(name,_9ff,_a00){if(_9ff){this.notificationBar.remove(_9ff);}if(_a00&&_a00.content){this.notificationBar.add(_a00,"first");}},_switchEditMode:function(_a01,_a02){var _a03,_a04=this._currentViewModel.viewName,_a05=false,_a06="view",_a07="onpageedit",_a08="formedit";if(!this.isActive){return;}if(_a04===_a06){_9e7.publish("/epi/cms/action/disablepreview");}if(_a04===_a08){_a03=_a07;_a05=true;}else{_a03=_a08;}return this._ensurePreviewReady(this.setView(_a03,_a02),_a05,true,_a03);},_iFrameLoaded:function(url,_a09){if(!!url&&!_a09){this._requestContextChangeByUrl(url,true,true);}},_iFrameUnLoaded:function(url){this.iframeWithOverlay.overlay.set("enabled",false);},_destroyCurrentViewComponent:function(){if(this._currentViewComponentReloadRequireHandle){this._currentViewComponentReloadRequireHandle.remove();this._currentViewComponentReloadRequireHandle=null;}if(this._currentViewComponent){this._currentViewComponent.destroyRecursive();this._currentViewComponent=null;}},_getViewModelIndex:function(id){var _a0a=-1;_9e2.some(this._viewModels,function(item,idx){if(item.contentLink===id){_a0a=idx;return true;}});return _a0a;},_getViewModel:function(id){var _a0b=this._getViewModelIndex(id);if(_a0b>=0){return this._viewModels[_a0b];}else{return null;}},_removeViewModel:function(id){var _a0c=this._getViewModelIndex(id);if(_a0c>=0){var _a0d=this._viewModels.splice(_a0c,1)[0];_a0d.clear();}},_createViewModel:function(_a0e,ctx){var _a0f=new _9f2({contentLink:_a0e.contentLink,contextTypeName:this.contextTypeName});_a0f.set("contentData",_a0e);_a0f.set("languageContext",ctx.languageContext);this._viewModels.push(_a0f);return _a0f;},contentContextUpdated:function(ctx,_a10){var _a11=ctx.id;this._pageDataStore.refresh(_a11).then(lang.hitch(this,function(_a12){if(this._currentViewModel){this._updateContentViewModel(_a12,ctx.languageContext);this._refreshModel(_a12,ctx);this._onViewRequireReload();}}));},updateView:function(_a13,ctx,_a14){when(this._ensurePreviewReadyPromise,lang.hitch(this,function(){if(_a13&&_a13.skipUpdateView&&_a13.viewName===this._currentViewModel.viewName){return;}if(_a14&&_a14.widgetResumed){_9e5.set(this.domNode,"visibility","hidden");}if(_a13&&_a13.contextIdSyncChange){this._pageDataStore.refresh(ctx.id).then(lang.hitch(this,function(_a15){var _a16=this._currentViewModel.contentData.contentLink;this._updateContentViewModel(_a15,ctx.languageContext);this._currentViewComponent.onContentLinkSyncChange(_a16,_a15.contentLink);this._refreshModel(_a15,ctx);}));}else{if(this._currentViewModel){this._currentViewModel.suspend();}var _a17;if(_a13&&_a13.viewName){if(_a13.availableViews){this._availableViewsLookup={};_9e2.forEach(_a13.availableViews,lang.hitch(this,function(_a18){this._availableViewsLookup[_a18.key]=_a18;}));}_a17=_a13.viewName;}this.toolbar.update({currentContext:ctx,viewConfigurations:{availableViews:_a13.availableViews,viewName:_a13.viewName}});if(this._currentViewComponent&&this._currentViewComponent.isSticky){_a17=this._currentViewModel.viewName;}var _a19=this._getPreviewUrl(ctx,_a17);return this._ensurePreviewReady(this._loadContentDataAndSetView(ctx.id,_a17,ctx),true,_a13.forceReload,_a17);}}));},_getPreviewUrl:function(_a1a){return when(this.getCurrentContext(),function(_a1b){return (_a1a==="view"&&_a1b.previewUrl)?_a1b.previewUrl:_a1b.editablePreviewUrl;});},_ensurePreviewReady:function(_a1c,_a1d,_a1e,_a1f){var def=new _9e6();if(_a1c){def=_a1c;}else{def.resolve();}if(_a1d&&_a1f!=="formedit"){def=def.then(lang.hitch(this,function(_a20){return when(this._getPreviewUrl(_a1f),lang.hitch(this,function(url){return when(this._changeUrl(url,_a1e),function(){return _a20;});}));}));}this._ensurePreviewReadyPromise=when(def,lang.hitch(this,function(_a21){var doc=this.iframeWithOverlay.iframe.getDocument();var _a22=this.connect(this._currentViewComponent,"onPrepareOverlayComplete",function(){this.disconnect(_a22);_a22=null;this.iframeWithOverlay.overlay.set("enabled",this._currentViewModel.get("showOverlay")&&this.iframeWithOverlay.iframe.isInspectable());if(this._viewSettingsManager.get("enabled")&&this._viewSettingsManager.getSettingProperty("project")){this.iframeWithOverlay.overlay.set("enabled",false);}this.iframeWithOverlay.layout(true);});_9e5.set(this.domNode,"visibility","visible");this._viewSettingsManager.onPreviewReady(this.iframeWithOverlay);this._currentViewComponent.onPreviewReady(this._currentViewModel,doc,!!_a21);this._viewSettingsNotification.set("value",{viewModel:this._currentViewModel,viewSetting:this._viewSettingsManager});}));return this._ensurePreviewReadyPromise;},_loadContentDataAndSetView:function(_a23,_a24,ctx){var def=new _9e6();when(this._pageDataStore.refresh(_a23),lang.hitch(this,function(_a25){if(!_a25){return;}if(this._currentViewModel&&this._currentViewModel.contentLink!==_a23){this.notificationBar.clear();}this._currentViewModel=this._getViewModel(_a25.contentLink);if(!this._currentViewModel){this._currentViewModel=this._createViewModel(_a25,ctx);}else{this._updateContentViewModel(_a25,ctx.languageContext);}this._currentViewModel.set("viewLanguage",this._viewSettingsManager.get("enabled")?this._viewSettingsManager.getSettingProperty("viewlanguage"):null);this._refreshModel(_a25,ctx);when(this.setView(_a24),function(){def.resolve(true);},function(){def.cancel();});}),function(){def.reject();});return def;},_updateContentViewModel:function(_a26,_a27){this._currentViewModel.wakeUp();this._currentViewModel.set("contentData",_a26);this._currentViewModel.set("languageContext",_a27);},_refreshModel:function(_a28,_a29){var _a2a=this._currentViewModel;if(_a2a){this.toolbar.set("contentViewModel",_a2a);this._inUseNotificationManager.updateCommandModel(_a2a);this._editingCommands.set("model",_a2a);this._shortcutNotification.set("value",_a2a);this._projectNotification.set("value",_a2a);this._editNotifications.update(_a28,_a29);}},itemChanged:function(id,item){},setView:function(_a2b,_a2c){var def=new _9e6();if(_a2b==="onpageedit"&&(!this._currentViewModel.contentData.hasTemplate||!(_a2b in this._availableViewsLookup))){_a2b="formedit";}if(_a2b&&!(_a2b in this._availableViewsLookup)){return;}var _a2d=lang.hitch(this,function(){when(this._setView(_a2b,_a2c),function(){def.resolve();},function(){def.cancel();});});var _a2e=lang.hitch(this,function(){_9e7.publish("/epi/cms/action/showerror");def.cancel();});when(this._savePendingChanges(),_a2d,_a2e);return def;},_setView:function(_a2f,_a30){var def=new _9e6(),_a31=this._currentViewComponent,_a32=_a31&&_a31.viewModel&&_a31.viewModel.viewName===_a2f;var _a33=lang.hitch(this,function(def){if(this.editLayoutContainer.leftOver&&!this._currentViewComponent.canHandleLeftOver){when(this.editLayoutContainer.selectedChildWidget===this.editLayoutContainer.leftOver?this.editLayoutContainer.selectChild(this.iframeWithOverlay):null,lang.hitch(this,function(){this.editLayoutContainer.removeChild(this.editLayoutContainer.leftOver);this.editLayoutContainer.leftOver.destroyRecursive();this.editLayoutContainer.leftOver=null;}));}def.resolve();});_9e7.publish("/epi/shell/action/changeview/updatestate",{viewName:_a2f});if(_a32){this._currentViewModel.viewName=_a2f;this.toolbar.set("contentViewModel",this._currentViewModel);_a33(def);}else{this._destroyCurrentViewComponent();var _a34=this._availableViewsLookup[_a2f].viewType;require([_a34],lang.hitch(this,function(_a35){this._currentViewComponent=new _a35(lang.mixin({mainLayoutContainer:this.mainLayoutContainer,editLayoutContainer:this.editLayoutContainer,iframeWithOverlay:this.iframeWithOverlay,contextTypeName:this.contextTypeName,toolbar:this.toolbar},_a30));this._currentViewComponentReloadRequireHandle=this.connect(this._currentViewComponent,"onReloadRequired",this._onViewRequireReload);this._currentViewComponent.startup();this._currentViewModel.viewName=_a2f;this.toolbar.set("contentViewModel",this._currentViewModel);_a33(def);}));}return def;},_onViewRequireReload:function(){return this._ensurePreviewReady(null,true,true,this._currentViewModel.viewName);},resize:function(size){this.inherited(arguments);this.mainLayoutContainer.resize(size);},onShow:function(){this.iframeWithOverlay.overlay.set("enabled",true);this.iframeWithOverlay.overlay.set("readOnly",false);},onHide:function(){this.iframeWithOverlay.overlay.set("enabled",false);if(this._currentViewModel){this._currentViewModel.resetNotifications();}},_requestContextChangeByUrl:function(url,_a36,_a37,_a38,_a39){var _a3a=new Url(url,_a38,_a39),_a3b={url:_a3a.toString()},_a3c={sender:this,forceContextChange:_a36,suppressFailure:_a37,viewName:this._currentViewModel&&this._currentViewModel.viewName};_9e7.publish("/epi/shell/context/request",_a3b,_a3c);},_changeUrl:function(url,_a3d){var _a3e=lang.mixin(this._previewQueryParameters,this._viewSettingsManager.get("previewParams"));return this.iframeWithOverlay.iframe.load(url,{query:_a3e},true,_a3d);},_interceptRequestContext:function(_a3f,_a40){if(!(_a40&&_a40.sender&&_a40.sender===this)){return this._savePendingChanges();}else{var def=new _9e6();def.resolve();return def;}},_savePendingChanges:function(){if(this._saveDeferred&&!this._saveDeferred.isFulfilled()){return this._saveDeferred.promise;}else{this._saveDeferred=new _9e6();}if(this._currentViewModel&&this._currentViewModel.get("hasPendingChanges")){var _a41=this._currentViewModel.watch("hasPendingChanges",lang.hitch(this,function(name,_a42,_a43){if(!_a43){_a41.remove();_a41=null;this._saveDeferred.resolve();}}));this._currentViewModel.save();}else{this._saveDeferred.resolve();}return this._saveDeferred.promise;},savePendingChanges:function(){return this._savePendingChanges();},_injectCssRules:function(){this.iFrame.addCssRules(this.defaultEditCssRules);},_undoAction:function(){if(this.get("isActive")&&this._currentViewModel){this._currentViewModel.undo();}},_redoAction:function(){if(this.get("isActive")&&this._currentViewModel){this._currentViewModel.redo();}},_saveAction:function(){if(this.get("isActive")&&this._currentViewModel){this._currentViewModel.save();}},_setIsActiveAttr:function(_a44){this._set("isActive",_a44);if(_a44){this._currentViewModel&&this._currentViewModel.wakeUp();this._editNotifications.wakeUp();}else{this._viewModels.forEach(function(_a45){_a45.suspend();});this._editNotifications.suspend();}}});});},"epi/shell/layout/CardContainer":function(){define("epi/shell/layout/CardContainer",["dojo/_base/declare","dojo/_base/lang","dojo/_base/fx","dojo/aspect","dojo/has","dojo/on","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/Deferred","dojo/when","dijit/_TemplatedMixin","dijit/layout/StackContainer","dgrid/util/has-css3"],function(_a46,lang,fx,_a47,has,on,_a48,_a49,_a4a,_a4b,when,_a4c,_a4d,_a4e){return _a46([_a4d,_a4c],{doLayout:false,transitionClass:"epi-transition",transitionDirection:"vertical",baseClass:"epi-cardContainer",templateString:"<div><div class='dijitContainer' style='position: relative;' data-dojo-attach-point='containerNode'></div></div>",layout:function(){var _a4f=this.selectedChildWidget;var _a50=this.getChildren(),_a51=_a50[_a50.length-1];if(_a4f&&_a4f.resize){if(_a4f.fitContainer){_a4f.resize(this._containerContentBox||this._contentBox);}else{_a4f.resize();}}if(_a4f!==_a51&&!_a4f.fitContainer){_a48.replace(_a51.domNode,"dijitVisible","dijitHidden");if(_a51&&_a51!==_a4f&&_a51.resize){if(_a51.fitContainer){_a51.resize(this._containerContentBox||this._contentBox);}else{_a51.resize();}}}},addChild:function(_a52,_a53){if(this._started){var _a54=this.getChildren(),_a55=_a54[_a54.length-1];if(_a53>=_a54.length){_a48.replace(_a55.domNode,"dijitHidden","dijitVisible");}}this.inherited(arguments);},_transition:function(_a56,_a57){var _a58=this.getChildren(),_a59=_a58[_a58.length-1];if(!_a57||_a57._destroyed){return;}if(_a57.fitContainer&&_a57!==_a59){_a48.replace(_a59.domNode,"dijitVisible","dijitHidden");}return when(_a56===_a59?this._hideTransition(_a57,_a59):null,lang.hitch(this,function(n){var _a5a=0;if(_a57&&!_a57._destroyed&&_a57!==_a59){_a5a=_a4a.getMarginBox(_a57.domNode).h;this._hideChild(_a57);}if(!_a56||_a56._destroyed){return;}this._showChild(_a56);if(_a56.resize){if(_a56.fitContainer){_a56.resize(this._containerContentBox||this._contentBox);}else{_a56.resize(null);}return when(this._showTransition(_a56,_a59,_a5a),function(){if(_a56.fitContainer&&_a56!==_a59){_a48.replace(_a59.domNode,"dijitHidden","dijitVisible");}});}else{return;}}));},_hideTransition:function(_a5b,_a5c){return this._doTransition(_a5b,_a5c,false);},_showTransition:function(_a5d,_a5e,_a5f){return this._doTransition(_a5d,_a5e,true,_a5f);},_doTransition:function(page,_a60,_a61,_a62){if(page!==_a60){var _a63=_a4a.getMarginBox(page.domNode),_a64=this._getAnimationNode(page,_a60);var _a65=this.transitionDirection==="vertical"?"top":"left",size=this.transitionDirection==="vertical"?_a63.h:_a63.w,from=_a61?-(size-_a62)+"px":"0px",to=_a61?"0px":-size+"px",_a66=!_a61;return this._animate(_a64,_a65,from,to,_a66);}},_getAnimationNode:function(page,_a67){return page.transitionMode==="slideIn"?this.containerNode:((page.transitionMode==="reveal")?_a67.domNode:null);},_animate:function(node,_a68,from,to,_a69){var dfd=new _a4b();if(node&&has("css-transitions")&&from!==to){_a49.set(node,_a68,from);setTimeout(lang.hitch(this,function(){_a48.add(node,this.transitionClass);var _a6a=on(node,has("transitionend"),lang.hitch(this,function(){_a6a.remove();_a48.remove(node,this.transitionClass);if(_a69){_a49.set(node,_a68,from);}dfd.resolve();}));setTimeout(function(){_a49.set(node,_a68,to);},1);}),1);}else{dfd.resolve();}return dfd.promise;}});});},"epi/shell/layout/PreserveRatioBorderContainer":function(){define("epi/shell/layout/PreserveRatioBorderContainer",["dojo/_base/declare","dijit/layout/BorderContainer","epi/shell/layout/_PreserveRatioMixin"],function(_a6b,_a6c,_a6d){return _a6b([_a6c,_a6d],{});});},"epi/shell/layout/_PreserveRatioMixin":function(){define("epi/shell/layout/_PreserveRatioMixin",["dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/aspect","dijit/Destroyable"],function(_a6e,lang,_a6f,_a70,_a71){return _a6e([_a71],{postCreate:function(){this.inherited(arguments);this.own(_a70.before(this,"resize",lang.hitch(this,this._adjustSplitter)));},_adjustSplitter:function(){if(typeof (this.getChildren==="function")){var _a72=this.getChildren();if(_a72.length===0){return;}var _a73=_a72.filter(function(obj){return (obj.splitter===true);});var _a74=_a72.filter(function(obj){return (obj.splitter!==true);});var _a75=_a73.length;var max=0;for(var _a76 in _a73){max=this._calcTrueMax(_a74,_a73[_a76],_a75);_a73[_a76].set("style",this._getStyle(_a73[_a76],max));}}},_getStyle:function(_a77,max){var _a78=null;switch(_a77.region){case "top":case "bottom":_a78="height: "+this._calcRatio(_a77.get("h"),max)+"%;";break;case "left":case "right":_a78="width: "+this._calcRatio(_a77.get("w"),max)+"%;";break;}return _a78;},_calcRatio:function(_a79,max){return (_a79/max)*100;},_calcTrueMax:function(_a7a,_a7b,_a7c){var _a7d="w";if(_a7b.region==="bottom"||_a7b.region==="top"){_a7d="h";}var max=_a7b.get(_a7d);var _a7e=_a7a.filter(function(_a7f){return _a7f.region==="center";})[0].get(_a7d);var _a80=_a7b._splitterWidget.get(_a7d);for(var _a81 in _a7a){if(_a7d==="w"&&(_a7a[_a81].region==="right"||_a7a[_a81].region==="left")){max+=_a7a[_a81].get("w");}else{if(_a7d==="h"&&(_a7a[_a81].region==="bottom"||_a7a[_a81].region==="top")){max+=_a7a[_a81].get("h");}}}return max+_a7e+(_a80*_a7c);}});});},"epi-cms/contentediting/EditNotifications":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Evented","epi/shell/DestroyableByKey","epi-cms/plugin-area/edit-notifications"],function(_a82,lang,_a83,_a84,_a85){return _a82([_a84,_a83],{_notificationChangedKey:"_EditingNotificationHandles",_notificationsKey:"_notifications",_notifications:null,postscript:function(){this.inherited(arguments);this.own(_a85.on("added, removed",this._watchNotifications.bind(this)));this._watchNotifications();},update:function(_a86,_a87){this._notifications.forEach(function(_a88){_a88.set("value",{contentData:_a86,context:_a87});});},suspend:function(){this._notifications.forEach(function(_a89){_a89.set("isSuspended",true);});},wakeUp:function(){this._notifications.forEach(function(_a8a){_a8a.set("isSuspended",false);});},_watchNotifications:function(){this.destroyByKey(this._notificationsKey);this._notifications=_a85.get().map(function(_a8b){this.ownByKey(this._notificationsKey,_a8b);return _a8b;},this);this.destroyByKey(this._notificationChangedKey);this._notifications.forEach(function(_a8c){this.ownByKey(this._notificationChangedKey,_a8c.watch("notification",function(name,_a8d,_a8e){this.emit("changed",{notification:_a8c,oldValue:_a8d,newValue:_a8e});}.bind(this)));},this);}});});},"epi-cms/plugin-area/edit-notifications":function(){define(["epi/PluginArea","epi-cms/contentediting/ContentReferencesNotification","epi-cms/contentediting/LanguageNotification","epi-cms/contentediting/ExpirationNotification","epi-cms/contentediting/FuturePublishingDateNotification"],function(_a8f,_a90,_a91,_a92,_a93){var _a94=new _a8f("epi-cms/edit/notifications[]");_a94.add(_a90);_a94.add(_a91);_a94.add(_a92);_a94.add(_a93);return _a94;});},"epi/PluginArea":function(){define("epi/PluginArea",["dojo/_base/declare","dojo/Evented","epi/locator"],function(_a95,_a96,_a97){return _a95([_a96],{constructor:function(_a98){if(typeof _a98!=="string"||_a98===""){throw new Error("The argument 'identifier' must be a non-empty string.");}this._identifier=_a98;_a97.add(_a98,[]);_a97.on(_a98,this.emit.bind(this));},add:function(_a99){return _a97.add(this._identifier,_a99);},get:function(){return _a97.get(this._identifier);}});});},"epi/locator":function(){define("epi/locator",["dojo/Evented","dojo/has","dojo/string"],function(_a9a,has,_a9b){var _a9c=/.+\[\]$/,_a9d={},_a9e=new _a9a();return {add:function(_a9f,_aa0){if(typeof _a9f!=="string"||_a9f===""){throw new Error("The argument 'identifier' must be a non-empty string.");}var _aa1=_a9c.test(_a9f);if(!_aa1&&_a9d[_a9f]){throw new Error(_a9b.substitute("A service with the identifier '${0}' has already been registered.",[_a9f]));}_a9d[_a9f]=_aa1?(_a9d[_a9f]||[]).concat(_aa0):_aa0;_a9e.emit(_a9f,"added");return {remove:this.remove.bind(this,_a9f,_aa0)};},get:function(_aa2){var _aa3=_a9d[_aa2];if(_aa3===undefined){if(has("epi-ignore-undefined-dependencies")){return;}throw new Error(_a9b.substitute("No service has been registered for the identifier '${0}'.",[_aa2]));}var _aa4=function(_aa5){return (typeof _aa5==="function")?new _aa5():_aa5;};if(_a9c.test(_aa2)){return _aa3.map(_aa4);}return _aa4(_aa3);},on:_a9e.on.bind(_a9e),remove:function(_aa6,_aa7){var _aa8=_a9d[_aa6];if(_aa8===undefined){return;}if(_a9c.test(_aa6)){var _aa9=_aa8.indexOf(_aa7);if(_aa9>-1){_aa8.splice(_aa9,1);}}else{delete _a9d[_aa6];}_a9e.emit(_aa6,"removed");}};});},"epi-cms/contentediting/ContentReferencesNotification":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/dom-construct","dojo/Stateful","dojo/on","dojo/when","epi/epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/DestroyableByKey","epi-cms/command/BackCommand","epi-cms/widget/sharedContentDialogHandler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.notificationbar"],function(_aaa,_aab,_aac,_aad,_aae,on,when,epi,_aaf,_ab0,_ab1,_ab2,_ab3,_ab4){return _aab([_aae,_ab1],{_backCommand:null,_clickHandleKey:"clickHandle",constructor:function(){this._backCommand=new _ab2();},postscript:function(){this.inherited(arguments);this._store=this._store||_aaf.resolve("epi.storeregistry").get("epi.cms.contentreferences");},_valueSetter:function(_ab5){this.value=_ab5;var _ab6=_ab0.getValue(_ab5.contentData.typeIdentifier,"actAsAnAsset");if(!_ab6){this.set("notification",null);return;}when(this._store.get(_ab5.contentData.contentLink)).then(this._updateNotification.bind(this));},_updateNotification:function(_ab7){if(!_ab7){this.set("notification",null);return;}var _ab8=_aad.create("div");if(_ab7.length>0){_ab8.innerHTML+=_ab4.affect;var _ab9=_ab7.length+" "+(_ab7.length===1?epi.resources.text.item:epi.resources.text.items),self=this,_aba=_aad.create("a",{href:"#",innerHTML:_ab9,title:_ab4.referencestooltip},_ab8);this.destroyByKey(this._clickHandleKey);this.ownByKey(this._clickHandleKey,on(_aba,"click",function(evt){_aac.stop(evt);self._showReferenceDialog();}));}else{_ab8.innerHTML+=epi.resources.messages.notinuse;}this._backCommand.set("model",{});this.set("notification",{content:_ab8,commands:[this._backCommand]});},_showReferenceDialog:function(){_ab3({contentData:this.get("value").contentData,showToolbar:true,mode:_ab3.mode.show});}});});},"epi-cms/command/BackCommand":function(){define(["dojo/_base/declare","dojo/topic","epi/dependency","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_abb,_abc,_abd,_abe,_abf){return _abb([_abe],{label:_abf.backtoprevious,tooltip:_abf.backtoprevious,category:"leftAligned",iconClass:"epi-iconLeft",cssClass:"epi-chromelessButton epi-visibleLink",_previousContent:null,postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_abd.resolve("epi.cms.BackContextHistory");},_execute:function(){_abc.publish("/epi/shell/context/request",{uri:this._previousContent.uri},{trigger:"back",sender:this});},_onModelChange:function(){this._previousContent=this.contextHistory.getPrevious();this.set("canExecute",this._previousContent!=null);}});});},"epi-cms/contentediting/LanguageNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/Stateful","dojo/dom-construct","epi/dependency","epi-cms/ApplicationSettings","epi-cms/contentediting/command/Editing","epi/i18n!epi/cms/nls/episerver.cms.contentediting.languagenotification"],function(_ac0,lang,_ac1,Url,_ac2,_ac3,_ac4,_ac5,_ac6,_ac7){return _ac0([_ac2],{_valueSetter:function(data){var _ac8=data.context;if(!_ac8.languageContext){this.set("notification",null);return;}var _ac9=_ac4.resolve("epi.storeregistry").get("epi.cms.language");_ac9.query().then(lang.hitch(this,function(_aca){var _acb={};_ac1.forEach(_aca,function(_acc){_acb[_acc.languageId]=_acc.name;},this);var _acd=_ac8.languageContext.warning;var _ace=_ac5.currentContentLanguage;var _acf=_ac8.languageContext;var _ad0;if(_ace!==_acf.preferredLanguage&&_acf.isTranslationNeeded){_acd=lang.replace(_ac7.nottranslatedswitchto,[_acb[_acf.language],_acb[_acf.preferredLanguage]]);_ad0=_acf.preferredLanguage;}else{if(_ace!==_acf.language&&!_acf.isTranslationNeeded){_acd=lang.replace(_ac7.workinginwrongsite,[_acb[_ace],_acb[_acf.language]]);_ad0=_acf.language;}}if(!_acd){this.set("notification",null);return;}var html=_ac3.create("div",{innerHTML:_acd});if(_ad0){var url=new Url(window.top.location.href);var text=lang.replace(_ac7.switchto,[_acb[_ad0]]);_ac3.create("a",{href:[url.scheme,"://",url.authority,url.path,"?language=",_ad0,"#context=",_ac8.versionAgnosticUri].join(""),innerHTML:text,title:text},html);}this.set("notification",{content:html,commands:_acf.isTranslationNeeded&&_ace===_acf.preferredLanguage?[_ac6.translate]:[]});}));}});});},"epi-cms/contentediting/ExpirationNotification":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/datetime","epi/dependency","epi-cms/ApplicationSettings","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(_ad1,_ad2,_ad3,_ad4,_ad5,_ad6,_ad7,_ad8){return _ad1([_ad2],{postscript:function(){this.inherited(arguments);this._notificationPeriod=_ad6.expirationNotificationPeriod;this._setupCommands();},_valueSetter:function(_ad9){var _ada=_ad9.contentData.properties.iversionable_expire;this._updateNotification(_ada);},_updateNotification:function(_adb){var _adc=_ad4.serverTime();var _add=_adb?_adb.stopPublish:null,_ade=new Date(_add);var text=null;if(_add&&_ad4.isDateValid(_ade)){if(new Date(_adc.getTime()+this._notificationPeriod*1000)>_ade){text=_ade<_adc?_ad8.expired:_ad3.substitute(_ad7.expiretimetext,[_ad4.timeToGo(_ade)]);}}if(!text){this.set("notification",null);}else{this.set("notification",{content:text,commands:[this._editingCommands.manageExpiration]});}},_viewModelValueHandler:null,_setupCommands:function(){if(!this._editingCommands){this._editingCommands=_ad5.resolve("epi.cms.contentEditing.command.Editing");}if(this._commandsWatchHandler){this._commandsWatchHandler.unwatch();}var self=this;self._commandsWatchHandler=this._editingCommands.manageExpiration.watch("viewModel",function(name,_adf,_ae0){if(self._viewModelValueHandler){self._viewModelValueHandler.unwatch();}self._viewModelValueHandler=_ae0.watch("value",function(name,_ae1,_ae2){self._updateNotification(_ae2);});});}});});},"epi-cms/contentediting/FuturePublishingDateNotification":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi/datetime","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.futurepublishingdate"],function(_ae3,_ae4,_ae5,_ae6,_ae7,_ae8){return _ae3([_ae4],{notification:null,_valueSetter:function(_ae9){var _aea=_ae9&&_ae9.contentData;if(_aea.status===_ae7.versionStatus.Published){var _aeb=new Date(_aea.properties.iversionable_startpublish);_aeb.setSeconds(0,0);if(_aeb.getTime()>_ae6.serverTime()){var _aec=_ae5.substitute(_ae8.message,[_ae6.toUserFriendlyHtml(_aeb)]);this.set("notification",{content:_aec});return;}}this.set("notification",null);}});});},"epi-cms/contentediting/ContentViewModel":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/Deferred","dojo/_base/lang","dojo/topic","dojo/on","dojo/when","dojo/promise/all","dojo/Stateful","dijit/Destroyable","dgrid/List","dgrid/extensions/DijitRegistry","epi","epi/dependency","epi/shell/UndoManager","epi/shell/conversion/ObjectConverterRegistry","epi/shell/widget/dialog/Alert","epi/shell/Stateful","../ApplicationSettings","./ContentActionSupport","./ContentEditingValidator","./ContentModelServerSync","./Operation","epi/i18n!epi/cms/nls/episerver.cms.contentediting","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(_aed,_aee,_aef,_af0,lang,_af1,on,when,all,_af2,_af3,List,_af4,epi,_af5,_af6,_af7,_af8,_af9,_afa,_afb,_afc,_afd,_afe,res,_aff){return _aef([_af2,_af3],{contentModel:null,metadata:null,syncService:null,editorFactory:null,validator:null,contentDataStore:null,profileHandler:null,languageContext:null,enableAutoSave:true,_converterRegistry:null,_contentVersionStore:null,_syncRetryTimeout:60000,undoManager:null,contextTypeName:"",contentLink:null,contentData:null,viewName:null,isCreatingNewVersion:false,hasUndoSteps:false,hasRedoSteps:false,isValid:true,hasPendingChanges:false,lastSaved:null,isSaved:true,isSaving:false,isOnline:true,hasErrors:false,isChangingContentStatus:false,isSuspended:false,constructor:function(){this.contentModel=new _af9();},postscript:function(){this.inherited(arguments);this.profileHandler=this.profileHandler||_af5.resolve("epi.shell.Profile");this.metadataManager=this.metadataManager||_af5.resolve("epi.shell.MetadataManager");this.projectService=this.projectService||_af5.resolve("epi.cms.ProjectService");this.currentContentLanguage=this.currentContentLanguage||_afa.currentContentLanguage;this.contentDataStore=this.contentDataStore||_af5.resolve("epi.storeregistry").get("epi.cms.contentdata");if(!this._contentVersionStore){this._contentVersionStore=_af5.resolve("epi.storeregistry").get("epi.cms.contentversion");}this.undoManager=this.undoManager||new _af6();this.validator=this.validator||new _afc({contextId:this.get("contentLink"),contextTypeName:this.contextTypeName});if(!this.syncService){this._createSyncService();}var _b00=lang.hitch(this,function(name,_b01,_b02){this.set(name,_b02);});this._operation=new _afe();this.own(this.syncService.watch("hasPendingChanges",_b00),this.validator.watch("isValid",_b00),this.validator.watch("hasErrors",_b00),this.undoManager.watch("hasUndoSteps",_b00),this.undoManager.watch("hasRedoSteps",_b00),on(this._operation,"commit",lang.hitch(this,this._commitChanges)));},setActiveProperty:function(name){this.onSetActiveProperty(name);},suspend:function(){this.set("isSuspended",true);this.onContentChange();this.onSuspend();},onSuspend:function(){},wakeUp:function(){this.set("isSuspended",false);},destroy:function(){this.clear();this.inherited(arguments);},clear:function(){this.undoManager.clear();},_createSyncService:function(){var _b03=new _afd({contentLink:this.get("contentLink"),contentDataStore:this.contentDataStore});this.syncService=_b03;},connectLocal:function(_b04,obj,evt,_b05){if(!lang.isArray(_b04)){throw Error("First argument to connectLocal must be an Array");}return _b04.push(_aee.connect(obj,evt,this,_b05));},disconnectLocal:function(_b06){if(lang.isArray(_b06)){var _b07;while((_b07=_b06.pop())){_aee.disconnect(_b07);}}},resetNotifications:function(){this.validator.clearErrorsBySource(this.validator.validationSource.client);},beginOperation:function(){this._operation.begin();},endOperation:function(){this._operation.end();},abortOperation:function(){this._operation.abort();},getProperty:function(_b08){return this.contentModel.get(_b08);},setProperty:function(_b09,_b0a,_b0b){this._setModelProperty(_b09,_b0a,_b0b);},forceSaveProperty:function(_b0c,_b0d){return this.syncService.forceSaveProperty(_b0c,_b0d).then(this.contentModel.set.bind(this.contentModel,_b0c,_b0d));},saveAndPublishProperty:function(_b0e,_b0f){return when(this.syncService.saveAndPublishProperty(_b0e,_b0f),lang.hitch(this,function(_b10){this.contentModel.set(_b0e,_b0f);return when(all([this.contentDataStore.refresh(_b10.contentLink),_b10.publishedContentLink?this.contentDataStore.refresh(_b10.publishedContentLink):null]),lang.hitch(this,function(_b11){var _b12=_b11[0];this.set("contentData",_b12);return _b10;}));}));},_commitChanges:function(_b13){var _b14=[];_b13.forEach(function(_b15){_b14.push({propertyName:_b15.propertyName,value:_b15.oldValue,oldValue:_b15.value});},this);this.undoManager.createStep(this,this._saveProperties,[_b14],"Edit properties");},_saveProperties:function(_b16){this.beginOperation();_aed.forEach(_b16,function(p){this._setModelProperty(p.propertyName,p.value,p.oldValue);},this);this.endOperation();},_setModelProperty:function(_b17,_b18,_b19){_b19=_b19===undefined?this.contentModel.get(_b17):_b19;this.set("isSaved",false);this.contentModel.set(_b17,_b18);this._operation.save({propertyName:_b17,value:_b18,oldValue:_b19});this.syncService.scheduleForSync(_b17,_b18);this.enableAutoSave&&this.save();this.onPropertyEdited(_b17,_b18);},onPropertyEdited:function(_b1a,_b1b){},onPropertySaved:function(_b1c,_b1d){},onPropertyReverted:function(_b1e,_b1f){this.contentModel.set(_b1e,_b1f);},_onSynchronizeSuccess:function(_b20,_b21,_b22){_aed.forEach(_b21,lang.hitch(this,function(_b23){this.validator.clearPropertyErrors(_b23.name,this.validator.validationSource.server);this._patchContentDataStore(_b20,_b23.name,null,_b23.value);this.onPropertySaved(_b23.name,_b23.value);}));this.validator.setGlobalErrors(_b22.validationErrors,this.validator.validationSource.server);},_onSynchronizeFailure:function(_b24,_b25,_b26,_b27){var _b28=[];_aed.forEach(_b25,function(_b29){if("successful" in _b29){if(_b29.successful){this.validator.clearPropertyErrors(_b29.name,this.validator.validationSource.server);}else{if(_b29.committed){this.validator.setPropertyErrors(_b29.name,[{errorMessage:_b29.validationErrors,severity:this.validator.severity.error}],this.validator.validationSource.server);}else{_b28.push(_b29);}}}},this);if(_b28.length){var _b2a=_aed.map(_b28,function(_b2b){return _b2b.validationErrors;});this._showErrorsDialog(res.autosave.title,res.autosave.error,_b2a,lang.hitch(this,function(){_aed.forEach(_b28,function(_b2c){this.onPropertyReverted(_b2c.name,_b2c.value);},this);}));}if(_b27){if(_b27.validationErrors){this.validator.setGlobalErrors(_b27.validationErrors,this.validator.validationSource.server);}else{this.validator.clearGlobalErrors(this.validator.validationSource.server);}}},_showErrorsDialog:function(_b2d,_b2e,_b2f,_b30){var list=new (_aef([List,_af4]))({className:"epi-grid-max-height--300"});list.renderArray(_b2f);list.startup();new _af8({title:_b2d,description:_b2e,content:list,onAction:_b30}).show();},_contentLinkChanged:function(_b31,_b32){this.set("contentLink",_b32);this.syncService.contentLink=_b32;this.validator.setContextId(_b32);if(!this.get("isSuspended")){var _b33={uri:"epi.cms.contentdata:///"+_b32};_af1.publish("/epi/shell/context/request",_b33,{sender:this,contextIdSyncChange:true,trigger:"internal"});}},ensureWritableVersion:function(){var _b34=this.get("contentLink");if(!this.contentData.isNewVersionRequired){return _b34;}if(this._isCreatingNewVersionDeferred&&!this._isCreatingNewVersionDeferred.isFulfilled()){return this._isCreatingNewVersionDeferred.promise;}else{this._isCreatingNewVersionDeferred=new _af0();}this.isCreatingNewVersion=true;when(this._contentVersionStore.put({originalContentLink:_b34}),lang.hitch(this,function(_b35){this.contentDataStore.refresh(_b35.contentLink).then(lang.hitch(this,function(_b36){this.set("contentData",_b36);})).always(lang.hitch(this,function(){this.isCreatingNewVersion=false;this._contentLinkChanged(_b34,_b35.contentLink);this._isCreatingNewVersionDeferred.resolve(_b35);}));}),lang.hitch(this,function(_b37){console.error(_b37);this.isCreatingNewVersion=false;this._isCreatingNewVersionDeferred.reject(_b37);}));return this._isCreatingNewVersionDeferred.promise;},validate:function(){var def;if(!this.validator){def=new _af0();def.resolve();}else{def=this.validator.validate();}return def;},revertToPublished:function(){var _b38=this.get("contentLink");when(this._contentVersionStore.remove(_b38),lang.hitch(this,function(){this._loadPublishedVersion(_b38);}),lang.hitch(this,function(_b39){var _b3a;if(_b39.status===403){_b3a=_aff.deleteversion.cannotdeletepublished;}else{if(_b39.status===404){_b3a=res.versionstatus.versionnotfound;}}if(_b3a){new _af8({description:_b3a,onAction:lang.hitch(this,function(){this._loadPublishedVersion(_b38);})}).show();}}));},_loadPublishedVersion:function(_b3b){when(this._contentVersionStore.query({contentLink:_b3b,language:this.languageContext?this.languageContext.language:"",query:"getpublishedversion"}),lang.hitch(this,function(_b3c){if(_b3c!==null){var _b3d={uri:"epi.cms.contentdata:///"+_b3c.contentLink,context:this};_af1.publish("/epi/shell/context/request",_b3d,{sender:this,forceReload:true});}}));},createDraft:function(){var _b3e=this.get("contentLink"),_b3f=this.contentData.isCommonDraft&&this.contentData.status===_afb.versionStatus.DelayedPublish&&!this.projectService.isProjectModeEnabled;return when(this._contentVersionStore.put({originalContentLink:_b3e,isCommonDraft:_b3f}),lang.hitch(this,function(_b40){var _b41={uri:"epi.cms.contentdata:///"+_b40.contentLink,context:this};_af1.publish("/epi/shell/context/request",_b41,{sender:this});_af1.publish("/epi/cms/content/statuschange/","common-draft",{id:_b40.contentLink});}));},editCommonDraft:function(){var _b42=this.get("contentLink");return when(this._contentVersionStore.query({contentLink:_b42,query:"getcommondraftversion"}),lang.hitch(this,function(_b43){var _b44={uri:"epi.cms.contentdata:///"+_b43.contentLink,context:this};_af1.publish("/epi/shell/context/request",_b44,{sender:this});}));},_populateContentModel:function(data,_b45){var _b46={},_b47,_b48;for(var _b49 in data){var _b4a=_b45.getPropertyMetadata(_b49);var _b4b=data[_b49];if(_b4a.hasSubProperties()){_b46[_b49]=this._populateContentModel(_b4b,_b4a);}else{_b46[_b49]=_b4b;_b47=_b4a.customEditorSettings.converter;if(_b47){_b48=_af7.getConverter(_b47,"runtimeType");if(_b48){_b46[_b49]=_b48.convert(_b47,"runtimeType",_b4b);}}}}return _b46;},getPropertyMetaData:function(_b4c){return when(this._getMetadata(),function(_b4d){return _b4d.getPropertyMetadata(_b4c);});},reload:function(){return when(all([this.contentDataStore.get(this.get("contentLink")),this._getMetadata(true)]),lang.hitch(this,function(data){var _b4e=data[0],_b4f=data[1];this.set("contentData",_b4e);var _b50=this.get("contentModel");var _b51=this._populateContentModel(_b4e.properties,_b4f);for(var name in _b51){if(_b51.hasOwnProperty(name)&&!epi.areEqual(_b50.get(name),_b51[name])){_b50.set(name,_b51[name]);}}}));},_getMetadata:function(_b52){var _b53=this.get("metadata");if(!_b52&&_b53){return _b53;}var self=this;return when(this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:this.get("contentLink")}),function(_b54){self.set("metadata",_b54);return _b54;});},save:function(){if(!this.isOnline){var def=new _af0();def.resolve(true);return def;}return this._save();},_save:function(){var def=new _af0(),_b55=lang.hitch(this,function(_b56){if(_b56){if(_b56.successful){this._onSynchronizeSuccess(_b56.contentLink,_b56.properties,_b56);}else{this._rescheduleProperties(_b56.properties);this._onSynchronizeFailure(_b56.contentLink,_b56.properties,_b56.validationErrors,_b56);}if(_b56&&_b56.hasContentLinkChanged){this._contentLinkChanged(_b56.contentLink,_b56.oldContentLink);}}this.set("isOnline",true);this.set("lastSaved",new Date());this.set("isSaving",false);this.set("isSaved",true);def.resolve(true);}),_b57=lang.hitch(this,function(_b58){this.set("hasErrors",true);this.set("isSaving",false);this.set("isSaved",false);this.set("isOnline",false);if(_b58){this._rescheduleProperties(_b58.properties);}setTimeout(lang.hitch(this,function(){this.set("isOnline",true);this._save();}),this._syncRetryTimeout);def.reject(_b58);});if(!this.hasPendingChanges){_b55();}else{when(this.ensureWritableVersion()).then(lang.hitch(this,function(){this.set("isSaving",true);return this.syncService.save();})).then(_b55).otherwise(_b57);}return def;},_rescheduleProperties:function(_b59){_aed.forEach(_b59,lang.hitch(this,function(_b5a){if(!this.syncService.pendingSync(_b5a.name)){this.syncService.scheduleForSync(_b5a.name,_b5a.value);}}));},undo:function(){!this.get("isSuspended")&&this.undoManager.undo();},redo:function(){!this.get("isSuspended")&&this.undoManager.redo();},_patchContentDataStore:function(_b5b,_b5c,_b5d,_b5e){var _b5f={};lang.setObject(_b5c,_b5e,_b5f);return this.contentDataStore.patchCache({contentLink:_b5b,changedBy:this.profileHandler.userName,saved:(new Date()).toISOString(),properties:_b5f});},changeContentStatus:function(_b60){var _b61=this.get("contentLink");var def=new _af0();this.set("isChangingContentStatus",true);var _b62=lang.hitch(this,function(_b63){var _b64=_b63&&_b63.success;var _b65=this.validator;if(_b64){if(_b60===_afb.action.Publish||_b60===_afb.action.CheckIn||_b60===(_afb.saveAction.CheckIn|_afb.saveAction.DelayedPublish|_afb.saveAction.ForceCurrentVersion)){this.set("lastSaved",null);}if(_b65){_b65.clearGlobalErrors(_b65.validationSource.server);}var _b66={id:_b63.id,oldId:_b61};_af1.publish("/epi/cms/content/statuschange/",_b60,_b66);def.resolve(_b66);}else{if(_b63&&_b63.validationErrors){if(_b65){_b65.setGlobalErrors(_b63.validationErrors,_b65.validationSource.server);_b65.validate();}def.reject(null);}else{def.reject((_b63&&_b63.errorMessage)?_b63.errorMessage:res.publish.error);}}this.set("isChangingContentStatus",false);});var _b67=lang.hitch(this,function(_b68){_af1.publish("/epi/cms/action/showerror");def.reject((_b68&&_b68.errorMessage)?_b68.errorMessage:res.publish.error);this.set("isChangingContentStatus",false);});this.onContentChange();when(this.validate(),lang.hitch(this,function(){when(this.save(),lang.hitch(this,function(){when(this.contentDataStore.executeMethod("ChangeStatus",this.get("contentLink"),{action:_b60}),_b62,_b67);}),_b67);}),_b67);return def;},onContentChange:function(){},hasEditAccess:function(){return _afb.hasAccess(this.contentData.accessMask,_afb.accessLevel.Edit);},hasAccess:function(_b69){var _b6a=!this.languageContext||!this.languageContext.isTranslationNeeded;return _b6a&&_afb.isActionAvailable(this.contentData,_b69||_afb.action.Edit,_afb.providerCapabilities.Edit);},canTranslateContent:function(){if(this.viewLanguage&&this.languageContext&&this.viewLanguage!==this.currentContentLanguage){return false;}return true;},canChangeContent:function(_b6b){var _b6c=this.projectService.isProjectModeEnabled&&this.contentData.isPartOfAnotherProject;return !_b6c&&this.canEditCurrentLanguage()&&this.hasAccess(_b6b);},canEditCurrentLanguage:function(){if(!this.languageContext){return true;}return this.languageContext.language===this.currentContentLanguage;},_contentDataSetter:function(_b6d){this.contentData=_b6d;if(_b6d.contentLink!==undefined){this.set("contentLink",_b6d.contentLink);}},_showOverlayGetter:function(){var _b6e=this.getProperty("iversionable_shortcut");if(_b6e&&_b6e.pageShortcutType){return _b6e.pageShortcutType!==4;}return true;}});});},"epi-cms/contentediting/ContentEditingValidator":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/connect","dojo/store/Memory","dojo/Stateful","epi/dependency"],function(dojo,_b6f,_b70,_b71,lang,_b72,_b73,_b74,_b75){return _b70([_b74],{contextTypeName:"",contextId:null,messageService:null,_isBlocking:false,isValid:true,hasErrors:false,_storeId:0,_store:null,severity:{none:0,info:1,warn:2,error:3},validationSource:{server:1,client:2},_errorLevels:{},constructor:function(_b76){_b70.safeMixin(this,_b76);},postscript:function(){this.inherited(arguments);for(var p in this.severity){var _b77=this.severity[p];this._errorLevels[_b77]=p;}this.messageService=this.messageService||_b75.resolve("epi.shell.MessageService");this._store=new _b73({idAttribute:"id",data:[]});},setContextId:function(_b78){var _b79=this.contextId;this.contextId=_b78;var _b7a=this.messageService.query({contextTypeName:this.contextTypeName,contextId:_b79});_b7a.forEach(lang.hitch(this,function(item){item.contextId=this.contextId;this.messageService.put(item);}));},clearPropertyErrors:function(_b7b,_b7c){if(!_b7b){return;}this._clearErrors(_b7b,_b7c);},setPropertyErrors:function(_b7d,_b7e,_b7f){if(!_b7d){return;}this._setErrors(_b7e,_b7d,_b7f);},clearGlobalErrors:function(_b80){this._clearErrors(null,_b80);},clearErrorsBySource:function(_b81){this._clearErrors(undefined,_b81);},setGlobalErrors:function(_b82,_b83){this._setErrors(_b82,null,_b83);},_clearErrors:function(_b84,_b85){var _b86;if(_b84){_b86={propertyName:_b84};}else{if(_b84===null){_b86={global:true};}else{_b86={};}}if(_b85){_b86.source=_b85;}var _b87=this._store.query(_b86);_b87.forEach(lang.hitch(this,function(item){this.messageService.remove({id:item.messageId});this._store.remove(item.id);}));this._updateFlags();},_setErrors:function(_b88,_b89,_b8a){this._clearErrors(_b89,_b8a);_b6f.forEach(_b88,function(item){this._putStoreItem(item,_b89,_b8a);},this);this._updateFlags();},_putStoreItem:function(item,_b8b,_b8c){var _b8d="";if(this._errorLevels[item.severity]){_b8d=this._errorLevels[item.severity];}var _b8e=this.messageService.put(_b8d,item.errorMessage,this.contextTypeName,this.contextId);var _b8f={id:this._storeId++,item:item,severity:item.severity,messageId:_b8e};if(_b8b){_b8f.propertyName=_b8b;}else{_b8f.global=true;}if(_b8c!==undefined){_b8f.source=_b8c;}return this._store.put(_b8f);},_updateFlags:function(){var _b90=this._store.query({severity:this.severity.error});var _b91=this._store.query({severity:this.severity.warn});var _b92=_b90.length===0&&_b91.length===0;var _b93=_b90.length>0;this.set("isValid",_b92);this.set("hasErrors",_b93);},validate:function(){var _b94=this.severity.error,_b95=this.severity.warn,_b96=new _b71();_b71.when(this._validate(_b94),function(_b97){if(_b97){_b72.publish("/epi/cms/action/showerror");}_b96.resolve(_b97);},function(){_b72.publish("/epi/cms/action/showerror");_b96.reject();});return _b96;},_validate:function(_b98){var _b99=new _b71();if(!this._isBlocking){_b71.when(this._store.query({severity:_b98}),lang.hitch(this,function(_b9a){var _b9b=_b6f.filter(_b9a,function(item){return item.source===this.validationSource.client;},this);var _b9c=_b9b.length>0;var _b9d=_b9a.length>_b9b.length;if(_b9c){_b99.reject();}else{_b99.resolve(_b9d);}}));}return _b99;}});});},"epi-cms/contentediting/ContentModelServerSync":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Deferred","dojo/when","dojo/_base/json","dojo/_base/lang","dojo/Stateful","epi/datetime","epi/string"],function(_b9e,_b9f,_ba0,when,json,lang,_ba1,_ba2,_ba3){return _b9f([_ba1],{_queue:null,_isSynchronizing:false,hasPendingChanges:false,contentLink:null,contentDataStore:null,processInterval:200,_processIntervalId:0,_saveDeferred:null,constructor:function(_ba4){_b9f.safeMixin(this,_ba4);this._queue=[];},scheduleForSync:function(_ba5,_ba6){if(_ba6===undefined){return;}this.set("hasPendingChanges",true);_ba6=_ba2.transformDate(_ba6);var _ba7=this._propertyIndexInQueue(_ba5);if(_ba7<0){this._queue.push({name:_ba5,value:_ba6});}else{this._queue[_ba7].value=_ba6;}},forceSaveProperty:function(_ba8,_ba9){return this.save().then(function(){this.scheduleForSync(_ba8,_ba9);return this._startSynchronizeInterval({delay:0,forceCurrent:true});}.bind(this));},saveAndPublishProperty:function(_baa,_bab){this.scheduleForSync(_baa,_bab);return this._startSynchronizeInterval({delay:0,publish:true});},_propertyIndexInQueue:function(_bac){var _bad=-1;_b9e.some(this._queue,function(item,i){if(item.name===_bac){_bad=i;return true;}});return _bad;},save:function(){return this._startSynchronizeInterval();},_startSynchronizeInterval:function(_bae){var _baf;if(!this._saveDeferred){this._saveDeferred=new _ba0();_baf=_bae&&_bae.delay||this.processInterval;setTimeout(this._synchronizeItem.bind(this,_bae),_baf);}return this._saveDeferred.promise;},_synchronizeItem:function(_bb0){var _bb1=this._queue,_bb2=this.contentLink,_bb3=this._saveDeferred;this._queue=[];this._saveDeferred=null;this.set("hasPendingChanges",false);var _bb4=function(_bb5){var _bb6={},_bb7;if(_bb5){_b9e.forEach(_bb5.properties,lang.hitch(this,function(_bb8){_bb8.name=_ba3.pascalToCamel(_bb8.name);}));_bb7=_bb5.savedContentLink;_bb6=lang.mixin({successful:false,contentLink:_bb5.savedContentLink,hasContentLinkChanged:_bb5.savedContentLink&&_bb7!==this.contentLink},_bb5);if(_bb7&&_bb7!==this.contentLink){_bb6.oldContentLink=this.contentLink;this.contentLink=_bb7;}_bb3.resolve(_bb6);}else{_bb3.reject({contentLink:_bb2,properties:_bb1,error:"Unexpected result returned from the server."});}}.bind(this);var _bb9=function(_bba){var _bbb={contentLink:_bb2,properties:_bb1,error:_bba};_bb3.reject(_bbb);}.bind(this);if(_bb1.length===0){_bb3.resolve();return;}when(this._saveProperties(_bb1,_bb0)).then(_bb4).otherwise(_bb9);},pendingSync:function(_bbc){return this._propertyIndexInQueue(_bbc)!==-1;},_saveProperties:function(_bbd,_bbe){var _bbf=this.contentLink,_bc0={},_bc1=!!_bbe&&_bbe.forceCurrent,_bc2=!!_bbe&&_bbe.publish;_b9e.forEach(_bbd,lang.hitch(this,function(item){_bc0[item.name]=json.toJson(item.value);}));var _bc3={id:_bbf,properties:_bc0,publishChanges:_bc2,forceCurrent:_bc1};return this.contentDataStore.patch(_bc3,{id:_bc3.id});}});});},"epi-cms/contentediting/Operation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Evented","dojo/Stateful"],function(_bc4,_bc5,lang,_bc6,_bc7){return _bc5([_bc7,_bc6],{inProgress:false,changes:null,constructor:function(){this.changes=[];},begin:function(){this.set("inProgress",true);},save:function(data){if(this.inProgress){this.changes=_bc4.filter(this.changes,function(_bc8){if(_bc8.propertyName===data.propertyName){data.oldValue=_bc8.oldValue;return false;}return true;});this.changes.push(data);return;}if(!lang.isArray(data)){data=[data];}this.emit("commit",data);},end:function(){this.set("inProgress",false);if(this.changes.length>0){this.save(this.changes);}this.changes=[];},abort:function(){this.set("inProgress",false);this.changes=[];}});});},"epi-cms/contentediting/EditToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-class","dojo/topic","dojo/when","epi","epi-cms/contentediting/command/Editing","epi-cms/contentediting/viewmodel/EditActionPanelViewModel","epi-cms/contentediting/StandardToolbar","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu","epi-cms/widget/NotificationStatusBar","epi-cms/contentediting/EditActionPanel"],function(_bc9,lang,_bca,_bcb,_bcc,when,epi,_bcd,_bce,_bcf,res,_bd0){return _bc9([_bcf],{res:res,_editActionViewModel:null,_commands:null,postMixInProperties:function(){this.inherited(arguments);this._commands=_bcd;this._commands.revertToPublished.watch("canExecute",lang.hitch(this,function(){this.setItemProperty(this._commands.revertToPublished.name,"disabled",!this._commands.revertToPublished.canExecute);}));this._editActionViewModel=new _bce();this.own(this._editActionViewModel);},resize:function(_bd1){this.inherited(arguments);if(_bd1){_bcb.toggle(this.domNode,"epi-editToolbarNarrow",_bd1.w<620);_bcb.toggle(this.domNode,"epi-editToolbarMedium",_bd1.w>=620&&_bd1.w<1000);this._editActionViewModel.set("expanded",_bd1.w>=1000);this.setItemProperty("autosave","isInNarrowToolbar",_bd1.w<1000);}},setupChildren:function(_bd2,_bd3){var _bd4=[{parent:"center",name:"autosave",label:this.res.autosave.savinglabel,type:"dropdown",settings:{"class":"epi-autosave-hidden"}},{parent:"autosave",name:"undo",title:this.res.undo.title,label:epi.resources.action.undo,type:"menuitem",iconClass:"epi-iconUndo",settings:{disabled:true,showLabel:false},action:function(){_bcc.publish("/epi/cms/action/undo",[]);}},{parent:"autosave",name:"redo",title:this.res.redo.title,label:epi.resources.action.redo,type:"menuitem",iconClass:"epi-iconRedo",settings:{disabled:true,showLabel:false},action:function(){_bcc.publish("/epi/cms/action/redo",[]);}},{parent:"autosave",name:"reverttopublished",title:this._commands.revertToPublished.tooltip,label:this._commands.revertToPublished.label,type:"menuitem",iconClass:"epi-iconRevert",settings:{separate:true},action:lang.hitch(this,function(){this._commands.revertToPublished.execute();})},{parent:"trailing",name:"notifications",widgetType:"epi-cms/widget/NotificationStatusBar"},{name:"editactionpanel",label:epi.resources.action.publish,parent:"trailing",widgetType:"epi-cms/contentediting/EditActionPanel",settings:{model:this._editActionViewModel}},{parent:"trailing",name:"editmodeswitch",title:this.res.formedit.title,label:this.res.formedit.label,widgetType:"dijit/form/ToggleButton",iconClass:"epi-iconForms",settings:{showLabel:false,"class":"epi-mediumButton epi-modeButton"},action:function(){if(this.get("state")==="Loading"){return;}this.set("state","Loading");setTimeout(function(){_bcc.publish("/epi/cms/action/switcheditmode");},0);}}];var _bd5=_bd2?_bd2:[];_bd4=_bd3?_bd3.concat(_bd4):_bd4;return this.inherited(arguments,[_bd5,_bd4]);},_setContentViewModelAttr:function(_bd6){this._set("contentViewModel",_bd6);when(this.isSetup(),lang.hitch(this,function(){this._updateToolbarItemsModel(_bd6);}));},_updateToolbarItemsModel:function(_bd7){this.setItemProperty("autosave","label","");this.setItemProperty("autosave","class","epi-autoSaveButton epi-disabledDropdownArrow");var _bd8=_bd7.contentData;this.setItemProperty("notifications","notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_bd8.contentLink});var _bd9="",_bda="";if(_bd7.viewName==="formedit"){this.setItemProperty("editmodeswitch","checked",true);_bd9=this.res.onpageedit.title;_bda=this.res.onpageedit.label;}else{this.setItemProperty("editmodeswitch","checked",false);_bd9=this.res.formedit.title;_bda=this.res.formedit.label;}this.setItemProperty("editmodeswitch","title",_bd9);this.setItemProperty("editmodeswitch","label",_bda);var _bdb=this._hasCustomViews(this.viewConfigurations.availableViews);var _bdc=this._hasBuiltInViews(this.viewConfigurations.availableViews);this.setItemVisibility("editmodeswitch",!_bdb&&_bdc&&_bd8.hasTemplate);this.setItemVisibility("viewselect",_bdb);this._editActionViewModel.set("dataModel",_bd7);},_hasCustomViews:function(_bdd){return _bca.filter(_bdd,function(view){return !view.hideFromViewMenu&&view.key!=="onpageedit"&&view.key!=="formedit";}).length;},_hasBuiltInViews:function(_bde){return _bca.filter(_bde,function(view){return view.key==="onpageedit"||view.key==="formedit";}).length===2;}});});},"epi-cms/contentediting/viewmodel/EditActionPanelViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/string","dojox/html/entities","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi-cms/contentediting/viewmodel/PublishMenuViewModel","epi/datetime","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel"],function(_bdf,_be0,lang,_be1,_be2,_be3,_be4,_be5,_be6,_be7,_be8,res){return _be0([_be5],{state:null,buttonText:null,statusText:null,statusIcon:null,additionalClass:null,nonEditableIndicator:null,visible:null,publishMenuViewModel:null,inUseNotificationManager:null,canApproveCurrentStep:null,approvalService:null,skipChildModels:false,_virtualStatusEnum:{NotCreated:0,NotPublishedYet:1,NoChangeToPublish:2,ChangesToPublish:3,ReadyToPublish:4,ScheduledPublish:5,Published:6,PreviouslyPublished:7,Expired:8,InUse:9,Deleted:10,AwaitingApproval:11,Rejected:12},_virtualStatusCssState:[],_virtualStatusLocalization:[],_statusIcon:[],_watchers:null,_statusMap:{},postscript:function(){this.res=this.res||res;this.inherited(arguments);this.inUseNotificationManager=this.inUseNotificationManager||_be8.resolve("epi.cms.contentediting.inUseNotificationManager");this.approvalService=this.approvalService||_be8.resolve("epi.cms.ApprovalService");if(this._virtualStatusCssState.length===0){for(var _be9 in this._virtualStatusEnum){this._virtualStatusCssState.push(_be9);this._virtualStatusLocalization.push(this.res["status"][_be9.toLowerCase()]);}this._statusMap[_be4.versionStatus.CheckedOut]=this._virtualStatusEnum.NotPublishedYet;this._statusMap[_be4.versionStatus.CheckedIn]=this._virtualStatusEnum.ReadyToPublish;this._statusMap[_be4.versionStatus.Rejected]=this._virtualStatusEnum.Rejected;this._statusMap[_be4.versionStatus.DelayedPublish]=this._virtualStatusEnum.ScheduledPublish;this._statusMap[_be4.versionStatus.Published]=this._virtualStatusEnum.Published;this._statusMap[_be4.versionStatus.PreviouslyPublished]=this._virtualStatusEnum.PreviouslyPublished;this._statusMap[_be4.versionStatus.Expired]=this._virtualStatusEnum.Expired;this._statusMap[_be4.versionStatus.AwaitingApproval]=this._virtualStatusEnum.AwaitingApproval;this._statusIcon[_be4.versionStatus.DelayedPublish]="epi-iconClock";this._statusIcon[_be4.versionStatus.AwaitingApproval]="epi-icon--inverted epi-iconReview";}if(!this.skipChildModels){this.publishMenuViewModel=new _be6({inUseNotificationManager:this.inUseNotificationManager});}},destroy:function(){if(this.publishMenuViewModel){this.publishMenuViewModel.destroy();}this.inherited(arguments);},_setDataModelAttr:function(_bea){this.inherited(arguments);if(this.publishMenuViewModel){this.publishMenuViewModel.set("dataModel",_bea);}},_onDataModelChange:function(_beb){var _bec=this._getVirtualStatus(_beb);this.set("state",this._virtualStatusCssState[_bec]);this.set("additionalClass",_bec===this._virtualStatusEnum.ChangesToPublish?"animated8 shake":"");this._setStatusText(_bec,_beb);this.set("buttonText",this._getButtonText(_bec,_beb));this.set("statusIcon",this._statusIcon[_beb.status]||"");var _bed=this.dataModel.canChangeContent(_be4.action.Edit);var _bee=_beb.status===_be4.versionStatus.AwaitingApproval;this.set("nonEditableIndicator",!_bed&&!_bee);this.set("visible",!_beb.isWastebasket);},onDataModelChange:function(){var _bef=this.dataModel.contentData;if(_bef.status===_be4.versionStatus.AwaitingApproval){this.approvalService.getApproval(_bef.contentLink).then(function(_bf0){_bf0&&this.set("canApproveCurrentStep",_bf0.canApproveCurrentStep);this._onDataModelChange(_bef);}.bind(this));}else{this._onDataModelChange(_bef);}},_setStatusText:function(_bf1,_bf2){if(_bf2.status===_be4.versionStatus.DelayedPublish){this.set("statusText",_be2.substitute(this._virtualStatusLocalization[_bf1],[_be7.toUserFriendlyHtml(_bf2.properties.iversionable_startpublish)]));}else{if(_bf1===this._virtualStatusEnum.InUse){var _bf3=this.inUseNotificationManager.getOtherUsersInUseNotifications(_bf2.inUseNotifications);_bf3=_bf3.map(function(item){return _be3.encode(item);}).join(",");this.set("statusText",_be2.substitute(this._virtualStatusLocalization[_bf1],[_bf3]));}else{if(_bf2.status===_be4.versionStatus.AwaitingApproval){if(this.canApproveCurrentStep){this.set("statusText",this.res.awaitingyourapproval.label);}else{this.set("statusText",this.res.currentlyinreview.label);}}else{this.set("statusText",this._virtualStatusLocalization[_bf1]);}}}},_getButtonText:function(_bf4,_bf5){if((_bf4===this._virtualStatusEnum.NotPublishedYet||_bf4===this._virtualStatusEnum.ChangesToPublish||_bf4===this._virtualStatusEnum.ReadyToPublish)&&this.dataModel.canChangeContent(_be4.action.Publish)){return this.res.buttonlabel.publish;}else{if(_bf4===this._virtualStatusEnum.AwaitingApproval&&this.canApproveCurrentStep){return this.res.awaitingyourapproval.button;}else{return this.res.buttonlabel.option;}}},_getVirtualStatus:function(_bf6){if(_bf6.isDeleted){return this._virtualStatusEnum.Deleted;}var _bf7,_bf8,_bf9;_bf7=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;_bf8=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_bf7;_bf9=this.inUseNotificationManager.hasInUseNotificationWarning(_bf6.inUseNotifications);if(_bf9&&_bf8){return this._virtualStatusEnum.InUse;}if(_bf6.isCommonDraft){if(_bf6.status===_be4.versionStatus.Published){return this._virtualStatusEnum.NoChangeToPublish;}if(_bf6.status===_be4.versionStatus.CheckedOut){return _bf6.isMasterVersion?this._virtualStatusEnum.NotPublishedYet:this._virtualStatusEnum.ChangesToPublish;}}return this._statusMap[_bf6.status];}});});},"epi-cms/contentediting/viewmodel/_ContentViewModelObserver":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin"],function(_bfa,_bfb,lang,_bfc,_bfd){return _bfa([_bfc,_bfd],{dataModel:null,_watchers:null,destroy:function(){this._unbindDataModel();this.inherited(arguments);},_bindDataModel:function(){this._watchers.push(this.dataModel.watch("status",lang.hitch(this,this.onDataModelChange)));this._watchers.push(this.dataModel.watch("contentData",lang.hitch(this,this.onDataModelChange)));},_unbindDataModel:function(){_bfb.forEach(this._watchers,function(w){w.unwatch();});this._watchers=[];},_setDataModelAttr:function(_bfe){this._unbindDataModel();this._set("dataModel",_bfe);this.onDataModelChange();this._bindDataModel();},onDataModelChange:function(name,_bff,_c00){}});});},"epi-cms/contentediting/viewmodel/PublishMenuViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/Deferred","dijit/Destroyable","dojox/html/entities","epi","epi/datetime","epi/dependency","epi/username","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContentViewModelObserver","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_GlobalCommandProviderMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_c01,lang,when,_c02,_c03,_c04,epi,_c05,_c06,_c07,_c08,_c09,_c0a,_c0b,res){return _c01([_c09,_c0a,_c0b,_c03],{commandKey:"epi.cms.publishmenu",contentActionSupport:null,inUseNotificationManager:null,_currentUser:null,commands:null,mainButtonCommand:null,lastExecutedCommand:null,mainButtonSectionVisible:null,lastChangeStatus:null,topInfoSectionVisible:null,publishInfoSectionVisible:null,lastPublishedText:null,lastPublishedViewLinkVisible:null,lastPublishedViewLinkHref:null,additionalInfoSectionVisible:null,additionalInfoText:null,isOpen:null,typeIdentifier:null,postscript:function(){this.inherited(arguments);this.res=this.res||res;this.projectService=this.projectService||_c06.resolve("epi.cms.ProjectService");this.approvalService=this.approvalService||_c06.resolve("epi.cms.ApprovalService");this.contentActionSupport=this.contentActionSupport||_c08;this.initializeCommandProviders();},_setDataModelAttr:function(_c0c){this.updateCommandModel(_c0c);this.inherited(arguments);},_setIsOpenAttr:function(_c0d){if(_c0d){var _c0e=this.dataModel.contentData;this._setLastChangeStatus(_c0e);if(_c0e.status===_c08.versionStatus.AwaitingApproval){this._setApprovalInfo(_c0e);}}},onDataModelChange:function(name,_c0f,_c10){var _c11=this.dataModel.contentData,_c12=(_c11.publishedBy!==null&&_c11.publishedBy!==undefined);this._updateCommands();this.set("typeIdentifier",_c11.typeIdentifier);this._setAdditionalInfo(_c11);if(_c11.status===_c08.versionStatus.AwaitingApproval){this._setApprovalInfo(_c11);return;}this._setLastChangeStatus(this.dataModel.contentData);this.set("topInfoSectionVisible",this._getTopInfoSectionVisible(_c11));this.set("publishInfoSectionVisible",this._getPublishInfoSectionVisible(_c11));this.set("lastPublishedTitle",this._getLastPublishedTitle(_c11));this.set("lastPublishedTitleVisible",_c12);this.set("lastPublishedText",this._getLastPublishedText(_c11));this.set("lastPublishedViewLinkVisible",this._getLastPublishedViewLinkVisible(_c11,_c12));this.set("lastPublishedViewLinkHref",_c11.publicUrl);},onCommandsChanged:function(name,_c13,_c14){_c14.forEach(function(_c15){if(_c15.options&&_c15.options.isMain){this.own(_c15.watch("canExecute",function(){this._calculateMainButtonCommand();}.bind(this)));}},this);},_setApprovalInfo:function(_c16){return this.approvalService.getApproval(_c16.contentLink).then(lang.hitch(this,function(_c17){if(_c17){var _c18=lang.replace(res.approvalinfo.timepassed,{timepassed:_c05.timePassed(new Date(_c17.startDate))});var _c19=lang.replace(res.approvalinfo.stepinfo,{activeStepIndex:_c17.activeStepIndex+1,totalsteps:_c17.totalSteps});var _c1a=_c18+" <br /> "+_c19;this.set("topInfoSectionVisible",true);this.set("lastChangeStatus",_c1a);var _c1b=lang.replace(res.approvalinfo.requestedby,{username:this._getFriendlyUsername(_c17.startedBy,true),time:_c05.toUserFriendlyHtml(_c17.startDate)});this.set("publishInfoSectionVisible",true);this.set("lastPublishedText",_c1b);this.set("lastPublishedTitleVisible",false);this.set("lastPublishedViewLinkVisible",false);return _c17;}return null;}));},_lastChangeStatusSetter:function(_c1c){this.lastChangeStatus=_c1c;return when(_c1c);},_updateCommands:function(){this._calculateMainButtonCommand();this.set("commands",this.getCommands());},_calculateMainButtonCommand:function(){var _c1d=this.getCommands(),_c1e=null;_c1d.forEach(function(_c1f){if(_c1f.canExecute&&_c1f.options&&_c1f.options.isMain&&_c1f.options.priority&&(!_c1e||_c1e.options.priority<_c1f.options.priority)){_c1e=_c1f;}});this.set("mainButtonCommand",_c1e);this.set("mainButtonSectionVisible",_c1e!==null);},_getTopInfoSectionVisible:function(_c20){return this.mainButtonCommand||!((_c20.status===_c08.versionStatus.Published||_c20.status===_c08.versionStatus.Expired)&&!_c20.isCommonDraft);},_getPublishInfoSectionVisible:function(_c21){var _c22=this.inUseNotificationManager.hasInUseNotificationWarning(_c21.inUseNotifications),_c23=this._isOriginallyEditable();return !(_c22&&_c23);},_getLastPublishedViewLinkVisible:function(_c24,_c25){return _c25&&!!_c24.publicUrl;},_setLastChangeStatus:function(_c26){if(_c26.status===_c08.versionStatus.AwaitingApproval){return;}var _c27,_c28,self=this;_c28=_c27=this._getTemplatedText(this.res.lastchangestatus,_c26.changedBy,_c26.saved);if(this.lastExecutedCommand&&this.lastExecutedCommand.options&&this.lastExecutedCommand.options.successStatus){var _c29=this.lastExecutedCommand.options.successStatus;this.lastExecutedCommand=this.mainButtonCommand;_c28=_c29;}if(_c26.missingLanguageBranch&&_c26.missingLanguageBranch.isTranslationNeeded){_c28=lang.replace(this.res.nottranslated,{languageName:epi.resources.language[_c26.missingLanguageBranch.languageId],languageId:_c26.missingLanguageBranch.languageId});}if(_c26.status===_c08.versionStatus.Published||_c26.status===_c08.versionStatus.Expired){_c28=this.res.notmodifiedsincelastpublish;}if(_c26.status===_c08.versionStatus.PreviouslyPublished){_c28=this._getTemplatedText(this.res.previouslypublished,_c26.versionCreatedBy,_c26.versionCreatedTime);}if(_c26.status===_c08.versionStatus.Rejected){_c28=this._getTemplatedText(this.res.rejectedapproval,_c26.versionCreatedBy,_c26.versionCreatedTime);}if(_c26.status===_c08.versionStatus.DelayedPublish){_c28=this.projectService.getProjectsForContent(_c26.contentLink).then(function(_c2a){_c2a=_c2a.filter(function(_c2b){return _c2b.status==="delayedpublished";});if(_c2a.length){return lang.replace(self.res.projectdelayedpublish,{date:_c05.toUserFriendlyHtml(_c26.properties.iversionable_startpublish),project:_c04.encode(_c2a[0].name)});}return _c27;});}when(_c28,lang.hitch(this,"set","lastChangeStatus"));},_getLastPublishedTitle:function(_c2c){return _c2c.status===_c08.versionStatus.PreviouslyPublished?this.res.currentlypublished:this.res.lastpublishedby;},_getLastPublishedText:function(_c2d){return (_c2d.publishedBy===null||_c2d.publishedBy===undefined)?this.res.notpublishedbefore:this._getTemplatedText(this.res.publishedtime,_c2d.publishedBy,_c2d.lastPublished,true);},_setAdditionalInfo:function(_c2e){var _c2f=this.inUseNotificationManager.hasInUseNotificationWarning(_c2e.inUseNotifications),_c30=this._isOriginallyEditable(),_c31=_c2f&&_c30;this.set("additionalInfoSectionVisible",_c31);if(_c31){var _c32=this.inUseNotificationManager.getOtherUsersInUseNotifications(_c2e.inUseNotifications);this.set("additionalInfoText",this._getTemplatedText(this.res.inusewarning,_c32.join(",")));}},_isOriginallyEditable:function(){var _c33=this.inUseNotificationManager.ignoreOthersNotifications;this.inUseNotificationManager.ignoreOthersNotifications=true;var _c34=this.dataModel.canChangeContent();this.inUseNotificationManager.ignoreOthersNotifications=_c33;return _c34;},_getFriendlyUsername:function(name,_c35){return _c07.toUserFriendlyHtml(name,null,_c35);},_getTemplatedText:function(_c36,_c37,_c38,_c39){var date=new Date(_c38);return lang.replace(_c36,{username:this._getFriendlyUsername(_c37,_c39),time:_c05.toUserFriendlyHtml(date),timepassed:_c05.timePassed(date)});}});});},"epi/shell/command/_GlobalCommandProviderMixin":function(){define("epi/shell/command/_GlobalCommandProviderMixin",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/shell/command/_CommandProviderMixin","epi/dependency"],function(_c3a,_c3b,lang,_c3c,_c3d){return _c3b([_c3c],{commandKey:null,commandProviders:null,_consumer:null,_currentCommandModel:null,_providerWatch:null,_initialized:false,initializeCommandProviders:function(){if(this.initialized||!this.commandKey||!this.getConsumer){return;}this._consumer=this.getConsumer();if(!this._consumer){return;}this.commandRegistry=this.commandRegistry||_c3d.resolve("epi.globalcommandregistry");this.commandProviders=this.commandRegistry.get(this.commandKey,true);_c3a.forEach(this.commandProviders.providers,function(_c3e){this._consumer.addProvider(_c3e);},this);this._providerWatch=this.commandProviders.watch("providers",lang.hitch(this,this.onProvidersChanged));this.initialized=true;},updateCommandModel:function(_c3f){this._currentCommandModel=_c3f;_c3a.forEach(this.commandProviders.providers,function(_c40){if(_c40.updateCommandModel){_c40.updateCommandModel(_c3f);}},this);},onProvidersChanged:function(name,_c41,_c42){if(_c41){_c3a.forEach(_c41,this._consumer.removeProvider,this._consumer);}if(_c42){_c3a.forEach(_c42,function(item){this._consumer.addProvider(item);if(item.updateCommandModel){item.updateCommandModel(this._currentCommandModel);}},this);}},destroy:function(){if(this._consumer&&this.commandProviders){_c3a.forEach(this.commandProviders.providers,this._consumer.removeProvider,this);}this._providerWatch&&this._providerWatch.unwatch();this.inherited(arguments);}});});},"epi-cms/contentediting/StandardToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dijit/form/DropDownButton","epi/shell/layout/ToolbarContainer","epi/shell/widget/ToolbarLabel","epi/shell/widget/ToolbarSet","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","epi-cms/widget/ViewSelectorDropDownButton"],function(_c43,lang,all,when,_c44,_c45,_c46,_c47,_c48,_c49,_c4a){return _c43([_c47],{currentContext:null,availableViews:null,viewName:null,_setupPromise:null,constructor:function(){this.viewConfigurations={};},buildRendering:function(){this.inherited(arguments);when(this._setupPromise=this.setupChildren(),lang.hitch(this,function(){this.updateChildren();}));},isSetup:function(){return this._setupPromise;},setupChildren:function(_c4b,_c4c){var _c4d=[{name:"leading",type:"toolbargroup",settings:{region:"leading"}},{name:"center",type:"toolbargroup",settings:{region:"center"}},{name:"trailing",type:"toolbargroup",settings:{region:"trailing"}}];var _c4e=[{parent:"leading",name:"breadcrumbs",widgetType:"epi-cms/widget/Breadcrumb",settings:{displayAsText:false,showCurrentNode:false}},{parent:"trailing",name:"viewselect",widgetType:"epi-cms/widget/ViewSelectorDropDownButton",settings:{showLabel:false,"class":"epi-mediumButton epi-trailingContainer"}},{parent:"leading",name:"currentcontent",widgetType:"epi-cms/widget/BreadcrumbCurrentItem"}];_c4d=_c4b?_c4b.concat(_c4d):_c4d;_c4e=_c4c?_c4c.concat(_c4e):_c4e;return this.add(_c4d).then(lang.hitch(this,function(){return this.add(_c4e);}));},updateChildren:function(){var _c4f=this.currentContext,_c50=_c4f&&_c4f.id;this.setItemProperty("breadcrumbs","contentLink",_c50);this.setItemProperty("viewselect","viewConfigurations",this.viewConfigurations);if(_c4f){this.setItemProperty("currentcontent","currentItemInfo",{name:_c4f.name,dataType:_c4f.dataType});}},update:function(data){if(!data){return;}this.currentContext=data.currentContext;this.viewConfigurations=data.viewConfigurations;when(this.isSetup(),lang.hitch(this,this.updateChildren));}});});},"epi-cms/widget/BreadcrumbCurrentItem":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/Evented","dojo/topic","dojo/dom-construct","dijit/_TemplatedMixin","dijit/_WidgetBase","epi/string","epi/shell/TypeDescriptorManager","dojo/text!./templates/BreadcrumbCurrentItem.html"],function(_c51,_c52,_c53,_c54,_c55,_c56,_c57,_c58,_c59,_c5a){return _c51([_c57,_c56],{templateString:_c5a,_currentIconClass:null,_setCurrentItemInfoAttr:function(_c5b){if(!_c5b){return;}this.heading.innerHTML=_c58.encodeForWebString(_c5b.name);if(_c5b.dataType){var _c5c=_c59.getValue(_c5b.dataType,"iconClass");if(_c5c&&_c5c!==this._currentIconClass){_c52.remove(this.iconNode,this._currentIconClass);_c52.add(this.iconNode,_c5c);this._currentIconClass=_c5c;}}}});});},"url:epi-cms/widget/templates/BreadcrumbCurrentItem.html":"<div>\n    <div class=\"epi-breadCrumbs-title-wrapper\"><span data-dojo-attach-point=\"iconNode\" class=\"dijitInline dijitIcon epi-breadCrumbsCurrentItem-icon\"></span><h1 data-dojo-attach-point=\"heading\" class=\"epi-breadcrumbContentItem dojoxEllipsis\"></h1></div>\n</div>","epi-cms/widget/ViewSelectorDropDownButton":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/form/DropDownButton","epi-cms/widget/ViewSelector","epi/i18n!epi/cms/nls/episerver.cms.widget.viewselector"],function(_c5d,_c5e,lang,_c5f,_c60,_c61){return _c5e([_c5f],{buildRendering:function(){this.inherited(arguments);this.set("title",_c61.title);this.own(this.dropDown=new _c60());},_setViewConfigurationsAttr:function(_c62){if(!_c62){return;}_c5d.some(_c62.availableViews,lang.hitch(this,function(view){if(view.key===_c62.viewName){this.set("iconClass",view.iconClass);return true;}}));this.dropDown.set("viewConfigurations",_c62);}});});},"epi-cms/widget/ViewSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","dijit/MenuSeparator","epi/i18n!epi/cms/nls/episerver.cms.widget.viewselector","epi-cms/widget/SelectorMenuBase","epi/shell/widget/CheckedMenuItem"],function(_c63,_c64,lang,_c65,when,_c66,_c67,_c68,_c69){return _c64([_c68],{viewConfigurations:null,headingText:_c67.title,_setViewConfigurationsAttr:function(_c6a){this._set("viewConfigurations",_c6a);this._setup();},onExecute:function(){},onCancel:function(){},_setup:function(){if(!this.viewConfigurations){return;}_c63.forEach(this.getChildren(),lang.hitch(this,this.removeChild));var _c6b=this.viewConfigurations.viewName,_c6c=this.viewConfigurations.availableViews;var _c6d="";_c63.forEach(_c6c,function(view){if(view.hideFromViewMenu){return;}var _c6e=view.category||"";if(_c6e!==_c6d){this.addChild(new _c66({baseClass:"epi-menuSeparator"}));}_c6d=_c6e;var item=new _c69({label:view.name,title:view.description,iconClass:view.iconClass,checked:view.key===_c6b,onClick:lang.hitch(this,function(){this.onExecute();item.set("checked",!item.checked);if(_c6b==="view"){_c65.publish("/epi/cms/action/disablepreview");}_c65.publish("/epi/shell/action/changeview",view.key,null,null);})});this.addChild(item);},this);}});});},"epi-cms/widget/SelectorMenuBase":function(){define(["dojo/_base/declare","dojo/keys","dijit/_MenuBase","dojo/text!./templates/SelectorMenuBase.html"],function(_c6f,keys,_c70,_c71){return _c6f([_c70],{templateString:_c71,headingText:null,postCreate:function(){this.inherited(arguments);this.connectKeyNavHandlers([keys.UP_ARROW],[keys.DOWN_ARROW]);}});});},"url:epi-cms/widget/templates/SelectorMenuBase.html":"<div class=\"epi-menu--inverted\">\n    <div class=\"epi-dijitTooltipContainer\">\n        <div class=\"epi-invertedTooltip\">\n            <div class=\"epi-tooltipDialogTop\">\n                <span>${headingText}</span>\n                <div class=\"dijitTooltipConnector\"></div>\n            </div>\n        </div>\n        <div class=\"epi-tooltipDialogContent--max-height\">\n            <table class=\"dijitReset dijitMenu epi-tooltipDialogMenu epi-menuInverted epi-mediumMenuItem\" style=\"width: 100%\" cellspacing=\"0\">\n\t            <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\n            </table>\n        </div>\n    </div>\n</div>\n","epi/shell/widget/CheckedMenuItem":function(){require({cache:{"url:epi/shell/widget/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\"/>\n\t\t<img src=\"${_blankGif}\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>\n"}});define("epi/shell/widget/CheckedMenuItem",["dojo/_base/declare","dijit/CheckedMenuItem","dojo/text!./templates/CheckedMenuItem.html"],function(_c72,_c73,_c74){return _c72(_c73,{templateString:_c74});});},"url:epi/shell/widget/templates/CheckedMenuItem.html":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemcheckbox\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\"/>\n\t\t<img src=\"${_blankGif}\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\" data-dojo-attach-point=\"containerNode,labelNode\"></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>\n","epi-cms/widget/NotificationStatusBar":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-class","dojo/keys","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/BorderContainer","dojox/html/entities","epi/dependency","epi-cms/widget/NotificationStatusZone","epi-cms/widget/TooltipDialog","dojo/text!./templates/NotificationStatusBar.html","epi/i18n!epi/cms/nls/episerver.cms.widget.statusbar.notificationstatus"],function(_c75,_c76,_c77,lang,_c78,keys,_c79,_c7a,_c7b,_c7c,_c7d,_c7e,_c7f,_c80,_c81,_c82){return _c76([_c79,_c7a,_c7b],{res:_c82,templateString:_c81,_itemTemplate:"<li>{message}</li>",_notificationTooltipDialogCssClass:"epi-notificationToolipDialog epi-notificationToolipDialogCompact",_dimmedOutCssClass:"epi-notificationIcon-DimmedOut",_notificationErrorClass:"epi-notificationIcon-Error",_notificationWarningClass:"epi-notificationIcon-Warning",_notificationNoteClass:"epi-notificationIcon-Note",_totalNotifications:0,messageContext:null,_tooltipDialog:null,messageService:null,_observeHandle:null,zoneContainer:null,notificationContext:null,baseClass:"epi-notificationIcon",postMixInProperties:function(){this.inherited(arguments);this.messageService=this.messageService||_c7e.resolve("epi.shell.MessageService");},postCreate:function(){this.inherited(arguments);this._tooltipDialog=new _c80({connectorMargin:47,hideOnBlur:true,content:this.zoneLayoutNode});this._buildIconBlock();_c78.add(this._tooltipDialog.domNode,this._notificationTooltipDialogCssClass);this.connect(this.domNode,"onclick",lang.hitch(this,this._show));this.connect(this.domNode,"onkeypress",lang.hitch(this,this._onKeyPress));this.connect(this.closeIcon,"onclick",lang.hitch(this,this._hideTooltip));},update:function(_c83){this._hideTooltip();this.messageContext=_c83;this._listenMessagePool();this._updateUI();},destroy:function(){this._unListenMessagePool();this.inherited(arguments);},focus:function(){this.domNode.focus();},show:function(){this._keepShowing=true;this._showTooltip();},getMessages:function(_c84){var _c85=(_c84)?lang.mixin({typeName:_c84},this.messageContext):this.messageContext;return this.messageService.query(_c85);},_onKeyPress:function(evt){if(evt.keyCode===keys.ENTER){this._show();}},_listenMessagePool:function(){this._unListenMessagePool();this._observeHandle=this.messageService.observe(this.messageContext,lang.hitch(this,function(){this._updateUI();}));},_unListenMessagePool:function(){if(this._observeHandle){this._observeHandle.cancel();delete this._observeHandle;}},_updateNotificationZone:function(zone,_c86,_c87){if(_c87&&_c87.length>0){_c75.forEach(_c87,function(item){zone.addRow(lang.replace(_c86,{message:_c7d.encode(item.message)}),"last");});zone.show();}else{zone.hide();}},_updateUI:function(){this.errorZone.empty();this.warningZone.empty();this.infoZone.empty();var _c88=this.getMessages("error");var _c89=this.getMessages("warn");var _c8a=this.getMessages("info");this._totalNotifications=_c88.length+_c89.length+_c8a.length;this._buildIconBlock();this._updateNotificationZone(this.errorZone,this._itemTemplate,_c88);this._updateNotificationZone(this.warningZone,this._itemTemplate,_c89);this._updateNotificationZone(this.infoZone,this._itemTemplate,_c8a);this._updateIconStatus(_c88.length,_c89.length,_c8a.length);},_buildIconBlock:function(){this.domNode.innerHTML=this._totalNotifications;if(this._totalNotifications===0){_c78.add(this.domNode,this._dimmedOutCssClass);_c78.remove(this.domNode,this._notificationNoteClass);_c78.remove(this.domNode,this._notificationWarningClass);_c78.remove(this.domNode,this._notificationErrorClass);this._hideTooltip();}else{_c78.remove(this.domNode,this._dimmedOutCssClass);}},_updateIconStatus:function(_c8b,_c8c,_c8d){if(_c8b){_c78.add(this.domNode,this._notificationErrorClass);_c78.remove(this.domNode,this._notificationNoteClass);_c78.remove(this.domNode,this._notificationWarningClass);}else{if(_c8c){_c78.add(this.domNode,this._notificationWarningClass);_c78.remove(this.domNode,this._notificationNoteClass);}else{if(_c8d){_c78.add(this.domNode,this._notificationNoteClass);}}}},_setNotificationContextAttr:function(_c8e){this._set("notificationContext",_c8e);this.update(_c8e);},_show:function(e){if(e){_c77.stop(e);}this._showTooltip();},_showTooltip:function(){if(this._totalNotifications===0){return;}this._tooltipDialog.showTooltipDialog(this.domNode,["below-alt"]);},_hideTooltip:function(){this._tooltipDialog.hideTooltipDialog();}});});},"epi-cms/widget/NotificationStatusZone":function(){define(["dojo","dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin"],function(dojo,_c8f,_c90,_c91){return _c8f([_c90,_c91],{templateString:"            <div>                <div class=\"epi-dijitTooltipNotificationBlock epi-dijitTooltipBlock${TypeName}\" data-dojo-attach-point=\"Zone\">                    <span class=\"epi-notificationTypeTitle\"><span class=\"dijitIcon dijitInline epi-dijitTooltip${TypeName}Icon\"></span>${title}</span>                    <ul data-dojo-attach-point=\"contentContainer\"></ul>                </div>            </div>",title:"",type:"",TypeName:"",_hiddenCssClass:"epi-dijitTooltipBlockHidden",postMixInProperties:function(){this.TypeName=this.type.charAt(0).toUpperCase()+this.type.slice(1);},empty:function(){dojo.empty(this.contentContainer);},addRow:function(_c92,_c93){dojo.place(_c92,this.contentContainer,_c93);},show:function(){dojo.removeClass(this.Zone,this._hiddenCssClass);},hide:function(){dojo.addClass(this.Zone,this._hiddenCssClass);}});});},"epi-cms/widget/TooltipDialog":function(){define(["dojo","dojo/number","dijit","dijit/TooltipDialog","dijit/_Widget","dijit/_TemplatedMixin","dojo/text!./templates/TooltipDialog.html"],function(dojo,_c94,_c95,_c96,_c97,_c98,_c99){return dojo.declare([_c96],{templateString:_c99,connectorMargin:25,_defaultConnectorMargin:25,hideOnBlur:false,_isFirstShow:false,_beforeCssClass:"epi-dijitTooltipBefore",_afterCssClass:"epi-dijitTooltipAfter",_pos:0,_defaultConnectorRight:0,_defaultConnectorLeft:0,_wrapperPosX:0,_availableSpace:0,_right:0,_left:0,onBlur:function(){this.inherited(arguments);if(this.hideOnBlur){this.hideTooltipDialog();}},postCreate:function(){this.inherited(arguments);if(!this.connectorMargin||!_c94.parse(this.connectorMargin)||this.connectorMargin===""||this.connectorMargin<this._defaultConnectorMargin){this.connectorMargin=this._defaultConnectorMargin;}},showTooltipDialog:function(_c9a,_c9b){_c95.popup.open({popup:this,around:_c9a,orient:_c9b});if(this.hideOnBlur){this.focus();}},hideTooltipDialog:function(){_c95.popup.close(this);},onOpen:function(pos){this._pos=pos;this.inherited(arguments);},_onShow:function(){this._setDefaultValues();this._updatePositions();this.inherited(arguments);},_setDefaultValues:function(){if(!this._isFirstShow){this._defaultConnectorRight=this._getConnectorSpace("right")||this._defaultConnectorMargin;this._defaultConnectorLeft=this._getConnectorSpace("left")||this._defaultConnectorMargin;this._isFirstShow=true;}this._wrapperPosX=_c94.parse(this._pos.x);this._availableSpace=dojo.body().clientWidth;if(this._pos.aroundCorner==="MR"||this._pos.aroundCorner==="ML"){var _c9c=_c94.round((this._pos.h-this.connectorNode.clientHeight)/2);dojo.style(this.connectorNode,"top",this._getNumberInPx(_c9c));}},_updatePositions:function(){switch(this._pos.aroundCorner){case "TR":case "BR":this._calculateConnectorMarginRight();this._calculateAvailableSpaceLeft();this._updateAlignedRightPositions();break;case "TL":case "BL":this._calculateConnectorMarginLeft();this._calculateAvailableSpaceRight();this._updateAlignedLeftPositions();break;case "MR":dojo.addClass(this.domNode,this._afterCssClass);break;case "ML":dojo.addClass(this.domNode,this._beforeCssClass);break;default:break;}},_updateAlignedRightPositions:function(){if(this._availableSpace>=this.connectorMargin){dojo.style(this.connectorNode,"right",this._getNumberInPx(this.connectorMargin));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX+(this.connectorMargin-this._right)));}else{dojo.style(this.connectorNode,"right",this._getNumberInPx(this._defaultConnectorRight));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX-(this._right-this._defaultConnectorRight)));}},_updateAlignedLeftPositions:function(){if(this._availableSpace>=this.connectorMargin){dojo.style(this.connectorNode,"left",this._getNumberInPx(this.connectorMargin));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX+(this.connectorMargin-this._left)));}else{dojo.style(this.connectorNode,"left",this._getNumberInPx(this._defaultConnectorLeft));dojo.style(this._popupWrapper,"left",this._getNumberInPx(this._wrapperPosX-(this._left-this._defaultConnectorLeft)));}},_calculateAvailableSpaceRight:function(){this._wrapperPosX-=this._left+this._getCenterHorizontalAroundNode();this._availableSpace-=(this._wrapperPosX+this._pos.w);},_calculateAvailableSpaceLeft:function(){this._wrapperPosX+=this._right+this._getCenterHorizontalAroundNode();this._availableSpace-=(this._wrapperPosX+this._pos.w);},_calculateConnectorMarginRight:function(){this._right=this._getConnectorSpace("right");if(this._right<this.connectorMargin){this._right=this.connectorMargin;}},_calculateConnectorMarginLeft:function(){this._left=this._getConnectorSpace("left");if(this._left<this.connectorMargin){this._left=this.connectorMargin;}},_getConnectorSpace:function(_c9d){if(!_c9d){return 0;}if(_c9d==="right"||_c9d==="left"){var _c9e=dojo.style(this.connectorNode,_c9d);if(!_c9e){return 0;}var _c9f=/(px|em|%)/ig;return _c94.parse(_c9e)||_c94.parse(_c9e.replace(_c9f,""));}return 0;},_getNumberInPx:function(_ca0){return _ca0+"px";},_getCenterHorizontalAroundNode:function(){return _c94.round((_c94.parse(this.connectorNode.clientWidth)-_c94.parse(this._pos.aroundNodePos.w))/2);}});});},"url:epi-cms/widget/templates/TooltipDialog.html":"<div class=\"epi-dijitTooltipDialog\" role=\"presentation\" tabindex=\"-1\">\n    <div class=\"dijitTooltipContainer epi-dijitTooltipContainer\" role=\"presentation\">\n        <div class=\"dijitTooltipContents dijitTooltipFocusNode epi-dijitTooltipContents\" data-dojo-attach-point=\"containerNode\" role=\"dialog\"></div>\n    </div>\n    <div class=\"dijitTooltipConnector epi-dijitTooltipConnector\" data-dojo-attach-point=\"connectorNode\" role=\"presentation\"></div>\n</div>","url:epi-cms/widget/templates/NotificationStatusBar.html":"<div>\n    <div class=\"epi-dijitTooltipTitleBar\">\n        <span class=\"epi-dijitTooltipTitle\">${res.title}</span>\n        <span class=\"epi-closeButton dijitDialogCloseIcon\" data-dojo-attach-point=\"closeIcon\" title=\"${res.title}\" role=\"button\"></span>\n    </div>\n    <div class=\"epi-dijitTooltipContent\" data-dojo-attach-point=\"zoneLayoutNode\">\n        <div data-dojo-attach-point=\"zoneContainer\">\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"errorZone\" data-dojo-props=\"title: '${res.errortitle}', type: 'error'\"></div>\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"warningZone\" data-dojo-props=\"title: '${res.warningtitle}', type: 'warning'\"></div>\n            <div data-dojo-type=\"epi-cms/widget/NotificationStatusZone\" data-dojo-attach-point=\"infoZone\"  data-dojo-props=\"title: '${res.notetitle}', type: 'note'\"></div>\n        </div>\n    </div>\n</div>\n","epi-cms/contentediting/EditActionPanel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/dom-attr","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/DropDownButton","epi","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/PublishMenu","epi/shell/widget/_ModelBindingMixin","epi/string","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel","dojo/text!./templates/EditActionPanel.html"],function(_ca1,lang,_ca2,_ca3,_ca4,_ca5,_ca6,_ca7,_ca8,_ca9,epi,_caa,_cab,_cac,_cad,res,_cae){return _ca1([_ca7,_ca6,_ca8,_ca5,_cac],{templateString:_cae,commonRes:epi.resources,baseClass:"epi-statusIndicator",modelBindingMap:{state:["state"],statusText:["statusText"],visible:["visible"],buttonText:["buttonText"],nonEditableIndicator:["nonEditableIndicator"],statusIcon:["statusIcon"],publishMenuViewModel:["publishMenuViewModel"],additionalClass:["additionalClass"],expanded:["expanded"]},_setStatusTextAttr:function(_caf){this._set("statusText",_caf);this._setStatusNodeText(_caf);},_setStatusNodeText:function(_cb0){this.statusTextNode.innerHTML=_cb0;_ca4.set(this.stateNode,"title",!this.expanded?_cad.stripHtmlTags(_cb0):"");},_setButtonTextAttr:function(val){this.dropDownButton.set("label",val);},_setVisibleAttr:function(val){_ca2.set(this.domNode,"visibility",val?"visible":"hidden");},_setExpandedAttr:function(_cb1){this._set("expanded",_cb1);this._setStatusNodeText(this.statusText);},_setNonEditableIndicatorAttr:function(val){if(val){_ca3.add(this.statusNonEditableIcon,"epi-iconPenDisabled");}else{_ca3.remove(this.statusNonEditableIcon,"epi-iconPenDisabled");}},_setStatusIconAttr:function(val){if(this.get("statusIcon")){_ca3.remove(this.statusTextIcon,this.get("statusIcon"));}this._set("statusIcon",val);_ca3.add(this.statusTextIcon,val);},_setAdditionalClassAttr:function(val){var _cb2=this.get("additionalClass");if(_cb2){_ca3.remove(this.stateNode,_cb2);}this._set("additionalClass",val);_ca3.add(this.stateNode,val);},focus:function(){this.dropDownButton.focus();},_setPublishMenuViewModelAttr:function(val){this.dropDownMenu.set("model",val);},postCreate:function(){this.inherited(arguments);this.dropDownButton.dropDownPosition=["below-alt"];}});});},"epi-cms/contentediting/PublishMenu":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/html","dojo/on","dojo/sniff","dojo/Stateful","dojo/when","dijit/DropDownMenu","dijit/_KeyNavContainer","dijit/_WidgetsInTemplateMixin","epi","epi/shell/TypeDescriptorManager","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/Downloader","epi-cms/contentediting/ContentActionSupport","dojo/text!./templates/PublishMenu.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu"],function(_cb3,_cb4,_cb5,lang,_cb6,_cb7,_cb8,_cb9,html,on,_cba,_cbb,when,_cbc,_cbd,_cbe,epi,_cbf,_cc0,_cc1,_cc2,_cc3,_cc4,res){return _cb4([_cbc,_cbe,_cc0],{templateString:_cc4,res:res,_menuBuilder:null,commands:null,mainButtonCommand:null,postMixInProperties:function(){this._menuBuilder=new _cc1();},modelBindingMap:{commands:["commands"],mainButtonCommand:["mainButtonCommand"],mainButtonSectionVisible:["mainButtonSectionVisible"],lastChangeStatus:["lastChangeStatus"],topInfoSectionVisible:["topInfoSectionVisible"],publishInfoSectionVisible:["publishInfoSectionVisible"],lastPublishedTitle:["lastPublishedTitle"],lastPublishedTitleVisible:["lastPublishedTitleVisible"],lastPublishedText:["lastPublishedText"],lastPublishedViewLinkVisible:["lastPublishedViewLinkVisible"],lastPublishedViewLinkHref:["lastPublishedViewLinkHref"],additionalInfoSectionVisible:["additionalInfoSectionVisible"],additionalInfoText:["additionalInfoText"],typeIdentifier:["typeIdentifier"]},_setCommandsAttr:function(_cc5){this.focusedChild=null;this.destroyDescendants();this._addCommandsToMenu(_cc5);this.focusFirstChild();},_setMainButtonCommandAttr:function(_cc6){this._set("mainButtonCommand",_cc6);if(_cc6){this.mainButton.set("label",_cc6.label);this.mainButton.set("disabled",!_cc6.get("canExecute"));_cb8.remove(this.mainButton.domNode,"epi-loading");if(this._addedMainButtonClass){_cb8.remove(this.mainButton.domNode,this._addedMainButtonClass);}if(_cc6.options&&_cc6.options.mainButtonClass){this._addedMainButtonClass=_cc6.options.mainButtonClass;_cb8.add(this.mainButton.domNode,this._addedMainButtonClass);}}},_setMainButtonSectionVisibleAttr:function(_cc7){_cb6.set(this.mainButtonSection,"display",_cc7?"":"none");_cb6.set(this.mainButton.domNode,"display",_cc7?"":"none");},_setLastChangeStatusAttr:{node:"lastChangeStatusNode",type:"innerHTML"},_setTopInfoSectionVisibleAttr:function(_cc8){_cb6.set(this.topInfoSection,"display",_cc8?"":"none");},_setPublishInfoSectionVisibleAttr:function(_cc9){_cb6.set(this.publishInfoSection,"display",_cc9?"":"none");},_setLastPublishedTitleAttr:{node:"lastPublishedTitleNode",type:"innerHTML"},_setLastPublishedTitleVisibleAttr:function(_cca){_cb6.set(this.lastPublishedTitleNode,"display",_cca?"":"none");},_setLastPublishedTextAttr:{node:"lastPublishedTextNode",type:"innerHTML"},_setLastPublishedViewLinkVisibleAttr:function(_ccb){_cb6.set(this.lastPublishedViewLinkNode,"display",_ccb?"":"none");},_setLastPublishedViewLinkHrefAttr:function(_ccc){_cb7.set(this.lastPublishedViewLinkNode,"href",_ccc);},_setAdditionalInfoSectionVisibleAttr:function(_ccd){_cb6.set(this.additionalInfoSection,"display",_ccd?"":"none");},_setAdditionalInfoTextAttr:{node:"additionalInfoNode",type:"innerHTML"},_setTypeIdentifierAttr:function(_cce){var _ccf=this.model&&this.model.dataModel&&this.model.dataModel.contentData,_cd0=_ccf&&_ccf.downloadUrl,_cd1=_cce&&_cbf.getValue(_cce,"actAsAnAsset");if(!_cd1||!_cd0){_cb7.set(this.lastPublishedViewLinkNode,"title",res.lastpublishedviewlinktooltip);html.set(this.lastPublishedViewLinkNode,res.view);if(this._downloadClickHandler){this._downloadClickHandler.remove();this._downloadClickHandler=null;}return;}_cb7.set(this.lastPublishedViewLinkNode,"title",res.download);html.set(this.lastPublishedViewLinkNode,res.download);if(!this._downloadClickHandler){this.own(this._downloadClickHandler=on(this.lastPublishedViewLinkNode,"click",lang.hitch(this,function(e){_cb5.stop(e);var _cd2=this.model&&this.model.dataModel&&this.model.dataModel.contentData,url=_cd2&&_cd2.downloadUrl,name=_cd2.name;_cc2.download(url,name);})));}},postCreate:function(){this.inherited(arguments);this.mainButton._setSelected=this.mainButton._onUnhover=function(){};},onOpen:function(){this.model.set("isOpen",true);this.inherited(arguments);},onClose:function(){this.model.set("isOpen",false);this.inherited(arguments);},_setModelAttr:function(){this.inherited(arguments);this.ownByKey(this.model,this.connect(this.model,"onCommandsChanged","onCommandsChanged"));},onCommandsChanged:function(name,_cd3,_cd4){if(_cd3){this._removeCommandsFromMenu(lang.isArray(_cd3)?_cd3:[_cd3]);}if(_cd4){this._addCommandsToMenu(lang.isArray(_cd4)?_cd4:[_cd4]);}},_addCommandsToMenu:function(_cd5){_cb3.forEach(_cd5,function(_cd6){if(_cd6!==this.model.mainButtonCommand){this._menuBuilder.create(_cd6,this);}},this);},_removeCommandsFromMenu:function(_cd7){var _cd8=this.getChildren();_cb3.forEach(_cd7,function(_cd9){for(var i=_cd8.length-1;i>=0;i--){var item=_cd8[i];if(item._command===_cd9){this.removeChild(item);break;}}},this);},_onMainButtonClick:function(){if(this.mainButtonCommand){this.mainButton.set("label",this.mainButtonCommand.executingLabel);_cb8.add(this.mainButton.domNode,"epi-loading");var _cda=this.mainButtonCommand,_cdb=lang.hitch(this,function(){if(_cda.options&&_cda.options.resetLabelAfterExecution){this.mainButton.set("label",_cda.label);}_cb8.remove(this.mainButton.domNode,"epi-loading");if(_cda.options&&!_cda.options.keepMenuOpen){this.onExecute();}}),_cdc=lang.hitch(this,function(){this.model.set("lastExecutedCommand",_cda);});when(this.mainButtonCommand.execute(),function(){return when(_cdb(),_cdc);},function(){return _cdb();});}},focusFirstChild:function(){if(this.mainButton.isFocusable()){return this.focusChild(this.mainButton);}else{return this.inherited(arguments);}},focusNext:function(){var _cdd=this._getLastFocusableChild();if(!this.focusedChild.focused){return this.focusChild(this._getFirstFocusableChild());}else{if(this.focusedChild===_cdd){this.focusedChild._setSelected(false);return _cb6.get(this.mainButton.domNode,"display")==="none"?this.lastPublishedViewLinkNode.focus():this.focusChild(this.mainButton);}else{if(this.focusedChild===this.mainButton){return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}}},focusPrev:function(){var _cde=this._getFirstFocusableChild();if(!this.focusedChild.focused){return _cb6.get(this.mainButton.domNode,"display")==="none"?this.focusChild(this._getLastFocusableChild()):this.focusChild(this.mainButton);}else{if(this.focusedChild===_cde){this.focusedChild._setSelected(false);return this.lastPublishedViewLinkNode.focus();}else{return this.inherited(arguments);}}},resize:function(_cdf){var _ce0=_cb9.getMarginBox(this.domNode),_ce1=_cb9.getPadExtents(this.topInfoSection),_ce2=_cb9.getMarginBox(this.mainButton.containerNode),_ce3=_cb9.getMarginBox(this.containerNode);var _ce4=Math.max(_ce2.w+_ce1.l+_ce1.r,_ce0.w);_ce4=Math.max(_ce3.w,_ce4);_cdf.w=_ce4;_cb9.setMarginBox(this.domNode,_cdf);}});});},"epi/shell/Downloader":function(){define("epi/shell/Downloader",["dojo/_base/lang","dojo/dom-construct"],function(lang,_ce5){return {_classicalDownload:function(url,name){var _ce6=document.getElementsByTagName("body")[0],_ce7={href:url,download:name,target:"_blank",style:{display:"none;"}},_ce8=_ce5.create("a",_ce7,_ce6,"last");_ce8.click();_ce5.destroy(_ce8);},download:function(url,name){if(url){return this._classicalDownload(url,name);}}};});},"url:epi-cms/contentediting/templates/PublishMenu.html":"<div class=\"epi-invertedTooltip epi-publishActionMenu\" role=\"menu\" tabIndex=\"${tabIndex}\" data-dojo-attach-event=\"onkeypress:_onKeyPress\" >\n    <div class=\"epi-tooltipDialogTop\" data-dojo-attach-point=\"topInfoSection\">\n        <ul>\n            <li data-dojo-attach-point=\"lastChangeStatusNode\" class=\"epi-lastchangeStatus\"></li>\n            <li data-dojo-attach-point=\"mainButtonSection\">\n                <button data-dojo-type=\"dijit/form/Button\"\n                        data-dojo-attach-point=\"mainButton\"\n                        data-dojo-attach-event=\"onClick: _onMainButtonClick\"\n                        class=\"epi-button--bold epi-button--full-width\"></button>\n            </li>\n        </ul>\n        <div data-dojo-attach-point=\"lastPublishedIcon\" class=\"dijitTooltipConnector\"></div>\n    </div>\n    <div class=\"epi-tooltipDialogInfo\"data-dojo-attach-point=\"publishInfoSection\">\n        <ul>\n            <li data-dojo-attach-point=\"lastPublishedTitleNode\"></li>\n            <li>\n                <span data-dojo-attach-point=\"lastPublishedTextNode\"></span>\n            </li>\n            <li>\n                <a href=\"#\" title=\"${res.lastpublishedviewlinktooltip}\" data-dojo-attach-point=\"lastPublishedViewLinkNode\">${res.view}</a>\n            </li>\n        </ul>\n    </div>\n    <div class=\"epi-tooltipDialogInfo\" data-dojo-attach-point=\"additionalInfoSection\">\n        <ul>\n            <li data-dojo-attach-point=\"additionalInfoNode\"></li>\n        </ul>\n    </div>\n    <table class=\"dijitReset epi-tooltipDialogMenu epi-menuInverted\" cellspacing=\"0\">\n\t    <tbody data-dojo-attach-point=\"containerNode\" ></tbody>\n    </table>\n</div>\n","url:epi-cms/contentediting/templates/EditActionPanel.html":"<div style=\"display: inline-block\">\n    <div class=\"dijitInline dijitReset\" data-dojo-attach-point=\"stateNode\">\n        <span data-dojo-attach-point=\"statusNonEditableIcon\" class=\"dijitInline dijitReset dijitIcon\">&nbsp;</span>\n        <span class=\"epi-statusContainer dijitInline dijitReset\">\n            <span data-dojo-attach-point=\"statusTextIcon\" class=\"dijitInline dijitReset dijitIcon\"></span>\n            <span data-dojo-attach-point=\"statusTextNode\" class=\"epi-statusText\"></span>\n        </span><span class=\"epi-statusArrow dijitInline dijitReset\"></span><!-- These need to be on the same line. -->\n    </div>\n\n\n\n    <div data-dojo-attach-point=\"dropDownButton\" data-dojo-type=\"dijit/form/DropDownButton\"\n        data-dojo-props=\"label: '${commonRes.action.publish}', 'class': 'epi-mediumButton epi-button--bold'\">\n        <div data-dojo-attach-point=\"dropDownMenu\" data-dojo-type=\"epi-cms/contentediting/PublishMenu\"></div>\n    </div>\n</div>\n","epi-cms/contentediting/NotificationBar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/_base/array","dojo/on","dijit/_TemplatedMixin","dijit/_Widget","dijit/_Container","dijit/_WidgetsInTemplateMixin","dojo/Evented","dijit/form/Button","dojox/html/ellipsis","dojo/text!./templates/NotificationBar.html","dojo/text!./templates/NotificationBarItem.html"],function(_ce9,lang,_cea,_ceb,_cec,_ced,on,_cee,_cef,_cf0,_cf1,_cf2,_cf3,_cf4,_cf5,_cf6){var _cf7=_ce9([_cef,_cee,_cf1,_cf2],{templateString:_cf6,item:null,viewModel:null,postCreate:function(){this.inherited(arguments);if(this.item.content){this._addContent(this.item);}this._addCommands(this.item);},_onClose:function(e){e.preventDefault();this.emit("close",this);},_addContent:function(item){if(lang.isString(item.content)){this.textContainer.innerHTML=this.item.content;}else{_cec.place(this.item.content,this.textContainer);}},_addCommands:function(item){if(lang.isArray(this.item.commands)){_ced.forEach(this.item.commands,lang.hitch(this,function(_cf8){this._addButtonForCommand(_cf8);}));}},_addButtonForCommand:function(_cf9){var _cfa=new _cf3({label:_cf9.label,title:_cf9.tooltip,iconClass:_cf9.iconClass});if(_cf9.cssClass){_cea.add(_cfa.domNode,_cf9.cssClass);}_cfa.set("disabled",!_cf9.canExecute);_cfa.on("click",function(){_cf9.execute();});this.own(_cf9.watch("canExecute",lang.hitch(this,function(){_cfa.set("disabled",!_cf9.canExecute);})));if(_cf9.category==="leftAligned"){_cfa.placeAt(this.contentContainer,"first");}else{_cfa.placeAt(this.buttonContainer,"first");}this.own(_cfa);}});var _cfb=_ce9([_cef,_cf0,_cee,_cf1,_cf2],{templateString:_cf5,noBorderClass:"epi-notificationBarWithoutBorder",buildRendering:function(){this.inherited(arguments);this._hideIfEmpty();},clear:function(){this._hideIfEmpty();_ced.forEach(this.getChildren(),function(_cfc){this.removeChild(_cfc);_cfc.destroy();_cfc=null;},this);this.emit("notificationsChanged");},destroy:function(){this.destroyDescendants();this.inherited(arguments);},add:function(_cfd,_cfe){var _cff=new _cf7({item:_cfd});this.own(on(_cff,"close",lang.hitch(this,"_onCloseNotification")));this.addChild(_cff,_cfe);this._hideIfEmpty();this.emit("notificationsChanged");},remove:function(_d00){_ced.forEach(this.getChildren(),lang.hitch(this,function(_d01){if(_d01.item&&_d01.item===_d00){this._onCloseNotification(_d01);}}));this._hideIfEmpty();},_onCloseNotification:function(item){this.removeChild(item);item.destroy();item=null;this._hideIfEmpty();this.emit("notificationsChanged");},_hideIfEmpty:function(){var show=this.getChildren().length>0;_cea.toggle(this.domNode,this.noBorderClass,!show);_ceb.set(this.domNode,"display",show?"":"none");}});return _cfb;});},"url:epi-cms/contentediting/templates/NotificationBar.html":"<div class=\"epi-notificationBar\">\n    <div data-dojo-attach-point=\"containerNode\"></div>\n</div>","url:epi-cms/contentediting/templates/NotificationBarItem.html":"<div class=\"epi-notificationBarItem\">\n    <div class=\"epi-notificationBarText\" data-dojo-attach-point=\"contentContainer\">\n        <p data-dojo-attach-point=\"textContainer\"></p>\n    </div>\n    <div class=\"epi-notificationBarButtonContainer\" data-dojo-attach-point=\"buttonContainer\">\n        <button data-dojo-type=\"dijit/form/Button\" class=\"epi-chromelessButton\" data-dojo-props=\"iconClass:'epi-iconClose', showLabel:false\" data-dojo-attach-event=\"onClick:_onClose\"></button>\n    </div>\n</div>","epi-cms/contentediting/ShortcutNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi/string","epi/i18n!epi/cms/nls/episerver.cms.contentediting.shortcutnotification"],function(_d02,lang,_d03,_d04,_d05){var _d06=["normal","shortcut","external","inactive","fetchdata"];return _d02([_d03],{_valueSetter:function(_d07){var _d08=_d07.contentModel.get("iversionable_shortcut");if(_d08){this._updateNotification(_d08.pageShortcutType);}if(this._contentModelWatch){this._contentModelWatch.unwatch();}this._contentModelWatch=_d07.contentModel.watch("iversionable_shortcut",lang.hitch(this,function(name,_d09,_d0a){this._updateNotification(_d0a&&_d0a.pageShortcutType);}));},_updateNotification:function(_d0b){var _d0c,_d0d=null;if(_d0b>0){_d0c=_d06[_d0b];_d0d=_d04.toHTML(_d05[_d0c]);}this.set("notification",{content:_d0d});}});});},"epi-cms/contentediting/ViewSettingsNotification":function(){define(["dojo/_base/declare","dojo/Stateful","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.contentediting.viewsettingsnotification"],function(_d0e,_d0f,_d10,_d11){return _d0e([_d0f],{_valueSetter:function(_d12){var _d13=_d12.viewModel.contentData&&_d12.viewModel.contentData.accessMask<=_d10.accessLevel.Read,_d14=_d13&&_d12.viewSetting.get("enabled")&&_d12.viewSetting.hasVisitorGroup();this.set("notification",_d14?{content:_d11.visitorgroups.noaccessright}:null);}});});},"epi-cms/project/ProjectNotification":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/Stateful","dojox/html/entities","epi/dependency","epi/shell/DestroyableByKey","epi-cms/ApplicationSettings","epi-cms/contentediting/command/CreateDraft","epi-cms/core/ContentReference","dojo/text!./templates/ProjectNotification.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.notifications"],function(_d15,lang,all,_d16,_d17,_d18,_d19,_d1a,_d1b,_d1c,_d1d,_d1e){return _d15([_d16,_d19],{_projectService:null,_createDraftCommand:null,constructor:function(_d1f,_d20){this._projectService=_d20||_d18.resolve("epi.cms.ProjectService");this._createDraftCommand=new _d1b({ignoreContentStatus:true});this.own(this._projectService.on("project-item-updated",lang.hitch(this,this._onItemUpdated)),this._projectService.on("project-item-removed",lang.hitch(this,this._onItemRemoved)),this._projectService.on("project-updated",function(){this._onModelChanged(this.value);}.bind(this)));},_valueSetter:function(_d21){this.value=_d21;if(!_d21||!_d21.contentLink){this.set("model",null);this._currentProjectItemId=0;return;}this._createDraftCommand.set("model",_d21);var _d22="contentLinkWatch";this.destroyByKey(_d22);this.ownByKey(_d22,_d21.watch("contentLink",lang.hitch(this,"_onModelChanged",_d21)));this._onModelChanged(_d21);},_onItemUpdated:function(item){this._onItemsAddedOrRemoved(item.id);},_onItemRemoved:function(id){this._onItemsAddedOrRemoved(id);},_onItemsAddedOrRemoved:function(_d23){if(!this.model){return;}if(this._currentProjectItemId===_d23){this._updateNotification(this.model.contentLink);}},_onModelChanged:function(_d24){if(_d24.get("isSuspended")){return;}this._projectService.getProjectItemForContent(_d24.contentLink).then(function(_d25){var _d26=_d24.languageContext,_d27=_d26&&_d26.isTranslationNeeded&&_d1a.currentContentLanguage===_d26.preferredLanguage;this.set("model",_d24);this._currentProjectItemId=_d25&&_d25.id||0;this._updateNotification(_d24.contentLink,_d24.contentData.isPartOfAnotherProject,_d27);}.bind(this)).otherwise(function(){this._currentProjectItemId=0;}.bind(this));},_updateNotification:function(_d28,_d29,_d2a){var self=this;all([this._projectService.getProjectsForContent(_d28),this._projectService.getCurrentProject()]).then(function(_d2b){var _d2c=_d2b[0],_d2d=_d2b[1];if(_d2c.length===0){self.set("notification",null);return;}var _d2e=_d2c.map(function(_d2f){return _d17.encode(_d2f.name);}).join(", ");var _d30="";if(_d29){_d30=_d1e.partofanotherproject+": "+_d2e;}else{if(_d2d){_d30=_d1e.partofcurrentproject;}else{_d30=_d1e.partofproject+": "+_d2e;}}var _d31=lang.replace(_d1d,{partOfProject:_d30});var _d32=_d29&&self._projectService.isProjectModeEnabled&&!_d2a?[self._createDraftCommand]:[];self.set("notification",{content:_d31,commands:_d32});});}});});},"url:epi-cms/project/templates/ProjectNotification.html":"<span class=\"dijitReset dijitInline dijitIcon epi-objectIcon epi-iconProject\"></span>\n<span class=\"dijitReset dijitInline epi-project-notification__content\">{partOfProject}</span>","url:epi-cms/contentediting/templates/PageDataController.html":"<div style=\"width: 100%; height: 100%;\">\n    <div data-dojo-attach-point=\"mainLayoutContainer\" data-dojo-type=\"epi/shell/layout/PreserveRatioBorderContainer\" data-dojo-props=\"gutters: false, livesplitters: false\" style=\"width: 100%; height: 100%\">\n        <div data-dojo-attach-point=\"toolbar\" data-dojo-type=\"epi-cms/contentediting/EditToolbar\" data-dojo-props=\"region:'top'\"></div>\n        <div data-dojo-attach-point=\"notificationBar\" data-dojo-type=\"epi-cms/contentediting/NotificationBar\" data-dojo-props=\"region:'top', layoutPriority: 99\"></div>\n        <div data-dojo-attach-point=\"editLayoutContainer\" data-dojo-type=\"epi/shell/layout/CardContainer\" data-dojo-props=\"region: 'center', layoutPriority: 100\">\n            <div data-dojo-attach-point=\"iframeWithOverlay\" data-dojo-type=\"epi/shell/widget/IframeWithOverlay\" data-dojo-props=\"fitContainer: true\">\n            </div>\n        </div>\n    </div>\n</div>\n","epi-cms/compare/CompareToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Evented","dojo/topic","dijit/Toolbar","epi/shell/widget/DeferredDropDownButton","epi","epi/username","epi-cms/version/VersionSelector","epi/shell/widget/_ModelBindingMixin","dojo/text!./template/CompareToolbar.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","epi/i18n!epi/shell/ui/nls/episerver.cms.compare"],function(_d33,lang,_d34,_d35,_d36,_d37,_d38,epi,_d39,_d3a,_d3b,_d3c,_d3d,_d3e){return _d33([_d37,_d35,_d3b],{region:"top",baseClass:"epi-compare-toolbar epi-localToolbar epi-flatToolbar",templateString:_d3c,_leftVersionSelector:null,_rightVersionSelector:null,_resources:lang.mixin(_d3d,_d3e),modelBindingMap:{currentLanguage:["currentLanguage"],leftVersion:["leftVersion"],rightVersion:["rightVersion"],leftButtonLabel:["leftButtonLabel"],rightButtonLabel:["rightButtonLabel"],leftByText:["leftByText"],rightByText:["rightByText"],leftDateText:["leftDateText"],rightDateText:["rightDateText"],messageText:["messageText"],showsVersionSelectors:["showsVersionSelectors"]},buildRendering:function(){this.inherited(arguments);this._leftVersionSelector=this._createVersionSelector("leftVersion","left");this._rightVersionSelector=this._createVersionSelector("rightVersion","right");this._leftButton=new _d38({"class":"epi-chromeless epi-chromeless--with-arrow epi-flat",dropDown:this._leftVersionSelector,iconClass:"epi-iconVersions"},this.leftVersionSelector);this._rightButton=new _d38({"class":"epi-chromeless epi-chromeless--with-arrow epi-flat",dropDown:this._rightVersionSelector,iconClass:"epi-iconVersions"},this.rightVersionSelector);this.own(this._leftVersionSelector,this._rightVersionSelector,this._leftButton,this._rightButton);},_refreshSelectors:function(){this._leftVersionSelector.refresh();this._rightVersionSelector.refresh();},_setLeftVersionAttr:function(_d3f){if(epi.areEqual(this.leftVersion,_d3f)){return;}this._set("leftVersion",_d3f);if(_d3f){this._leftVersionSelector.set("contentLink",_d3f.contentLink);this._rightVersionSelector.set("markedContentLink",_d3f.contentLink);this._refreshSelectors();}},_setRightVersionAttr:function(_d40){this._set("rightVersion",_d40);if(_d40){this._rightVersionSelector.set("contentLink",_d40.contentLink);this._leftVersionSelector.set("markedContentLink",_d40.contentLink);}},_setLeftButtonLabelAttr:function(_d41){this._set("leftButtonLabel",_d41);this._leftButton.set("label",_d41);},_setRightButtonLabelAttr:function(_d42){this._set("rightButtonLabel",_d42);this._rightButton.set("label",_d42);},_setLeftByTextAttr:{node:"leftBy",type:"innerHTML"},_setRightByTextAttr:{node:"rightBy",type:"innerHTML"},_setLeftDateTextAttr:{node:"leftDate",type:"innerHTML"},_setRightDateTextAttr:{node:"rightDate",type:"innerHTML"},_setMessageTextAttr:{node:"messageSection",type:"innerHTML"},_setShowsVersionSelectorsAttr:function(_d43){_d34.toggle(this.leftVersionSection,"dijitHidden",!_d43);_d34.toggle(this.rightVersionSection,"dijitHidden",!_d43);_d34.toggle(this.messageSection,"dijitHidden",_d43);this.emit("versionInformationUpdated");},_createVersionSelector:function(_d44,_d45){var _d46=this.model,_d47=new _d3a({store:_d46.contentVersionStore,region:_d45,languages:_d46.languages,currentLanguage:_d46.currentLanguage,name:_d44}),_d48=function(name,_d49,_d4a){_d47.set(name,_d4a);};this.own(_d47.on("change",function(e){_d46.set(_d44,e.version);}),_d46.watch("languages",_d48),_d46.watch("currentLanguage",_d48));return _d47;}});});},"epi-cms/version/VersionSelector":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/keys","epi-cms/core/ContentReference","dojo/text!./template/VersionSelector.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","dgrid/OnDemandGrid","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/Selection","dgrid/extensions/ColumnHider","epi/shell/dgrid/Focusable","epi/shell/dgrid/selection/Exclusive","epi/shell/dgrid/util/misc","epi-cms/dgrid/formatters","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_KeyNavContainer","epi/shell/widget/_FocusableMixin","epi-cms/version/LanguageSelector"],function(_d4b,_d4c,lang,_d4d,_d4e,keys,_d4f,_d50,_d51,_d52,_d53,_d54,_d55,_d56,_d57,_d58,misc,_d59,_d5a,_d5b,_d5c,_d5d,_d5e){return _d4b([_d5a,_d5b,_d5c,_d5d,_d5e],{baseClass:"epi-version-selector",templateString:_d50,contentLink:null,markedContentLink:null,languages:null,store:null,region:null,buildRendering:function(){this.inherited(arguments);this.grid=new (_d4b([_d52,_d53,_d54,_d55,_d58,_d57,_d56]))({columns:{selector:{label:"",formatter:function(){return misc.icon("epi-iconCheckmark");},sortable:false},icon:{label:"",formatter:function(){return misc.icon("");},sortable:false},language:{label:_d51.language,sortable:false},status:{label:_d51.status,renderCell:_d59.commonDraft},savedDate:{label:_d51.saved,formatter:_d59.localizedDate,className:"epi-grid--30"},savedBy:{label:_d51.by,formatter:_d59.userName,sortable:false}},cellNavigation:false,selectionEvents:"click",selectionMode:"exclusive",sort:[{attribute:"savedDate",descending:true}]},this.gridNode);this.own(this.grid,this.grid.on("dgrid-refresh-complete",lang.hitch(this,"_refreshComplete")),this.grid.on("dgrid-select",lang.hitch(this,"_versionSelected")),_d4d.around(this.grid,"renderRow",lang.hitch(this,"_renderRow")),this.languageSelector.watch("value",lang.hitch(this,"_updateFilter")),this.on("keydown",lang.hitch(this,"_onKeydown")));},startup:function(){if(this._started){return;}this.inherited(arguments);this.grid.startup();this.grid.set("store",this.store,{contentLink:this.contentLink});},resize:function(){this.inherited(arguments);this.grid.resize();},refresh:function(){if(this._started){this.grid.refresh();}},_setContentLinkAttr:function(_d5f){if(this.contentLink===_d5f){return;}if(this._started&&!_d4f.compareIgnoreVersion(this.contentLink,_d5f)){this.languageSelector.set("value",this.languageSelector.defaultOption.value);this.grid.set("query",{contentLink:_d5f});}this.contentLink=_d5f;this.grid.clearSelection();this.grid.select(_d5f);},_setCurrentLanguageAttr:function(_d60){this._set("currentLanguage",_d60);this.languageSelector.set("currentLanguage",_d60);},_setLanguagesAttr:function(_d61){this._set("languages",_d61);this.languageSelector.set("languages",_d61);var _d62=_d61&&_d61.length;this.languageSelector.set("disabled",!_d62);_d4e.toggle(this.languageSelectorContainer,"dijitHidden",!_d62);this.grid.toggleColumnHiddenState("language",!_d62);},_setMarkedContentLinkAttr:function(_d63){var row=this._getRowElement(this.markedContentLink);if(row){_d4e.remove(row,"dgrid-row--marked");}row=this._getRowElement(_d63);if(row){_d4e.add(row,"dgrid-row--marked");}this.markedContentLink=_d63;},_setRegionAttr:function(_d64){var _d65=this.baseClass+"--"+_d64,_d66=this.baseClass+"--"+this.region;this.region=_d64;_d4e.replace(this.domNode,_d65,_d66);},_refreshComplete:function(){this.grid.select(this.contentLink);this.emit("loaded");},_versionSelected:function(e){if(e.parentType){var _d67=e.rows&&e.rows[0].data;this.contentLink=_d67.contentLink;this.emit("change",{version:_d67});}},_renderRow:function(_d68){var self=this;return function(item){var row=_d68.apply(this,arguments);if(item.contentLink===self.markedContentLink){_d4e.add(row,"dgrid-row--marked");}return row;};},_getRowElement:function(_d69){if(_d69){return this.grid.row(_d69).element;}},_updateFilter:function(name,_d6a,_d6b){if(this._started){if(_d6b!==this.languageSelector.defaultOption.value){this.grid.set("query",{contentLink:this.contentLink,language:_d6b});}else{this.grid.set("query",{contentLink:this.contentLink});}}this.refresh();},_onKeydown:function(evt){if(evt.ctrlKey||evt.altKey||evt.keyCode!==keys.TAB){return;}if(evt.shiftKey){this.focusPrev();}else{this.focusNext();}_d4c.stop(evt);}});});},"url:epi-cms/version/template/VersionSelector.html":"<div>\n    <div data-dojo-attach-point=\"languageSelectorContainer\" class=\"epi-flatToolbar\">\n        <select data-dojo-attach-point=\"languageSelector\" data-dojo-type=\"epi-cms/version/LanguageSelector\" class=\"epi-flat epi-chromeless epi-chromeless--with-arrow\"></select>\n    </div>\n    <div data-dojo-attach-point=\"gridNode\" class=\"epi-plain-grid epi-grid-max-height--300\"></div>\n</div>\n","dgrid/extensions/ColumnHider":function(){define(["dojo/_base/declare","dojo/has","dojo/on","../util/misc","put-selector/put","dojo/i18n!./nls/columnHider","xstyle/css!../css/extensions/ColumnHider.css"],function(_d6c,has,_d6d,_d6e,put,i18n){var _d6f,_d70,_d71=has("ie"),_d72=_d71&&has("quirks"),_d73=_d71<8||_d72?"htmlFor":"for";function _d74(cb,grid){return cb.id.substr(grid.id.length+18);};return _d6c(null,{hiderMenuNode:null,hiderToggleNode:null,i18nColumnHider:i18n,_hiderMenuOpened:false,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var _d75=this.subRows,_d76=true,_d77,_d78,sr,c;delete this._columnHiderFirstCheckbox;for(sr=0,_d77=_d75.length;sr<_d77;sr++){for(c=0,_d78=_d75[sr].length;c<_d78;c++){this._renderHiderMenuEntry(_d75[sr][c]);if(_d76){_d76=false;this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[_d75[sr][c].id];}}}},_renderHiderMenuEntry:function(col){var id=col.id,_d79=_d6e.escapeCssIdentifier(id,"-"),div,_d7a,_d7b,_d7c;if(col.hidden){col.hidden=false;this._hideColumn(id);col.hidden=true;}if(col.unhidable){return;}div=put("div.dgrid-hider-menu-row");_d7a=this.domNode.id+"-hider-menu-check-"+_d79;_d7b=this._columnHiderCheckboxes[id]=put(div,"input.dgrid-hider-menu-check.hider-menu-check-"+_d79+"[type=checkbox]");_d7b.id=_d7a;_d7c=put(div,"label.dgrid-hider-menu-label.hider-menu-label-"+_d79+"["+_d73+"="+_d7a+"]",col.label||col.field||"");put(this.hiderMenuNode,div);if(!col.hidden){_d7b.checked=true;}},renderHeader:function(){var grid=this,_d7d=this.hiderMenuNode,_d7e=this.hiderToggleNode,id;function _d7f(_d80){_d80.stopPropagation();};this.inherited(arguments);if(!_d7d){_d7e=this.hiderToggleNode=put(this.domNode,"button.ui-icon.dgrid-hider-toggle[type=button][aria-label="+this.i18nColumnHider.popupTriggerLabel+"]");this._listeners.push(_d6d(_d7e,"click",function(e){grid._toggleColumnHiderMenu(e);}));_d7d=this.hiderMenuNode=put("div.dgrid-hider-menu[role=dialog][aria-label="+this.i18nColumnHider.popupLabel+"]");_d7d.id=this.id+"-hider-menu";this._listeners.push(_d6d(_d7d,"keyup",function(e){var _d81=e.charCode||e.keyCode;if(_d81===27){grid._toggleColumnHiderMenu(e);_d7e.focus();}}));_d7d.style.display="none";put(this.domNode,_d7d);this._listeners.push(_d6d(_d7d,".dgrid-hider-menu-check:"+(_d71<9||_d72?"click":"change"),function(e){grid._updateColumnHiddenState(_d74(e.target,grid),!e.target.checked);}));this._listeners.push(_d6d(_d7d,"mousedown",_d7f),_d6d(_d7e,"mousedown",_d7f));if(!_d70){_d70=_d6d.pausable(document,"mousedown",function(e){_d6f&&_d6f._toggleColumnHiderMenu(e);});_d70.pause();}}else{for(id in this._columnHiderRules){this._columnHiderRules[id].remove();}_d7d.innerHTML="";}this._columnHiderCheckboxes={};this._columnHiderRules={};this._renderHiderMenuEntries();},destroy:function(){this.inherited(arguments);for(var id in this._columnHiderRules){this._columnHiderRules[id].remove();}},left:function(cell,_d82){return this.right(cell,-_d82);},right:function(cell,_d83){if(!cell.element){cell=this.cell(cell);}var _d84=this.inherited(arguments),_d85=cell;while(_d84.column.hidden){_d84=this.inherited(arguments,[_d84,_d83>0?1:-1]);if(_d85.element===_d84.element){return cell;}_d85=_d84;}return _d84;},isColumnHidden:function(id){return !!this._columnHiderRules[id];},_toggleColumnHiderMenu:function(){var _d86=this._hiderMenuOpened,_d87=this.hiderMenuNode,_d88=this.domNode,_d89;_d87.style.display=(_d86?"none":"");if(_d86){_d87.style.height="";}else{if(_d87.offsetHeight>_d88.offsetHeight-12){_d87.style.height=(_d88.offsetHeight-12)+"px";}(_d89=this._columnHiderFirstCheckbox)&&_d89.focus();}_d70[_d86?"pause":"resume"]();_d6f=_d86?null:this;this._hiderMenuOpened=!_d86;},_hideColumn:function(id){var grid=this,_d8a="#"+_d6e.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-",_d8b;if(this._columnHiderRules[id]){return;}this._columnHiderRules[id]=_d6e.addCssRule(_d8a+_d6e.escapeCssIdentifier(id,"-"),"display: none;");if((has("ie")===8||has("ie")===10)&&!has("quirks")){_d8b=_d6e.addCssRule(".dgrid-row-table","display: inline-table;");window.setTimeout(function(){_d8b.remove();grid.resize();},0);}},_showColumn:function(id){if(this._columnHiderRules[id]){this._columnHiderRules[id].remove();delete this._columnHiderRules[id];}},_updateColumnHiddenState:function(id,_d8c){this[_d8c?"_hideColumn":"_showColumn"](id);this.columns[id].hidden=_d8c;_d6d.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[id],hidden:_d8c,bubbles:true});this.resize();},toggleColumnHiddenState:function(id,_d8d){if(typeof _d8d==="undefined"){_d8d=!this._columnHiderRules[id];}this._updateColumnHiddenState(id,_d8d);this._columnHiderCheckboxes[id].checked=!_d8d;}});});},"epi-cms/version/LanguageSelector":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.languageselector","dijit/form/Select"],function(_d8e,_d8f,_d90){return _d8e([_d90],{defaultOption:null,languages:null,currentLanguage:null,constructor:function(){this.defaultOption={label:_d8f.alllanguages,value:"all"};},_setLanguagesAttr:function(_d91){this._set("languages",_d91);if(!_d91||!_d91.length){this.set("options",[]);return;}this.set("options",this._convertLanguagesToOptions(_d91));},_setCurrentLanguageAttr:function(_d92){this._set("currentLanguage",_d92);var _d93=this.languages;if(_d93&&_d93.length){this.set("options",this._convertLanguagesToOptions(_d93));}},_convertLanguagesToOptions:function(_d94){var _d95=this.value,_d96=this.currentLanguage;var _d97=_d94.map(function(item){var _d98=item.languageId===_d96;return {label:item.name+(_d98?" ("+_d8f.currentlanguage+")":""),value:item.languageId};});_d97=[this.defaultOption,{}].concat(_d97);_d97.forEach(function(item){item.selected=item.value===_d95;});return _d97;}});});},"dijit/form/Select":function(){require({cache:{"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode,_popupStateNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n"}});define("dijit/form/Select",["dojo/_base/array","dojo/_base/declare","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/_base/event","dojo/i18n","dojo/_base/lang","dojo/sniff","./_FormSelectWidget","../_HasDropDown","../Menu","../MenuItem","../MenuSeparator","../Tooltip","dojo/text!./templates/Select.html","dojo/i18n!./nls/validate"],function(_d99,_d9a,_d9b,_d9c,_d9d,_d9e,i18n,lang,has,_d9f,_da0,Menu,_da1,_da2,_da3,_da4){var _da5=_d9a("dijit.form._SelectMenu",Menu,{autoFocus:true,buildRendering:function(){this.inherited(arguments);var o=(this.menuTableNode=this.domNode);var n=(this.domNode=this.ownerDocument.createElement("div"));n.style.cssText="overflow-x: hidden; overflow-y: scroll";if(o.parentNode){o.parentNode.replaceChild(n,o);}_d9c.remove(o,"dijitMenuTable");n.className=o.className+" dijitSelectMenu";o.className="dijitReset dijitMenuTable";n.setAttribute("role","listbox");o.setAttribute("role","presentation");n.appendChild(o);},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onselectstart",_d9e.stop);},focus:function(){var _da6=false,val=this.parentWidget.value;if(lang.isArray(val)){val=val[val.length-1];}if(val){_d99.forEach(this.parentWidget._getChildren(),function(_da7){if(_da7.option&&(val===_da7.option.value)){_da6=true;this.focusChild(_da7,false);}},this);}if(!_da6){this.inherited(arguments);}},resize:function(mb){if(mb){_d9d.setMarginBox(this.domNode,mb);if("w" in mb){this.menuTableNode.style.width="100%";}}}});var _da8=_d9a("dijit.form.Select",[_d9f,_da0],{baseClass:"dijitSelect dijitValidationTextBox",templateString:_da4,_buttonInputDisabled:has("ie")?"disabled":"",required:false,state:"",message:"",tooltipPosition:[],emptyLabel:"&#160;",_isLoaded:false,_childrenLoaded:false,_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var si=this.srcNodeRef.selectedIndex||0;this.value=this.options[si>=0?si:0].value;}this.dropDown=new _da5({id:this.id+"_menu",parentWidget:this});_d9c.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "));},_getMenuItemForOption:function(_da9){if(!_da9.value&&!_da9.label){return new _da2({ownerDocument:this.ownerDocument});}else{var _daa=lang.hitch(this,"_setValueAttr",_da9);var item=new _da1({option:_da9,label:_da9.label||this.emptyLabel,onClick:_daa,ownerDocument:this.ownerDocument,dir:this.dir,disabled:_da9.disabled||false});item.focusNode.setAttribute("role","option");return item;}},_addOptionItem:function(_dab){if(this.dropDown){this.dropDown.addChild(this._getMenuItemForOption(_dab));}},_getChildren:function(){if(!this.dropDown){return [];}return this.dropDown.getChildren();},_loadChildren:function(_dac){if(_dac===true){if(this.dropDown){delete this.dropDown.focusedChild;}if(this.options.length){this.inherited(arguments);}else{_d99.forEach(this._getChildren(),function(_dad){_dad.destroyRecursive();});var item=new _da1({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(item);}}else{this._updateSelection();}this._isLoaded=false;this._childrenLoaded=true;if(!this._loadingStore){this._setValueAttr(this.value,false);}},_refreshState:function(){if(this._started){this.validate(this.focused);}},startup:function(){this.inherited(arguments);this._refreshState();},_setValueAttr:function(_dae){this.inherited(arguments);_d9b.set(this.valueNode,"value",this.get("value"));this._refreshState();},_setDisabledAttr:function(_daf){this.inherited(arguments);this._refreshState();},_setRequiredAttr:function(_db0){this._set("required",_db0);this.focusNode.setAttribute("aria-required",_db0);this._refreshState();},_setOptionsAttr:function(_db1){this._isLoaded=false;this._set("options",_db1);},_setDisplay:function(_db2){var lbl=_db2||this.emptyLabel;this.containerNode.innerHTML="<span role=\"option\" class=\"dijitReset dijitInline "+this.baseClass.replace(/\s+|$/g,"Label ")+"\">"+lbl+"</span>";},validate:function(_db3){var _db4=this.disabled||this.isValid(_db3);this._set("state",_db4?"":(this._hasBeenBlurred?"Error":"Incomplete"));this.focusNode.setAttribute("aria-invalid",_db4?"false":"true");var _db5=_db4?"":this._missingMsg;if(_db5&&this.focused&&this._hasBeenBlurred){_da3.show(_db5,this.domNode,this.tooltipPosition,!this.isLeftToRight());}else{_da3.hide(this.domNode);}this._set("message",_db5);return _db4;},isValid:function(){return (!this.required||this.value===0||!(/^\s*$/.test(this.value||"")));},reset:function(){this.inherited(arguments);_da3.hide(this.domNode);this._refreshState();},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=i18n.getLocalization("dijit.form","validate",this.lang).missingMessage;},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"onselectstart",_d9e.stop);this.domNode.setAttribute("aria-expanded","false");},_setStyleAttr:function(_db6){this.inherited(arguments);_d9c.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width);},isLoaded:function(){return this._isLoaded;},loadDropDown:function(_db7){this._loadChildren(true);this._isLoaded=true;_db7();},closeDropDown:function(){this.inherited(arguments);if(this.dropDown&&this.dropDown.menuTableNode){this.dropDown.menuTableNode.style.width="";}},destroy:function(_db8){if(this.dropDown&&!this.dropDown._destroyed){this.dropDown.destroyRecursive(_db8);delete this.dropDown;}this.inherited(arguments);},_onFocus:function(){this.validate(true);this.inherited(arguments);},_onBlur:function(){_da3.hide(this.domNode);this.inherited(arguments);this.validate(false);}});_da8._Menu=_da5;return _da8;});},"dijit/form/_FormSelectWidget":function(){define("dijit/form/_FormSelectWidget",["dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/data/util/sorter","dojo/_base/declare","dojo/dom","dojo/dom-class","dojo/_base/kernel","dojo/_base/lang","dojo/query","dojo/when","dojo/store/util/QueryResults","./_FormValueWidget"],function(_db9,_dba,_dbb,_dbc,_dbd,dom,_dbe,_dbf,lang,_dc0,when,_dc1,_dc2){var _dc3=_dbd("dijit.form._FormSelectWidget",_dc2,{multiple:false,options:null,store:null,query:null,queryOptions:null,labelAttr:"",onFetch:null,sortByLabel:true,loadChildrenOnOpen:false,onLoadDeferred:null,getOptions:function(_dc4){var opts=this.options||[];if(_dc4==null){return opts;}if(lang.isArray(_dc4)){return _db9.map(_dc4,"return this.getOptions(item);",this);}if(lang.isString(_dc4)){_dc4={value:_dc4};}if(lang.isObject(_dc4)){if(!_db9.some(opts,function(_dc5,idx){for(var a in _dc4){if(!(a in _dc5)||_dc5[a]!=_dc4[a]){return false;}}_dc4=idx;return true;})){_dc4=-1;}}if(_dc4>=0&&_dc4<opts.length){return opts[_dc4];}return null;},addOption:function(_dc6){_db9.forEach(lang.isArray(_dc6)?_dc6:[_dc6],function(i){if(i&&lang.isObject(i)){this.options.push(i);}},this);this._loadChildren();},removeOption:function(_dc7){var _dc8=this.getOptions(lang.isArray(_dc7)?_dc7:[_dc7]);_db9.forEach(_dc8,function(_dc9){if(_dc9){this.options=_db9.filter(this.options,function(node){return (node.value!==_dc9.value||node.label!==_dc9.label);});this._removeOptionItem(_dc9);}},this);this._loadChildren();},updateOption:function(_dca){_db9.forEach(lang.isArray(_dca)?_dca:[_dca],function(i){var _dcb=this.getOptions({value:i.value}),k;if(_dcb){for(k in i){_dcb[k]=i[k];}}},this);this._loadChildren();},setStore:function(_dcc,_dcd,_dce){var _dcf=this.store;_dce=_dce||{};if(_dcf!==_dcc){var h;while((h=this._notifyConnections.pop())){h.remove();}if(!_dcc.get){lang.mixin(_dcc,{_oldAPI:true,get:function(id){var _dd0=new _dba();this.fetchItemByIdentity({identity:id,onItem:function(_dd1){_dd0.resolve(_dd1);},onError:function(_dd2){_dd0.reject(_dd2);}});return _dd0.promise;},query:function(_dd3,_dd4){var _dd5=new _dba(function(){if(_dd6.abort){_dd6.abort();}});_dd5.total=new _dba();var _dd6=this.fetch(lang.mixin({query:_dd3,onBegin:function(_dd7){_dd5.total.resolve(_dd7);},onComplete:function(_dd8){_dd5.resolve(_dd8);},onError:function(_dd9){_dd5.reject(_dd9);}},_dd4));return new _dc1(_dd5);}});if(_dcc.getFeatures()["dojo.data.api.Notification"]){this._notifyConnections=[_dbb.after(_dcc,"onNew",lang.hitch(this,"_onNewItem"),true),_dbb.after(_dcc,"onDelete",lang.hitch(this,"_onDeleteItem"),true),_dbb.after(_dcc,"onSet",lang.hitch(this,"_onSetItem"),true)];}}this._set("store",_dcc);}if(this.options&&this.options.length){this.removeOption(this.options);}if(this._queryRes&&this._queryRes.close){this._queryRes.close();}if(this._observeHandle&&this._observeHandle.remove){this._observeHandle.remove();this._observeHandle=null;}if(_dce.query){this._set("query",_dce.query);this._set("queryOptions",_dce.queryOptions);}if(_dcc){this._loadingStore=true;this.onLoadDeferred=new _dba();this._queryRes=_dcc.query(this.query,this.queryOptions);when(this._queryRes,lang.hitch(this,function(_dda){if(this.sortByLabel&&!_dce.sort&&_dda.length){if(_dcc.getValue){_dda.sort(_dbc.createSortFunction([{attribute:_dcc.getLabelAttributes(_dda[0])[0]}],_dcc));}else{var _ddb=this.labelAttr;_dda.sort(function(a,b){return a[_ddb]>b[_ddb]?1:b[_ddb]>a[_ddb]?-1:0;});}}if(_dce.onFetch){_dda=_dce.onFetch.call(this,_dda,_dce);}_db9.forEach(_dda,function(i){this._addOptionForItem(i);},this);if(this._queryRes.observe){this._observeHandle=this._queryRes.observe(lang.hitch(this,function(_ddc,_ddd,_dde){if(_ddd==_dde){this._onSetItem(_ddc);}else{if(_ddd!=-1){this._onDeleteItem(_ddc);}if(_dde!=-1){this._onNewItem(_ddc);}}}),true);}this._loadingStore=false;this.set("value","_pendingValue" in this?this._pendingValue:_dcd);delete this._pendingValue;if(!this.loadChildrenOnOpen){this._loadChildren();}else{this._pseudoLoadChildren(_dda);}this.onLoadDeferred.resolve(true);this.onSetStore();}),function(err){console.error("dijit.form.Select: "+err.toString());this.onLoadDeferred.reject(err);});}return _dcf;},_setValueAttr:function(_ddf,_de0){if(!this._onChangeActive){_de0=null;}if(this._loadingStore){this._pendingValue=_ddf;return;}if(_ddf==null){return;}if(lang.isArray(_ddf)){_ddf=_db9.map(_ddf,function(_de1){return lang.isObject(_de1)?_de1:{value:_de1};});}else{if(lang.isObject(_ddf)){_ddf=[_ddf];}else{_ddf=[{value:_ddf}];}}_ddf=_db9.filter(this.getOptions(_ddf),function(i){return i&&i.value;});var opts=this.getOptions()||[];if(!this.multiple&&(!_ddf[0]||!_ddf[0].value)&&!!opts.length){_ddf[0]=opts[0];}_db9.forEach(opts,function(opt){opt.selected=_db9.some(_ddf,function(v){return v.value===opt.value;});});var val=_db9.map(_ddf,function(opt){return opt.value;});if(typeof val=="undefined"||typeof val[0]=="undefined"){return;}var disp=_db9.map(_ddf,function(opt){return opt.label;});this._setDisplay(this.multiple?disp:disp[0]);this.inherited(arguments,[this.multiple?val:val[0],_de0]);this._updateSelection();},_getDisplayedValueAttr:function(){var ret=_db9.map([].concat(this.get("selectedOptions")),function(v){if(v&&"label" in v){return v.label;}else{if(v){return v.value;}}return null;},this);return this.multiple?ret:ret[0];},_setDisplayedValueAttr:function(_de2){this.set("value",this.getOptions(typeof _de2=="string"?{label:_de2}:_de2));},_loadChildren:function(){if(this._loadingStore){return;}_db9.forEach(this._getChildren(),function(_de3){_de3.destroyRecursive();});_db9.forEach(this.options,this._addOptionItem,this);this._updateSelection();},_updateSelection:function(){this._set("value",this._getValueFromOpts());var val=[].concat(this.value);if(val&&val[0]){_db9.forEach(this._getChildren(),function(_de4){var _de5=_db9.some(val,function(v){return _de4.option&&(v===_de4.option.value);});_dbe.toggle(_de4.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),_de5);_de4.domNode.setAttribute("aria-selected",_de5?"true":"false");},this);}},_getValueFromOpts:function(){var opts=this.getOptions()||[];if(!this.multiple&&opts.length){var opt=_db9.filter(opts,function(i){return i.selected;})[0];if(opt&&opt.value){return opt.value;}else{opts[0].selected=true;return opts[0].value;}}else{if(this.multiple){return _db9.map(_db9.filter(opts,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_onNewItem:function(item,_de6){if(!_de6||!_de6.parent){this._addOptionForItem(item);}},_onDeleteItem:function(item){var _de7=this.store;this.removeOption({value:_de7.getIdentity(item)});},_onSetItem:function(item){this.updateOption(this._getOptionObjForItem(item));},_getOptionObjForItem:function(item){var _de8=this.store,_de9=(this.labelAttr&&this.labelAttr in item)?item[this.labelAttr]:_de8.getLabel(item),_dea=(_de9?_de8.getIdentity(item):null);return {value:_dea,label:_de9,item:item};},_addOptionForItem:function(item){var _deb=this.store;if(_deb.isItemLoaded&&!_deb.isItemLoaded(item)){_deb.loadItem({item:item,onItem:function(i){this._addOptionForItem(i);},scope:this});return;}var _dec=this._getOptionObjForItem(item);this.addOption(_dec);},constructor:function(_ded){this._oValue=(_ded||{}).value||null;this._notifyConnections=[];},buildRendering:function(){this.inherited(arguments);dom.setSelectable(this.focusNode,false);},_fillContent:function(){if(!this.options){this.options=this.srcNodeRef?_dc0("> *",this.srcNodeRef).map(function(node){if(node.getAttribute("type")==="separator"){return {value:"",label:"",selected:false,disabled:false};}return {value:(node.getAttribute("data-"+_dbf._scopeName+"-value")||node.getAttribute("value")),label:String(node.innerHTML),selected:node.getAttribute("selected")||false,disabled:node.getAttribute("disabled")||false};},this):[];}if(!this.value){this._set("value",this._getValueFromOpts());}else{if(this.multiple&&typeof this.value=="string"){this._set("value",this.value.split(","));}}},postCreate:function(){this.inherited(arguments);_dbb.after(this,"onChange",lang.hitch(this,"_updateSelection"));var _dee=this.store;if(_dee&&(_dee.getIdentity||_dee.getFeatures()["dojo.data.api.Identity"])){this.store=null;this.setStore(_dee,this._oValue);}},startup:function(){this._loadChildren();this.inherited(arguments);},destroy:function(){var h;while((h=this._notifyConnections.pop())){h.remove();}if(this._queryRes&&this._queryRes.close){this._queryRes.close();}if(this._observeHandle&&this._observeHandle.remove){this._observeHandle.remove();this._observeHandle=null;}this.inherited(arguments);},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return [];},_getSelectedOptionsAttr:function(){return this.getOptions({selected:true});},_pseudoLoadChildren:function(){},onSetStore:function(){}});return _dc3;});},"dojo/data/util/sorter":function(){define("dojo/data/util/sorter",["../../_base/lang"],function(lang){var _def={};lang.setObject("dojo.data.util.sorter",_def);_def.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_def.createSortFunction=function(_df0,_df1){var _df2=[];function _df3(attr,dir,comp,s){return function(_df4,_df5){var a=s.getValue(_df4,attr);var b=s.getValue(_df5,attr);return dir*comp(a,b);};};var _df6;var map=_df1.comparatorMap;var bc=_def.basicComparator;for(var i=0;i<_df0.length;i++){_df6=_df0[i];var attr=_df6.attribute;if(attr){var dir=(_df6.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_df2.push(_df3(attr,dir,comp,_df1));}}return function(rowA,rowB){var i=0;while(i<_df2.length){var ret=_df2[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _def;});},"url:dijit/form/templates/Select.html":"<table class=\"dijit dijitReset dijitInline dijitLeft\"\n\tdata-dojo-attach-point=\"_buttonNode,tableNode,focusNode,_popupStateNode\" cellspacing='0' cellpadding='0'\n\trole=\"listbox\" aria-haspopup=\"true\"\n\t><tbody role=\"presentation\"><tr role=\"presentation\"\n\t\t><td class=\"dijitReset dijitStretch dijitButtonContents\" role=\"presentation\"\n\t\t\t><div class=\"dijitReset dijitInputField dijitButtonText\"  data-dojo-attach-point=\"containerNode\" role=\"presentation\"></div\n\t\t\t><div class=\"dijitReset dijitValidationContainer\"\n\t\t\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&#935; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t/></div\n\t\t\t><input type=\"hidden\" ${!nameAttrSetting} data-dojo-attach-point=\"valueNode\" value=\"${value}\" aria-hidden=\"true\"\n\t\t/></td\n\t\t><td class=\"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\"\n\t\t\tdata-dojo-attach-point=\"titleNode\" role=\"presentation\"\n\t\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readonly=\"readonly\" role=\"presentation\"\n\t\t\t\t${_buttonInputDisabled}\n\t\t/></td\n\t></tr></tbody\n></table>\n","url:epi-cms/compare/template/CompareToolbar.html":"<div class=\"dijit\" role=\"toolbar\" tabIndex=\"${tabIndex}\" data-dojo-attach-point=\"containerNode\">\n    <span data-dojo-attach-point=\"leftVersionSection\" class=\"epi-compare-toolbar__text-wrapper\">\n        <span>${_resources.comparing}</span>\n        <span data-dojo-attach-point=\"leftVersionSelector\"></span>\n\n        <span data-dojo-attach-point=\"leftDate\"></span>\n        <span class=\"epi-secondaryText epi-compare-toolbar__info-text\">${_resources.by}</span>\n        <span data-dojo-attach-point=\"leftBy\"></span>\n    </span>\n    <span data-dojo-attach-point=\"rightVersionSection\" class=\"epi-compare-toolbar__text-wrapper\">\n        <span>${_resources.with}</span>\n        <span data-dojo-attach-point=\"rightVersionSelector\"></span>\n        <span data-dojo-attach-point=\"rightDate\"></span>\n        <span class=\"epi-secondaryText epi-compare-toolbar__info-text\">${_resources.by}</span>\n        <span data-dojo-attach-point=\"rightBy\"></span>\n    </span>\n    <span data-dojo-attach-point=\"messageSection\" class=\"epi-compare-toolbar__text-wrapper epi-compare-toolbar__text-wrapper--text-only\"></span>\n</div>\n","epi-cms/compare/viewmodels/CompareViewModel":function(){define(["dojo/_base/declare","dojo/aspect","dojo/topic","dojo/_base/lang","dojo/Stateful","dojo/when","epi/shell/DestroyableByKey","epi/dependency","epi-cms/core/ContentReference","epi-cms/compare/viewmodels/CompareToolbarViewModel"],function(_df7,_df8,_df9,lang,_dfa,when,_dfb,_dfc,_dfd,_dfe){return _df7([_dfa,_dfb],{contentLink:null,languages:null,typeIdentifier:null,leftVersion:null,rightVersion:null,leftVersionUri:null,rightVersionUrl:null,hasAccess:true,contentDataStore:null,contentVersionStore:null,orientation:"vertical",compareToolbarViewModel:null,postscript:function(){this.inherited(arguments);this.contentDataStore=this.contentDataStore||_dfc.resolve("epi.storeregistry").get("epi.cms.contentdata");this.contentVersionStore=this.contentVersionStore||_dfc.resolve("epi.storeregistry").get("epi.cms.contentversion");this._setupCompareToolbarViewModel();this.own(_df9.subscribe("/epi/cms/content/statuschange/",lang.hitch(this,"_refresh")));},_refresh:function(){var _dff=this.contentVersionStore;when(_dff.refresh(this.leftVersion.contentLink),lang.hitch(this,function(_e00){this.set("leftVersion",_e00);}));if(this.rightVersion){when(_dff.refresh(this.rightVersion.contentLink),lang.hitch(this,function(_e01){this.set("rightVersion",_e01);}));}},_contentLinkSetter:function(_e02){this.contentLink=_e02;var _e03=this.contentVersionStore;when(_e03.get(_e02),lang.hitch(this,function(_e04){this.set("leftVersion",_e04);if(!this.rightVersion||!_dfd.compareIgnoreVersion(this.leftVersion.contentLink,this.rightVersion.contentLink)){var _e05={contentLink:_e02,language:this.leftVersion.language,query:"getcompareversion"};var _e06=_e03.query(_e05);when(_e06,lang.hitch(this,function(_e07){this.set("hasAccess",true);this.set("rightVersion",_e07&&_e07.length?_e07[0]:null);}),lang.hitch(this,function(_e08){this.set("hasAccess",_e08.status!==403);this.set("rightVersion",null);}));}}));},_leftVersionSetter:function(_e09){this.leftVersion=_e09;if(this.compareToolbarViewModel){if(this.compareToolbarViewModel.leftVersion!==_e09){this.compareToolbarViewModel.set("leftVersion",_e09);}}this.set("leftVersionUri",_e09.uri);},_rightVersionSetter:function(_e0a){var _e0b="removeAfter";this.rightVersion=_e0a;this.destroyByKey(_e0b);if(_e0a){this.ownByKey(_e0b,_df8.after(this.contentVersionStore,"remove",lang.hitch(this,function(_e0c){if(_e0a.contentLink===_e0c){this.set("rightVersion",null);}}),true));}if(this.compareToolbarViewModel){if(this.compareToolbarViewModel.rightVersion!==_e0a){this.compareToolbarViewModel.set("rightVersion",_e0a);}}if(_e0a===null){this.set("rightVersionUrl","about:blank");return;}when(this.contentDataStore.get(_e0a.contentLink),lang.hitch(this,function(_e0d){if(this.leftVersion===this.rightVersion){this.set("rightVersionUrl","about:blank");}this.set("rightVersionUrl",_e0d.editablePreviewUrl);}));},_typeIdentifierSetter:function(_e0e){this.typeIdentifier=_e0e;if(this.compareToolbarViewModel){this.compareToolbarViewModel.set("typeIdentifier",_e0e);}},_languagesSetter:function(_e0f){this.languages=_e0f;if(this.compareToolbarViewModel){this.compareToolbarViewModel.set("languages",_e0f);}},_hasAccessSetter:function(_e10){this.hasAccess=_e10;if(this.compareToolbarViewModel){this.compareToolbarViewModel.set("hasAccess",_e10);}},_setupCompareToolbarViewModel:function(){this.compareToolbarViewModel=this.compareToolbarViewModel||new _dfe({contentVersionStore:this.contentVersionStore,leftVersion:this.leftVersion,rightVersion:this.rightVersion,typeIdentifier:this.typeIdentifier,hasAccess:this.hasAccess,languages:this.languages});this.own(this.compareToolbarViewModel.watch("leftVersion",lang.hitch(this,function(_e11,_e12,_e13){if(this.leftVersion!==_e13){this.set("leftVersion",_e13);}})));this.own(this.compareToolbarViewModel.watch("rightVersion",lang.hitch(this,function(_e14,_e15,_e16){if(this.rightVersion!==_e16){this.set("rightVersion",_e16);}})));}});});},"epi-cms/compare/viewmodels/CompareToolbarViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/when","epi/dependency","epi/datetime","epi/username","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/shell/ui/nls/episerver.cms.compare"],function(_e17,lang,_e18,when,_e19,_e1a,_e1b,_e1c,_e1d,_e1e){return _e17([_e18],{contentVersionStore:null,leftVersion:null,rightVersion:null,leftButtonLabel:null,rightButtonLabel:null,leftByText:null,rightByText:null,leftDateText:null,rightDateText:null,messageText:null,showsVersionSelectors:null,hasAccess:true,typeIdentifier:null,languages:null,currentLanguage:null,postscript:function(){this.inherited(arguments);var _e1f=this._profile||_e19.resolve("epi.shell.Profile");when(_e1f.getContentLanguage(),lang.hitch(this,function(_e20){this.set("currentLanguage",_e20);}));},_leftVersionSetter:function(_e21){this.leftVersion=_e21;if(_e21){this.set("leftButtonLabel",this._createButtonLabel(_e21));this.set("leftByText",_e1b.toUserFriendlyString(_e21.savedBy,null,false));this.set("leftDateText",_e1a.toUserFriendlyString(_e21.savedDate));}},_rightVersionSetter:function(_e22){this.rightVersion=_e22;if(_e22){this.set("rightButtonLabel",this._createButtonLabel(_e22));this.set("rightByText",_e1b.toUserFriendlyString(_e22.savedBy,null,false));this.set("rightDateText",_e1a.toUserFriendlyString(_e22.savedDate));}this.set("showsVersionSelectors",_e22!==null);},_typeIdentifierSetter:function(_e23){this.typeIdentifier=_e23;this._updateMessageText();},_hasAccessSetter:function(_e24){this.hasAccess=_e24;this._updateMessageText();},_updateMessageText:function(){this.set("messageText",this.hasAccess?_e1c.getResourceValue(this.typeIdentifier,"compare.onlyoneversion"):_e1e.insufficientpermission);},_createButtonLabel:function(_e25){var _e26=_e25.language?" ("+_e25.language+")":"";var _e27=_e1d.getVersionStatus(_e25.status);return _e27+_e26;}});});},"epi-cms/compare/views/SideBySideCompareView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/shell/widget/Iframe","epi/shell/widget/_ModelBindingMixin","epi-cms/contentediting/OnPageEditing"],function(_e28,lang,_e29,_e2a,_e2b,_e2c){return _e28([_e2c,_e2b],{createOverlays:true,modelBindingMap:{rightVersionUrl:["rightVersionUrl"]},_rightIframe:null,buildRendering:function(){this.inherited(arguments);this._setupComparePanes();},destroy:function(){this._removeAndDestroyComparePanes();this.inherited(arguments);},_setRightVersionUrlAttr:function(url){if(url){this._rightIframe.load(url);}},_setupComparePanes:function(){var _e2d=this.model.orientation;this._rightIframe=new _e2a({region:_e2d==="vertical"?"right":"bottom",layoutPriority:100,style:_e2d==="vertical"?"width: 50%;":"height: 50%",splitter:true,"class":"epi-iframe--overflow epi-editorViewport"});this.own(this._rightIframe.on("load",lang.hitch(this,this._onRightIframeLoad)));this.mainLayoutContainer.addChild(this._rightIframe);},_onRightIframeLoad:function(url,_e2e){if(!!url&&!_e2e&&url!==this.model.rightVersionUrl){_e29.publish("/epi/shell/context/request",{url:url},{sender:this,forceContextChange:true,suppressFailure:true});}},_removeAndDestroyComparePanes:function(){if(this._rightIframe){this.mainLayoutContainer.removeChild(this._rightIframe);this._rightIframe.destroyRecursive();this._rightIframe=null;}}});});},"epi-cms/contentediting/OnPageEditing":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/when","dojo/topic","epi/shell/gesture/ScrollPullDown","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_e2f,lang,_e30,on,when,_e31,_e32,_e33,_e34,_e35){return _e2f([_e35,_e33,_e34],{_iframeConnects:null,postMixInProperties:function(){this.inherited(arguments);this.formSettings={doLayout:false,baseClass:"epi-cmsEditingForm epi-cmsEditingFormOpe",propertyFilter:function(_e36,_e37){return _e37.groupName==="EPiServerCMS_SettingsPanel";}};},destroy:function(){this._removePullDownGesture();this.inherited(arguments);},onEditorWrapperCreated:function(_e38){if(_e38&&_e38.editorWidget){var _e39=_e38.editorWidget;if(_e39.onFieldCreated){var _e3a=_e30.after(_e39,"onFieldCreated",lang.hitch(this,function(_e3b,_e3c){_e3a.remove();_e3a=null;this._addStateWatch(_e3c);}),true);}else{_e39.set("name",_e38.get("propertyName"));this._addStateWatch(_e39);}_e39.validate&&_e39.validate();}},onSetActiveProperty:function(_e3d){var _e3e=this._mappingManager.findOne("propertyName",_e3d);if(!_e3e){_e31.publish("/epi/cms/action/switcheditmode",null,{activePropertyOnStartup:_e3d});}else{if(_e3e.wrapper){_e3e.wrapper.startEdit();}else{if(_e3e.overlayItem){this._onOverlayItemClick(_e3e.overlayItem);}}}},_onOverlayItemClick:function(_e3f,e){var _e40=this._activeEditorWrapper;var _e41=this._mappingManager.find().filter(function(item){return (item.overlayItem&&item.wrapper);}).map(function(item){return item.wrapper;});if(_e41.length>0){_e41.forEach(function(item){item.tryToStopEditing();});var _e42=_e41.some(function(item){return (item.editing);});if(_e42||(_e40&&_e3f.name===_e40.overlayItem.name)){return;}}this.inherited(arguments);},onReadySetupEditMode:function(){this.inherited(arguments);var self=this,_e43=function(){var _e44=self._activeEditorWrapper;if(_e44&&_e44.closeOnViewportClick){_e44.tryToStopEditing(false);}};this.own(on(this._form,"mousedown",_e43),on(this.iframeWithOverlay.iframe,"mousedown",_e43));},placeForm:function(form){form.set("fitContainer",false);form.set("transitionMode","slideIn");this.editLayoutContainer.addChild(form,0);this._setupPullDownGesture(form);},_setupPullDownGesture:function(form){var _e45=this;this._pullDownGesture=_e32(_e45.iframeWithOverlay.previewContainer,{isShown:false,show:function(){this.isShown=null;when(_e45.editLayoutContainer.selectChild(form),lang.hitch(this,function(){this.isShown=true;_e45.iframeWithOverlay.onViewportPullDown();}),lang.hitch(this,function(){this.isShown=false;_e45.iframeWithOverlay.onViewportPullDown();}));},hide:function(){this.isShown=null;when(_e45.editLayoutContainer.selectChild(_e45.iframeWithOverlay),lang.hitch(this,function(){this.isShown=false;_e45.iframeWithOverlay.onViewportPullDown();}),lang.hitch(this,function(){this.isShown=true;_e45.iframeWithOverlay.onViewportPullDown();}));}});this._pullDownGesture.addMouseWheelListener(form.domNode);if(_e45.iframeWithOverlay.iframe.isInspectable()){this._setupIframeMouseWheelListeners();}},_setupIframeMouseWheelListeners:function(){var _e46=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());this._iframeConnects=[];this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onLoad",function(){_e46=this._pullDownGesture.addMouseWheelListener(this.iframeWithOverlay.iframe.getDocument());}));this._iframeConnects.push(this.connect(this.iframeWithOverlay.iframe,"onUnload",function(){_e46&&_e46.remove();}));},_teardownIframeMouseWheelListeners:function(){if(this._iframeConnects){var c;while((c=this._iframeConnects.pop())){this.disconnect(c);}c=null;this._iframeConnects=null;}},_removePullDownGesture:function(){this._teardownIframeMouseWheelListeners();if(this._pullDownGesture){this._pullDownGesture.destroy();this._pullDownGesture=null;}},_destroyOverlay:function(){this.inherited(arguments);this._removeViewModelWatches();},removeForm:function(form){this._removePullDownGesture();this.editLayoutContainer.leftOver=form;return false;}});});},"epi/shell/gesture/ScrollPullDown":function(){define("epi/shell/gesture/ScrollPullDown",["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/mouse","dojo/on","dijit/Destroyable"],function(_e47,_e48,lang,_e49,on,_e4a){return _e47([_e4a],{_delegate:null,_scrollTarget:null,_isScrolling:false,_pullDownInertia:100,_ts:null,_tb:null,destroy:function(){this._delegate=null;},constructor:function(_e4b,_e4c){this._delegate=_e4c;this._scrollTarget=_e4b;this.addMouseWheelListener(_e4b);},addMouseWheelListener:function(_e4d){if(_e4d){return this.own(on(_e4d,_e49.wheel,lang.hitch(this,this._onMouseWheel)))[0];}},_blockShowEvent:function(){if(this._scrollTarget.scrollTop>0){this._isScrolling=true;}this._ts&&clearTimeout(this._ts);this._ts=setTimeout(lang.hitch(this,function(){this._isScrolling=false;}),this._pullDownInertia);return this._isScrolling;},_initiateScrollBlock:function(){this._scrollBlock=true;},_blockScrollEvent:function(){this._tb&&clearTimeout(this._tb);this._tb=setTimeout(lang.hitch(this,function(){this._scrollBlock=false;}),this._pullDownInertia);return (this._delegate.isShown==null)||this._scrollBlock;},_raiseShow:function(evt){if(this._delegate.isShown===false){_e48.stop(evt);this._delegate.show();this._initiateScrollBlock();}},_raiseHide:function(evt){if(this._delegate.isShown===true){_e48.stop(evt);this._delegate.hide();this._initiateScrollBlock();}},_onMouseWheel:function(evt){if(!evt.wheelDelta){this._blockScrollEvent();return;}if(this._blockScrollEvent()){_e48.stop(evt);return;}if(evt.wheelDelta<0||(this._delegate.isShown&&this._scrollTarget.scrollTop>0)){this._raiseHide(evt);}else{if(!this._blockShowEvent()){this._raiseShow(evt);}}}});});},"epi-cms/contentediting/_FormEditingMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","epi-cms/contentediting/SideBySideEditorWrapper","epi/shell/widget/FormContainer"],function(_e4e,_e4f,lang,_e50,when,_e51,_e52){return _e4f(null,{_form:null,_formWidgets:null,canHandleLeftOver:true,selectFormOnCreation:false,formSettings:null,connectOverlayItemsToFormWidgets:false,_formConnects:null,destroy:function(){this._removeAndDestroyForm();this._formWidgets=null;this.inherited(arguments);},_removeAndDestroyForm:function(){if(this._form){if(this.removeForm(this._form)){this._form.destroyRecursive();this._form=null;}var _e53;while((_e53=this._formConnects.pop())){this.disconnect(_e53);_e53=null;}this._formConnects=null;this._form=null;}for(var p in this._formWidgets){this._formWidgets[p]=null;}},_setupForm:function(){var _e54=new _e50();this._formWidgets={};this._form=this._createForm();this._formConnects=[this.connect(this._form,"onFieldCreated",this.onFieldCreated),this.connect(this._form,"onGroupCreated",this.onGroupCreated),this.connect(this._form,"onFormCreated",function(){_e54.resolve();})];this.placeForm(this._form);when(_e54,lang.hitch(this,function(){this._finishFormCreation();}));},_createForm:function(){return new _e52(lang.mixin({readOnly:!this.viewModel.canChangeContent(),metadata:this.viewModel.metadata,baseClass:"epi-cmsEditingForm",useDefaultValue:false},this.formSettings));},_createFormEditorWrappers:function(){for(var _e55 in this._formWidgets){var _e56={name:_e55,metadata:this.viewModel.getPropertyMetaData(_e55)};var _e57=lang.clone(this.viewModel.getProperty(_e56.name));var _e58=new _e51({property:_e56,propertyName:_e55,value:_e57,editorWidget:this._formWidgets[_e55],contentModel:this.viewModel.contentModel,operation:this.viewModel._operation});_e58.editorWidget.set("parent",_e58);_e58.editorWidget.set("editMode","formedit");this.connect(_e58,"onValueChange","_onWrapperValueChange");this.connect(_e58,"onCancel","_onWrapperCancel");this.connect(_e58,"onStopEdit","_onWrapperStopEdit");this._createMapping(_e55,_e58);_e56=null;_e57=null;_e58=null;}},_createMapping:function(_e59,_e5a){var _e5b=_e59.split(".");var _e5c=false;if(this.connectOverlayItemsToFormWidgets){while(_e5b.length>0){var _e5d=_e5b.join(".");var _e5e=this._mappingManager.find("propertyName",_e5d);_e4e.forEach(_e5e,function(_e5f){_e5c=true;_e5f.propertyName=_e59;_e5f.wrapper=_e5f.wrapper||_e5a;});_e5b.pop();}}if(!_e5c){this._mappingManager.add({propertyName:_e59,wrapper:_e5a});}},onSetActiveProperty:function(_e60){var _e61=this._mappingManager.find("propertyName",_e60).filter(function(_e62){return !!_e62.wrapper;})[0];if(_e61){_e61.wrapper.startEdit();}},placeForm:function(form){},removeForm:function(form){},onFieldCreated:function(_e63,_e64){this._formWidgets[_e63]=_e64;if(this._addStateWatch){this._addStateWatch(_e64);}},onGroupCreated:function(_e65,_e66,_e67){if(_e66.contentViewModel!==undefined){_e66.set("contentViewModel",this.viewModel);}},_finishFormCreation:function(){when(this.selectFormOnCreation?this.editLayoutContainer.selectChild(this._form):null,lang.hitch(this,this._removeLeftOver));this.toolbar.setItemProperty("editmodeswitch","state","");this._createFormEditorWrappers(this._form);this.onSetupEditModeComplete();},_removeLeftOver:function(){var _e68=this.editLayoutContainer,_e69;if(_e68.leftOver){_e69=_e68.selectedChildWidget===_e68.leftOver;when(_e69?_e68.selectChild(this.iframeWithOverlay):null,function(){var _e6a=_e68.leftOver;if(_e6a){_e68.removeChild(_e6a);_e6a.destroyRecursive();_e68=_e68.leftOver=null;}});}},onReadySetupEditMode:function(){this.inherited(arguments);this._removeAndDestroyForm();this._setupForm();},remapEditMode:function(){this.inherited(arguments);this._form&&this._form.set("readOnly",!this.viewModel.canChangeContent());}});});},"epi-cms/contentediting/SideBySideEditorWrapper":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/window","epi-cms/contentediting/_EditorWrapperBase"],function(_e6b,lang,_e6c,_e6d){return _e6b([_e6d],{_grabFocusOnStartEdit:true,postCreate:function(){this.inherited(arguments);if(this.editorWidget){this.connect(this.editorWidget,"onChange","_onChange");this.connect(this.editorWidget,"onFocus",lang.hitch(this,function(){this._tryToStartEditing(false);}));this.connect(this.editorWidget,"onBlur",lang.hitch(this,function(){setTimeout(lang.hitch(this,function(){this.tryToStopEditing(true);}),0);}));this.connect(this.editorWidget,"onDropping",lang.hitch(this,function(){this._tryToStartEditing(true);}));}},contentModelChanged:function(name,_e6e,_e6f){this.set("value",_e6f);},_tryToStartEditing:function(_e70){if(this.editing){return;}this._grabFocusOnStartEdit=_e70;this.startEdit();this._grabFocusOnStartEdit=true;},_onChange:function(val){if(this._preventChangeEvent){return;}var _e71=this.editing;if(this.operation&&this.operation.inProgress&&!this.editing){this.editing=true;this._lastSavedValue=this._resetValue=this.value;}this.inherited(arguments);this.editing=_e71;},_setValueAttr:function(_e72){this._preventChangeEvent=true;this.inherited(arguments);this._preventChangeEvent=false;},startEdit:function(){if(this._grabFocusOnStartEdit){this.editorWidget.focus();_e6c.scrollIntoView(this.editorWidget.domNode);}this.inherited(arguments);},stopEdit:function(_e73){this.set("value",this.getEditorValue());this.inherited(arguments);}});});},"epi-cms/contentediting/_EditorWrapperBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/keys","dijit/_Widget","dijit/form/_TextBoxMixin","epi/epi"],function(_e74,lang,_e75,keys,_e76,_e77,epi){return _e74([_e76],{wrapperType:"",editorWidgetType:null,editorParams:null,editing:false,disabled:false,blockDisplayNode:null,editorWidget:null,isModified:false,_resetValue:null,_lastSavedValue:null,_createdEditor:false,propertyName:"",propertyDisplayName:"",overlayItem:null,isOverlayDisabled:false,isUndoDisabled:false,hasInlineEditor:false,contentModel:null,closeOnViewportClick:true,onStartEdit:function(_e78,data){},onValueChange:function(_e79,_e7a,_e7b){},onCancel:function(_e7c){},onStopEdit:function(_e7d,_e7e,_e7f){},postCreate:function(){this.inherited(arguments);this._contentModelWatchHandle=this.contentModel.watch(this.propertyName,lang.hitch(this,"contentModelChanged"));},destroy:function(){this._contentModelWatchHandle.remove();if(this._createdEditor&&this.editorWidget){this.editorWidget.destroyRecursive();}if(this.editorWidget){this.editorWidget.parent=null;}this.blockDisplayNode=this.overlayItem=this.editorWidget=null;this.inherited(arguments);},contentModelChanged:function(name,_e80,_e81){if(!this.editing){this.set("value",_e81);}},startEdit:function(_e82){this._startEdit(_e82);},_startEdit:function(_e83){lang.mixin(this.editorParams,_e83);this.set("editing",true);this.set("isModified",false);this._lastSavedValue=this._resetValue=lang.clone(this.getEditorValue());this.isValid();this.onStartEdit(this,this.editorParams);},_stopEdit:function(_e84){this.set("editing",false);this._removeEditingFeatures();this.onStopEdit(this,this.getEditorValue(),this._resetValue,_e84);},cancel:function(){if(this.isModified){this.save(this._resetValue);}else{this.set("value",this._resetValue);}this.set("editing",false);this._removeEditingFeatures();this.onCancel(this);},save:function(val){this.set("value",val);this.set("isModified",true);this.onValueChange(this,val,this._lastSavedValue);this._lastSavedValue=lang.clone(val);},hasBeenEdited:function(){return this.editing&&(!epi.areEqual(this.getEditorValue(),this._resetValue));},hasPendingChanges:function(){return this.editing&&(!epi.areEqual(this.getEditorValue(),this._lastSavedValue));},tryToStopEditing:function(_e85){if(this.editing){if(this.isValid()){if(this.hasBeenEdited()){if(this.hasPendingChanges()){this.save(this.getEditorValue());}this._stopEdit(_e85);}else{this.cancel(_e85);}}else{this._onTryToStopWithInvalidValue();}}},_removeEditingFeatures:function(){},_onTryToStopWithInvalidValue:function(){this.set("editing",false);this._removeEditingFeatures();},_onEditorKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode===keys.ESCAPE){_e75.stop(e);this.cancel();}else{if(e.keyCode===keys.ENTER&&e.target.tagName==="INPUT"){_e75.stop(e);this.tryToStopEditing(false);}}}},_onChange:function(val){if(this.editing&&this.isValid()&&this.hasPendingChanges()){this.save(val);}},getEditorWidget:function(){return this.editorWidget;},getEditorValue:function(){var ew=this.editorWidget;if(ew){return ew.get("value");}return null;},setEditorValue:function(val){var ew=this.editorWidget;if(!this.editing&&ew&&!epi.areEqual(val,ew.get("value"))){ew.set("value",val);}},_setValueAttr:function(_e86){this.setEditorValue(_e86);this._set("value",this.getEditorValue()||_e86);},_setBlockDisplayNodeAttr:function(node){this.blockDisplayNode=null;this._set("blockDisplayNode",node);},isValid:function(){return (this.editorWidget&&this.editorWidget.isValid?this.editorWidget.isValid():true);},focus:function(){this.editorWidget.focus();setTimeout(lang.hitch(this,function(){if(this.editorWidget.focusNode&&this.editorWidget.focusNode.tagName==="INPUT"){_e77.selectInputText(this.editorWidget.focusNode);}}),0);}});});},"epi-cms/contentediting/_ValidationMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(_e87,_e88,lang){return _e88(null,{_watchHandles:null,constructor:function(){this._watchHandles=[];},destroy:function(){this._removeViewModelWatches();this.inherited(arguments);},_removeViewModelWatches:function(){_e87.forEach(this._watchHandles,function(_e89){_e89.remove();});this._watchHandles=[];},_addStateWatch:function(_e8a){var _e8b=_e8a.get("name"),_e8c=this.viewModel;var _e8d=function(){var _e8e=_e8a.get("state");if(_e8e!=="Error"){_e8c.validator.clearPropertyErrors(_e8b,_e8c.validator.validationSource.client);}else{if(_e8e==="Error"){var _e8f=_e8a.get("message")||_e8a.getErrorMessage()||"";_e8c.validator.setPropertyErrors(_e8b,[{severity:_e8c.validator.severity.error,errorMessage:_e8f}],_e8c.validator.validationSource.client);}}};this._watchHandles.push(_e8a.watch("state",_e8d));this._watchHandles.push(_e8a.watch("message",_e8d));}});});},"epi-cms/contentediting/EditingBase":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/event","dojo/_base/json","dojo/_base/lang","dojo/aspect","dojo/date/stamp","dojo/dom-attr","dojo/query","dojo/topic","dojo/when","epi/dependency","epi/datetime","epi/string","epi/shell/DestroyableByKey","epi-cms/contentediting/_View","epi-cms/contentediting/AutoSaveButton","epi-cms/contentediting/MappingManager","epi-cms/contentediting/RenderManager","epi-cms/contentediting/UpdateController","epi-cms/widget/overlay/overlayFactory","epi/i18n!epi/cms/nls/episerver.cms.contentediting"],function(_e90,_e91,_e92,_e93,_e94,json,lang,_e95,date,_e96,_e97,_e98,when,_e99,_e9a,_e9b,_e9c,_e9d,_e9e,_e9f,_ea0,_ea1,_ea2,res){return _e92([_e9d,_e9c],{toolbar:null,editorFactory:null,activePropertyOnStartup:null,createOverlays:true,_renderManager:null,_mappingManager:null,_activeEditorWrapper:null,_autoSaveButton:null,_deferredReloadHandle:null,_eventHandlers:null,_isCreatingWrapper:null,constructor:function(){this.defaultQueryParameters={epieditmode:true};},postMixInProperties:function(){this.inherited(arguments);this.editorFactory=this.editorFactory||_e99.resolve("epi.cms.contentediting.EditorFactory");this._mappingManager=new _e9f();this._eventHandlers=[];},postCreate:function(){this.inherited(arguments);this.subscribe("/epi/cms/action/disableundoredoactions",this._toggleUndoRedoActions);},destroy:function(){this._stopActiveEditorWrapper();if(this._renderManager){this._renderManager.destroy();}if(this._autoSaveButton){this._autoSaveButton.destroyRecursive();}this._mappingManager.clear();if(this.toolbar){this.toolbar=null;}this.overlay.destroyDescendants();this.inherited(arguments);},_setCommandEnabled:function(_ea3,_ea4){if(this.toolbar){this.toolbar.setItemProperty(_ea3,"disabled",!_ea4);}},onContentLinkSyncChange:function(){this.inherited(arguments);this._setButtonState();},onReloadRequired:function(){this.inherited(arguments);setTimeout(function(){this._renderManager.suspend();this._renderManager.clear();}.bind(this),0);},_setViewModelAttr:function(_ea5){if(_ea5===this.viewModel){return;}this.inherited(arguments);this.destroyByKey("viewModel");this.ownByKey("viewModel",_e91.connect(this.viewModel,"onContentChange",this,this._stopActiveEditorWrapper));this.ownByKey("viewModel",_e91.connect(this.viewModel,"onSetActiveProperty",this,this.onSetActiveProperty));this.ownByKey("viewModel",_e91.connect(this.viewModel,"onPropertyReverted",this,this._onPropertyReverted));this.ownByKey("viewModel",_e98.subscribe("/dnd/start",lang.hitch(this.viewModel,"beginOperation")));this.ownByKey("viewModel",_e98.subscribe("/dnd/stop",lang.hitch(this,function(){if(this._activeEditorWrapper){return;}this.viewModel.endOperation();})));},_stopActiveEditorWrapper:function(){if(this._activeEditorWrapper!=null){when(this._activeEditorWrapper.tryToStopEditing(),lang.hitch(this,function(){this._activeEditorWrapper=null;}));}},onSetActiveProperty:function(_ea6){},onPreviewReady:function(_ea7,doc,_ea8){if(_ea8||_ea7!==this.viewModel){this.set("viewModel",_ea7);this.setupEditMode(doc);}else{if(_ea7){this.remapEditMode(doc);}}},_setButtonState:function(){this._setCommandEnabled("reverttopublished",this.viewModel&&!this.viewModel.contentData.isPendingPublish);},setupEditMode:function(doc){this.viewModel.reload().then(lang.hitch(this,function(){this._mappingManager.clear();if(this._renderManager){this._renderManager.destroy();}this._renderManager=new _ea0();if(this.toolbar&&!this._autoSaveButton){this._autoSaveButton=new _e9e({button:this.toolbar._getWidget("autosave")});this.own(_e95.after(this._autoSaveButton,"onLayoutChanged",lang.hitch(this,function(){this.mainLayoutContainer.layout();})));}this._autoSaveButton.set("model",this.viewModel);var _ea9=lang.hitch(this,function(){this._toggleUndoRedoActions(this.viewModel.hasUndoSteps,this.viewModel.hasRedoSteps);});this.viewModel.resetNotifications();this._destroyOverlay();this.ownByKey("viewModel",this.viewModel.watch("hasUndoSteps",_ea9),this.viewModel.watch("hasRedoSteps",_ea9));_ea9();this.onReadySetupEditMode(doc);doc=null;this._setButtonState();this.onPrepareOverlayComplete();}));},remapEditMode:function(doc){this.viewModel.reload().then(lang.hitch(this,function(){this._renderManager.resume();if(doc){setTimeout(lang.hitch(this,function(){this._remapUpdateControllers(doc);this.onPrepareOverlayComplete();this._toggleUndoRedoActions(this.viewModel.hasUndoSteps,this.viewModel.hasRedoSteps);this._autoSaveButton.set("model",this.viewModel);}),1);}}));},_destroyOverlay:function(){this.destroyByKey("overlay");},onReadySetupEditMode:function(doc){this._createUpdateControllers(doc);},onSetupEditModeComplete:function(){if(this.activePropertyOnStartup){this.onSetActiveProperty(this.activePropertyOnStartup);this.activePropertyOnStartup=null;}},_getPropertyNodes:function(doc){var _eaa=_e97("[data-epi-property-name]",doc);var _eab=_e97("[data-epi-property-name] [data-epi-property-name]",doc);return _e90.filter(_eaa,function(node){return _eab.indexOf(node)===-1;});},_getEditableNodes:function(doc){if(!doc||!this.viewModel.canChangeContent()){return [];}var _eac=this._getPropertyNodes(doc);var _ead=[];_e90.forEach(_eac,function(node){var _eae=_e9b.pascalToCamel(_e96.get(node,"data-epi-property-name"));var _eaf=this.viewModel.getPropertyMetaData(_eae);if(!_eaf){return;}if(_eaf.settings&&_eaf.settings.readOnly){return;}var _eb0=_e9b.pascalToCamel(_eaf.getName());var _eb1=_e96.get(node,"data-epi-property-display-name");if(_eb1){_eaf=lang.delegate(_eaf,{displayName:_eb1});}if(_eaf!=null&&_eaf.showForEdit){var _eb2={cacheResults:true,rerenderOnCancel:false,propertyRenderSettings:_e96.get(node,"data-epi-property-rendersettings")||undefined,useMvc:_e96.has(node,"data-epi-use-mvc")?_e96.get(node,"data-epi-use-mvc").toLowerCase()==="true":false};_eb2=lang.mixin(_eb2,_eaf.additionalValues.renderSettings);var _eb3=_e96.has(node,"data-epi-property-editorsettings")?json.fromJson(_e96.get(node,"data-epi-property-editorsettings")):null;var _eb4=_e96.has(node,"data-epi-property-overlaysettings")?json.fromJson(_e96.get(node,"data-epi-property-overlaysettings")):null;_eb4=lang.mixin(_eb4,_eaf.overlaySettings);_ead.push({node:node,disabled:(_e96.get(node,"data-epi-disabled")==="true"),useOverlay:(_e96.get(node,"data-epi-useoverlay")==="true"),overlayZIndex:parseInt(_e96.get(node,"data-epi-overlay-z-index"),10)||0,property:{name:_eb0,contentLink:this.viewModel.contentLink,contentModel:this.viewModel.contentModel,type:_e96.get(node,"data-epi-property-type"),wrapperType:_e96.get(node,"data-epi-property-edittype"),editorParams:_eb3,overlayParams:_eb4,editorWidgetType:_e96.get(node,"data-epi-property-editor"),renderSettings:_eb2,rendererClass:(_e96.get(node,"data-epi-property-render")==="client")?"epi-cms/contentediting/ClientRenderer":_eaf.customEditorSettings.rendererClass,metadata:_eaf,propertyNodeName:_eae}});}},this);_ead.sort(function(a,b){if(a.overlayZIndex<b.overlayZIndex){return -1;}else{if(a.overlayZIndex>b.overlayZIndex){return 1;}else{return 0;}}});return _ead;},_createUpdateControllers:function(doc){var _eb5=this._createFullPageUpdateController(doc);if(_eb5){this._connectUpdateControllerAndOverlayEvents(_eb5,null);this._mappingManager.add({updateController:_eb5});}var _eb6=this._getEditableNodes(doc);_e90.forEach(_eb6,function(_eb7){var _eb8=_eb7.property;var _eb9=_eb7.node.innerHTML;var _eba=this._createNodeUpdateController(_eb7);when(this._createNodeOverlay(_eb7),lang.hitch(this,function(_ebb){this._connectUpdateControllerAndOverlayEvents(_eba,_ebb);this._mappingManager.add({blockPropertyInfo:_eb8,node:_eb7.node,updateController:_eba,overlayItem:_ebb});}));this._renderManager.cacheRender(_eb8.name,_eb8.renderSettings,this.viewModel.getProperty(_eb8.name),_eb9);},this);},_createNodeOverlay:function(_ebc){var _ebd=new _e93();if(!this.createOverlays){_ebd.resolve(null);return _ebd;}when(_ea2.create(_ebc),lang.hitch(this,function(_ebe){this.overlay.addChild(_ebe);_ebd.resolve(_ebe);}));return _ebd;},_createNodeUpdateController:function(_ebf){var _ec0=_ebf.property;var _ec1=_ec0.metadata;var _ec2=new _ea1({displayName:_ec1.displayName,renderManager:this._renderManager,contentModel:_ec0.contentModel,contentLink:_ec0.contentLink,modelPropertyName:_ec0.name,nodePropertyName:_ec0.propertyNodeName,renderSettings:_ec0.renderSettings,rendererClass:_ec0.rendererClass,displayNode:_ebf.node});return _ec2;},_createFullPageUpdateController:function(doc){var _ec3=[];if(doc){var _ec4=_e97("input[data-epi-full-refresh-property-names][type='hidden']",doc);_e90.forEach(_ec4,function(tag){_e90.forEach(_e96.get(tag,"data-epi-full-refresh-property-names").split(","),function(_ec5){if(!_e90.some(_ec3,function(p){return p===_ec5;})){_ec3.push(_e9b.pascalToCamel(_ec5));}});});}_e90.forEach(this.viewModel.metadata.properties,function(_ec6){if(_ec6.additionalValues["reloadOnChange"]===true){_ec3.push(_e9b.pascalToCamel(_ec6.name));}});if(!_ec3.length){return null;}var _ec7=new _ea1({displayName:"",renderManager:this._renderManager,contentModel:this.viewModel.contentModel,modelPropertyName:_ec3,renderSettings:{isFullReload:true}});return _ec7;},_remapUpdateControllers:function(doc){var _ec8=this._getEditableNodes(doc);var _ec9=this._mappingManager.remap(_ec8);_e90.forEach(_ec9,function(_eca){var _ecb=_eca.property;var _ecc=this._createNodeUpdateController(_eca);var _ecd=this._mappingManager.find(function(m){return (!m.updateController)&&(m.propertyName.indexOf(_ecb.name)===0);});when(this._createNodeOverlay(_eca),lang.hitch(this,function(_ece){this._connectUpdateControllerAndOverlayEvents(_ecc,_ece);if(_ecd&&_ecd.length){this._mappingManager.update(_ecd[0],{updateController:_ecc,overlayItem:_ece,node:_eca.node,wrapper:null});}else{this._mappingManager.add({blockPropertyInfo:_ecb,node:_eca.node,updateController:_ecc,overlayItem:_ece});}}));this._renderManager.cacheRender(_ecb.name,_ecb.renderSettings,this.viewModel.getProperty(_ecb.name),_eca.node.innerHTML);},this);var _ecf=this._createFullPageUpdateController(doc);if(_ecf){this._connectUpdateControllerAndOverlayEvents(_ecf,null);this._mappingManager.add({updateController:_ecf});}},_connectUpdateControllerAndOverlayEvents:function(_ed0,_ed1){if(_ed0){this.ownByKey("overlay",_e95.after(_ed0,"onReloadRequired",lang.hitch(this,this._onBlockReloadRequired),true),_e95.after(_ed0,"onRender",lang.hitch(this,this._onBlockRender),true));}if(_ed1){this.ownByKey("overlay",_e95.after(_ed1,"onClick",lang.hitch(this,this._onOverlayItemClick),true),_e95.after(_ed1,"onValueChange",lang.hitch(this,function(_ed2){this._onOverlayValueChange(_ed1,_ed2);}),true));}},_getEditor:function(_ed3){var _ed4=this._mappingManager.findOne("overlayItem",_ed3);return (_ed4.wrapper&&_ed4.wrapper.editorWidget)?_ed4.wrapper.editorWidget:null;},onEditorWrapperCreated:function(_ed5){},_onOverlayItemClick:function(_ed6){if(this._isCreatingWrapper){return;}this._isCreatingWrapper=true;var _ed7=this._mappingManager.findOne("overlayItem",_ed6);var _ed8=_ed7.blockPropertyInfo;var val=this.viewModel.getProperty(_ed7.propertyName);var _ed9=lang.clone(val,true);var _eda;var _edb=lang.hitch(this,function(_edc){_ed7.wrapper=_edc;this._activeEditorWrapper=_edc;_e98.publish("/epi/layout/pinnable/propertyEditor/show",null);_e90.forEach(this._mappingManager.find(),function(m){if(m.overlayItem){m.overlayItem.set("active",false);}});_ed7.overlayItem.set("active",true);var _edd={value:_ed9,parent:_edc};when(_edc.startEdit(_edd)).always(lang.hitch(this,function(){this._isCreatingWrapper=null;}));this.overlay.set("readOnly",_edc.isOverlayDisabled);this.viewModel.set("disableUndo",_edc.isUndoDisabled);});if(_ed7.wrapper){_eda=_ed7.wrapper;if(_eda&&_eda.editorWidget&&!_eda.editorWidget.overlayItem){_eda.editorWidget.overlayItem=_ed6;}_eda.set("blockDisplayNode",_ed7.node);_edb(_eda);}else{when(this._createEditorWrapper(_ed8,_ed6,_ed7.node,_ed9),lang.hitch(this,function(_ede){_edb(_ede);this.onEditorWrapperCreated(_ede);}));}},_createEditorWrapper:function(_edf,_ee0,node,_ee1){var def=new _e93(),_ee2={overlayItem:_ee0};when(this.editorFactory.createEditor(_edf,node,_ee1,_ee2),lang.hitch(this,function(_ee3){this.ownByKey("overlay",_e95.after(_ee3,"onValueChange",lang.hitch(this,this._onWrapperValueChange),true),_e95.after(_ee3,"onCancel",lang.hitch(this,this._onWrapperCancel),true),_e95.after(_ee3,"onStopEdit",lang.hitch(this,this._onWrapperStopEdit),true));def.resolve(_ee3);}),def.reject);return def;},_onBlockReloadRequired:function(_ee4){var _ee5=function(){if(this._activeEditorWrapper&&this._activeEditorWrapper.hasInlineEditor){return;}if(this._deferredReloadHandle){this._deferredReloadHandle.remove();this._deferredReloadHandle=null;}this._toggleUndoRedoActions(false,false);this.onReloadRequired();}.bind(this);if(this.viewModel.isSaved){_ee5();}else{if(!this._deferredReloadHandle){this.own(this._deferredReloadHandle=_e95.after(this.viewModel,"onPropertySaved",_ee5,true));}}},_onBlockRender:function(_ee6){var _ee7=this._mappingManager.findOne("updateController",_ee6);if(_ee7&&_ee7.overlayItem){_ee7.overlayItem.refresh();}},_saveEditorChanges:function(_ee8,data){var _ee9=this._getEditor(_ee8);if(_ee9&&!_ee9.overlayItem){_ee9.overlayItem=_ee8;}if(_ee9&&_ee9.saveChanges){_ee9.saveChanges(_ee9,data);}},_onOverlayValueChange:function(_eea,data){this._saveEditorChanges(_eea,data.value);this.viewModel.setProperty(data.propertyName,data.value);},_onWrapperValueChange:function(_eeb,_eec,_eed){var _eee=this._mappingManager.findOne("wrapper",_eeb),_eef=_eee.propertyName;if(_eee.overlayItem){_eee.overlayItem.set("updated",true);}this.viewModel.beginOperation();this.viewModel.setProperty(_eef,_eec,_eed);},_onWrapperStopEdit:function(_ef0,_ef1,_ef2,_ef3){var _ef4=this._mappingManager.findOne("wrapper",_ef0);this.viewModel.endOperation();if(_ef4.overlayItem){_ef4.overlayItem.set("active",false);}this._activeEditorWrapper=null;this.overlay.set("readOnly",false);this.viewModel.set("disableUndo",false);},_onWrapperCancel:function(_ef5,_ef6){var _ef7=this._mappingManager.findOne("wrapper",_ef5),_ef8=_ef7.updateController;this.viewModel.abortOperation();if(_ef8&&_ef8.renderSettings&&_ef8.renderSettings.rerenderOnCancel){_ef8.render();}if(_ef7.overlayItem){_ef7.overlayItem.set("active",false);}this._activeEditorWrapper=null;this.overlay.set("readOnly",false);this.viewModel.set("disableUndo",false);},_onPropertyReverted:function(_ef9,_efa){this._mappingManager.find("propertyName",_ef9).forEach(function(_efb){var _efc=_efb.wrapper,_efd;if(_efc){_efd=_efc.get("editing");_efc.set("editing",false);_efc.set("value",_efa);_efc.set("editing",_efd);}});},_toggleUndoRedoActions:function(_efe,_eff){this._setCommandEnabled("undo",!!_efe);this._setCommandEnabled("redo",!!_eff);}});});},"epi-cms/contentediting/_View":function(){define(["dojo/_base/declare","dijit/_Widget"],function(_f00,_f01){return _f00([_f01],{iframeWithOverlay:null,overlay:null,iFrame:null,layoutContainer:null,contextTypeName:null,viewModel:null,postMixInProperties:function(){this.inherited(arguments);if(this.iframeWithOverlay){this.iFrame=this.iframeWithOverlay.iframe;this.overlay=this.iframeWithOverlay.overlay;}this._viewConnections=[];},_setViewModelAttr:function(_f02){this._set("viewModel",_f02);},_setIframeWithOverlayAttr:function(_f03){this._set("iframeWithOverlay",_f03);this.iFrame=this.iframeWithOverlay.iframe;this.overlay=this.iframeWithOverlay.overlay;},onPreviewReady:function(_f04,doc){this.set("viewModel",_f04);this.onPrepareOverlayComplete();},onPrepareOverlayComplete:function(){},onContentLinkSyncChange:function(_f05,_f06){},onReloadRequired:function(){}});});},"epi-cms/contentediting/AutoSaveButton":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/string","dijit/_WidgetBase","epi/datetime","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons.autosave"],function(_f07,_f08,_f09,lang,_f0a,_f0b,_f0c,_f0d,_f0e,res){var _f0f={Saving:0,Offline:1,Saved:2};return _f09([_f0d],{_state:null,button:undefined,lastSaved:undefined,model:null,_currentlySavingClass:"epi-autosave-saving",_errorClass:"epi-autosave-error",_savedClass:"epi-autosave-saved",_hoverClass:"epi-autosave-hover",_modelHandles:null,postMixInProperties:function(){this.inherited(arguments);this._modelHandles=[];},postCreate:function(){this.inherited(arguments);if(!this.button){return;}this.connect(this.button.domNode,"onmouseover",this._addHoverClass);this.connect(this.button.domNode,"onmouseout",this._removeHoverClass);},destroy:function(){_f07.forEach(this._modelHandles,function(_f10){_f10.unwatch();});this.inherited(arguments);},_setModelAttr:function(_f11){_f07.forEach(this._modelHandles,function(_f12){_f12.unwatch();});this._set("model",_f11);if(_f11){this._modelHandles=[_f11.watch("isOnline",lang.hitch(this,"_isOnlineChanged")),_f11.watch("lastSaved",lang.hitch(this,"_lastSavedChanged")),_f11.watch("isSaved",lang.hitch(this,"_isSavedChanged")),_f11.watch("isSaving",lang.hitch(this,"_isSavingChanged")),_f11.watch("hasErrors",lang.hitch(this,"_hasErrorsChanged")),_f11.watch("disableUndo",lang.hitch(this,this._disableUndo))];this.set("lastSaved",_f11.lastSaved);if(this.lastSaved){this.updateButton();}else{this._setVisibility(false);}}},_setLastSavedAttr:function(_f13){this._set("lastSaved",_f13);this.updateLastSaveTime();},_disableUndo:function(_f14,_f15,_f16){this._isUndoDisabled=_f16;this.updateButton();},_isOnlineChanged:function(name,_f17,_f18){if(_f18===_f17){return;}if(_f18){this.revertToLastAutoSaveTime();}else{this.showOfflineStatus();}},_lastSavedChanged:function(name,_f19,_f1a){this.set("lastSaved",_f1a);},_isSavedChanged:function(name,_f1b,_f1c){if(_f1c){this.updateLastSaveTime();}},_isSavingChanged:function(name,_f1d,_f1e){if(_f1e){this.showSavingStatus();}else{if(!this.model.isSaved){this.revertToLastAutoSaveTime();}}},_hasErrorsChanged:function(name,_f1f,_f20){if(_f1f===_f20){return;}if(!_f20){this.revertToLastAutoSaveTime();}else{_f08.publish("/epi/cms/action/showerror");}},_animateSaving:function(){_f0a.replace(this.button.domNode,this._currentlySavingClass,[this._errorClass,this._savedClass]);this._removeHoverClass();},_animateOffline:function(){_f0a.replace(this.button.domNode,this._errorClass,[this._currentlySavingClass,this._savedClass]);this._removeHoverClass();},_animateSaved:function(){_f0a.replace(this.button.domNode,this._savedClass,[this._currentlySavingClass,this._errorClass]);this._removeHoverClass();},_addHoverClass:function(){if(this._state==null||this._state===_f0f.Saving||this._hasDropDownOpen()){return;}if(this._state===_f0f.Saved){_f0a.add(this.button.domNode,this._hoverClass);}},_removeHoverClass:function(){if(!this._hasDropDownOpen()){_f0a.remove(this.button.domNode,this._hoverClass);}},_updateState:function(text){this.button.set("label",text);this.button.set("disabled",this._isUndoDisabled||this._state!==_f0f.Saved);},_setVisibility:function(_f21){if(_f21!==this._visible){this._visible=_f21;if(this.button){_f0b.set(this.button.domNode,{display:_f21?"":"none"});this.button.set("itemVisibility",_f21&&!this.button.disabled);if(this.button.isInNarrowToolbar){this.onLayoutChanged();}}}},onLayoutChanged:function(){},_hasDropDownOpen:function(){return this.button._popupStateNode?_f0a.contains(this.button._popupStateNode,"dijitHasDropDownOpen"):false;},revertToLastAutoSaveTime:function(){if(this.lastSaved===undefined){this._setVisibility(false);return;}this.updateLastSaveTime();},updateLastSaveTime:function(){if(!this.lastSaved){return;}if(!this.model.isOnline){return;}setTimeout(lang.hitch(this,function(){if(this.model.isOnline){this.updateButton();this._animateSaved();}}),1000);this._setVisibility(true);},showSavingStatus:function(){this._state=_f0f.Saving;this._updateState(res.savinglabel);this._animateSaving();},showOfflineStatus:function(){this._state=_f0f.Offline;this._updateState(res.offlinelabel);this._animateOffline();},updateButton:function(){if(!this.lastSaved||!this.model.canChangeContent()||(this.model.contentData&&this.model.contentData.isDeleted)){this._setVisibility(false);return;}this._state=_f0f.Saved;var _f22="<span class=\"dijitReset dijitInline clearfix\">${autosavelabel} ${timestamp}</span>&nbsp;<span class=\"epi-inlineButtonLink\">${undolabel}</span>";var _f23={autosavelabel:res.autosavelabel,undolabel:this.model.undoManager.get("hasUndoSteps")&&!this._isUndoDisabled?res.undolabel:"",timestamp:_f0e.toUserFriendlyHtml(this.lastSaved,null,true)};this._updateState(_f0c.substitute(_f22,_f23));}});});},"epi-cms/contentediting/MappingManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/connect","dojo/dom-attr","dojox/encoding/digests/SHA1"],function(_f24,lang,_f25,json,_f26,_f27,SHA1){return _f24(null,{_mappings:null,domUtils:null,attrNames:["data-epi-property-name","data-epi-property-display-names","data-epi-property-customsettings-customtag","data-epi-use-mvc","data-epi-disabled","data-epi-useoverlay","data-epi-overlay-z-index","data-epi-property-type","data-epi-property-edittype","data-epi-property-editorsetting","data-epi-property-editor","data-epi-property-render"],constructor:function(){this._mappings=[];this.domUtils=_f27;},clear:function(){var _f28;try{while((_f28=this._mappings.pop())){for(var prop in _f28){if(_f28[prop]){if(prop!=="node"){if(lang.isFunction(_f28[prop].destroyRecursive)){_f28[prop].destroyRecursive();}else{if(lang.isFunction(_f28[prop].destroy)){_f28[prop].destroy();}else{if(lang.isFunction(_f28[prop].remove)){_f28[prop].remove();}}}}_f28[prop]=null;}}}}catch(ex){console.error(ex);}},_calculateNodeHash:function(node){if(!node){return "";}var _f29=_f25.map(this.attrNames,lang.hitch(this,function(n){return this.domUtils.get(node,n)||"";}));return SHA1(json.toJson(_f29));},update:function(_f2a,_f2b){lang.mixin(_f2a,_f2b);if(_f2b.node){_f2a.nodeHash=this._calculateNodeHash(_f2b.node);}},add:function(item){if(item.node){item.nodeHash=this._calculateNodeHash(item.node);}if(item.blockPropertyInfo&&!item.propertyName){item.propertyName=item.blockPropertyInfo.name;}this._mappings.push(item);},_tryRemapNode:function(item,_f2c){if(this._calculateNodeHash(_f2c.node)===item.nodeHash){item.node=_f2c.node;item.updateController.displayNode=_f2c.node;item.updateController.checkEmptyHtml();if(item.overlayItem){item.overlayItem.set("disabled",false);item.overlayItem.set("sourceItemNode",_f2c.node);item.overlayItem.refresh();}return {success:true,mappedNode:_f2c};}return {success:false};},remap:function(_f2d){var _f2e=[];var _f2f=(_f2d!=null?_f2d.slice(0):[]);_f25.forEach(this._mappings,lang.hitch(this,function(item){if(!item.updateController){return;}var _f30=null;var _f31=_f25.some(_f2f,lang.hitch(this,function(_f32){var _f33=this._tryRemapNode(item,_f32);_f30=_f30||_f33.mappedNode;return _f33.success;}));if(_f31){if(_f30){_f2f.splice(_f25.indexOf(_f2f,_f30),1);}}else{item.updateController.destroy();delete item.updateController;if(item.overlayItem){item.overlayItem.destroy();delete item.overlayItem;}delete item.node;delete item.nodeHash;}if(this._isEmpty(item)){_f2e.push(item);}if(item.wrapper&&item.node){item.wrapper.set("blockDisplayNode",item.node);}}));var _f34;while((_f34=_f2e.pop())){this._mappings.splice(_f25.indexOf(this._mappings,_f34),1);}return _f2f;},_isEmpty:function(_f35){for(var _f36 in _f35){if(_f35.hasOwnProperty(_f36)){return false;}}return true;},findOne:function(_f37,_f38){var _f39;_f25.some(this._mappings,function(m){if(m[_f37]===_f38){_f39=m;return true;}});return _f39;},find:function(){var _f3a;if(arguments[0]===undefined){return this._mappings;}else{if(lang.isFunction(arguments[0])){_f3a=arguments[0];}else{var _f3b=arguments[0],_f3c=arguments[1];_f3a=function(m){return m[_f3b]===_f3c;};}}return _f25.filter(this._mappings,_f3a);}});});},"dojox/encoding/digests/SHA1":function(){define("dojox/encoding/digests/SHA1",["./_base"],function(dxd){var _f3d=8,mask=(1<<_f3d)-1;function R(n,c){return (n<<c)|(n>>>(32-c));};function FT(t,b,c,d){if(t<20){return (b&c)|((~b)&d);}if(t<40){return b^c^d;}if(t<60){return (b&c)|(b&d)|(c&d);}return b^c^d;};function KT(t){return (t<20)?1518500249:(t<40)?1859775393:(t<60)?-1894007588:-899497514;};function core(x,len){x[len>>5]|=128<<(24-len%32);x[((len+64>>9)<<4)+15]=len;var w=new Array(80),a=1732584193,b=-271733879,c=-1732584194,d=271733878,e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d,olde=e;for(var j=0;j<80;j++){if(j<16){w[j]=x[i+j];}else{w[j]=R(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);}var t=dxd.addWords(dxd.addWords(R(a,5),FT(j,b,c,d)),dxd.addWords(dxd.addWords(e,w[j]),KT(j)));e=d;d=c;c=R(b,30);b=a;a=t;}a=dxd.addWords(a,olda);b=dxd.addWords(b,oldb);c=dxd.addWords(c,oldc);d=dxd.addWords(d,oldd);e=dxd.addWords(e,olde);}return [a,b,c,d,e];};function hmac(data,key){var wa=_f3e(key);if(wa.length>16){wa=core(wa,key.length*_f3d);}var ipad=new Array(16),opad=new Array(16);for(var i=0;i<16;i++){ipad[i]=wa[i]^909522486;opad[i]=wa[i]^1549556828;}var hash=core(ipad.concat(_f3e(data)),512+data.length*_f3d);return core(opad.concat(hash),512+160);};function _f3e(s){var wa=[];for(var i=0,l=s.length*_f3d;i<l;i+=_f3d){wa[i>>5]|=(s.charCodeAt(i/_f3d)&mask)<<(32-_f3d-i%32);}return wa;};function _f3f(wa){var h="0123456789abcdef",s=[];for(var i=0,l=wa.length*4;i<l;i++){s.push(h.charAt((wa[i>>2]>>((3-i%4)*8+4))&15),h.charAt((wa[i>>2]>>((3-i%4)*8))&15));}return s.join("");};function _f40(wa){var s=[];for(var i=0,l=wa.length*32;i<l;i+=_f3d){s.push(String.fromCharCode((wa[i>>5]>>>(32-_f3d-i%32))&mask));}return s.join("");};function _f41(wa){var p="=",tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=[];for(var i=0,l=wa.length*4;i<l;i+=3){var t=(((wa[i>>2]>>8*(3-i%4))&255)<<16)|(((wa[i+1>>2]>>8*(3-(i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*(3-(i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>wa.length*32){s.push(p);}else{s.push(tab.charAt((t>>6*(3-j))&63));}}}return s.join("");};dxd.SHA1=function(data,_f42){var out=_f42||dxd.outputTypes.Base64;var wa=core(_f3e(data),data.length*_f3d);switch(out){case dxd.outputTypes.Raw:return wa;case dxd.outputTypes.Hex:return _f3f(wa);case dxd.outputTypes.String:return _f40(wa);default:return _f41(wa);}};dxd.SHA1._hmac=function(data,key,_f43){var out=_f43||dxd.outputTypes.Base64;var wa=hmac(data,key);switch(out){case dxd.outputTypes.Raw:return wa;case dxd.outputTypes.Hex:return _f3f(wa);case dxd.outputTypes.String:return _f40(wa);default:return _f41(wa);}};return dxd.SHA1;});},"dojox/encoding/digests/_base":function(){define("dojox/encoding/digests/_base",["dojo/_base/lang"],function(lang){var d=lang.getObject("dojox.encoding.digests",true);d.outputTypes={Base64:0,Hex:1,String:2,Raw:3};d.addWords=function(a,b){var l=(a&65535)+(b&65535);var m=(a>>16)+(b>>16)+(l>>16);return (m<<16)|(l&65535);};var _f44=8;var mask=(1<<_f44)-1;d.stringToWord=function(s){var wa=[];for(var i=0,l=s.length*_f44;i<l;i+=_f44){wa[i>>5]|=(s.charCodeAt(i/_f44)&mask)<<(i%32);}return wa;};d.wordToString=function(wa){var s=[];for(var i=0,l=wa.length*32;i<l;i+=_f44){s.push(String.fromCharCode((wa[i>>5]>>>(i%32))&mask));}return s.join("");};d.wordToHex=function(wa){var h="0123456789abcdef",s=[];for(var i=0,l=wa.length*4;i<l;i++){s.push(h.charAt((wa[i>>2]>>((i%4)*8+4))&15)+h.charAt((wa[i>>2]>>((i%4)*8))&15));}return s.join("");};d.wordToBase64=function(wa){var p="=",tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=[];for(var i=0,l=wa.length*4;i<l;i+=3){var t=(((wa[i>>2]>>8*(i%4))&255)<<16)|(((wa[i+1>>2]>>8*((i+1)%4))&255)<<8)|((wa[i+2>>2]>>8*((i+2)%4))&255);for(var j=0;j<4;j++){if(i*8+j*6>wa.length*32){s.push(p);}else{s.push(tab.charAt((t>>6*(3-j))&63));}}}return s.join("");};return d;});},"epi-cms/contentediting/RenderManager":function(){define(["dojo","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/_base/json","dojo/_base/array","epi","epi/dependency","epi/datetime","dojox/encoding/digests/SHA1","dojo/Stateful","epi-cms/contentediting/PropertyRenderer"],function(dojo,_f45,lang,_f46,json,_f47,epi,_f48,_f49,SHA1,_f4a,_f4b){return _f45([_f4a],{_cache:null,_queue:null,defaultRenderer:null,_rendererPool:{},rendering:false,processQueueOnRenderValue:true,numberOfItemsInQueue:0,numberOfItemsRendering:0,concurrentProcessedItems:2,processInterval:200,_processIntervalId:0,_itemsBeingRendered:null,viewSettingsManager:null,_viewSettingsToCopy:["visitorgroup"],constructor:function(_f4c){this._cache={};this._queue=[];this._itemsBeingRendered={};lang.mixin(this,_f4c);this.defaultRenderer=this.defaultRenderer||new _f4b();},postscript:function(){this.viewSettingsManager=this.viewSettingsManager||_f48.resolve("epi.viewsettingsmanager");},destroy:function(){this._stopRenderingInterval();this._isDestroyed=true;for(var i in this._cache){delete this._cache[i];}for(var j in this._itemsBeingRendered){delete this._itemsBeingRendered[j];}this._cache=null;this._itemsBeingRendered=null;this._queue=null;this.inherited(arguments);},_getRenderer:function(_f4d){var def=new _f46();if(_f4d){if(this._rendererPool[_f4d]){return this._rendererPool[_f4d];}else{require([_f4d],function(_f4e){def.resolve(new _f4e());});}}else{return this.defaultRenderer;}return def;},renderValue:function(_f4f,_f50,_f51,_f52,_f53){var def;if(this._isSuspending){def=new _f46();def.cancel();return def;}_f51=_f49.transformDate(_f51);_f52=this.cloneAndCompleteRenderSettings(_f52||{});var _f54=this._get(_f50,_f52,_f51);if(_f54){def=new _f46();def.resolve(_f54);}else{if(_f52&&_f52.isFullReload){def=new _f46();def.resolve({doReload:true});}else{def=new _f46();_f46.when(this._getRenderer(_f53),lang.hitch(this,function(_f55){if(!_f55){_f55=this.defaultRenderer;}_f46.when(this._queueItem(_f55,_f4f,_f50,_f52,_f51),function(_f56){def.resolve(_f56);});if(this.processQueueOnRenderValue&&!this._isSuspending){this._startRenderingInterval();}}));}}return def;},cloneAndCompleteRenderSettings:function(_f57){_f57.propertyRenderSettings=_f57.propertyRenderSettings||"";var _f58=lang.clone(_f57);if(this.viewSettingsManager.get("enabled")){_f47.forEach(this.viewSettingsManager.getRenderingViewSettings(),lang.hitch(this,function(_f59){if(_f59.get("enabled")){var _f5a=this.viewSettingsManager.getSettingProperty(_f59.key);if(_f5a){this.updateRenderSettings(_f58,_f5a,_f59.key,_f59.isTagItem);}}}));}return _f58;},updateRenderSettings:function(_f5b,_f5c,key,_f5d){var _f5e=[],_f5f=[],_f60="",_f61=(_f5d?"tag":key),_f62=!_f5d,data=null;if(_f5d){_f5b.propertyRenderSettings=_f5b.propertyRenderSettings||"";data=(_f5b.propertyRenderSettings?dojo.fromJson(_f5b.propertyRenderSettings):{});}else{data=(_f5b?_f5b:{});}if(!data[_f61]||_f62){_f60=_f5c;}else{_f5e=data[_f61].split(",");_f47.forEach(_f5e,function(item,idx){item=lang.trim(item);if(item.toLowerCase()!==_f5c.toLowerCase()){_f5f.push(item);}});_f5f.push(_f5c);_f60=_f5f.join(", ");}data[_f61]=_f60;if(_f5d){_f5b.propertyRenderSettings=dojo.toJson(data);}},processQueue:function(){if(this._isSuspending){return;}if(this._queue.length===0){this._stopRenderingInterval();return;}if(this.numberOfItemsRendering>=this.concurrentProcessedItems){return;}var _f63=this._nextItemToProcessIndex();while(_f63>=0&&this.numberOfItemsRendering<this.concurrentProcessedItems){this._processItemInQueue(_f63);_f63=this._nextItemToProcessIndex();}},suspend:function(){if(this._isSuspending){return;}this._isSuspending=true;this._stopRenderingInterval();},clear:function(){this.set("numberOfItemsRendering",0);for(var key in this._itemsBeingRendered){this._itemsBeingRendered[key].deferred.cancel();delete this._itemsBeingRendered[key];}this._itemsBeingRendered={};this.set("numberOfItemsInQueue",0);for(var i=this._queue.length-1;i>=0;i--){delete this._queue[i];}this._queue=[];},resume:function(){if(!this._isSuspending){return;}this._isSuspending=false;this._startRenderingInterval();},_nextItemToProcessIndex:function(){var _f64=-1;var i=0;while(i<this._queue.length&&_f64===-1){var item=this._queue[i];var key=this._getRenderHash(item.propertyName,item.renderSettings);if(!(key in this._itemsBeingRendered)){_f64=i;}i++;}return _f64;},_processItemInQueue:function(_f65){var item=this._queue.splice(_f65,1)[0];this.set("numberOfItemsRendering",this.numberOfItemsRendering+1);this.set("numberOfItemsInQueue",this._queue.length);var key=this._getRenderHash(item.propertyName,item.renderSettings);this._itemsBeingRendered[key]=item;this.set("rendering",true);var _f66=lang.hitch(this,function(_f67){if(this._isDestroyed){item.deferred.cancel();return;}if(_f67&&_f67.innerHtml){this._put(item.propertyName,item.renderSettings,item.value,{doReload:_f67.doReload,innerHtml:_f67.innerHtml});}delete this._itemsBeingRendered[key];this.set("numberOfItemsRendering",this.numberOfItemsRendering-1);this.set("rendering",false);item.deferred.resolve(_f67);});var _f68=lang.hitch(this,function(err){if(this._isDestroyed){item.deferred.cancel();return;}delete this._itemsBeingRendered[key];this.set("numberOfItemsRendering",this.numberOfItemsRendering-1);this.set("rendering",false);item.deferred.reject(err);});_f46.when(item.renderer.render(item.contentLink,item.propertyName,item.value,item.renderSettings),_f66,_f68);},cacheRender:function(_f69,_f6a,_f6b,_f6c){var data={innerHtml:_f6c,doReload:false};this._put(_f69,_f6a,_f6b,data);},_queueItem:function(_f6d,_f6e,_f6f,_f70,_f71){var key=this._getRenderHash(_f6f,_f70);var _f72;var _f73=this._itemsBeingRendered[key];if(_f73&&!_f73.deferred.fired&&_f73.value===_f71){_f72=_f73.deferred;}else{var _f74=this._queueIndex(_f6d,_f6e,_f6f,_f70,_f71);if(_f74<0){_f72=new _f46();this._queue.push({contentLink:_f6e,renderer:_f6d,propertyName:_f6f,renderSettings:_f70,renderSettingsString:json.toJson(_f70),value:_f71,deferred:_f72});this.set("numberOfItemsInQueue",this._queue.length);}else{var item=this._queue[_f74];item.contentLink=_f6e;item.renderer=_f6d;item.value=_f71;_f72=item.deferred;}}return _f72;},_startRenderingInterval:function(){if(!this._processIntervalId){this.processQueue();this._processIntervalId=setInterval(lang.hitch(this,function(){this.processQueue();}),this.processInterval);}},_stopRenderingInterval:function(){if(this._processIntervalId){clearInterval(this._processIntervalId);this._processIntervalId=0;}this.set("rendering",false);},_getRenderHash:function(_f75,_f76){return SHA1(json.toJson({p:_f75,r:_f76}));},_queueIndex:function(_f77,_f78,_f79,_f7a,_f7b){var _f7c=-1;var _f7d=json.toJson(_f7a);_f47.some(this._queue,function(item,i){if((item.propertyName===_f79)&&(item.renderSettingsString===_f7d)){_f7c=i;return true;}});return _f7c;},_put:function(_f7e,_f7f,_f80,data){if(!_f7f.cacheResults){return;}var _f81=this._getCacheHash(_f7e,_f7f,_f80);if(!this._cache){this._cache={};}this._cache[_f81]={data:data};},_get:function(_f82,_f83,_f84){var _f85=this._getCacheHash(_f82,_f83,_f84);var _f86=this._cache[_f85];return (_f86?_f86.data:undefined);},_getCacheHash:function(_f87,_f88,_f89){return SHA1(json.toJson({p:_f87,r:_f88,v:_f89}));}});});},"epi-cms/contentediting/PropertyRenderer":function(){define(["dojo/_base/json","dojo/_base/declare","epi","epi/dependency","epi/shell/XhrWrapper","epi-cms/contentediting/_Renderer","epi-cms/core/ContentReference","epi/routes","dojo/string"],function(json,_f8a,epi,_f8b,_f8c,_f8d,_f8e,_f8f,_f90){return _f8a([_f8d],{_routes:_f8f,_xhrHandler:null,_profile:null,constructor:function(){if(!this._routes){this._routes=epi.routes;}if(!this._xhrHandler){this._xhrHandler=new _f8c();}this._profile=this._profile||_f8b.resolve("epi.shell.Profile");},render:function(_f91,_f92,_f93,_f94){var _f95=_f8e.toContentReference(_f91);var url=null;if(_f94.useMvc){url=this._routes.getActionPath({moduleArea:"CMS",controller:"PropertyRender",action:"Render",epieditmode:true,visitorgroupsByID:_f94.visitorgroup,epslanguage:this._profile?this._profile.contentLanguage:""});}else{url=this._routes.getActionPath({moduleArea:"LegacyCMS",path:"edit/RenderProperty.aspx",id:_f95.toString(),epieditmode:true,visitorgroupsByID:_f94.visitorgroup,epslanguage:this._profile?this._profile.contentLanguage:""});}var _f96={propertyName:_f92,propertyValue:json.toJson(_f93),id:_f95.toString(),renderSettings:""};if(_f94&&_f94.propertyRenderSettings){_f96.renderSettings=_f94.propertyRenderSettings;}return this._xhrHandler.xhrPost({url:url,handleAs:"json",content:_f96});}});});},"epi-cms/contentediting/_Renderer":function(){define(["epi","dojo"],function(epi,dojo){return dojo.declare(null,{constructor:function(_f97){dojo.mixin(this,_f97);},render:function(_f98,_f99,_f9a,_f9b){throw new Error("Abstract method _render must be overridden in a derived class");}});});},"epi-cms/contentediting/UpdateController":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/dom-attr","dijit"],function(dojo,_f9c,_f9d,lang,_f9e,_f9f,_fa0,_fa1,_fa2){return _f9d(null,{_showEmptyNode:true,_hasEmptyHtml:false,emptyValue:"&nbsp;",minWidth:18,minHeight:14,displayNode:null,contentModel:null,contentLink:null,modelPropertyName:null,nodePropertyName:null,renderManager:null,displayName:null,renderSettings:null,rendererClass:null,constructor:function(_fa3){dojo.mixin(this,_fa3);},postscript:function(){if(this.contentModel){this._modelWatchHandle=[];dojo.forEach(dojo.isArray(this.modelPropertyName)?this.modelPropertyName:[this.modelPropertyName],dojo.hitch(this,function(_fa4){this._modelWatchHandle.push(this.contentModel.watch(_fa4,dojo.hitch(this,this._renderNode)));}));}this.checkEmptyHtml();},destroy:function(){_f9c.forEach(this._modelWatchHandle,function(_fa5){_fa5.remove();});dojo.disconnect(this._renderDisplayNodeConnect);delete this.srcNodeRef;delete this.displayNode;this.inherited(arguments);},onReloadRequired:function(_fa6){},onRender:function(_fa7){},_renderNode:function(_fa8,_fa9,_faa){var _fab=this.contentLink;var _fac=this.renderSettings;var _fad=this.rendererClass;var _fae=this.nodePropertyName||this.modelPropertyName;var def=this.renderManager.renderValue(_fab,_fae,_faa,_fac,_fad);if(def!==this._lastRenderDeferred){this._lastRenderDeferred=def;dojo.when(def,dojo.hitch(this,function(_faf){if(this._lastRenderDeferred){if(_faf.doReload!==undefined&&_faf.doReload){this.onReloadRequired(this);}else{if(dojo.isString(_faf)){this._updateRendering(_faf);}else{if(_faf.innerHtml!==undefined){this._updateRendering(_faf.innerHtml,_faf.attributes);}else{if(_faf.error!==undefined){this._handleValidationError(_faf.error);}}}}if(def===this._lastRenderDeferred){this._lastRenderDeferred=null;}}}));}},_isEmptyHtml:function(_fb0){var html="";if(!_fb0){return false;}if(_fb0.tagName==="IMG"){html=dojo.attr(_fb0,"src")||"";}else{html=_fb0.innerHTML;}html=html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");return (typeof html=="string")&&(html.replace(/\s*/g,"").length===0);},checkEmptyHtml:function(){var _fb1;if(!this._showEmptyNode){return;}_fb1=this._isEmptyHtml(this.displayNode);if(_fb1){this.displayNode.innerHTML=dojo.string.substitute(this.emptyValue,this);}this._ensureSize();},_ensureSize:function(){try{this._clearComputedStyle();this._computeStyle();}catch(e){console.warn("Could not get or set domStyle for displayNode",e);}},_clearComputedStyle:function(){var _fb2=this._originalStyle;if(_fb2){for(var prop in _fb2){if(_fb2.hasOwnProperty(prop)){_f9f.set(this.displayNode,prop,this._originalStyle[prop]);}}this._originalStyle=null;}},_computeStyle:function(){var node=this.displayNode,_fb3=node&&_f9f.get(node);if(!_fb3){return;}var _fb4={minWidth:_f9f.toPixelValue(node,_fb3.minWidth),minHeight:_f9f.toPixelValue(node,_fb3.minHeight),display:_fb3.display},_fb5={},_fb6=_fb4.minHeight===0,_fb7=_fb4.minWidth===0,_fb8=_fb4.display==="inline",_fb9=_fa0.getMarginBox(node,_fb3);if(_fb9.h<(_fb6?this.minHeight:_fb4.minHeight)||_fb9.w<(_fb7?this.minWidth:_fb4.minWidth)){if(_fb6){_fb5.minHeight=this.minHeight+"px";}if(_fb7){_fb5.minWidth=this.minWidth+"px";}if(_fb8){_fb5.display="inline-block";}if(_fb8||_fb6||_fb7){this._originalStyle=_fb4;_f9f.set(node,_fb5);}}},_updateRendering:function(_fba,_fbb){this.displayNode.innerHTML=_fba;if(_fbb){_f9c.forEach(_fbb,lang.hitch(this,function(_fbc){this._updateAttribute(_fbc);}));}this._hasEmptyHtml=this._isEmptyHtml(this.displayNode);if(this._hasEmptyHtml){this.checkEmptyHtml();if(!this._showEmptyNode){_f9f.set(this.displayNode,"display","none");}}else{if(this._showEmptyNode){this._ensureSize();}}this.onRender(this);},_updateAttribute:function(_fbd){if(_fbd.name.toLowerCase()==="class"){_f9e.add(this.displayNode,_fbd.value);}else{_fa1.set(this.displayNode,_fbd.name,_fbd.value);}},_handleValidationError:function(_fbe){},render:function(){var val=this.contentModel.get(this.modelPropertyName);this._renderNode(this.modelPropertyName,val,val);},focus:function(){_fa2.focus(this.displayNode);},setShowEmptyNode:function(val){this._showEmptyNode=val;if(this._hasEmptyHtml){this._updateRendering("");}}});});},"epi-cms/widget/overlay/overlayFactory":function(){define(["dojo/_base/lang","dojo/_base/Deferred","epi-cms/widget/overlay/Property"],function(lang,_fbf){return {defaultType:"epi-cms/widget/overlay/Property",create:function(_fc0){var _fc1=new _fbf();var _fc2=_fc0.property.metadata.overlaySettings&&_fc0.property.metadata.overlaySettings.customType;var _fc3=_fc0.property,_fc4=_fc2||this.defaultType,_fc5={},_fc6=_fc3.metadata&&_fc3.metadata.settings||{};_fc5.allowedTypes=_fc6.allowedTypes||[];_fc5.restrictedTypes=_fc6.restrictedTypes||[];require([_fc4],lang.hitch(this,function(_fc7){var _fc8=lang.mixin({name:_fc3.name,contentModel:_fc3.contentModel,displayName:_fc3.metadata.displayName,disabled:_fc0.disabled,sourceItemNode:_fc0.node},_fc3.overlayParams,_fc5);var _fc9=new _fc7(_fc8);_fc1.resolve(_fc9);}));return _fc1;}};});},"epi-cms/widget/overlay/Property":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/string","epi/shell/widget/overlay/Item"],function(_fca,lang,_fcb,Item){return _fca([Item],{onValueChange:function(_fcc){},_getRightProperty:function(){var _fcd=this.name;if(this.dndTargetPropertyName){_fcd+=("."+_fcb.pascalToCamel(this.dndTargetPropertyName));}return _fcd;},onDrop:function(_fce,_fcf){var _fd0=this._getRightProperty();function _fd1(_fd2){if(!_fd2){return [];}if(!(_fd2 instanceof Array)){return [_fd2];}return _fd2;};if(this.dndTargetPropertyAllowMultiple===true){var _fd3=_fd1(lang.clone(this.contentModel.get(_fd0)));_fd1(_fcf).forEach(function(item){_fd3.push(item);});_fcf=_fd3;}this.onValueChange({propertyName:_fd0,value:_fcf});}});});},"epi-cms/compare/views/AllPropertiesCompareView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","../viewmodels/AllPropertiesCompareViewModel","../AllPropertiesTransformer","../FormField","epi/shell/widget/FormContainer","epi-cms/contentediting/FormEditing","epi/shell/widget/_ModelBindingMixin"],function(_fd4,lang,_fd5,when,_fd6,_fd7,_fd8,_fd9,_fda,_fdb){return _fd4([_fda,_fdb],{modelBindingMap:{comparison:["comparison"],rightMetadata:["rightMetadata"]},postMixInProperties:function(){this.inherited(arguments);this._groupMap={};this.own(this.model=new _fd6({model:this.model}));},removeForm:function(form){var _fdc=form.containerLayout.selectedChildWidget;if(_fdc){this._selectedTabName=_fdc.name.toLowerCase();}this._groupMap={};this._mappingManager.clear();return this.inherited(arguments);},_createForm:function(){return new _fd9(lang.mixin({readOnly:!this.viewModel.canChangeContent(),metadata:this.viewModel.metadata,metadataTransformer:new _fd7({model:this.model}),baseClass:"epi-cmsEditingForm epi-form-container epi-form-container--compare"},this.formSettings));},_setupForm:function(){this.inherited(arguments);var _fdd=this._groupMap[this._selectedTabName];if(_fdd){this._form.containerLayout.selectChild(_fdd);}},_setComparisonAttr:function(_fde){this._set("comparison",_fde);for(var _fdf in this._groupMap){var _fe0=this._groupMap[_fdf];var _fe1=(_fde&&_fde[_fdf]&&_fde[_fdf].length)||0;this._setGroupTitleWithChanges(_fe0,_fe1);}},_setRightMetadataAttr:function(_fe2){this._set("rightMetadata",_fe2);if(!this._started){return;}this._removeAndDestroyForm();if(_fe2&&this.model.leftMetadata&&this.viewModel){this._setupForm();}},onGroupCreated:function(_fe3,_fe4,_fe5){this.inherited(arguments);if(_fe5){return;}var name=_fe3.toLowerCase(),_fe6=this.comparison;_fe4.groupName=_fe3;this._groupMap[name]=_fe4;this._setGroupTitleWithChanges(_fe4,_fe6&&_fe6[name]&&_fe6[name].length);},_setViewModelAttr:function(_fe7){this.inherited(arguments);this.model.set("contentViewModel",this.viewModel);},_setGroupTitleWithChanges:function(_fe8,_fe9){var _fea=_fe8.params.title;if(_fe9){_fea=lang.replace("{0}<span class=\"epi-compare-tab--has-changes\">{1}</span>",[_fea,_fe9]);}_fe8.set("title",_fea);}});});},"epi-cms/compare/viewmodels/AllPropertiesCompareViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","epi","epi/dependency","epi/string","epi-cms/core/ContentReference","dojo/Stateful","dijit/Destroyable"],function(_feb,lang,_fec,when,epi,_fed,_fee,_fef,_ff0,_ff1){return _feb([_ff0,_ff1],{_metadataManager:null,contentViewModel:null,leftMetadata:null,leftPropertyMap:null,rightMetadata:null,rightPropertyMap:null,postscript:function(){this.inherited(arguments);this._metadataManager=this._metadataManager||_fed.resolve("epi.shell.MetadataManager");this.initialize();},initialize:function(){var _ff2=lang.hitch(this,function(name,_ff3,_ff4){if(!_ff4||(_ff3&&_ff3.contentLink===_ff4.contentLink)){return;}when(this._metadataManager.getMetadataForType("EPiServer.Core.ContentData",{contentLink:_ff4.contentLink}),lang.hitch(this,function(_ff5){this.set("rightMetadata",_ff5);}));});_ff2("rightVersion",null,this.model.rightVersion);this.own(this.model.watch("rightVersion",_ff2),this.model.watch("contentLink",lang.hitch(this,function(name,_ff6,_ff7){if(!_fef.compareIgnoreVersion(_ff6,_ff7)){this.set({leftMetadata:null,leftPropertyMap:null,rightMetadata:null,rightPropertyMap:null});}})));},generateComparison:function(){var _ff8={},_ff9=this.rightMetadata;if(!this.leftPropertyMap||!this.rightPropertyMap){this.set("comparison",null);return;}_ff9.groups.forEach(function(_ffa){_ff8[_ffa.name.toLowerCase()]=[];});_ff9.properties.forEach(lang.hitch(this,function(_ffb){this._addPropertyToComparison(_ff8,_ffb,_ffb.groupName);}));this.set("comparison",_ff8);},copy:function(_ffc){if(!_ffc){throw new Error("propertyName is required");}var _ffd=this.contentViewModel,_ffe=lang.getObject(_ffc,false,this.rightPropertyMap);if(_ffd&&_ffe!==undefined){_ffd.setProperty(_ffc,lang.clone(_ffe));_ffd.save();}},_addPropertyToComparison:function(_fff,_1000,_1001,_1002){var _1003=_fee.pascalToCamel((_1002||"")+_1000.name),_1004=lang.getObject(_1003,false,this.leftPropertyMap),_1005=lang.getObject(_1003,false,this.rightPropertyMap);if(_1000.showForEdit&&!epi.areEqual(_1004,_1005)){if(_1000.properties.length){_1000.properties.forEach(lang.hitch(this,function(_1006){this._addPropertyToComparison(_fff,_1006,_1001,_1003+".");}));}else{_fff[_1001.toLowerCase()].push(_1003.toLowerCase());}}},_contentViewModelSetter:function(_1007){this.contentViewModel=_1007;this.set({leftMetadata:_1007.metadata,leftPropertyMap:_1007.contentData.properties});this.own(_1007.watch("contentData",lang.hitch(this,function(name,_1008,_1009){this.set("leftPropertyMap",_1009.properties);})),_fec.after(_1007,"onPropertySaved",lang.hitch(this,"_onPropertySaved"),true));},_leftPropertyMapSetter:function(_100a){this.leftPropertyMap=lang.clone(_100a);this.generateComparison();},_rightPropertyMapSetter:function(_100b){this.rightPropertyMap=lang.clone(_100b);this.generateComparison();},_rightMetadataSetter:function(_100c){this.rightMetadata=_100c;if(this.rightMetadata){when(this.model.contentDataStore.get(this.model.rightVersion.contentLink)).then(lang.hitch(this,function(_100d){this.set("rightPropertyMap",_100d.properties);}));}},_onPropertySaved:function(_100e,value){var _100f=this.comparison;if(this.leftPropertyMap){lang.setObject(_100e,value,this.leftPropertyMap);}if(!_100f){return;}var _1010=this.rightMetadata.getPropertyMetadata(_100e.split(".")[0]),_1011=this.rightMetadata.getPropertyMetadata(_100e),_1012=this.rightPropertyMap&&lang.getObject(_100e,false,this.rightPropertyMap);if(!_1011.showForEdit){return;}var group=_100f[_1010.groupName.toLowerCase()],name=_100e.toLowerCase(),index=group.indexOf(name),_1013=epi.areEqual(value,_1012);if(index>=0&&_1013){group.splice(index,1);}else{if(index<0&&!_1013){group.splice(0,0,name);}}this.set("comparison",_100f);}});});},"epi-cms/compare/AllPropertiesTransformer":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/string","epi/shell/MetadataTransformer","epi/i18n!epi/cms/nls/episerver.cms.compare"],function(_1014,lang,_1015,_1016,res){return _1014([_1016],{model:null,_map:null,_getProperty:function(_1017){function _1018(map,_1019,path){_1019.forEach(function(_101a){var name=(!path?_101a.name:path+"."+_101a.name).toLowerCase();map[name]=_101a;_101a.properties.length&&_1018(map,_101a.properties,name);});return map;};if(!this.model.rightMetadata){return null;}if(!this._map){this._map=_1018({},this.model.rightMetadata.properties);}return this._map[_1017.toLowerCase()];},_getComponentDefinitions:function(_101b,_101c,_101d,_101e,_101f){if(_101c instanceof Array){var _1020=this.defaultSingleGroupType;_101c.forEach(function(group){if(group.name==="EPiServerCMS_SettingsPanel"){delete group.options.region;group.options.title=res.settingspaneltabname;group.uiType=_1020;}});}return this.inherited(arguments);},_createPropertyWidget:function(_1021,_1022,_1023,_1024){var _1025=this.inherited(arguments),_1026=this._getProperty(_1022+_1021.name),_1027;_1025.settings._hint="compare";_1025.settings.groupName=_1021.groupName;if(_1026){var _1028=_1015.pascalToCamel(_1022+_1021.name),value=this.model&&lang.getObject(_1028,false,this.model.rightPropertyMap);_1027=this.inherited(arguments,[_1026,"compare."+_1022,false,true]);_1027.settings._type="compare";_1027.settings.compareViewModel=this.model;_1027.settings.value=value;return [_1025,_1027];}return _1025;},_createGroupContainer:function(group,_1029){var _102a=this.inherited(arguments);_102a.settings._hint="compare";return _102a;},_createParentContainer:function(_102b){_102b.properties.forEach(function(_102c){_102c.groupName=_102b.groupName;});return this.inherited(arguments);}});});},"epi-cms/compare/FormField":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/form/Button","epi/shell/form/Field","epi/shell/form/formFieldRegistry","epi/i18n!epi/cms/nls/episerver.cms.compare"],function(_102d,lang,_102e,_102f,_1030,_1031,Field,_1032,res){var _1033=_102d([Field],{_copyButton:null,buildRendering:function(){this.inherited(arguments);this.own(this._copyButton=new _1031({"class":"epi-form-container__section__row__copy-button epi-chromeless",iconClass:"epi-icon-compare--copy",label:res.copy.label,title:res.copy.tooltip}).placeAt(this.domNode,"last"));this._copyButton.on("click",lang.hitch(this,function(){this.model.copy(this.params.name);}));},addChild:function(child,index){var _1034,_1035=_102f.create("div",{"class":"epi-form-container__section__row__editor--"+child._type},this.domNode);if(child.checkbox){_1034=(child._type==="compare")?_102f.create("label",{innerHTML:child.label},_1035):_102f.place(this.labelNode,_1035);this._addCheckboxChild(child,_1034);}else{child.placeAt(_1035);}},destroy:function(){this.inherited(arguments);if(this._comparisonWatch){this._comparisonWatch.remove();this._comparisonWatch=null;}},_setReadonlyIconDisplayAttr:function(_1036){this.inherited(arguments);if(this._copyButton){_1030.set(this._copyButton.domNode,"display",_1036?"none":"");}},_setModelAttr:function(model){this._set("model",model);if(this._comparisonWatch){this._comparisonWatch.remove();}this._updateChangedState();this._comparisonWatch=model.watch("comparison",lang.hitch(this,"_updateChangedState"));},_updateChangedState:function(){var _1037=this.model.comparison,group=_1037&&_1037[this.groupName],_1038=group&&group.indexOf(this.name.toLowerCase())>=0;_102e.toggle(this.domNode,"epi-form-container__section__row--has-changes",_1038);}});function _1039(_103a,_103b){var _103c=new _1033({labelTarget:_103a.checkbox?_103a.checkbox.id:_103a.id,label:_103a.label,tooltip:_103a.tooltip,name:_103a.name,groupName:_103a.groupName.toLowerCase(),readonlyIconDisplay:_103a.readOnly,hasFullWidthValue:_103a.useFullWidth});_103c.own(_103a.watch("readOnly",function(name,_103d,_103e){_103c.set("readonlyIconDisplay",_103e);}));return _103c;};function _103f(_1040,_1041){var _1042=_1041.getChildren().pop();_1042.set("model",_1040.compareViewModel);return _1042;};_103f.preventAdd=true;_1032.add([{type:_1032.type.field,hint:"compare",factory:_1039},{type:"compare",hint:"",factory:_103f}]);return _1033;});},"epi-cms/contentediting/FormEditing":function(){define(["dojo/_base/declare","dojo/dom-class","dijit/layout/ContentPane","epi-cms/contentediting/_FormEditingMixin","epi-cms/contentediting/_ValidationMixin","epi-cms/contentediting/EditingBase"],function(_1043,_1044,_1045,_1046,_1047,_1048){return _1043([_1048,_1046,_1047],{createOverlays:false,selectFormOnCreation:true,placeForm:function(form){form.set("transitionMode","reveal");form.set("fitContainer",true);this.editLayoutContainer.addChild(form,0);},removeForm:function(form){this.editLayoutContainer.leftOver&&this._removeLeftOver();this.editLayoutContainer.leftOver=form;_1044.replace(this.iframeWithOverlay.domNode,"dijitVisible","dijitHidden");return false;},_reloadPropertyPreview:function(){}});});},"epi-cms/component/ContextHistory":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/dependency","epi/UriParser","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/widget/_GridWidgetBase"],function(array,_1049,lang,topic,_104a,_104b,_104c,_104d,_104e){return _1049([_104e],{ignoreVersionWhenComparingLinks:false,_sort:"dateAdded",postMixInProperties:function(){this.inherited(arguments);this.store=this.store||_104a.resolve("epi.shell.ContextHistory").store;},buildRendering:function(){this.inherited(arguments);var _104f=lang.mixin({columns:{name:{renderCell:lang.hitch(this,this._renderContentItem)}},store:this.store,selectionMode:"single",dndFormatSuffix:this.dndFormatSuffix,sort:this._sort},this.defaultGridMixin);this.grid=new this._gridClass(_104f,this.domNode);this.grid.set("showHeader",false);},postCreate:function(){this.inherited(arguments);topic.subscribe("/epi/cms/trash/empty",lang.hitch(this,function(_1050){if(_1050){_1050.forEach(function(_1051){this.store.remove("epi.cms.contentdata:///"+_1051);},this);}}));},startup:function(){this.inherited(arguments);this.fetchData();},_dndNodeCreator:function(item,hint){var _1052=this.inherited(arguments);_1052.data.contentLink=new _104b(_1052.data.uri).getId();return _1052;},contextChanged:function(){this.inherited(arguments);this.grid.set("sort",this._sort,true);},fetchData:function(){var _1053=_104c.wastebasketPage;this.grid.set("query",{uri:new RegExp("epi\\.cms\\.contentdata:///([^"+_1053+"]|\\d{2,})")});this.grid.set("sort",this._sort,true);}});});},"epi-cms/component/GlobalToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/store/Memory","dijit/registry","dijit/Toolbar","epi/shell/command/_CommandModelBindingMixin","epi/shell/command/_WidgetCommandConsumerMixin","epi/shell/command/builder/_Builder","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/ExpandoMenuBuilder","dojo/text!./templates/GlobalToolbar.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons"],function(_1054,lang,_1055,_1056,_1057,_1058,_1059,_105a,_105b,_105c,_105d,_105e,_105f,_1060){var _1061=_1054([_105b],{_create:function(_1062){var _1063=_1054([_1062.settings.widget,_1059]);return new _1063(_1062.settings);}});var _1064=_1054([_105c],{_getBuildInfo:function(_1065){if(_1065.settings.category){var i=this.configuration.length-1;for(;i>0;i--){if(this.configuration[i].category===_1065.settings.category){return this.configuration[i];}}}return this.configuration[0];}});return _1054([_1058,_105a],{templateString:_105f,commandKey:"epi.cms.globalToolbar",postCreate:function(){this.inherited(arguments);var _1066=new _1061();var _1067=new _105d({settings:{title:_1060.createcontent.title,"class":"epi-mediumButton epi-disabledDropdownArrow",iconClass:"epi-iconPlus",showLabel:false},hideEmptyButton:true});var _1068=[{category:"leading",builder:_1066,target:this.leadingContainerNode},{category:"view",builder:new _105e({optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"}),target:this.viewNode},{category:"center",builder:_1066,target:this.centerContainerNode},{category:"trailing",builder:_1066,target:this.trailingContainerNode},{category:"create",builder:_1067,target:this.leadingContainerNode},{category:"compare",builder:new _105e({optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"}),target:this.compareNode}];var _1069=new _1064({configuration:_1068,commandSource:this});_1069.build();},_getNextFocusableChild:function(child,dir){var _106a=this.getChildren();var index=_106a.indexOf(child);index=(dir>0)?index+1:index-1;if(index<0){index=_106a.length-1;}else{if(index>=_106a.length){index=0;}}return _106a[index];}});});},"epi/shell/command/_WidgetCommandConsumerMixin":function(){define("epi/shell/command/_WidgetCommandConsumerMixin",["dojo/_base/declare","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_WidgetCommandProviderMixin"],function(_106b,_106c,_106d){return _106b([_106c,_106d],{});});},"epi/shell/command/_WidgetCommandProviderMixin":function(){define("epi/shell/command/_WidgetCommandProviderMixin",["dojo/_base/declare","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/command/_GlobalCommandProviderMixin"],function(_106e,_106f,_1070){return _106e([_1070,_106f],{postMixInProperties:function(){this.inherited(arguments);this.commandProvider=this.commandProvider||this;}});});},"url:epi-cms/component/templates/GlobalToolbar.html":"<div class=\"dijit epi-globalToolbar\" role=\"toolbar\" tabIndex=\"${tabIndex}\" data-dojo-attach-point=\"containerNode\">\n    <div class=\"epi-toolbarGroupContainer\">\n        <div class=\"epi-toolbarLeading epi-toolbarGroup\">\n            <span data-dojo-attach-point=\"leadingContainerNode\"></span\n            ><span data-dojo-attach-point=\"viewNode\"></span\n            ><span data-dojo-attach-point=\"compareNode\"></span>\n        </div>\n        <div data-dojo-attach-point=\"centerContainerNode\" class=\"epi-toolbarCenter epi-toolbarGroup\"></div>\n        <div data-dojo-attach-point=\"trailingContainerNode\" class=\"epi-toolbarTrailing epi-toolbarGroup\"></div>\n    </div>\n</div>","epi-cms/component/MainNavigationComponent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/dependency","epi-cms/widget/SearchBox"],function(array,_1071,lang,_1072,_1073,_1074,_1075,_1076,_1077,_1078){return _1071([_1073,_1074,_1075],{templateString:"<div>                            <div data-dojo-type=\"epi-cms/widget/SearchBox\" data-dojo-attach-point=\"search\" class=\"epi-gadgetInnerToolbar\"></div>                            <div data-dojo-attach-point=\"navigation\" style=\"overflow:auto;\">                            </div>                        </div>",contentRepositoryDescriptors:null,postCreate:function(){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_1076.resolve("epi.cms.contentRepositoryDescriptors");var _1079=this.contentRepositoryDescriptors[this.repositoryKey];var roots=this.roots?this.roots:_1079.roots;this.search.set("area",_1079.searchArea);this.search.set("searchRoots",roots);var _107a=_1079.customNavigationWidget||"epi-cms/component/ContentNavigationTree";require([_107a],lang.hitch(this,function(_107b){var _107c=new _107b({typeIdentifiers:_1079.mainNavigationTypes?_1079.mainNavigationTypes:_1079.containedTypes,containedTypes:_1079.containedTypes,settings:_1079,roots:roots,repositoryKey:this.repositoryKey});_107c.placeAt(this.navigation);this.tree=_107c;this.tree.resize();this.own(this.tree.watch("showAllLanguages",lang.hitch(this,function(){this.search.set("filterOnCulture",!this.tree.get("showAllLanguages"));})));}));},layout:function(){var cb=this._contentBox,ocb=this._oldContentBox;if(!cb){return;}if(!ocb||cb.w!==ocb.w||cb.h!==ocb.h){this._oldContentBox=cb;var sb=_1072.getMarginBox(this.search.domNode);_1072.setMarginBox(this.navigation,{w:cb.w,h:cb.h-sb.h});}}});});},"epi-cms/component/Media":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/on","dojo/topic","epi-cms/component/MediaViewModel","epi-cms/widget/HierarchicalList","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist","epi/i18n!epi/cms/nls/episerver.cms.components.media"],function(_107d,lang,_107e,_107f,on,topic,_1080,_1081,_1082,_1083){return _107d([_1081],{res:_1083,enableDndFileDropZone:true,showCreateContentArea:true,showThumbnail:true,modelClassName:_1080,noDataMessage:_1083.nocontent,hierarchicalListClass:"epi-mediaList",createContentText:_1083.dropareatitle,postCreate:function(){this.inherited(arguments);this.list.set("noDataMessage",this.res.nocontent);this.own(this.model.getCommand("upload").watch("canExecute",lang.hitch(this,function(name,_1084,_1085){this._toggleCreateContentArea(_1085);})));},_onCreateAreaClick:function(){this.inherited(arguments);this.model._commandRegistry.uploadDefault.command.execute();},_setupCreateContentArea:function(){this.inherited(arguments);var _1086=this.createContentAreaButton.domNode;_107e.remove(_1086,"epi-flat");_107e.add(_1086,"epi-button--full-width");}});});},"epi-cms/component/MediaViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/when","epi","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/widget/viewmodel/HierarchicalListViewModel","epi-cms/widget/viewmodel/MultipleFileUploadViewModel","epi-cms/widget/MultipleFileUpload","epi-cms/command/UploadContent","epi-cms/command/EditImage","epi-cms/command/DownloadMedia","epi/i18n!epi/cms/nls/episerver.cms.components.media"],function(array,_1087,lang,_1088,when,epi,_1089,_108a,_108b,_108c,_108d,_108e,_108f,_1090,_1091){return _1087([_108b],{_dialog:null,_getTypesToCreate:function(){return [];},_setupCommands:function(){this.inherited(arguments);var _1092={selection:this.selection,model:this};var _1093={uploadDefault:{command:new _108e(lang.mixin({iconClass:"epi-iconPlus",label:_1091.command.label,resources:_1091,viewModel:this},_1092))},upload:{command:new _108e(lang.mixin({category:"context",iconClass:"epi-iconUpload",label:_1091.linktocreateitem,viewModel:this},_1092)),isAvailable:this.menuType.ROOT|this.menuType.TREE,order:2},editImage:{command:new _108f(lang.mixin({category:"context",forceContextChange:true,label:_1091.command.openineditor},_1092)),isAvailable:this.menuType.LIST,order:3},download:{command:new _1090(lang.mixin({category:"context",label:_1091.command.download},_1092)),isAvailable:this.menuType.LIST,order:4}};this._commandRegistry=lang.mixin(this._commandRegistry,_1093);this.pseudoContextualCommands.push(this._commandRegistry.uploadDefault.command);this.pseudoContextualCommands.push(this._commandRegistry.upload.command);},_updateTreeContextCommandModels:function(model){this.inherited(arguments);this._commandRegistry.uploadDefault.command.set("model",model);this._commandRegistry.upload.command.set("model",model);},upload:function(_1094,_1095,_1096){var _1097=new _108d({model:new _108c({store:this.get("store"),query:this.get("listQuery")})});_1097.on("beforeUploaderChange",lang.hitch(this,function(){this._uploading=true;}));_1097.on("close",lang.hitch(this,function(_1098){this._dialog&&(_1098?this._dialog.hide():this._dialog.destroy());}));_1097.on("uploadComplete",lang.hitch(this,function(_1099){if(_1097.createAsLocalAsset){when(this.treeStoreModel&&typeof this.treeStoreModel.refreshRoots==="function"&&this.treeStoreModel.refreshRoots(this),lang.hitch(this,function(){_1097.set("createAsLocalAsset",false);_1097.set("uploadDirectory",this.get("currentTreeItem").id);_1097.model.set("query",this.get("listQuery"));}));}else{this.onListItemUpdated(_1099);this.set("currentTreeItem",this.get("currentTreeItem"));}if(this._dialog&&!this._dialog.open){this._dialog.destroy();}this._uploading=false;}));this._dialog=new _1089({title:_1091.linktocreateitem,dialogClass:"epi-dialog-upload",content:_1097,autofocus:true,defaultActionsVisible:false,closeIconVisible:false,destroyOnHide:false});this._dialog.definitionConsumer.add({name:"close",label:epi.resources.action.close,action:function(){_1097.close();}});this._dialog.resize({w:700});this._dialog.show();var _109a=_1096?this.selection.data[0].data:this.store.get(_1095);when(_109a,lang.hitch(this,function(_109b){this._buildBreadcrumb(_109b,_1097);_1097.set("uploadDirectory",_1095||this.get("currentTreeItem").id);_1097.set("createAsLocalAsset",_1096);_1097.upload(_1094);}));},onListItemUpdated:function(_109c){var store=this.store;return when(this.getCurrentContext(),function(_109d){var _109e=(new _108a(_109d.id)).createVersionUnspecificReference().toString();return when(store.get(_109e),function(_109f){var _10a0=array.filter(_109c,function(_10a1){return _109f.name.toLowerCase()===_10a1.fileName.toLowerCase();})[0];return _10a0?_109f:null;});});},_buildBreadcrumb:function(_10a2,_10a3){if(!_10a3){return;}if(this.treeStoreModel.isTypeOfRoot(_10a2)){_10a3.set("breadcrumb",[_10a2]);return;}this.treeStoreModel.getAncestors(_10a2.contentLink,lang.hitch(this,function(_10a4){var _10a5,paths=[_10a2];for(var i=_10a4.length-1;i>=0;i--){_10a5=_10a4[i];paths.unshift(_10a5);if(this.treeStoreModel.isTypeOfRoot(_10a5)){break;}}_10a3.set("breadcrumb",paths);}));},getContextualParentLink:function(_10a6,_10a7){var link=this.inherited(arguments);var _10a8=this.treeStoreModel.get("previousSelection");if(_10a8&&_10a8.selectedContent){var _10a9=_10a8.selectedContent.tree.getNodesByItem(link)[0];if(_10a9===undefined){link=this.roots[this.roots.length-1];}}return link;}});});},"epi-cms/widget/viewmodel/HierarchicalListViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/when","dijit/registry","epi","epi/dependency","epi/shell/ClipboardManager","epi/shell/command/_CommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi-cms/_MultilingualMixin","epi-cms/contentediting/_ContextualContentContextMixin","epi-cms/core/ContentReference","epi-cms/widget/ContentForestStoreModel","epi-cms/widget/ContextualContentForestStoreModel","epi-cms/widget/command/NewFolder","epi-cms/command/RenameFolder","epi-cms/widget/CreateCommandsMixin","epi-cms/command/CopyContent","epi-cms/command/CutContent","epi-cms/command/DeleteContent","epi-cms/command/PasteContent","epi-cms/command/TranslateContent","epi-cms/component/command/ViewTrash","epi-cms/component/command/ChangeContext"],function(array,_10aa,lang,topic,_10ab,when,_10ac,epi,_10ad,_10ae,_10af,_10b0,_10b1,_10b2,_10b3,_10b4,_10b5,_10b6,_10b7,_10b8,_10b9,_10ba,_10bb,_10bc,_10bd,_10be,_10bf,_10c0){return _10aa([_10ab,_10b3,_10b2,_10b9],{menuType:{ROOT:1,TREE:2,LIST:4},searchArea:"",searchRoots:"",clipboardManager:null,selection:null,commands:null,createCommands:null,createHierarchyCommands:null,pseudoContextualCommands:null,currentTreeItem:null,currentListItem:null,listQuery:null,listQueryOptions:null,showAllLanguages:true,treeStoreModelClass:null,treeStoreModel:null,store:null,searchStore:null,storeKey:"epi.cms.content.light",mainNavigationTypes:null,containedTypes:null,_showAllLanguagesSetter:function(value){this.showAllLanguages=value;this._updateListQuery(this.currentTreeItem);if(this.get("isSearching")){var _10c1=this.get("searchListQuery");this._updateSearchListQuery(_10c1.queryText);}this.treeStoreModel.set("showAllLanguages",value);},_currentTreeItemSetter:function(value){this.currentTreeItem=value;this._updateListQuery(value);},postscript:function(args){this.inherited(arguments);this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_10ad.resolve("epi.cms.contentRepositoryDescriptors");_10aa.safeMixin(this,this.contentRepositoryDescriptors[args.repositoryKey]);this.clipboardManager=this.clipboardManager||new _10ae();this.selection=this.selection||new _10b0();this.store=this.store||_10ad.resolve("epi.storeregistry").get(this.storeKey);this.searchStore=this.searchStore||_10ad.resolve("epi.storeregistry").get("epi.cms.content.search");this._setupTreeStoreModel();this._setupCommands();this.set("commands",this._commandRegistry.toArray());this._setupSearchRoots();this.set("listQueryOptions",this.treeStoreModel._queryOptions);},startup:function(){this.inherited(arguments);this._setupSelection();},getCommand:function(_10c2){return this._commandRegistry[_10c2]?this._commandRegistry[_10c2].command:null;},contentContextChanged:function(_10c3,_10c4){this._setupSearchRoots();if(!this._isSupportedContent(_10c3)){return;}var self=this,_10c5=self.get("currentListItem"),_10c6=_10b4.toContentReference(_10c3.id);var _10c7=this.get("isSearching");when(self.store.get(_10c6.createVersionUnspecificReference().toString()),function(_10c8){var _10c9=self.getContextualParentLink(_10c8,_10c3);var _10ca=_10b4.toContentReference(_10c9);self.set("editingListItem",_10c6);if(_10c4&&_10c4.forceReload||!_10b4.compareIgnoreVersion(_10c5,_10c6)){when(self.store.get(_10ca.createVersionUnspecificReference().toString()),function(model){self.treeStoreModel&&when(self.treeStoreModel.canExpandTo(model),function(_10cb){if(_10cb){self.set("currentTreeItem",_10ca);self.set("currentListItem",_10c6);if(!_10c7){self._updateCommands(model,self.menuType.LIST);}}});});}});},getContextualParentLink:function(_10cc,_10cd){var _10ce=this.treeStoreModel.get("previousSelection");var _10cf=_10ce&&this.hasContextual(_10ce.selectedAncestors)&&_10cc.assetsFolderLink!=null?_10cc.assetsFolderLink:_10cd.parentLink;return _10cf||this.roots[0];},onSearchTextChanged:function(_10d0){this.set("isSearching",!!_10d0);this._updateSearchListQuery(_10d0);if(!this.get("isSearching")&&this.currentListItem){var self=this;when(this.store.get(this.currentListItem.createVersionUnspecificReference().toString())).then(function(_10d1){self._updateCommands(_10d1,self.menuType.LIST);});}else{this._updateCommands(null,this.menuType.LIST);}},onSearch:function(_10d2){when(this.store.get(_10d2.id),lang.hitch(this,function(model){var _10d3=_10b4.toContentReference(model.contentLink);this.set("editingListItem",_10d3);this.set("currentListItem",_10d3);this.set("currentTreeItem",_10b4.toContentReference(model.parentLink));this._updateCommands(model,this.menuType.LIST);}));},onTreeItemSelected:function(model,_10d4){var _10d5=this.get("currentTreeItem"),_10d6=_10b4.toContentReference(model.contentLink),_10d7=_10d4?this.menuType.ROOT:this.menuType.TREE;this._updateCommands(model,_10d7);if(!_10b4.compareIgnoreVersion(_10d5,_10d6)&&_10b4.emptyContentReference!==_10d6){this.set("currentTreeItem",_10d6);}},onListItemSelected:function(model){var _10d8=this.get("currentListItem"),_10d9=_10b4.toContentReference(model.contentLink);this._updateCommands(model,this.menuType.LIST);if(!_10b4.compareIgnoreVersion(_10d8,_10d9)){this.set("currentListItem",_10d9);}},onListItemUpdated:function(_10da){},_isSupportedContent:function(_10db){return !!(_10db&&_10db.id)&&this.containedTypes.some(function(type){return _10b1.isBaseTypeIdentifier(_10db.dataType,type);});},_setupSelection:function(){when(this.getCurrentContext(),lang.hitch(this,function(ctx){var _10dc;if(!this._isContentContext(ctx)||!this._isSupportedContent(ctx)){_10dc=_10b4.toContentReference(this.roots[0]).toString();when(this.store.get(_10dc),lang.hitch(this,function(model){this.onTreeItemSelected(model,true);}));}else{this.contentContextChanged(ctx,null);}}));},_setupTreeStoreModel:function(){if(!this.treeStoreModelClass){this.treeStoreModelClass=this.enableContextualContent?_10b6:_10b5;}var _10dd=new this.treeStoreModelClass({store:this.store,roots:this.roots,typeIdentifiers:this.mainNavigationTypes,containedTypes:this.containedTypes,notAllowToCopy:this.preventCopyingFor,notAllowToDelete:this.preventDeletionFor,notSupportContextualContents:this.preventContextualContentFor,autoSelectPastedItem:false,onAddDelegate:lang.hitch(this,function(node){var _10de=_10ac.getEnclosingWidget(node.domNode),_10df=_10de&&_10de.item,_10e0=(typeof (this.treeStoreModel.canEdit)==="function")&&this.treeStoreModel.canEdit(_10df);if(_10e0){node.edit();var _10e1=function(){topic.publish("/epi/cms/contentdata/childrenchanged",_10df.parentLink);};var _10e2=node.on("rename",function(){_10e2.remove();_10e1();});var _10e3=node.on("cancelEdit",function(){_10e3.remove();_10e1();});}}),onRefreshRoots:lang.hitch(this,this._setupSearchRoots),additionalQueryOptions:{sort:this._getSortSettings()}});this.set("treeStoreModel",_10dd);},_getSortSettings:function(){return [{attribute:"name",descending:false}];},_setupSearchRoots:function(){var roots=this.roots instanceof Array&&this.roots.length>0?lang.clone(this.roots):[];when(this.getCurrentContent()).then(lang.hitch(this,function(_10e4){var _10e5=_10e4&&_10e4.assetsFolderLink;if(_10e5&&typeof this._getPseudoContextualContent==="function"&&_10e5!==this._getPseudoContextualContent().toString()){roots.push(_10e5);}})).always(lang.hitch(this,function(){this.set("searchRoots",roots.join(","));}));},_setupCommands:function(){var _10e6=this.menuType;var _10e7={category:"context",model:this.treeStoreModel,selection:this.selection,clipboard:this.clipboardManager};this.createHierarchyCommands={};var index=1;array.forEach(this.mainNavigationTypes,function(type){this.createHierarchyCommands[type]={command:new _10b7(lang.mixin({typeIdentifier:type},_10e7)),isAvailable:_10e6.ROOT|_10e6.TREE,order:index};index=index+1;},this);this.createCommands=this.getCreateCommands(index);var _10e8={rename:{command:new _10b8({category:"context"}),isAvailable:_10e6.TREE,order:10},cut:{command:new _10bb(_10e7),isAvailable:_10e6.TREE|_10e6.LIST,order:20},copy:{command:new _10ba(_10e7),isAvailable:_10e6.TREE|_10e6.LIST,order:30},paste:{command:new _10bd(_10e7),isAvailable:_10e6.ROOT|_10e6.TREE,order:40},edit:{command:new _10c0({category:"context",forceReload:true,forceContextChange:true}),isAvailable:this.menuType.LIST,order:3},translate:{command:new _10be(),isAvailable:this.menuType.TREE|this.menuType.LIST},"delete":{command:new _10bc(_10e7),isAvailable:_10e6.TREE|_10e6.LIST,order:50},trash:{command:new _10bf({typeIdentifiers:this.mainNavigationTypes,order:60}),order:60},sort:function(){var _10e9=[];for(var key in this){if(key!=="toArray"&&key!=="sort"&&this.hasOwnProperty(key)){var index=this[key].order;if(!index){index=100;}_10e9.push([index,this[key].command]);}}_10e9.sort(function(a,b){return a[0]-b[0];});return _10e9;},toArray:function(){var _10ea=this.sort();var _10eb=[];array.forEach(_10ea,function(key){_10eb.push(key[1]);});return _10eb;}};this._commandRegistry=lang.mixin(this._commandRegistry,this.createHierarchyCommands,this.createCommands,_10e8);this.pseudoContextualCommands=this._getPseudoContextualCommands();},_updateListQuery:function(_10ec){var id,query=null;var _10ed=array.filter(this.containedTypes,function(item){return this.mainNavigationTypes.indexOf(item)<0;},this);if(_10ec){id=_10ec.toString();query=this._createListChildrenQuery(id,this.showAllLanguages,_10ed);}this.set("listQuery",query);},_updateSearchListQuery:function(_10ee){var query=null;if(_10ee){query=this._createListSearchQuery(_10ee,this.showAllLanguages);}this.set("searchListQuery",query);},_createListSearchQuery:function(_10ef,_10f0){return {queryText:_10ef,query:"searchcontent",allLanguages:_10f0,contentSearchAreas:this.get("searchArea"),searchRoots:this.get("searchRoots"),maxResults:1000,filterDeleted:true};},_createListChildrenQuery:function(id,_10f1,_10f2){return {referenceId:id,query:"getchildren",allLanguages:_10f1,typeIdentifiers:_10f2};},_updateSelection:function(model){this.selection.set("data",model?[{type:"epi.cms.contentdata",data:model}]:[]);},_updateCommands:function(model,_10f3){this._updateSelection(model);if(typeof this.treeStoreModel.isSupportedType==="function"&&model&&this.treeStoreModel.isSupportedType(model.typeIdentifier)){this._updateTreeContextCommandModels(model);this.decoratePseudoContextualCommands(this.pseudoContextualCommands);}this._commandRegistry.translate.command.set("model",model);this._commandRegistry.translate.command.set("executeDelegate",null);this._commandRegistry.edit.command.set("model",model);this._updateCommandAvailability(_10f3);},_updateTreeContextCommandModels:function(model){this._updateCreateCommandModels(model);this._commandRegistry.rename.command.set("model",model);},_updateCreateCommandModels:function(model){var _10f4=this.createCommands;for(var key in _10f4){_10f4[key].command.set("model",model);}},_getPseudoContextualCommands:function(){var key,_10f5=[];for(key in this.createCommands){_10f5.push(this.createCommands[key].command);}for(key in this.createHierarchyCommands){_10f5.push(this.createHierarchyCommands[key].command);}_10f5.push(this._commandRegistry.paste.command);return _10f5;},_updateCommandAvailability:function(_10f6){var _10f7=this._commandRegistry,_10f8;for(var key in _10f7){if(key!=="toArray"&&_10f7.hasOwnProperty(key)){_10f8=_10f7[key].isAvailable;if(_10f8){var _10f9=_10f7[key].command;this._updateAvailabilityForSpecificCommand(_10f9,_10f6,_10f8);}}}},_updateAvailabilityForSpecificCommand:function(_10fa,_10fb,_10fc){if(!_10fa.isInstanceOf(_10be)){_10fa.set("isAvailable",!!(_10fc&_10fb));}},upload:function(_10fd){}});});},"epi/shell/ClipboardManager":function(){define("epi/shell/ClipboardManager",["dojo/_base/declare","dojo/Stateful"],function(_10fe,_10ff){return _10fe(_10ff,{copy:true,data:null,constructor:function(){this.data=[];},clear:function(){this.set("data",null);},isCopy:function(){return this.get("copy");},setDataObject:function(_1100,copy){this.set("copy",copy);this.set("data",_1100);},getDataObject:function(){return this.data;},containsData:function(){return !!this.data;}});});},"epi/shell/selection":function(){define("epi/shell/selection",["dojo/_base/declare","./StatefulArray"],function(_1101,_1102){return _1101(_1102,{data:null,constructor:function(){this.data=[];}});});},"epi-cms/_MultilingualMixin":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/when","dojo/_base/lang","epi/dependency","epi-cms/ApplicationSettings","epi-cms/component/SiteTreeModel"],function(_1103,_1104,when,lang,_1105,_1106,_1107){return _1103([],{isMultilingual:false,_application:null,_siteTreeModel:null,_cachedValue:undefined,constructor:function(_1108){lang.mixin(this,_1108);},_isSiteMultilingual:function(){var _1109=new _1104();if(this._cachedValue!==undefined){_1109.resolve(this._cachedValue);}if(!this._siteTreeModel){var _110a=_1105.resolve("epi.storeregistry"),_110b=_110a.get("epi.cms.sitestructure");this._siteTreeModel=new _1107({store:_110b});}when(this._siteTreeModel.getAllLanguagesForCurrentSite(),lang.hitch(this,function(items){this._cachedValue=items.length>=2;_1109.resolve(this._cachedValue);}));return _1109;},_contentExistsInCurrentLanguage:function(_110c){if(!_110c){return false;}if(_110c.capabilities&&!_110c.capabilities.language){return true;}if(!_110c.currentLanguageBranch){return false;}return _1106.currentContentLanguage===_110c.currentLanguageBranch.languageId;}});});},"epi-cms/widget/command/NewFolder":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(array,_110d,lang,topic,when,_110e,_110f,_1110,_1111,_1112){return _110d([_110e,_110f],{iconClass:"epi-iconFolder",typeIdentifier:null,createAsLocalAsset:false,_defaultName:null,postscript:function(){this.inherited(arguments);var _1113=this.typeIdentifier;this._defaultName=_1110.getResourceValue(_1113,"newitemdefaultname");var _1114=_1110.getResourceValue(_1113,"create");this.set("label",_1114);this.set("tooltip",_1114);},_execute:function(){var self=this,_1115=self.get("selectionData"),_1116=(new _1111(_1115.contentLink)).createVersionUnspecificReference().toString(),_1117=self.createAsLocalAsset;var _1118=function(_1119){self.model.getChildren(_1119,function(_111a){when(self.model.add({parentLink:_1116,name:self._getUniqueFolderName(_111a,self._defaultName),contentTypeIdentifier:self.typeIdentifier,createAsLocalAsset:_1117},self.onRefreshSelection),function(_111b){if(_111b.parentLink!==_1116){topic.publish("/epi/cms/action/createlocalasset");}});});};if(_1117){when(self.model.store.refresh(_1116),function(_111c){when(self.model.store.get(_111c.assetsFolderLink),_1118);});}else{_1118(_1115);}},_onModelChange:function(){var _111d=this.get("selectionData"),_111e=_1112.action.Create,_111f=_1112.providerCapabilities.Create,_1120=this.model&&_111d&&_1112.isActionAvailable(_111d,_111e,_111f,true);this.set("canExecute",!!_1120);},_getUniqueFolderName:function(arr,_1121){var _1122=function(times){var name=times>0?lang.replace(_1121+" {0}",[times]):_1121;if(times>1000){return name;}var _1123=array.some(arr,function(child){return lang.trim(child.name).toLowerCase()===lang.trim(name).toLowerCase();});if(_1123){times=times+1;return _1122(times);}return name;};return _1122(0);}});});},"epi-cms/command/RenameFolder":function(){define(["dojo/_base/declare","epi","epi-cms/_MultilingualMixin","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command"],function(_1124,epi,_1125,_1126,_1127){return _1124([_1127,_1125],{label:epi.resources.action.rename,contentActionSupport:null,iconClass:"epi-iconRename",renameDelegate:null,typeIdentifier:"episerver.core.contentfolder",postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_1126;},_execute:function(){this.renameDelegate(this.model);},_onModelChange:function(){var _1128=this.renameDelegate&&this.model&&this.model.typeIdentifier===this.typeIdentifier&&this.contentActionSupport.hasAccess(this.model.accessMask,_1126.accessLevel[_1126.action.Edit])&&this._contentExistsInCurrentLanguage(this.model);this.set("canExecute",_1128);}});});},"epi-cms/widget/CreateCommandsMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi/dependency","../command/PopupCommand","../command/NewContent","epi/i18n!epi/nls/episerver.shared"],function(array,_1129,lang,_112a,_112b,_112c,_112d){return _1129([],{contentRepositoryDescriptors:null,typeDescriptorManager:null,createCommandClass:_112c,repositoryKey:null,category:null,isAvailableFlags:null,postscript:function(){this.inherited(arguments);if(!this.repositoryKey){throw "You need to specify the repositoryKey field";}this.contentRepositoryDescriptors=this.contentRepositoryDescriptors||_112a.resolve("epi.cms.contentRepositoryDescriptors");_1129.safeMixin(this,this.contentRepositoryDescriptors[this.repositoryKey]);this.commandCategory=this.commandCategory||"context";var _112e={ROOT:1,TREE:2,LIST:4};this.isAvailableFlags=this.isAvailableFlags||_112e.ROOT|_112e.TREE;},getCreateCommands:function(index){var _112f={};var _1130=index||1;if(!this.creatableTypes){return _112f;}array.forEach(this.creatableTypes,function(type){_112f[type]={command:this._createCommand(type),isAvailable:this.isAvailableFlags,order:_1130};_1130=_1130+1;},this);if(this.creatableTypes.length<2){return _112f;}var _1131=new _112b({label:_112d.action["new"],commands:_112f});return {popupCommand:{command:_1131,order:index}};},_createCommand:function(type){return new this.createCommandClass({contentType:type,category:this.commandCategory});}});});},"epi-cms/command/PopupCommand":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","epi/shell/command/_Command","epi/shell/command/_CommandProviderMixin","epi/shell/widget/ContextMenu"],function(array,_1132,_1133,_1134,_1135,_1136){return _1132([_1134,_1135],{category:"popup",canExecute:true,popup:null,popupClass:_1136,popupCategory:"context",_commandsSetter:function(value){if(!value){return;}var _1137=[];if(value instanceof Array){_1137=value;}else{for(var index in value){_1137.push(value[index].command);}}this.commands=_1137;this._updateIsAvailable();},_popupSetter:function(popup){this.popup=popup;popup.addProvider(this);},_updateIsAvailable:function(){var _1138=array.some(this.get("commands"),function(_1139){return _1139.get("isAvailable");});this.set("isAvailable",_1138);},_onModelChange:function(){this.updateCommandModel(this.model);this._updateIsAvailable();}});});},"epi-cms/command/NewContent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/topic","dojo/when","dojo/promise/all","epi/dependency","epi/shell/command/_Command","epi/shell/TypeDescriptorManager","epi-cms/contentediting/ContentActionSupport"],function(array,_113a,lang,_113b,topic,when,all,_113c,_113d,_113e,_113f){return _113a([_113d],{contentType:null,createAsLocalAsset:false,postscript:function(){this.inherited(arguments);var _1140=this.contentType;this.label=this.label||_113e.getResourceValue(_1140,"create");this.tooltip=this.tooltip||_113e.getResourceValue(_1140,"createdescription");this.iconClass=this.iconClass||_113e.getValue(_1140,"commandIconClass");if(!this.store){var _1141=_113c.resolve("epi.storeregistry");this.store=_1141.get("epi.cms.contenttype");}},_execute:function(){topic.publish("/epi/shell/action/changeview","epi-cms/contentediting/CreateContent",null,{requestedType:this.contentType,parent:this.model,createAsLocalAsset:this.createAsLocalAsset,view:_113e.getValue(this.contentType,"createView")});},_onModelChange:function(){if(this.model&&this.model instanceof Array){if(this.model.length===1){this.model=this.model[0];}else{this.model=null;}}this.set("createAsLocalAsset",this.model?this.model.typeIdentifier==="episerver.core.contentassetfolder":false);this.set("canExecute",this._canExecute());var model=this.model;if(!model){return;}when(this._getContentType(model),lang.hitch(this,function(_1142){if(!_1142){this.set("isAvailable",false);return;}when(this._checkAvailability(_1142.availableContentTypes),lang.hitch(this,function(_1143){this.set("isAvailable",_1143);}));}));},_canExecute:function(){var model=this.model,_1144=_113f.action.Create,_1145=_113f.providerCapabilities.Create,_1146=model&&!(model.isWastebasket||model.isDeleted)&&_113f.hasLanguageAccess(model)&&_113f.isActionAvailable(model,_1144,_1145,true);return !!_1146;},_getContentType:function(model){if(!model){return null;}return this.store.get(model.contentTypeID);},_checkAvailability:function(_1147){if(_1147.length===0){return false;}var _1148=new _113b();var _1149=array.map(_1147,lang.hitch(this,function(_114a){return this.store.get(_114a);}));when(all(_1149),lang.hitch(this,function(_114b){var _114c=array.some(_114b,lang.hitch(this,function(_114d){return _113e.isBaseTypeIdentifier(_114d.typeIdentifier,this.contentType);}));_1148.resolve(_114c);}));return _1148;}});});},"epi-cms/command/CopyContent":function(){define(["dojo/_base/declare","dojo/_base/array","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(_114e,array,epi,_114f,_1150,_1151){return _114e([_114f,_1150,_1151],{label:epi.resources.action.copy,iconClass:"epi-iconCopy",_execute:function(){this.clipboard.set("copy",true);this.clipboard.set("data",this.selection.data.concat());},_onModelChange:function(){var model=this.model,_1152=this.selection.data,_1153=false;if(model&&_1152.length){_1153=array.every(_1152,function(item){return model.canCopy(item.data);});}this.set("canExecute",_1153);}});});},"epi-cms/command/CutContent":function(){define(["dojo/_base/array","dojo/_base/declare","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(array,_1154,epi,_1155,_1156,_1157){return _1154([_1155,_1156,_1157],{label:epi.resources.action.cut,iconClass:"epi-iconCut",_execute:function(){this.clipboard.set("copy",false);this.clipboard.set("data",this.selection.data.concat());},_onModelChange:function(){var model=this.model,_1158=this.selection.data,_1159=false;if(model&&_1158.length){_1159=array.every(_1158,function(item){return model.canCut(item.data);});}this.set("canExecute",_1159);}});});},"epi-cms/command/DeleteContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","dojo/when","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.command","epi/i18n!epi/nls/episerver.shared"],function(_115a,lang,_115b,topic,when,_115c,_115d,_115e,_115f,_1160,_1161,_1162){return _115a([_115e,_115f,_1160],{label:_1161.movetotrash,iconClass:"epi-iconTrash",hasWastebasket:true,_execute:function(){var model=this.model,_1163=this.clipboard,_1164=this.selection.data,_1165=this.hasWastebasket?model.move(_1164,{contentLink:_115c.wastebasketPage,isWastebasket:true}):model.remove(_1164);return when(_1165,lang.hitch(this,function(){var _1166=[];if(_1163&&_1163.data){_1164.forEach(function(_1167){var map=_1163.data.map(function(_1168){return model.isAncestor(_1167.data,_1168.data);});_1166=_1166.concat(map);});}when(_115b(_1166),function(_1169){var _116a=_1169.every(function(_116b){return _116b;});if(_116a){_1163.clear();}});}),lang.hitch(this,function(){topic.publish("/epi/cms/action/delete/error");}));},_hasWastebasketSetter:function(_116c){this.hasWastebasket=_116c;this.set("iconClass",_116c?"epi-iconTrash":"epi-iconClose");this.set("label",_116c?_1161.movetotrash:_1162.action.deletelabel);},_onModelChange:function(){var model=this.model,_116d=this.selection.data,_116e=function(item){var _116f=item.data;return _116f&&!_116f.isDeleted&&model.canDelete(_116f);},_1170=function(item){var _1171=item.data;return _1171&&_115d.hasProviderCapability(_1171.providerCapabilityMask,_115d.providerCapabilities.Wastebasket);};this.set("hasWastebasket",!!_116d.length&&_116d.every(_1170));this.set("canExecute",!!(model&&_116d.length)&&_116d.every(_116e)&&(this.hasWastebasket||!_116d.some(_1170)));}});});},"epi-cms/command/PasteContent":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","epi","epi/shell/command/_Command","epi/shell/command/_ClipboardCommandMixin","epi/shell/command/_SelectionCommandMixin"],function(array,_1172,lang,_1173,when,epi,_1174,_1175,_1176){return _1172([_1174,_1175,_1176],{label:epi.resources.action.paste,iconClass:"epi-iconPaste",createAsLocalAsset:false,_execute:function(){var _1177=this.get("clipboardData"),_1178=this.get("selectionData");this.model.set("createAsLocalAsset",this.createAsLocalAsset);if(this.clipboard.copy){return this.model.copy(_1177,_1178);}else{return when(this.model.move(_1177,_1178),lang.hitch(this,function(){this.clipboard.clear();}));}},_onModelChange:function(){var self=this,model=self.model,_1179=self.get("clipboardData"),_117a=self.get("selectionData");self.set("canExecute",false);if(model&&_1179&&_1179.length&&_117a){var _117b=array.map(_1179,function(item){return model.canPaste(item.data,_117a,self.clipboard.copy);});when(_1173(_117b),function(_117c){var _117d=array.every(_117c,function(_117e){return _117e;});if(self.clipboard.copy){self.set("canExecute",_117d);return;}model.getAncestors(_117a,function(_117f){var _1180=array.some(_1179,function(item){return array.indexOf(_117f,item.data)>=0;});self.set("canExecute",_117d&&!_1180);});});}}});});},"epi-cms/component/command/ViewTrash":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_1181,lang,topic,when,_1182,_1183,_1184,_1185){return _1181([_1184],{label:_1185.viewtrash,category:"setting",typeIdentifiers:null,postscript:function(){this.inherited(arguments);var store=this.store||_1182.resolve("epi.storeregistry").get("epi.cms.content.light"),_1186=store.get(_1183.wastebasketPage.toString());when(_1186,lang.hitch(this,function(_1187){this.set("canExecute",_1187.statusCode!==403);}));},_execute:function(){topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_1183.wastebasketPage},{sender:this,typeIdentifiers:this.typeIdentifiers});}});});},"epi-cms/component/command/ChangeContext":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi/shell/command/_Command","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1188,topic,_1189,_118a,_118b){return _1188([_118a],{contentActionSupport:null,forceContextChange:false,forceReload:false,viewType:null,viewName:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_1189;},_execute:function(){topic.publish("/epi/shell/context/request",{uri:this.model.uri},{sender:null,forceReload:this.forceReload,forceContextChange:this.forceContextChange,viewType:this.viewType,viewName:this.viewName});},_onModelChange:function(){if(!this.model){this.set("canExecute",false);return;}if(this.model.length===1){this.model=this.model[0];}var _118c=this.model instanceof Array;var _118d=this.contentActionSupport.hasAccess(this.model.accessMask,this.contentActionSupport.accessLevel.Read);this.set("canExecute",!_118c&&_118d);if(!_118c){if(this.contentActionSupport.hasAccess(this.model.accessMask,this.contentActionSupport.accessLevel.Edit)){this.set("label",_118b.edit);this.set("iconClass","epi-iconPen");}else{this.set("label",_118b.view);this.set("iconClass","epi-iconSearch");}}}});});},"epi-cms/widget/viewmodel/MultipleFileUploadViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/when","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin"],function(array,_118e,when,_118f,_1190){return _118e([_118f,_1190],{upload:function(_1191){return when(this._filterUploadingFiles(_1191),function(_1192){if(!_1192||!(_1192.existingContents instanceof Array)||_1192.existingContents.length===0){return {showConfirmation:false,uploadingFiles:_1191};}return {showConfirmation:true,uploadingFiles:_1191,newFiles:_1192.newFiles,existingContents:_1192.existingContents};});},_filterUploadingFiles:function(_1193){var self=this;if(!self.store){return null;}return when(self.store.query(self.get("query")),function(_1194){var _1195=array.filter(_1194,function(_1196){return array.some(_1193,function(file){return file.name.toLowerCase()===_1196.name.toLowerCase();});});var _1197=array.filter(_1193,function(file){return array.every(_1194,function(_1198){return file.name.toLowerCase()!==_1198.name.toLowerCase();});});return {existingContents:_1195,newFiles:_1197};});}});});},"epi-cms/widget/MultipleFileUpload":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/aspect","dojo/when","dojo/Evented","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojox/form/Uploader","epi/routes","epi/shell/widget/dialog/Alert","epi-cms/widget/MultipleFileUploadConfirmation","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/FileListViewModel","dojo/text!./templates/MultipleFileUpload.html","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles","epi-cms/widget/Breadcrumb","epi-cms/widget/FileList","epi/shell/form/uploader/HTML5"],function(array,_1199,lang,_119a,_119b,when,_119c,_119d,_119e,_119f,_11a0,_11a1,Alert,_11a2,_11a3,_11a4,_11a5,_11a6){return _1199([_119d,_119e,_119f,_119c],{res:_11a6,_isCompleted:true,_uploadStatus:[],templateString:_11a5,postCreate:function(){this.inherited(arguments);this._setupUploader();this._setupFileList();this._confirmationDialog=this._confirmationDialog||new _11a2();},upload:function(_11a7){var self=this,_11a8=self.uploaderInput,_11a9=self._getUploadSettings();when(self.model.upload(_11a7),function(_11aa){when(self._confirm(_11aa),function(_11ab){self._resetUploader();if(!(_11ab instanceof Array)||_11ab.length===0){return;}self._fileListModel.set("uploadFiles",_11ab);_11a8._files=_11ab;_11a8.upload(_11a9);});});},close:function(){var self=this,files=self.uploaderInput._files,_11ac=function(_11ad){self.emit("close",_11ad);self.set("disableToolbar",false);};if(self._isCompleted||!files||files.length<=0){_11ac(false);}else{var _11ae=new Alert({description:_11a6.confirmdialog.description,onAction:function(){_11ac(true);}});_11ae.show();}},_setUploadStatusAttr:function(scope,_11af,_11b0){this._uploadStatus=_11a3.addStatus(this._uploadStatus,scope,_11af,_11b0);},_getUploadStatusAttr:function(){return this._uploadStatus;},_setBreadcrumbAttr:function(parts){this.breadcrumbBar._cleanUp();this.breadcrumbBar._availableWidth=_119a.getContentBox(this.breadcrumbBar.domNode).w;var i=0,_11b1=parts?parts.length:0;if(_11b1>0){for(i;i<_11b1-1;i++){this.breadcrumbBar._createItem(parts[i],true);}this.breadcrumbBar._createItem(parts[_11b1-1],false);}},_setDisableToolbarAttr:function(_11b2){this.uploaderInput.set("disabled",_11b2);!_11b2&&this.uploaderInput.set("tabindex",0);},_setupUploader:function(){var self=this;this.uploaderInput.uploadUrl=_11a1.getActionPath({moduleArea:"CMS",controller:"FileUpload",action:"Upload"});this.own(_119b.before(this.uploaderInput,"onChange",function(_11b3){self._isCompleted=false;self.set("disableToolbar",true);return [self._getUploadSettings()];}),this.uploaderInput.on("error",function(err){self.set("uploadStatus",_11a3.StatusScope.All,"",_11a6.uploadform.errormessage);self._onUploadComplete();}));},_getUploadSettings:function(){return {uploadDirectory:this.get("uploadDirectory"),createAsLocalAsset:this.get("createAsLocalAsset")};},_setupFileList:function(){var self=this,_11b4=this.uploaderInput;self._fileListModel=new _11a4();self.fileList.set("model",self._fileListModel);this.own(_11b4.on("begin",function(files){if(files&&files.length>0){self._fileListModel.set("showProgressBar",true);}}),_11b4.on("progress",function(_11b5){self._fileListModel.set("progress",_11b5);}),_11b4.on("complete",lang.hitch(self,self._onUploadComplete)),_119b.after(_11b4,"reset",lang.hitch(self,self._fileListModel.clear)),_119b.around(_11b4,"onChange",function(_11b6){return function(_11b7){var _11b8=_11b4._files;return when(self.model.upload(_11b8),function(_11b9){return when(self._confirm(_11b9),function(_11ba){self._clearUploadStatus();_11ba=_11a3.getFileArray(_11ba);if(!(_11ba instanceof Array)||_11ba.length===0){self._resetUploader();return _11b6.apply(_11b4,[_11b7]);}self._fileListModel.set("uploadFiles",_11ba);_11b4._files=_11ba;_11b4.upload(self._getUploadSettings());return _11b6.apply(_11b4,[_11b7]);});});};}));},_confirm:function(_11bb){return _11bb.showConfirmation===true?this._confirmationDialog.showConfirmation(_11bb.existingContents,_11bb.uploadingFiles,_11bb.newFiles):_11bb.uploadingFiles;},_clearUploadStatus:function(){this._uploadStatus=[];},_clearUploadFiles:function(){this.uploaderInput._files=[];},_resetUploader:function(){this._fileListModel.set("showProgressBar",false);this.uploaderInput.reset();this.set("disableToolbar",false);},_onUploadComplete:function(evt){var _11bc="";this._isCompleted=true;if(evt){if(evt instanceof Array){array.forEach(evt,function(item){_11bc=item.errorMessage;this.set("uploadStatus",item.index?_11a3.StatusScope.Single:_11a3.StatusScope.All,item.fileName||item.name,_11bc);},this);}else{if(evt.isValid===false&&evt.saved===false){this.set("uploadStatus",_11a3.StatusScope.All,"",evt.errorMessage);}}}this._fileListModel.set("uploadStatus",this.get("uploadStatus"));this.set("disableToolbar",false);this._clearUploadFiles();this.emit("uploadComplete",!this._fileListModel.uploadStatus?this._fileListModel.uploadFiles:null);}});});},"epi-cms/widget/MultipleFileUploadConfirmation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/aspect","dojo/Deferred","dojo/when","epi/string","epi/shell/widget/dialog/Dialog","epi-cms/widget/ReadOnlyContentList","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.replaceconfirmdialog"],function(array,_11bd,lang,_11be,_11bf,_11c0,when,_11c1,_11c2,_11c3,_11c4){return _11bd(null,{showConfirmation:function(_11c5,_11c6,_11c7){var _11c8=new _11c0(),_11c9=this._getDialog(_11c5.length),_11ca=this._getContentList();_11c9.set("content",_11ca);_11c9.set("onAction",function(_11cb){_11c8.resolve(_11cb?_11c6:_11c7);});when(_11c9.show(),function(){_11ca.grid.renderArray(_11c5);});return _11c8;},_getDialog:function(_11cc){var self=this,_11cd=_11c1.toHTML(_11cc>1?lang.replace(_11c4.multiple.heading,[_11cc]):_11c4.single.heading),_11ce=_11c1.toHTML(_11cc>1?_11c4.multiple.description:_11c4.single.description);var _11cf=new _11c2({closeIconVisible:false,title:_11c4.title,heading:_11cd,description:_11ce,dialogClass:"epi-dialog--auto-height",getActions:function(){return self._getActions(this,_11cc===1);}});return _11cf;},_getActions:function(_11d0,_11d1){return [{name:"replaceFiles",label:_11d1?_11c4.single.buttons.replace:_11c4.multiple.buttons.replace,title:null,action:function(){when(_11d0.hide(),function(){return _11d0.onAction(true);});}},{name:"skipFiles",label:_11d1?_11c4.single.buttons.skip:_11c4.multiple.buttons.skip,title:null,action:function(){when(_11d0.hide(),function(){return _11d0.onAction(false);});}}];},_getContentList:function(){var _11d2=new _11c3();_11be.add(_11d2.grid.domNode,"epi-thumbnailContentList");return _11d2;}});});},"epi-cms/widget/ReadOnlyContentList":function(){define(["dojo/_base/declare","dgrid/OnDemandList","epi/shell/dgrid/Formatter","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/widget/_ContentListBase","epi/i18n!epi-cms/nls/episerver.shared.header"],function(_11d3,_11d4,_11d5,_11d6,_11d7,_11d8,_11d9){return _11d3([_11d8],{_gridClass:_11d3([_11d4,_11d5]),query:null,queryOptions:null,onPostCreateSettings:function(){},postCreate:function(){this.inherited(arguments);this.onPostCreateSettings();},destroy:function(){if(this.grid){this.grid.destroy();this.grid=null;}this.inherited(arguments);},getContextMenu:function(){},createList:function(){this.inherited(arguments);this.grid.set("showHeader",false);},getListSettings:function(){return this._getBaseSettings();},_setQueryAttr:function(value){this._set("query",value);this._updateQuery(value);},_getBaseSettings:function(_11da){var _11db=function(item){var _11dc=new _11d6(item.contentLink);var title=item.name+", "+_11d9.id+": "+_11dc.id+" ("+_11d9.type+": "+item.contentTypeName+")";return title;};var _11dd=function(item){return item.thumbnailUrl;};return {store:this.store,queryOptions:this.queryOptions,formatters:[_11d7.contentItemFactory("name",_11db,null,_11da,_11dd)],deselectOnRefresh:true,sort:this.queryOptions&&this.queryOptions.sort};},_updateQuery:function(query){if(query){this.grid.set("query",query);}else{this.grid.cleanup();}}});});},"epi-cms/widget/_ContentListBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/dom-geometry","dojo/when","./_GridWidgetBase"],function(_11de,lang,_11df,_11e0,when,_11e1){return _11de([_11e1],{storeKeyName:"epi.cms.content.search",trackActiveItem:false,gridAttachNode:null,_defaultGridNode:null,contextChangeEvent:"dblclick",postMixInProperties:function(){this.inherited(arguments);this.model=this.model||this.createModel();},postCreate:function(){this.inherited(arguments);this.createList();},createModel:function(){},createList:function(){var _11e2=this.getListSettings();_11e2=lang.mixin(_11e2,this.defaultGridMixin);if(!this.gridAttachNode){this._defaultGridNode=_11df.create("div",null,this.domNode);}this.grid=new this._gridClass(_11e2,this.gridAttachNode||this._defaultGridNode);var _11e3=this.model&&this.model.commands&&this.model.commands.length>0;if(_11e3){this.grid.contextMenu.addProvider(this.model);}if(this.contextMenu){this.grid.contextMenu=this.contextMenu;}this.own(this.grid);this.setupEvents();},layout:function(){this.inherited(arguments);if(this._defaultGridNode){_11e0.setMarginBox(this._defaultGridNode,this._contentBox);}},getListSettings:function(){return {};},setupEvents:function(){},onContextChanged:function(){},_onSelect:function(e){when(this.getCurrentContext(),lang.hitch(this,function(_11e4){var grid=this.grid;var model={contextId:_11e4.id,data:[]};if(this.model){for(var id in grid.selection){if(grid.selection[id]){var row=grid.row(id);model.data.push(row.data);}}this.model.set("model",model);}}));}});});},"epi-cms/widget/UploadUtil":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/dom-style"],function(array,lang,_11e5){return {StatusScope:{Single:0,All:1},validUploadFiles:function(files){if(!files||!(files instanceof Array)||files.length===0){return false;}return !array.some(files,function(item){return (item.name==null||item.size==null);});},addStatus:function(store,scope,_11e6,_11e7){var _11e8=[];if(store instanceof Array){_11e8=lang.clone(store);}var _11e9=array.some(_11e8,function(item){return (item.scope===scope&&item.itemName===_11e6&&item.message===_11e7);});if(!_11e9){_11e8.push({scope:scope,itemName:_11e6,message:_11e7});}return _11e8;},filterFileOnly:function(files){return array.filter(files,function(file){if(file.type===""&&(file.size===0||file.size%4096===0)){return false;}return true;});},toggleVisibility:function(_11ea,_11eb){_11e5.set(_11ea,"display",(_11eb?"block":"none"));},getFileArray:function(_11ec){if(!_11ec){return null;}if(_11ec instanceof Array){return _11ec;}if(typeof _11ec.item!=="function"){return null;}var i=0,total=_11ec.length,_11ed=[];for(i;i<total;i++){_11ed.push(_11ec.item(i));}return _11ed;}};});},"epi-cms/widget/viewmodel/FileListViewModel":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Stateful","epi/shell/_StatefulGetterSetterMixin","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles"],function(_11ee,array,lang,_11ef,_11f0,_11f1,_11f2){return _11ee([_11ef,_11f0],{progress:null,uploadFiles:null,uploadStatus:null,showProgressBar:false,_setUploadFilesAttr:function(files){if(!_11f1.validUploadFiles(files)){return;}var _11f3=[];array.forEach(files,function(file){_11f3.push({fileName:file.name,size:file.size,status:_11f2.uploadform.uploading});},this);this._set("uploadFiles",_11f3);},_setUploadStatusAttr:function(_11f4){var files=this.get("uploadFiles");if(array.some(files,function(item){return item.status!==_11f2.uploadform.uploading;})){return;}array.forEach(files,function(item){if(!_11f4||_11f4.length<=0){item.status=_11f2.uploadform.uploaded;return false;}if(_11f4[0]&&_11f4[0].scope===_11f1.StatusScope.All&&_11f4[0].itemName===""){item.status=_11f2.uploadform.failed;item.statusMessage=_11f4[0].message;return false;}var _11f5=array.filter(_11f4,function(_11f6){return item.fileName===_11f6.itemName;});if(_11f5&&_11f5.length>0){item.status=_11f2.uploadform.failed;item.statusMessage=_11f5[0].message;}else{item.status=_11f2.uploadform.uploaded;}},this);this._set("uploadFiles",files);},clear:function(){this._set("uploadFiles",null);}});});},"url:epi-cms/widget/templates/MultipleFileUpload.html":"<div class=\"epi-multiFileUpload\">\n    <form method=\"post\" action=\"\" enctype=\"multipart/form-data\">\n        <div data-dojo-attach-point=\"breadcrumbBar\" data-dojo-type=\"epi-cms/widget/Breadcrumb\"></div>\n        <div data-dojo-attach-point=\"uploadToolbar\" class=\"epi-toolbar-unwrapped\">\n            <span title=\"${res.uploadform.addfiles}\" >\n                <input type=\"file\" multiple=\"multiple\" data-dojo-type=\"dojox.form.Uploader\" data-dojo-attach-point=\"uploaderInput\" \n                    data-dojo-props=\"iconClass:'epi-iconPlus', showLabel: false, multiple: true\" />\n            </span>\n            <div data-dojo-attach-point=\"toolbarDisableLayer\"></div>\n        </div>\n        <div data-dojo-attach-point=\"fileList\" data-dojo-type=\"epi-cms/widget/FileList\"></div>\n    </form>\n</div>","epi-cms/widget/FileList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojox/form/uploader/Base","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dijit/ProgressBar","epi/shell/widget/_ModelBindingMixin","epi/shell/dgrid/Formatter","epi-cms/widget/UploadUtil","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.uploadform","dojo/text!./templates/FileList.html"],function(_11f7,lang,_11f8,_11f9,_11fa,_11fb,_11fc,_11fd,_11fe,_11ff,_1200,_1201,_1202,_1203,_1204,_1205){return _11f7([_11fc,_1201],{templateString:_1205,modelBindingMap:{showProgressBar:["showProgressBar"],progress:["progress"],uploadFiles:["uploadFiles"]},postCreate:function(){this.inherited(arguments);this._buildGrid();},_setUploadFilesAttr:function(files){this._bindData(files);},_setShowProgressBarAttr:function(show){_1203.toggleVisibility(this.progressBar.domNode,show);},_setProgressAttr:function(_1206){if(!_1206){return;}this.progressBar.update({progress:_1206.percent.replace("%","")});},_bindData:function(data){data=data||[];this._grid.refresh();this._grid.renderArray(data);},_buildGrid:function(){var _1207=_11f7([_11fd,_11ff,_1202]);this._grid=new _1207({columns:{fileName:{label:_1204.uploadfilename,field:"fileName",htmlEncode:true},size:{label:_1204.uploadfilesize,field:"size",get:lang.hitch(this,function(file){var _1208=this.convertBytes(file.size).value;if(isNaN(_1208)){return _1208;}var _1209=_1208===0?_1204.bytetext:_1204.bytestext;return lang.replace("{0} {1}",[_1208,_1209]);})},status:{label:_1204.uploadfilestatus,field:"status",renderCell:lang.hitch(this,function(item,value,node,_120a){_11f8.set(node,"title",item.statusMessage?item.statusMessage:"");_11fa.toggle(node,"epi-failedStatus",item.status===_1204.failed);node.innerHTML=item.status;})}}});this.own(this._grid);_11f9.place(this._grid.domNode,this.domNode);}});});},"dijit/ProgressBar":function(){require({cache:{"url:dijit/templates/ProgressBar.html":"<div class=\"dijitProgressBar dijitProgressBarEmpty\" role=\"progressbar\"\n\t><div  data-dojo-attach-point=\"internalProgress\" class=\"dijitProgressBarFull\"\n\t\t><div class=\"dijitProgressBarTile\" role=\"presentation\"></div\n\t\t><span style=\"visibility:hidden\">&#160;</span\n\t></div\n\t><div data-dojo-attach-point=\"labelNode\" class=\"dijitProgressBarLabel\" id=\"${id}_label\"></div\n\t><img data-dojo-attach-point=\"indeterminateHighContrastImage\" class=\"dijitProgressBarIndeterminateHighContrastImage\" alt=\"\"\n/></div>\n"}});define("dijit/ProgressBar",["require","dojo/_base/declare","dojo/dom-class","dojo/_base/lang","dojo/number","./_Widget","./_TemplatedMixin","dojo/text!./templates/ProgressBar.html"],function(_120b,_120c,_120d,lang,_120e,_120f,_1210,_1211){return _120c("dijit.ProgressBar",[_120f,_1210],{progress:"0",value:"",maximum:100,places:0,indeterminate:false,label:"",name:"",templateString:_1211,_indeterminateHighContrastImagePath:_120b.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);if(!(this.params&&"value" in this.params)){this.value=this.indeterminate?Infinity:this.progress;}},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());this.update();},update:function(_1212){lang.mixin(this,_1212||{});var tip=this.internalProgress,ap=this.domNode;var _1213=1;if(this.indeterminate){ap.removeAttribute("aria-valuenow");}else{if(String(this.progress).indexOf("%")!=-1){_1213=Math.min(parseFloat(this.progress)/100,1);this.progress=_1213*this.maximum;}else{this.progress=Math.min(this.progress,this.maximum);_1213=this.maximum?this.progress/this.maximum:0;}ap.setAttribute("aria-valuenow",this.progress);}ap.setAttribute("aria-labelledby",this.labelNode.id);ap.setAttribute("aria-valuemin",0);ap.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(_1213);_120d.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);tip.style.width=(_1213*100)+"%";this.onChange();},_setValueAttr:function(v){this._set("value",v);if(v==Infinity){this.update({indeterminate:true});}else{this.update({indeterminate:false,progress:v});}},_setLabelAttr:function(label){this._set("label",label);this.update();},_setIndeterminateAttr:function(_1214){this.indeterminate=_1214;this.update();},report:function(_1215){return this.label?this.label:(this.indeterminate?"&#160;":_120e.format(_1215,{type:"percent",places:this.places,locale:this.lang}));},onChange:function(){}});});},"url:dijit/templates/ProgressBar.html":"<div class=\"dijitProgressBar dijitProgressBarEmpty\" role=\"progressbar\"\n\t><div  data-dojo-attach-point=\"internalProgress\" class=\"dijitProgressBarFull\"\n\t\t><div class=\"dijitProgressBarTile\" role=\"presentation\"></div\n\t\t><span style=\"visibility:hidden\">&#160;</span\n\t></div\n\t><div data-dojo-attach-point=\"labelNode\" class=\"dijitProgressBarLabel\" id=\"${id}_label\"></div\n\t><img data-dojo-attach-point=\"indeterminateHighContrastImage\" class=\"dijitProgressBarIndeterminateHighContrastImage\" alt=\"\"\n/></div>\n","url:epi-cms/widget/templates/FileList.html":"<div class=\"epi-multiFileUpload-list\">\n    <div data-dojo-type=\"dijit/ProgressBar\" data-dojo-attach-point=\"progressBar\" data-dojo-props=\"maximum:100\"></div>\n</div>","epi/shell/form/uploader/HTML5":function(){define("epi/shell/form/uploader/HTML5",["dojo/_base/declare","dojo/_base/lang","dojox/form/uploader/plugins/HTML5","epi/shell/request/mutators"],function(_1216,lang,HTML5,_1217){var _1218=_1216([HTML5],{_headers:null,uploadWithFormData:function(data){return this._getHeadersThenExecute(this.getInherited(arguments),arguments);},sendAsBinary:function(data){return this._getHeadersThenExecute(this.getInherited(arguments),arguments);},createXhr:function(){var xhr=this.inherited(arguments),_1219=this._headers;if(_1219){for(var key in _1219){if(_1219.hasOwnProperty(key)){xhr.setRequestHeader(key,_1219[key]);}}}return xhr;},_getHeadersThenExecute:function(_121a,args){var _121b={options:{headers:{}}};return _1217.execute("beforeSend",_121b).then(lang.hitch(this,function(_121c){this._headers=_121c.options.headers;var _121d=_121a.apply(this,args);this._headers=null;return _121d;}));}});dojox.form.addUploaderPlugin(_1218);return _1218;});},"epi-cms/command/UploadContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi/shell/DestroyableByKey","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference"],function(_121e,_121f,_1220,_1221,_1222){return _121e([_121f,_1220],{fileList:null,createAsLocalAsset:false,_execute:function(){var _1223=_1222.toContentReference(this.model.contentLink).createVersionUnspecificReference();this.viewModel.upload(this.fileList,_1223.toString(),this.createAsLocalAsset);this.fileList=null;},_onModelChange:function(){var model=this.model,_1224=model&&_1221.hasProviderCapability(model.providerCapabilityMask,_1221.providerCapabilities.Create)&&_1221.hasAccess(model.accessMask,_1221.accessLevel.Create);this.destroyByKey("isSearchingWatch");this.viewModel&&this.ownByKey("isSearchingWatch",this.viewModel.watch("isSearching",this._onModelChange.bind(this)));this.set("canExecute",!!(_1224&&this.viewModel&&!this.viewModel.get("isSearching")));}});});},"epi-cms/command/EditImage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","epi/dependency","epi/routes","epi/Url","epi/UriParser","epi/shell/TypeDescriptorManager","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/legacy/LegacyDialogPopup","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/shell/command/_SelectionCommandMixin"],function(_1225,lang,topic,_1226,_1227,Url,_1228,_1229,_122a,_122b,_122c,_122d,_122e){return _1225([_122d,_122e],{canExecute:false,iconClass:"epi-iconNewWindow",_segmentIdSeperator:",,",postscript:function(){this.inherited(arguments);this.contextService=this.contextService||_1226.resolve("epi.shell.ContextService");},getRouteParams:function(){var _122f=this._getTarget();return this.contextService.query({uri:"epi.cms.contentdata:///"+_122f.contentLink}).then(function(_1230){var _1231=new _1228(_1230.uri).getId();return {moduleArea:"LegacyCMS",path:"Edit/ImageEditor/ImageEditor.aspx",IsInLegacyWrapper:false,imageId:_1231};});},_createDialog:function(_1232,_1233){var _1234=this._getTarget();if(_1234){var _1235=function(_1236){if(_1236){topic.publish("/epi/shell/context/request",{url:_1236.src},{forceReload:true});}};lang.mixin(_1232,{url:_1227.getActionPath(_1233),dialogArguments:{src:_1234.permanentLink,contentLink:_1233.imageId},onCallback:_1235});}return new _122c(_1232);},_onModelChange:function(){if(!_122a.imageEditorEnabled){if(this.get("isAvailable")){this.set("isAvailable",false);}return;}var _1237=this._getTarget(),_1238=this.model&&_1237&&_1229.isBaseTypeIdentifier(_1237.typeIdentifier,"episerver.core.icontentimage");this.set("canExecute",!!_1238);},_getTarget:function(){var _1239=this.selection&&this.selection.data,_123a=_1239&&_1239.length===1&&_1239[0];return _123a&&(_123a.type==="epi.cms.contentdata")?_123a.data:null;}});});},"epi-cms/legacy/LegacyDialogPopup":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/Deferred","dojo/DeferredList","epi","epi/shell/widget/dialog/Dialog"],function(_123b,lang,_123c,_123d,_123e,_123f,epi,_1240){return _123b([_1240],{url:null,dialogArguments:null,callbackArguments:null,features:null,autoFit:false,showLoadingOverlay:false,legacyDialogObject:null,defaultActionsVisible:false,legacyButtonQuery:null,contentClass:"epi-dialog-fullWidth",dialogClass:"",dialogTitle:null,_legacyDialogContainer:null,_legacyDialogLoadDeferred:null,wrapper:null,buildRendering:function(){this.inherited(arguments);_123c.add(this.domNode,"epi-legacyDialog");},postCreate:function(){this.inherited(arguments);this._legacyDialogContainer=_123d.create("div");this.set("content",this._legacyDialogContainer);},onCallback:function(_1241,_1242){},onClose:function(){},onLoad:function(_1243){},onMapDialogButton:function(_1244){return true;},onBeforePerformAction:function(_1245){},show:function(){var _1246=new _123f([this._loadLegacyDialog(),this.inherited(arguments)]);return _1246.then(lang.hitch(this,function(_1247){var _1248=_1247[1];if(this.features&&this.features.left&&this.features.top){this.dialog._relativePosition={x:this.features.left,y:this.features.top};}return _1248;}));},_loadLegacyDialog:function(){if(this._legacyDialogLoadDeferred){return this._legacyDialogLoadDeferred;}this._legacyDialogLoadDeferred=new _123e();require(["epi-cms/legacy/LegacyDialogWrapper"],lang.hitch(this,function(_1249){var _124a=new _1249({url:this.url,dialogArguments:this.dialogArguments,callbackArguments:this.callbackArguments,features:this.features,autoFit:this.autoFit,showLoadingOverlay:this.showLoadingOverlay,dialogTitle:this.dialogTitle,legacyButtonQuery:this.legacyButtonQuery,showCloseButton:this.showCloseButton,opener:this.opener},this._legacyDialogContainer);if(this._started&&!_124a._started){_124a.startup();}this.legacyDialogObject=_124a.getLegacyDialog();this.connect(_124a,"onMapDialogButton",this.onMapDialogButton);this.connect(_124a,"onBeforePerformAction",this.onBeforePerformAction);this.connect(_124a,"onCallback",function(_124b,_124c){this.onCallback(_124b,_124c);setTimeout(lang.hitch(this,function(){this.hide();}),1);});this.connect(_124a,"onLoad",function(){this.set("title",_124a.title);this.onLoad(_124a);});this.connect(_124a,"onCancel",function(){this.hide();});this.connect(_124a,"onResize",function(){this.resize();});this.connect(this,"onHide",function(){this.onClose();});this.wrapper=_124a;this._legacyDialogLoadDeferred.resolve();}));return this._legacyDialogLoadDeferred;}});});},"epi-cms/contentediting/command/_LegacyDialogCommandBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","epi/routes","epi/shell/command/_Command","epi/UriParser","epi-cms/core/ContentReference","epi-cms/legacy/LegacyDialogPopup"],function(_124d,lang,_124e,topic,_124f,_1250,_1251,_1252,_1253){return _124d([_1250],{dialogPath:null,raiseCloseEvent:null,routeParams:null,dialogParams:null,canExecute:true,getContentReference:function(_1254){var _1255=lang.getObject("model.contentData.contentLink",false,this),_1256=_1255?new _1252(_1255):null;if(_1256){_1256=_1254?_1256.toString():_1256.createVersionUnspecificReference().toString();}return _1256;},getRouteParams:function(){return {id:this.getContentReference(),path:this.dialogPath,moduleArea:"LegacyCMS",IsInLegacyWrapper:true};},getDialogParams:function(){return {};},_createDialog:function(_1257,_1258){var _1259={url:_124f.getActionPath(_1258),dialogArguments:window.document,autoFit:true,onClose:lang.hitch(this,function(){var _125a=this.getContentReference();if(this.raiseCloseEvent&&_125a){topic.publish("/epi/cms/contentdata/updated",{contentLink:_125a,recursive:true});}})};return new _1253(lang.mixin({},_1259,_1257));},_execute:function(){_124e([this.getDialogParams(),this.getRouteParams()]).then(lang.hitch(this,function(_125b){var _125c=this._createDialog.apply(this,_125b);_125c.show();}));}});});},"epi-cms/command/DownloadMedia":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/dom-construct","dojo/has","dojo/sniff","dojo/when","epi/shell/Downloader","epi/shell/TypeDescriptorManager","epi/shell/command/_Command","epi/shell/command/_SelectionCommandMixin","epi/i18n!epi/cms/nls/episerver.cms.command"],function(_125d,_125e,_125f,has,sniff,when,_1260,_1261,_1262,_1263,_1264){return _125d([_1262,_1263],{label:_1264.download,tooltip:_1264.download,iconClass:"epi-iconDownload",_execute:function(){var _1265=this._getContentData();if(!_1265){return;}_1260.download(_1265.downloadUrl,_1265.name);},_onModelChange:function(){var _1266=this._getContentData(),_1267=_1266&&_1266.downloadUrl,_1268=_1266&&_1266.typeIdentifier,_1269=_1268&&_1261.getValue(_1268,"actAsAnAsset");this.set("canExecute",!!(_1269&&_1267));},_getContentData:function(){var _126a=null;if(this.selection&&this.selection.data&&this.selection.data instanceof Array&&this.selection.data.length===1){_126a=this.selection.data[0].data;}return _126a;}});});},"epi-cms/widget/HierarchicalList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/keys","dojo/on","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dojox/html/entities","epi/string","epi/shell/command/_WidgetCommandBinderMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/DestroyableByKey","epi/shell/widget/dialog/Alert","epi/shell/widget/ContextMenu","epi/shell/widget/SearchBox","epi-cms/widget/FolderTree","epi-cms/widget/ContentList","epi-cms/widget/FilesUploadDropZone","epi-cms/widget/UploadUtil","epi-cms/widget/viewmodel/HierarchicalListViewModel","dojo/text!./templates/HierarchicalList.html","dojo/text!./templates/AssetsDropZone.html","epi/i18n!epi/cms/nls/episerver.cms.widget.hierachicallist"],function(array,_126b,lang,_126c,_126d,_126e,_126f,_1270,keys,on,when,_1271,_1272,_1273,_1274,_1275,_1276,_1277,_1278,_1279,Alert,_127a,_127b,_127c,_127d,_127e,_127f,_1280,_1281,_1282,res){return _126b([_1273,_1271,_1272,_1278,_1277,_1279],{contextMenu:null,templateString:_1281,showRoot:false,showThumbnail:false,enableDndFileDropZone:false,showCreateContentArea:false,triggerContextChange:false,res:res,modelClassName:_1280,hierarchicalListClass:"",noDataMessage:"",noSearchResultMessage:res.nosearchresults,createContentIcon:"",createContentText:"",modelBindingMap:{searchRoots:["searchRoots"],searchArea:["searchArea"],listQuery:["listQuery"],currentTreeItem:["currentTreeItem"],currentListItem:["currentListItem"],editingListItem:["editingListItem"],searchListQuery:["searchListQuery"]},_setSearchAreaAttr:function(value){this.searchBox.set("area",value);},_setSearchRootsAttr:function(value){this.searchBox.set("searchRoots",value);},_setListQueryAttr:function(value){this.list.set("query",value);},_setSearchListQueryAttr:function(value){this.searchResultList.set("query",value);this._showSearchResults(value);},_setCurrentTreeItemAttr:function(value){if(value){this._toggleActive(this.tree,this.list);when(this.tree.selectContent(value.toString()),lang.hitch(this,function(){var _1283=this.tree.getNodesByItem(value.toString())[0];if(_1283){this.tree.model.set("previousSelection",{selectedContent:_1283,selectedAncestors:_1283.getTreePath()});}}));}},_setCurrentListItemAttr:function(value){this.list.set("currentItem",value);this._toggleActive(this.list,this.tree);},_setEditingListItemAttr:function(value){this.list.set("editingItem",value);},_setShowRootAttr:function(value){this.tree.set("showRoot",value);},postMixInProperties:function(){this.inherited(arguments);if(!this.model&&!this.commandProvider&&this.modelClassName){var _1284=_126b(this.modelClassName);this.model=this.commandProvider=new _1284({repositoryKey:this.repositoryKey});}this.setupContextMenu();},setupContextMenu:function(){this.own(this.contextMenu=new _127a({category:"context"}));this.contextMenu.addProvider(this.model);},postCreate:function(){this.inherited(arguments);_126d.add(this.domNode,this.hierarchicalListClass);this._setupTree();this._setupCreateContentArea();this._setupList();if(this.enableDndFileDropZone){this._setupDropZone();}this._toggleCreateContentArea(this.showCreateContentArea);this.model.startup();this.own(this.model.clipboardManager.watch("data",lang.hitch(this,this._updateClipboardIndicators)),this.searchBox.on("searchBoxChange",lang.hitch(this,this._onSearchTextChanged)),this.model.watch("isSearching",lang.hitch(this,function(){if(this._dropZone){this._dropZone.set("enabled",!this.model.get("isSearching"));}})));},startup:function(){this.inherited(arguments);if(this.contextMenu){this.contextMenu.startup();}},destroy:function(){this.model.destroy();this.inherited(arguments);},layout:function(){if(this.enableDndFileDropZone){var grid=this.list.grid;if(grid){_126d.add(grid.bodyNode,"epi-drop-area");}var _1285=this.searchResultList.grid;if(_1285){_126d.add(_1285.bodyNode,"epi-drop-area");}}var _1286=_126f.getMarginBox(this.searchBoxNode),_1287={h:this._contentBox.h-_1286.h,w:this._contentBox.w,l:this._contentBox.l,t:this._contentBox.t};this.container.resize(_1287);},_toggleCreateContentArea:function(_1288){_1270.set(this.createContentArea.domNode,"display",_1288?"":"none");this.listContainer.layout();},_toggleActive:function(_1289,_128a){_126d.remove(_128a.domNode,"epi-focused");_126d.add(_1289.domNode,"epi-focused");},_showNotification:function(_128b){var _128c=new Alert({description:_1276.toHTML(_128b)});_128c.show();},_onSearchTextChanged:function(_128d){this._wireItemSelectedEvent(_128d?this.searchResultList:this.list);this.model.onSearchTextChanged(_128d);},_showSearchResults:function(_128e){_1270.set(this.contentNode,"display",!!_128e?"none":"");_1270.set(this.resultNode,"display",!_128e?"none":"");this.container.layout();},_onDrop:function(evt,_128f){_128f=_127f.filterFileOnly(_128f);if(!_128f||_128f.length<=0){return;}var _1290=this.model.getCommand("uploadDefault");if(!_1290){return;}_1290.set("fileList",_128f);_1290.execute();this.searchBox.clearValue();},_setupDropZone:function(){this.own(this._dropZone=new _127e({templateString:_1282,res:res,outsideDomNode:this.container.domNode}));_126e.place(this._dropZone.domNode,this.domNode,"first");this.connect(this._dropZone,"onDrop",this._onDrop);var _1291=this.model.getCommand("uploadDefault");if(_1291){var _1292=this._dropZone;this.own(_1291.watch("canExecute",function(name,_1293,_1294){_1292.set("enabled",_1294);}));}},_setupTree:function(){var _1295=this.model._commandRegistry;function _1296(item,node,e){this.model.onTreeItemSelected(item,this.tree.model.isTypeOfRoot(item));};function _1297(copy){copy?_1295.copy.command.execute():_1295.cut.command.execute();};this.own(on(this.tree,"copyOrCut",_1297),on(this.tree,"select",lang.hitch(this,_1296)),on(this.tree,"paste",function(){_1295.paste.command.execute();}),on(this.tree,"delete",function(){_1295["delete"].command.execute();}),_126c.after(this.tree,"onClick",lang.hitch(this,_1296),true));this.model._commandRegistry.rename.command.set("renameDelegate",lang.hitch(this,function(model){this.tree.getNodesByItem(model)[0].edit();}));},_setupCreateContentArea:function(){this.createContentAreaButton.set("iconClass",this.createContentIcon);this.createContentAreaButton.set("label",this.createContentText);this.own(this.createContentAreaButton.on("click",lang.hitch(this,"_onCreateAreaClick")));},_wireItemSelectedEvent:function(list){this.destroyByKey("itemSelectedWatch");this.ownByKey("itemSelectedWatch",on(list,"itemSelected",lang.hitch(this.model,this.model.onListItemSelected)));},_setupList:function(){var _1298=this.model._commandRegistry;this._wireItemSelectedEvent(this.list);this.own(_126c.after(this.model,"onListItemUpdated",lang.hitch(this.list,function(_1299){when(_1299,lang.hitch(this,this.editContent));})),this.searchResultList.grid.addKeyHandler(keys.ESCAPE,lang.hitch(this.searchBox,this.searchBox.clearValue)),_126c.after(this.model.treeStoreModel,"onDeleted",lang.hitch(this,function(items){array.forEach(items,function(item){var _129a=this.searchResultList.grid.row(item.data.contentLink);if(_129a&&_129a.data){this.searchResultList.grid.removeRow(_129a);}},this);}),true));this.searchBox.on("keyup",lang.hitch(this,function(e){if(e.keyCode===keys.ENTER){e.preventDefault();this.searchResultList.editSelectedContent();}}));this.searchBox.on("keydown",lang.hitch(this,function(e){if(e.keyCode===keys.DOWN_ARROW||e.keyCode===keys.UP_ARROW){e.preventDefault();this.searchResultList.grid.moveSelection(e.keyCode===keys.UP_ARROW);}}));if(this.model.changeContextOnItemSelection){var _129b=function(){_1298.edit.command.execute();};this.own(on(this.list,"itemAction",_129b),on(this.searchResultList,"itemAction",_129b));}if(this.showThumbnail){_126d.add(this.list.grid.domNode,"epi-thumbnailContentList");_126d.add(this.searchResultList.grid.domNode,"epi-thumbnailContentList");}this.list.set("noDataMessage",this.noDataMessage);this.searchResultList.set("noDataMessage",this.noSearchResultMessage);},_onCreateAreaClick:function(){this.list.emit("createItemAction",{});},_onSearchAction:function(value){this.model.onSearch(value.metadata);},_updateClipboardIndicators:function(name,_129c,_129d){var _129e=this.model.clipboardManager.isCopy();if(_129c instanceof Array){array.forEach(_129c,function(clip){this.tree.toggleCut(clip.data,false);this.list.toggleCut(clip.data,false);this.searchResultList.toggleCut(clip.data,false);},this);}if(!_129e&&_129d instanceof Array){array.forEach(_129d,function(clip){this.tree.toggleCut(clip.data,true);this.list.toggleCut(clip.data,true);this.searchResultList.toggleCut(clip.data,true);},this);}}});});},"epi-cms/widget/FolderTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/aspect","dojo/json","dojo/when","dojox/html/entities","dijit/tree/_dndSelector","epi/dependency","epi/string","epi-cms/widget/_FolderTreeNode","epi-cms/widget/ContentTree","epi-cms/widget/ContentTreeStoreModel"],function(array,_129f,lang,_12a0,_12a1,_12a2,json,when,_12a3,_12a4,_12a5,_12a6,_12a7,_12a8,_12a9){return _129f([_12a8],{handleSelection:true,postCreate:function(){var self=this;self.inherited(arguments);self.own(self.connect(self.model,"onDeleted",lang.hitch(self,self._onDeleted)),_12a2.around(self.model,"onRefreshRoots",function(_12aa){return function(_12ab){if(_12ab&&typeof self._onItemDelete==="function"){self._onItemDelete(_12ab);}return _12aa.apply(self.model,[_12ab]);};}));},toggleCut:function(item,isCut){var node=this.tree.getNodesByItem(item)[0];if(node){_12a1.toggle(node.rowNode,"epi-opacity50",isCut);}},_createTreeModel:function(){return new _12a9({store:this.store});},_updateItemDeletedHierachy:function(node){if(!node){return;}array.forEach(node.getChildren(),function(_12ac){_12ac.set({item:lang.mixin(_12ac.item,{isDeleted:true})});this._updateItemDeletedHierachy(_12ac);},this);},_onDeleted:function(item){var nodes=this.getNodesByItem(item);array.forEach(nodes,function(node){this._updateItemDeletedHierachy(node);},this);},_renameFolder:function(item,name){var _12ad=lang.trim(name),_12ae=this.getNodesByItem(item)[0];if(_12ad){when(this.model.rename(item.contentLink,_12ad)).otherwise(function(ex){_12ae.rollbackLabel(item.name,ex);_12ae.edit();});}else{_12ae.rollbackLabel(item.name);}},buildNodeFromTemplate:function(args){var _12af=new _12a7(args);_12af.bindContextMenu(this.contextMenu);this.own(_12af.on("rename",lang.hitch(this,function(val){this._renameFolder(_12af.item,val);})));return _12af;},_onNodeMouseEnter:function(node,evt){this.inherited(arguments);node._handleMouseEnter();},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);node._handleMouseLeave();},_onClick:function(node,evt){this.inherited(arguments);node._onClick();}});});},"epi-cms/widget/_FolderTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/Evented","dojo/Deferred","dojo/keys","dojo/on","dojo/when","dojox/html/entities","dojo/text!./templates/_FolderTreeNode.html","dijit/form/TextBox","dijit/form/ValidationTextBox","dijit/InlineEditBox","epi","epi-cms/widget/_ContentTreeNode"],function(_12b0,lang,_12b1,_12b2,_12b3,_12b4,_12b5,_12b6,keys,on,when,_12b7,_12b8,_12b9,_12ba,_12bb,epi,_12bc){_12b0("_TreeInlineEditor",[_12bb._InlineEditor],{postCreate:function(){this.inherited(arguments);this.own(on(this.domNode,"mousedown, mouseup, click, keydown, keypress, selectstart",function(e){e.stopPropagation();}));}});var _12bd={normal:0,root:1};return _12b0([_12bc,_12b5],{templateString:_12b8,_blockFolderMenu:"epi-iconContextMenu",_blockFolderDnDIcon:"epi-iconDnD",_blockFolderExpand:"epi-iconObjectFolderOpen",_blockFolderCollapse:"epi-iconObjectFolder",_isResetValue:false,_menuTooltip:undefined,contextMenu:null,_editWidget:null,_rowStates:{NORMAL:1,EXPANDED:2,ENTERED:4,SELECTED:8},_currentRowState:1,postMixInProperties:function(){this.inherited(arguments);this._menuTooltip=epi.resources.action.options;},postCreate:function(){this.inherited(arguments);_12b4.set(this.iconNodeMenu,"zIndex",_12b3.position(this.rowNode).zIndex+1);this._updateStyle();},buildRendering:function(){this.inherited(arguments);this.labelWidget=new _12bb({value:this.label,editorWrapper:"_TreeInlineEditor",editor:"dijit/form/ValidationTextBox",width:"auto",editorParams:{maxLength:255},_onMouseOver:function(){},_onClick:function(){},onChange:lang.hitch(this,this._onChangeLabelValue),onCancel:lang.hitch(this,function(){this.emit("cancelEdit",this.item.contentLink);this._resetValue();this._setEditorState();})},this.labelNode);},edit:function(){this.labelWidget.value=this.label;this.labelWidget.edit();this._editWidget=this.labelWidget.wrapperWidget.editWidget;this.own(on(this._editWidget.domNode,"keydown",lang.hitch(this,function(e){if(!this._editWidget.isValid()&&e.keyCode!==keys.ENTER){this._setEditorState();}})));},_resetValue:function(val){this._isResetValue=true;this.labelWidget.set("value",val||this.label);},_onChangeLabelValue:function(val){if(!val){this._resetValue();return;}if(!this._isResetValue){this.emit("rename",val);}this._isResetValue=false;},_onClick:function(evt){this.inherited(arguments);_12b2.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");this.emit("nodeSelected",this);},rollbackLabel:function(val,error){if(!this.labelWidget.value){this._resetValue(val);}if(error&&error.length>0){this._setEditorState(error[0].errorMessage);}},bindContextMenu:function(menu){this.contextMenu=menu;this.connect(this.iconNodeMenu,"onclick","_onIconNodeMenuClick");},collapse:function(){var self=this,def=new _12b6();when(self.inherited(arguments),function(){self._currentRowState=self._currentRowState^self._rowStates.EXPANDED;self._updateStyle();def.resolve(true);});return def;},expand:function(){var self=this,def=new _12b6();when(self.inherited(arguments),function(){self._currentRowState=self._currentRowState|self._rowStates.EXPANDED;self._updateStyle();def.resolve();});return def;},setSelected:function(_12be){if(!this.tree.getNodesByItem(this.item)[0]){return;}this.inherited(arguments);var _12bf=this._currentRowState;this._currentRowState=_12be?(this._currentRowState|this._rowStates.SELECTED):parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0?(this._currentRowState^this._rowStates.SELECTED):_12bf;this._updateStyle();if(_12be){this.emit("nodeSelected",this);}},_updateIndividualLayout:function(){this._updateStyleBySingleState();if(this.item&&this.item.contentLink){this.emit("nodeRefreshed",this.item.contentLink);}},_updateBlockFolderTypeIcon:function(){if(this._isTypeOfRoot()){this._iconNodeClass=this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse);}else{this._iconNodeClass=this.isExpanded?this._blockFolderExpand:this._blockFolderCollapse;}_12b2.add(this.iconNode,this._iconNodeClass);},_handleMouseEnter:function(){this._currentRowState=this._currentRowState|this._rowStates.ENTERED;this._updateStyle();_12b2.remove(this.labelNode,"dijitInlineEditBoxDisplayModeHover");},_handleMouseLeave:function(){this._currentRowState=this._currentRowState^this._rowStates.ENTERED;this._updateStyle();},_onIconNodeMenuClick:function(evt){this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});this.emit("nodeSelected",this);},_updateStyleBySingleState:function(_12c0){var _12c1=this._rowStates;switch(_12c0){case _12c1.SELECTED:case _12c1.ENTERED:if(this.contextMenu){_12b2.add(this.iconNodeMenu,this._blockFolderMenu);}break;default:if(this.contextMenu){_12b2.remove(this.iconNodeMenu,this._blockFolderMenu);}_12b2.remove(this.iconNode,this._blockFolderExpand);_12b2.remove(this.iconNode,this._blockFolderCollapse);var _12c2=this.isExpanded&&this.hasChildren()?this._blockFolderExpand:this._blockFolderCollapse;_12b2.add(this.iconNode,this._isTypeOfRoot()?this.tree.model.getObjectIconClass(this.item,this._blockFolderCollapse):_12c2);if(this.contextMenu&&parseInt(this._currentRowState&this._rowStates.SELECTED,10)>0){_12b2.add(this.iconNodeMenu,this._blockFolderMenu);}break;}},_updateStyle:function(){for(var _12c3 in this._rowStates){if(parseInt(this._currentRowState&this._rowStates[_12c3],10)>0){this._updateStyleBySingleState(this._rowStates[_12c3]);}}},_addLanguageIndicator:function(){this.inherited(arguments);_12b1.remove(this.iconNodeLanguage,"title");},_setEditorState:function(_12c4){if(this._editWidget){_12c4=_12b7.encode(_12c4);this._editWidget.invalidMessage=_12c4||"";this._editWidget.set("state",_12c4?"Error":"");this._editWidget.isValid=function(){return !_12c4;};this._editWidget.validate();}}});});},"url:epi-cms/widget/templates/_FolderTreeNode.html":"<div class=\"dijitTreeNode epi-folderTreeNode\" role=\"presentation\">\n    <div tabindex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon dijitTreeIcon\" role=\"presentation\" title=\"${_menuTooltip}\">&nbsp;</span>\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-ft-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\n            </span>\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\n        </span>\n    </div>\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\n</div>","epi-cms/widget/ContentList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/aspect","dojo/Evented","dojo/on","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","dojox/html/entities","epi","epi/shell/dgrid/Formatter","epi/shell/dgrid/selection/Extensions","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/dgrid/formatters","epi-cms/dgrid/DnD","epi-cms/dgrid/WithContextMenu","epi-cms/widget/ReadOnlyContentList"],function(_12c5,lang,_12c6,_12c7,_12c8,_12c9,on,_12ca,_12cb,_12cc,_12cd,epi,_12ce,_12cf,_12d0,_12d1,_12d2,DnD,_12d3,_12d4){return _12c5([_12d4,_12c9],{_gridClass:_12c5([_12cb,_12ce,_12cc,_12cf,DnD,_12ca,_12d3]),resources:"",noDataMessage:null,editingItem:null,postCreate:function(){this.inherited(arguments);_12c6.add(this.domNode,"epi-contentList");},_setCurrentItemAttr:function(value){if(!this.get("editingItem")){this.set("editingItem",value);}this._set("currentItem",value);this.select(value);},_setNoDataMessageAttr:function(value){this.noDataMessage=value;this.grid.set("noDataMessage",value);},_dndNodeCreator:function(item,hint){var _12d5=_12d0.getAndConcatenateValues(item.typeIdentifier,"dndTypes");if(!_12d5&&this.dndTypes){_12d5=this.dndTypes;}return {node:_12c7.create("div").appendChild(document.createTextNode(item.name)),type:_12d5,data:item};},getListSettings:function(){var menu={hasMenu:!!this.contextMenu,settings:{title:epi.resources.action.options}};return lang.delegate(this._getBaseSettings(menu),{noDataMessage:this.noDataMessage,dndParams:{copyOnly:true,selfAccept:false,accept:[],creator:lang.hitch(this,this._dndNodeCreator)}});},setupEvents:function(){this.inherited(arguments);this.own(_12c8.around(this.grid,"insertRow",lang.hitch(this,this._aroundInsertRow)),this.grid.on("dgrid-contextmenu",lang.hitch(this,"_itemSelected")));},_onSelect:function(evt){this.inherited(arguments);if(this.grid.selectionMode==="single"){this._itemSelected(evt.rows[0].element);}},_itemSelected:function(_12d6){var row=this.grid.row(_12d6);this.emit("itemSelected",row.data);},editContent:function(item){if(!item||!this.grid.row(item).element){return;}this.emit("itemAction",item);this.set("editingItem",this.currentItem);},editSelectedContent:function(){var _12d7=this.grid.getFirstSelectedRow();if(!_12d7){return;}this.editContent(_12d7.data);},_onChangeContext:function(evt){var grid=this.grid;on.once(grid.domNode,"dgrid-refresh-complete",function(evt){grid.focus(grid.getFirstSelectedRow());});this.editContent(grid.row(evt).data);},toggleCut:function(item,isCut){var row;if(item){row=this.grid.row(_12d1.toContentReference(item.contentLink).id);if(row&&row.element){_12c6.toggle(row.element,"epi-opacity50",isCut);}}}});});},"epi/shell/dgrid/selection/Extensions":function(){define("epi/shell/dgrid/selection/Extensions",["dojo/_base/declare","dojo/query"],function(_12d8,query){return _12d8([],{moveSelectionUp:function(){return this.moveSelection(true);},moveSelectionDown:function(){return this.moveSelection(false);},moveSelection:function(up){var _12d9=this.getFirstSelectedRow();if(!_12d9){return this._selectFirstRow();}this.clearSelection();_12d9=up?this.up(_12d9,1,true):this.down(_12d9,1,true);this.select(_12d9,1,true);return _12d9;},hasSelection:function(){return Object.keys(this.selection).length>0;},getFirstSelectedRow:function(){if(!this.hasSelection()){return null;}var row=this.row(Object.keys(this.selection)[0]);if(row&&!row.data){return null;}return row;},_selectFirstRow:function(){var rows=query(".dgrid-row",this.domNode);if(rows.length===0){return null;}var _12da=this.row(rows[0]);if(!_12da){return null;}this.select(_12da,1,true);return _12da;}});});},"epi-cms/widget/FilesUploadDropZone":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dijit/_Widget","dijit/_TemplatedMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.uploadmultiplefiles.dropzone","dojo/text!./templates/FilesUploadDropZone.html"],function(_12db,lang,_12dc,_12dd,_12de,_12df,_12e0,_12e1){return _12db([_12de,_12df],{res:_12e0,templateString:_12e1,dragStartCssClass:"epi-dragStart",dragOverCssClass:"epi-dragOver",outsideDomNode:null,enabled:true,postCreate:function(){this.inherited(arguments);if(this.outsideDomNode){this.connect(this.outsideDomNode,"dragover",lang.hitch(this,this._onDragOverOutside));this.connect(this.outsideDomNode,"dragleave",lang.hitch(this,function(evt){this._onDragLeave(evt,this.outsideDomNode);}));this.connect(this.outsideDomNode,"dragend",lang.hitch(this,this._onDragLeave));this.connect(this.outsideDomNode,"drop",lang.hitch(this,this._onDragLeave));}this.connect(this.domNode,"dragover",lang.hitch(this,this._onDragOver));this.connect(this.domNode,"dragleave",lang.hitch(this,this._onDragLeave));this.connect(this.domNode,"dragend",lang.hitch(this,this._onDragLeave));this.connect(this.domNode,"drop",lang.hitch(this,this._onDrop));},_onDragOverOutside:function(evt){if(!this.enabled){return;}evt.preventDefault();_12dc.add(this.domNode,this.dragStartCssClass);},_isHover:function(evt,_12e2){var _12e3=_12dd.position(_12e2),_12e4=evt.clientX,_12e5=evt.clientY;return !(_12e4<_12e3.x||_12e4>(_12e3.x+_12e3.w)||_12e5<_12e3.y||_12e5>(_12e3.y+_12e3.h));},_onDragOver:function(evt){if(!this.enabled){return;}evt.preventDefault();_12dc.remove(this.domNode,this.dragStartCssClass);_12dc.add(this.domNode,this.dragOverCssClass);},_onDragLeave:function(evt,_12e6){if(!this.enabled){return;}evt.preventDefault();if(!this._isHover(evt,_12e6||this.domNode)){this._removeAllCssClasses();}},onDrop:function(evt,files){},_onDrop:function(evt){if(!this.enabled){return;}evt.preventDefault();this._removeAllCssClasses();this.onDrop(evt,evt.dataTransfer.files);},_removeAllCssClasses:function(){_12dc.remove(this.domNode,this.dragStartCssClass);_12dc.remove(this.domNode,this.dragOverCssClass);}});});},"url:epi-cms/widget/templates/FilesUploadDropZone.html":"<div class=\"epi-filesUploadDropZone\">\n    <div>\n        <span data-dojo-attach-point=\"description\">${res.description}</span>\n    </div>\n</div>","url:epi-cms/widget/templates/HierarchicalList.html":"<div class=\"epi-hierarchicalList\">\n    <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxNode\">\n        <div data-dojo-attach-point=\"searchBox\"\n             data-dojo-type=\"epi/shell/widget/SearchBox\"\n             data-dojo-props=\"triggerContextChange: this.triggerContextChange, triggerChangeOnEnter: true, encodeSearchText: true\">\n        </div>\n    </div>\n    <div data-dojo-attach-point=\"container\"\n         data-dojo-type=\"dijit/layout/BorderContainer\"\n         data-dojo-props=\"gutters: false\">\n\n        <div data-dojo-attach-point=\"contentNode\">\n            <div class=\"epi-secondaryGadgetContainer epi-gadgetTopContainer\"\n                 data-dojo-attach-point=\"tree\"\n                 data-dojo-type=\"epi-cms/widget/FolderTree\"\n                 data-dojo-props=\"region:'center', splitter:false, model: this.model.treeStoreModel, showRoot: false, contextMenu: this.contextMenu\"></div>\n            <div class=\"epi-gadgetBottomContainer\"\n                 data-dojo-attach-point=\"listContainer\"\n                 data-dojo-type=\"dijit/layout/BorderContainer\"\n                 data-dojo-props=\"region:'bottom', splitter:true, gutters: false\">\n                <div class=\"epi-createContentContainer\"\n                     data-dojo-attach-point=\"createContentArea\"\n                     data-dojo-type=\"dijit/layout/_LayoutWidget\"\n                     data-dojo-props=\"region:'top', splitter:false\">\n                    <button type=\"button\" class=\"epi-flat epi-chromeless\"\n                            data-dojo-type=\"dijit/form/Button\"\n                            data-dojo-attach-point=\"createContentAreaButton\"></button>\n                </div>\n                <div data-dojo-attach-point=\"list\"\n                     data-dojo-type=\"epi-cms/widget/ContentList\"\n                     data-dojo-props=\"region:'center', splitter:false, store: this.model.store, queryOptions: this.model.listQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\n                </div>\n            </div>\n        </div>\n        <div data-dojo-attach-point=\"resultNode\" style=\"display:none\">\n            <div data-dojo-attach-point=\"searchResultList\"\n                 data-dojo-type=\"epi-cms/widget/ContentList\"\n                 data-dojo-props=\"region:'center', splitter:false, store: this.model.searchStore, queryOptions: this.model.searchResultQueryOptions, contextMenu: this.contextMenu, resources: this.res\">\n            </div>\n        </div>\n    </div>\n</div>\n","url:epi-cms/widget/templates/AssetsDropZone.html":"<div class=\"epi-assetsDropZone\">\n    <span class=\"dijitReset dijitInline epi-dropZoneText\">${res.dropzonedescription}</span>\n</div>\n","epi-cms/component/PageNavigationTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi-cms/ApplicationSettings","../command/NewContent","./command/ViewTrash","./ContentNavigationTree","epi/i18n!epi/cms/nls/episerver.cms.components.createpage"],function(array,_12e7,lang,topic,when,_12e8,_12e9,_12ea,_12eb,_12ec){return _12e7([_12eb],{betweenThreshold:5,expandExtraNodeItems:_12e8.startPage,allowSorting:true,postMixInProperties:function(){this.inherited(arguments);this.checkAcceptance=lang.hitch(this,this.checkAcceptance);this.checkItemAcceptance=lang.hitch(this,this.checkItemAcceptance);},checkAcceptance:function(_12ed,nodes){return _12ed===this.tree.dndController;},checkItemAcceptance:function(_12ee,_12ef,_12f0){return this.allowSorting||_12f0==="over";},_startupCommands:function(){this.inherited(arguments);this._createCommand=new _12e9({order:10,contentType:this.settings.containedTypes[0],iconClass:"epi-iconPlus",label:_12ec.command.label,resources:_12ec});this.commands=array.filter(this.commands,lang.hitch(this,function(_12f1){return !(_12f1 instanceof _12e9);}));this._viewTrashCommand=new _12ea({typeIdentifiers:this.typeIdentifiers,order:100});this.commands.push(this._createCommand);this.commands.push(this._viewTrashCommand);},_setShowAllLanguagesAttr:function(value){this.inherited(arguments);this.allowSorting=!!value;},getIconClass:function(item,_12f2){var _12f3=array.some(this.model.roots,function(root){return root===this.model.getIdentity(item);},this);if(_12f3){return "epi-iconObjectRoot";}else{if(item.isStartPage){return "epi-iconObjectStart";}else{return this.inherited(arguments);}}}});});},"epi-cms/component/ContentNavigationTree":function(){define(["dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/topic","dojo/when","epi/dependency","epi/string","epi/shell/ClipboardManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/selection","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Alert","epi/shell/widget/dialog/Confirmation","epi-cms/_ContentContextMixin","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/contentediting/PageShortcutTypeSupport","epi-cms/command/ShowAllLanguages","epi-cms/component/_ContentNavigationTreeNode","epi-cms/component/ContentContextMenuCommandProvider","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/ContentTree","epi/shell/widget/ContextMenu","./command/_GlobalToolbarCommandProvider","../command/CopyContent","../command/CutContent","../command/DeleteContent","../command/PasteContent","epi/i18n!epi/cms/nls/episerver.cms.components.createpage","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree","epi/i18n!epi/cms/nls/episerver.shared.header"],function(array,_12f4,_12f5,lang,_12f6,topic,when,_12f7,_12f8,_12f9,_12fa,_12fb,_12fc,Alert,_12fd,_12fe,_12ff,_1300,_1301,_1302,_1303,_1304,_1305,_1306,_1307,_1308,_1309,_130a,_130b,_130c,_130d,_130e,res){return _12f5([_1307,_12fe,_12fa,_12ff],{res:res,showAllLanguages:true,_separatorBeforeCssClass:"rowSeparatorBefore",_separatorAfterCssClass:"rowSeparatorAfter",_clipboardManager:null,_contextMenu:null,_contextMenuCommandProvider:null,_focusNode:null,betweenThreshold:0,contextMenuCommandProvider:_1304,nodeConstructor:_1303,postMixInProperties:function(){this.inherited(arguments);this._clipboardManager=new _12f9();this.selection=new _12fb();this._contextMenuCommandProvider=new this.contextMenuCommandProvider({treeModel:this.model,clipboardManager:this._clipboardManager,repositoryKey:this.repositoryKey});this._startupCommands();this.model.roots=this.roots;this.model.notAllowToDelete=this.settings.preventDeletionFor;this.model.notAllowToCopy=this.settings.preventCopyingFor;},postCreate:function(){this.inherited(arguments);this.own(this.on("copyOrCut",lang.hitch(this,function(copy){copy?this._copyCommand.execute():this._cutCommand.execute();})),this.on("paste",lang.hitch(this,function(){when(this._pasteCommand.execute(),lang.hitch(this,function(){this.selectedNode.expand();}));})),this.on("delete",lang.hitch(this,function(){this._deleteCommand.canExecute?this._deleteCommand.execute():this._showNotificationMessage(this.res.cannotdelete);})),this.on("select",lang.hitch(this,this._onTreeNodeClicked)));this.connect(this,"onClick","_onTreeNodeClicked");var _130f=lang.hitch(this,"_resetSelectionToLastSelected");this.subscribe("/epi/dnd/dropdata",_130f);this.subscribe("/dnd/cancel",_130f);},startup:function(){this.inherited(arguments);when(this.getCurrentContext(),lang.hitch(this,function(_1310){this.contextChanged(_1310);}));},_preparePathNodes:function(paths){var self=this,_1311;array.some(paths,function(_1312,index){var nodes=self.getNodesByItem(_1312),_1313=nodes.length===1&&!nodes[0];if(index>0&&_1313){array.forEach(_1311,function(_1314){if(_1314.state==="LOADED"){_1314._loadDeferred=null;}});return true;}_1311=nodes;return false;});},_resetSelectionToLastSelected:function(){if(!this._lastSelectedContentReference||!this.selectedItem){return;}if(this.selectedItem.contentLink!==this._lastSelectedContentReference){this.selectContent(this._lastSelectedContentReference);}},_startupCommands:function(){this._showLanguagesCommand=new _1302({model:this});var _1315=this._contextMenuCommandProvider.get("commands");array.some(_1315,lang.hitch(this,function(_1316){if(_1316 instanceof _130a){this._copyCommand=_1316;}else{if(_1316 instanceof _130b){this._cutCommand=_1316;}else{if(_1316 instanceof _130d){this._pasteCommand=_1316;}else{if(_1316 instanceof _130c){this._deleteCommand=_1316;}}}}if(this._deleteCommand&&this._pasteCommand&&this._copyCommand){return true;}}));this.commands=[this._showLanguagesCommand].concat(_1315);},_setShowAllLanguagesAttr:function(value){this._set("showAllLanguages",value);this.model.set("showAllLanguages",value);},_onTreeNodeClicked:function(page,node,event){when(this.getCurrentContext(),lang.hitch(this,function(_1317){var _1318=true;if(_1317&&_1306.isContentReference(_1317.id)){_1318=_1306.compareIgnoreVersion(page.contentLink,_1317.id);}var _1319=function(_131a){var _131b={typeName:_12fc.getResourceValue(page.typeIdentifier,"name"),name:page.name};topic.publish("/epi/shell/context/request",{uri:page.uri},{sender:lang.mixin(_131a,{requestedContent:_131b}),forceContextChange:true});};if(!_1318){_1319(this);return;}if(this.selectContentThrottle){clearTimeout(this.selectContentThrottle);this.selectContentThrottle=null;}this.selectContentThrottle=setTimeout(_1319,300);}));},contentContextChanged:function(_131c,_131d){var _131e=new _1306(_131c.id),_131f=_131e.createVersionUnspecificReference().toString(),_1320=_1300.wastebasketPage.toString();this.inherited(arguments);if(_131f===_1320){return;}this.selection.set("data",this._getSelectionData(this.selectedItem));this._lastSelectedContentReference=_131f;if(_131d&&_131d.sender===this&&this.selectedItem&&_131f===this.selectedItem.contentLink){this._updateGlobalToolbarButtons();}if(this.isSupportedType(_131c.dataType)){this.selectContent(_131f,false,true).then(lang.hitch(this,"_updateGlobalToolbarButtons"));}},isSupportedType:function(_1321){return this.tree.model.isSupportedType(_1321);},_getSelectionData:function(_1322){return _1322?[{type:"epi.cms.contentdata",data:_1322}]:[];},_updateGlobalToolbarButtons:function(_1323){var node=_1323||this.get("selectedNode"),_1324=node?this._getSelectionData(node.item):[];if(this._createCommand){this._createCommand.set("model",node&&node.item);}this._contextMenuCommandProvider.updateCommandModel(node&&node.item);this.selection.set("data",_1324);},contextChangeFailed:function(_1325,_1326,_1327){this.inherited(arguments);if(_1325){if(_1327&&_1327.sender===this){this.selectContent(_1325.contentLink);}}},_removeHighlightClass:function(){if(this._focusNode&&this._focusNode!==this.selectedNode&&this._focusNode.rowNode){_12f6.remove(this._focusNode.rowNode,"dijitTreeRowSelected");}},_onContextMenuClose:function(){this._removeHighlightClass();},_onContextMenuOpen:function(){if(this._focusNode){_12f6.add(this._focusNode.rowNode,"dijitTreeRowSelected");}},_set_focusNodeAttr:function(value){this._removeHighlightClass();this._focusNode=value;},_showContextMenu:function(evt){if(!this._contextMenu){this.own(this._contextMenu=new _1308({leftClickToOpen:true,category:"context",popupParent:this}),_12f4.connect(this._contextMenu,"onClose",this,"_onContextMenuClose"),_12f4.connect(this._contextMenu,"onOpen",this,"_onContextMenuOpen"));this._contextMenu.addProvider(this._contextMenuCommandProvider);this._contextMenu.startup();}this._contextMenu.scheduleOpen(evt.target,null,{x:evt.x,y:evt.y});},_createTreeNode:function(){var _1328=this.inherited(arguments);if(_1328.item.contentLink===this.tree.model.rootPage){var _1329=array.filter(_1328.domNode.children,function(_132a){return _132a.className===this._separatorAfterCssClass;},this);}_1328.on("onContextMenuClick",lang.hitch(this,function(node){this._updateGlobalToolbarButtons(node.node);this.set("_focusNode",node.node);this._showContextMenu(node);}));return _1328;},getIconClass:function(item,_132b){var _132c=this.inherited(arguments);if(!item||!item.properties||!item.properties.pageShortcutType){return _132c;}var _132d="";switch(item.properties.pageShortcutType){case _1301.pageShortcutTypes.Shortcut:_132d="epi-iconObjectInternalLink";break;case _1301.pageShortcutTypes.External:_132d="epi-iconObjectExternalLink";break;case _1301.pageShortcutTypes.Inactive:_132d="epi-iconObjectNoLink";break;case _1301.pageShortcutTypes.FetchData:_132d=!item.hasTemplate?"epi-iconObjectContainerFetchContent":"epi-iconObjectFetchContent";break;default:break;}return _132d?_132c+" "+_132d:_132c;},enableDrop:function(node,_132e){node._droppable=_132e;},_showNotificationMessage:function(_132f){var _1330=new Alert({description:_12f8.toHTML(_132f)});_1330.show();},_onNodeMouseEnter:function(node,evt){this.inherited(arguments);node.showContextMenu(true);},_onNodeMouseLeave:function(node,evt){this.inherited(arguments);node.showContextMenu(false);}});});},"epi-cms/contentediting/PageShortcutTypeSupport":function(){define([],function(){return {pageShortcutTypes:{Normal:0,Shortcut:1,External:2,Inactive:3,FetchData:4}};});},"epi-cms/command/ShowAllLanguages":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojox/html/entities","epi/dependency","epi-cms/ApplicationSettings","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.command"],function(_1331,lang,when,_1332,_1333,_1334,_1335,_1336){return _1331([_1335],{property:"showAllLanguages",category:"setting",order:50,_watchHandle:null,postscript:function(){this.inherited(arguments);this.currentContentLanguage=this.currentContentLanguage||_1334.currentContentLanguage;this.store=this.store||_1333.resolve("epi.storeregistry").get("epi.cms.language");when(this.store.get(this.currentContentLanguage),lang.hitch(this,function(_1337){this.set("label",lang.replace(_1336.showonlycontentin,[_1332.encode(_1337.name)]));}));},_execute:function(){this.set("active",!this.active);this.model.set(this.property,!this.active);},_onModelChange:function(){if(this.model&&this.model._isSiteMultilingual){when(this.model._isSiteMultilingual(),lang.hitch(this,function(value){this.set("canExecute",value);}));}}});});},"epi-cms/component/_ContentNavigationTreeNode":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-attr","dojo/dom-class","dojo/Evented","dojo/mouse","dojo/on","dojo/text!./templates/_ContentNavigationTreeNode.html","epi/datetime","epi/dependency","epi/string","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/Tooltip","epi-cms/core/ContentReference","epi-cms/widget/_ContentTreeNode","epi-cms/widget/viewmodel/ContentStatusViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.pagetree"],function(array,_1338,event,lang,_1339,_133a,_133b,mouse,on,_133c,_133d,_133e,_133f,_1340,_1341,_1342,_1343,_1344,res){return _1338([_1343,_1340,_133b],{templateString:_133c,res:res,hasContextMenu:true,_pageLocked:"epi-pt-accessRights",_pageBeingEdited:"epi-pt-edited",_contextMenuClass:"epi-iconContextMenu",_iconNodeClass:"",_selected:false,_contentTypeStore:null,postMixInProperties:function(){this.inherited(arguments);var _1345=_133e.resolve("epi.storeregistry");this._contentTypeStore=_1345.get("epi.cms.contenttype");},postCreate:function(){this.inherited(arguments);this.set("model",new _1344({contentStatus:this.item.status}));},modelBindingMap:{statusIcon:["statusIcon"],statusMessage:["statusMessage"]},_setStatusMessageAttr:function(_1346){_1339.set(this.iconNodeStatus,"title",_133f.toTooltipText(_1346));},_setStatusIconAttr:function(_1347){if(!(_1347 instanceof Array)){return;}_133a.remove(this.iconNodeStatus);_133a.add(this.iconNodeStatus,"dijitTreeIcon epi-extraIcon");array.forEach(_1347,function(_1348){_133a.add(this.iconNodeStatus,_1348);},this);},setSelected:function(_1349){this.inherited(arguments);if(this.hasContextMenu){_133a.toggle(this.iconNodeMenu,this._contextMenuClass,this._selected=_1349);}},showContextMenu:function(show){if(!this._selected&&this.hasContextMenu){_133a.toggle(this.iconNodeMenu,this._contextMenuClass,show);}},_onClickIconNodeMenu:function(evt){event.stop(evt);this.labelNode.focus();this.emit("onContextMenuClick",{node:this,target:evt.target,x:evt.pageX,y:evt.pageY});},_onMouseDownIconNodeMenu:function(evt){event.stop(evt);},_updateIndividualLayout:function(){this._updateAccessRightIcon();if(this.model){this.model.set("contentStatus",this.item.status);}},_updateAccessRightIcon:function(){if(this.item.accessMask===0||this.item.accessMask===1){_133a.add(this.iconNodeAccess,this._pageLocked);_1339.set(this.iconNodeAccess,"title",this.res.tooltip.pagelocked);_133a.add(this.contentNode,"epi-treeReadOnly");}else{if(this.item.inUseNotifications&&this.item.inUseNotifications.length>0){_133a.add(this.iconNodeAccess,this._pageBeingEdited);var _134a=[this.res.tooltip.beingedited];array.forEach(this.item.inUseNotifications,function(_134b){var date=_133d.toUserFriendlyString(new Date(_134b.created));_134a.push(_134b.userName+", "+date);},this);_1339.set(this.iconNodeAccess,"title",_134a.join("\n"));}else{_133a.remove(this.iconNodeAccess,this._pageBeingEdited);_133a.remove(this.iconNodeAccess,this._pageLocked);_1339.set(this.iconNodeAccess,"title","");_133a.remove(this.contentNode,"epi-treeReadOnly");}}}});});},"url:epi-cms/component/templates/_ContentNavigationTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\n    <div data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow dijitInline\" role=\"presentation\">\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" role=\"presentation\" data-dojo-attach-event=\"onmousedown:_onMouseDownIconNodeMenu, click: _onClickIconNodeMenu\" >&nbsp;</span>\n                <span data-dojo-attach-point=\"iconNodeStatus\" class=\"epi-extraIcon\" role=\"presentation\">&nbsp;</span>\n                <span data-dojo-attach-point=\"iconNodeAccess\" class=\"epi-extraIcon\" role=\"presentation\">&nbsp;</span>\n                <span data-dojo-attach-point=\"iconNodeLanguage\" class=\"epi-extraIcon epi-pt-currentLanguageMissing\" role=\"presentation\">&nbsp;</span>\n            </span>\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\n        </span>\n    </div>\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\n</div>","epi/shell/widget/Tooltip":function(){define("epi/shell/widget/Tooltip",["dojo/_base/declare","dojo/string","dojox/html/entities","dojox/html/ellipsis","dijit/Tooltip"],function(_134c,_134d,_134e,_134f,_1350){return _134c(_1350,{showDelay:600,position:["after","before","below","above"],tooltipRows:null,tooltipRowTemplate:"<span>${label}</span>: ${text}",tooltipRowNoTextTemplate:"<span>${label}</span>",getContent:function(){if(this.tooltipRows){var _1351="<ul class='dijitInline dijitReset epi-tooltip-ellipsis'>";for(var i=0;i<this.tooltipRows.length;i++){var row=this.tooltipRows[i];if(!row.text){row.text="";}if(row.htmlEncode===undefined||row.htmlEncode===true){row.label=_134e.encode(row.label);row.text=_134e.encode(row.text);}if(!row.text){_1351+="<li class='dojoxEllipsis'>"+_134d.substitute(this.tooltipRowNoTextTemplate,row)+"</li>";}else{_1351+="<li class='dojoxEllipsis'>"+_134d.substitute(this.tooltipRowTemplate,row)+"</li>";}}_1351+="</ul>";return _1351;}return this.inherited(arguments);}});});},"epi-cms/widget/viewmodel/ContentStatusViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/when","dojo/promise/all","dojo/Stateful","epi/dependency","epi/shell/_StatefulGetterSetterMixin","epi-cms/contentediting/ContentActionSupport","epi/shell/_ContextMixin","epi-cms/ContentLanguageHelper","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus"],function(array,_1352,_1353,lang,when,all,_1354,_1355,_1356,_1357,_1358,_1359,_135a){return _1352([_1354,_1358],{_contentStructureStore:null,autoLoadStatus:false,statusIcon:null,statusMessage:null,constructor:function(){this._statusIconMap={0:["epi-statusIndicatorIcon","epi-statusIndicator0"],1:["epi-statusIndicatorIcon","epi-statusIndicator1"],2:["epi-statusIndicatorIcon","epi-statusIndicator2"],3:["epi-statusIndicatorIcon","epi-statusIndicator3"],4:["epi-statusIndicatorIcon","epi-statusIndicator4"],5:["epi-statusIndicatorIcon","epi-statusIndicator5"],6:["epi-statusIndicatorIcon","epi-statusIndicator6"],7:["epi-statusIndicatorIcon","epi-statusIndicator7"],100:["epi-statusIndicatorIcon","epi-statusIndicator100"]};this._statusMessageMap={0:_135a.notcreated,1:_135a.rejected,2:_135a.checkedout,3:_135a.checkedin,4:_135a.published,5:_135a.previouslypublished,6:_135a.delayedpublish,7:_135a.awaitingapproval,100:_135a.expired};},postscript:function(){this.inherited(arguments);this._contentStructureStore=this._contentStructureStore||_1355.resolve("epi.storeregistry").get("epi.cms.content.light");},loadStatus:function(){if(!this.contentLink){return;}when(this.getCurrentContext(),lang.hitch(this,function(ctx){when(this._contentStructureStore.refresh(this.contentLink),lang.hitch(this,function(_135b){if(_135b&&_135b.status!==undefined){this.set("content",_135b);}}));}));},_contentLinkSetter:function(_135c){if(!_135c){return;}this.contentLink=_135c;if(this.autoLoadStatus){this.loadStatus();}},_isDeletedGetter:function(){return this.get("content")&&this.get("content").isDeleted;},_isTranslationNeededGetter:function(){return this.get("content")&&this.get("content").missingLanguageBranch&&this.get("content").missingLanguageBranch.isTranslationNeeded;},_missingLanguageBranchGetter:function(){return this.get("content")&&this.get("content").missingLanguageBranch;},_contentSetter:function(_135d){this.content=_135d;this.set("contentStatus",_135d.status);},_contentStatusSetter:function(_135e){this.contentStatus=_135e;if(!_135e){return;}this.set("statusIcon",this._statusIconMap[_135e]);when(this._getStatusMessage(),lang.hitch(this,function(_135f){this.set("statusMessage",_135f);}));},_getStatusMessage:function(){if(this.get("isDeleted")){return _135a.versionnotfound;}if(this.get("isTranslationNeeded")){return _1359.getMissingLanguageMessage(this.content);}if(this.get("isVisibleOnSite")){return null;}return this._statusMessageMap[this.get("contentStatus")];},_isVisibleOnSiteGetter:function(){var _1360=this.get("missingLanguageBranch");if(this.get("isDeleted")||_1360&&_1360.reason===6){return false;}return this.get("contentStatus")===_1357.versionStatus.Published;}});});},"epi-cms/component/ContentContextMenuCommandProvider":function(){define(["dojo/_base/declare","dijit/Destroyable","epi/shell/command/_CommandProviderMixin","../command/CopyContent","../command/CutContent","../command/PasteContent","../command/TranslateContent","../command/DeleteContent","../plugin-area/navigation-tree","../widget/CreateCommandsMixin","epi/shell/command/_SelectionCommandMixin","epi/shell/selection"],function(_1361,_1362,_1363,_1364,_1365,_1366,_1367,_1368,_1369,_136a,_136b,_136c){return _1361([_1363,_136a,_1362],{treeModel:null,clipboardManager:null,_settings:null,constructor:function(_136d){_1361.safeMixin(this,_136d);this.own(_1369.on("added, removed",this._updateCommands.bind(this)));},postscript:function(){this.inherited(arguments);this._updateCommands();},updateCommandModel:function(_136e){this.get("commands").forEach(function(_136f){if(!_136f.isInstanceOf(_136b)){_136f.set("model",_136e);}});this._settings.selection.set("data",[{type:"epi.cms.contentdata",data:_136e}]);},_updateCommands:function(){this.get("commands").forEach(function(_1370){if(typeof _1370.destroy==="function"){_1370.destroy();}});this._settings={category:"context",model:this.treeModel,clipboard:this.clipboardManager,selection:new _136c()};var _1371=this.getCreateCommands(),_1372=[];for(var key in _1371){_1372.push(_1371[key].command);}_1372.push(new _1367({category:"context"}),new _1365(this._settings),new _1364(this._settings),new _1366(this._settings),new _1368(this._settings));_1369.get().forEach(function(_1373){_1373.category="context";_1372.push(_1373);});this.set("commands",_1372);}});});},"epi-cms/plugin-area/navigation-tree":function(){define(["epi/PluginArea","epi-cms/content-approval/command/EditApprovalDefinition"],function(_1374,_1375){var _1376=new _1374("epi-cms/navigation-tree/commands[]");_1376.add(_1375);return _1376;});},"epi-cms/content-approval/command/EditApprovalDefinition":function(){define(["dojo/_base/declare","dojo/topic","dojo/when","epi/dependency","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/nls/episerver.cms.contentapproval.command.edit","epi/shell/command/_Command"],function(_1377,topic,when,_1378,_1379,_137a,_137b){return _1377([_137b],{canExecute:false,contentActionSupport:null,iconClass:"epi-iconApproval",isAvailable:false,label:null,postscript:function(){this.inherited(arguments);this.contentActionSupport=this.contentActionSupport||_1379;this.profile=this.profile||_1378.resolve("epi.shell.Profile");},_onModelChange:function(){if(!this.model){this._setEnabledState(false);return;}this._setEnabledState(true);var _137c=this.contentActionSupport.hasAccess(this.model.accessMask,this.contentActionSupport.accessLevel.Administer);this.set("label",_137c?_137a.editlabel:_137a.viewlabel);},_setEnabledState:function(_137d){when(this.profile.get("isEPiBetaUser"),function(_137e){this.set("isAvailable",!!_137d&&_137e);}.bind(this));this.set("canExecute",!!_137d);},_execute:function(){topic.publish("/epi/shell/context/request",{uri:"epi.cms.approval:///"+this.model.contentLink},{sender:null});}});});},"epi-cms/component/RecentlyChanged":function(){define(["dojo/_base/declare","dojo/_base/lang","epi","epi/dependency","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/_Command","epi/shell/command/ToggleCommand","epi/shell/widget/layout/ComponentContainer","epi/shell/widget/dialog/Alert","epi/shell/widget/_FocusableMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/widget/_GridWidgetBase","epi/i18n!epi/cms/nls/episerver.cms.components.recentlychanged"],function(_137f,lang,epi,_1380,_1381,_1382,_1383,_1384,Alert,_1385,_1386,_1387,_1388,_1389){return _137f([_1388,_1381,_1385],{_componentsController:null,onlyShowMyChanges:false,postMixInProperties:function(){this.storeKeyName="epi.cms.content.search";this._componentsController=_1380.resolve("epi.shell.controller.Components");this.ignoreVersionWhenComparingLinks=false;this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);var _138a=lang.mixin({columns:this._createGridColumns(),store:this.store,selectionMode:"single"},this.defaultGridMixin);this.grid=new this._gridClass(_138a,this.domNode);},startup:function(){if(this._started){return;}this.inherited(arguments);var _138b=[new _1383({label:_1389.showmychanges,category:"setting",model:this,property:"onlyShowMyChanges"}),new _1382({iconClass:"epi-iconReload",label:epi.resources.action.refresh,canExecute:true,_execute:lang.hitch(this,function(){this.grid.refresh();})})];this.add("commands",_138b);this.fetchData();},_setOnlyShowMyChangesAttr:function(value){this._set("onlyShowMyChanges",value);if(this._started){this._saveSettingComponent("onlyShowMyChanges",value);}},fetchData:function(){var query=this._getQuery();this.grid.set("query",query.query,query.options);},_getQuery:function(){return {query:{query:"recentlychanged",onlyShowMyChanges:this.onlyShowMyChanges,keepversion:true},options:{ignore:["query"],sort:[{attribute:"saved",descending:true}]}};},_createGridColumns:function(){var _138c={name:{label:epi.resources.header.name,className:"epi-width50",renderCell:lang.hitch(this,this._renderContentItem)},status:{label:epi.resources.header.status,renderCell:function(item,value,node,_138d){node.innerHTML=_1386.getVersionStatus(value);},className:"epi-width15"},saved:{label:epi.resources.header.saved,formatter:this._localizeDate,className:"epi-width25"}};if(!this.get("onlyShowMyChanges")){_138c.changedBy={label:epi.resources.header.by,formatter:this._createUserFriendlyUsername,className:"epi-width10"};}return _138c;},_saveSettingComponent:function(type,value){var item=this._componentsController.getComponentDefinition(this.id),query;if(item){item.settings.onlyShowMyChanges=value;var saved=this._componentsController.saveComponent(item);saved.then(function(done){},function(){var _138e=new Alert({description:_1389.errormessage});_138e.show();});query=this._getQuery();this.grid.query=query.query;this.grid.queryOptions=query.options;this.grid.set("columns",this._createGridColumns());}},onContextChanged:function(_138f){this.grid.clearSelection();var _1390=new _1387(_138f.id).createVersionUnspecificReference().toString();var row=this.grid.row(_1390);if(row){this.grid.select(row);}}});});},"epi-cms/component/SharedBlocks":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","epi-cms/widget/HierarchicalList","epi-cms/component/SharedBlocksViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.createblock","epi/i18n!epi/cms/nls/contenttypes.blockdata"],function(array,_1391,lang,_1392,on,_1393,_1394,_1395,res){return _1391([_1393],{showCreateContentArea:false,modelClassName:_1394,noDataMessage:_1395.nocontent,hierarchicalListClass:"epi-blockList",createContentIcon:"epi-iconPlus",createContentText:res.create,buildRendering:function(){this.inherited(arguments);var self=this;this.own(_1392.after(this.list.grid,"renderQuery",function(_1396){_1396.then(function(_1397){var _1398=_1397.length>0?false:self.model.getCommand("newBlockDefault").get("canExecute");self._toggleCreateContentArea(_1398);});}));},_onCreateAreaClick:function(){this.inherited(arguments);this.model._commandRegistry.newBlockDefault.command.execute();},_setupList:function(){this.inherited(arguments);var _1399=this.model._commandRegistry,_139a=this.list;this.own(on(_139a,"copyOrCut",function copyOrCuthandler(copy){copy?_1399.copy.command.execute():_1399.cut.command.execute();}),on(_139a,"delete",function(){_1399["delete"].command.execute();}));}});});},"epi-cms/component/SharedBlocksViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/widget/viewmodel/HierarchicalListViewModel","./command/NewBlock","epi-cms/command/ShowAllLanguages"],function(_139b,lang,_139c,_139d,_139e){return _139b([_139c],{_updateTreeContextCommandModels:function(model){this.inherited(arguments);var _139f=lang.hitch(this.treeStoreModel,this.treeStoreModel.translate);this._commandRegistry.translate.command.set("model",model);this._commandRegistry.translate.command.set("executeDelegate",_139f);this._commandRegistry.newBlockDefault.command.set("model",model);},_setupCommands:function(){this.inherited(arguments);var _13a0={newBlockDefault:{command:new _139d({viewModel:this})},allLanguages:{command:new _139e({model:this}),order:55}};this._commandRegistry=lang.mixin(this._commandRegistry,_13a0);this.pseudoContextualCommands.push(this._commandRegistry.newBlockDefault.command);}});});},"epi-cms/component/command/NewBlock":function(){define(["dojo/_base/declare","epi/shell/DestroyableByKey","epi-cms/command/NewContent","epi/i18n!epi/cms/nls/episerver.cms.components.createblock"],function(_13a1,_13a2,_13a3,_13a4){return _13a1([_13a3,_13a2],{contentType:"episerver.core.blockdata",iconClass:"epi-iconPlus",label:_13a4.command.label,resources:_13a4,viewModel:null,_onModelChange:function(){this.destroyByKey("isSearchingWatch");this.ownByKey("isSearchingWatch",this.viewModel.watch("isSearching",this._onModelChange.bind(this)));this.inherited(arguments);},_canExecute:function(){var _13a5=this.inherited(arguments);return _13a5&&!this.viewModel.get("isSearching");}});});},"epi-cms/component/SiteTree":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/array","dojo/when","dojo/dom-style","dijit/layout/_LayoutWidget","dijit/Tooltip","epi-cms/component/SiteTreeModel","epi-cms/component/SiteTreeNode","epi/dependency","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/ToggleCommand","epi/shell/widget/Tree","epi/i18n!epi/cms/nls/episerver.cms.components.sitetree"],function(_13a6,_13a7,lang,array,when,_13a8,_13a9,_13aa,_13ab,_13ac,_13ad,_13ae,_13af,Tree,_13b0){return _13a6([_13a9,_13ae],{profile:null,buildRendering:function(){this.inherited(arguments);_13a8.set(this.domNode,"overflow","auto");},postCreate:function(){this.inherited(arguments);var _13b1=_13ad.resolve("epi.storeregistry");var store=_13b1.get("epi.cms.sitestructure");this.profile=this.profile||_13ad.resolve("epi.shell.Profile");var model=this._treeModel=new _13ab({store:store});var _13b2=new _13af({category:"setting",label:_13b0.showalllanguages,model:model,property:"showAllLanguages"});this.commands.push(_13b2);this._tree=new Tree({model:model,showRoot:false,"class":"epi-simpleTree",persist:false,onClick:lang.hitch(this,function(item){if(!item.host||!item.languageId){window.location.replace(item.editUrl);}else{var self=this;when(self.profile.setContentLanguage(item.languageId,item.host),function(){var _13b3=item.editUrl;if(array.some(item.hosts,function(host){return host===window.location.host;})){_13b3=item.editUrl.replace(new RegExp(item.host,"i"),window.location.host);}window.location.replace(_13b3);});}}),_createTreeNode:function(args){return new _13ac(args);},_onNodeMouseEnter:function(node){if(node.item.isLanguageNode&&!node.item.isAvailable){_13aa.show(_13b0.notavailabletooltip,node.labelNode,["after-centered","below"]);}},_onNodeMouseLeave:function(node){_13aa.hide(node.labelNode);}});this.addChild(this._tree);},layout:function(){this._tree.resize();},startup:function(){this.inherited(arguments);this._setTreePath();},_setTreePath:function(){_13a7.when(this._treeModel.getCurrentSite(),lang.hitch(this,function(_13b4){this._tree.set("path",["root",_13b4.currentSite,_13b4.currentEditLanguageId]);}));}});});},"epi-cms/component/SiteTreeNode":function(){define(["dojo/_base/declare","dojo/dom-class","epi-cms/widget/_ContentTreeNode"],function(_13b5,_13b6,_13b7){return _13b5([_13b7],{_updateItemClasses:function(item){this.inherited(arguments);if(item.isLanguageNode&&!item.isAvailable){_13b6.add(this.domNode,"epi-st-disabledRow");}else{_13b6.remove(this.domNode,"epi-st-disabledRow");}if(!item.isLanguageNode){_13b6.add(this.iconNode,"epi-iconObjectStart");}}});});},"epi-cms/component/Tasks":function(){define(["dojo","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-construct","dojo/dom-geometry","dojo/topic","dijit/form/Select","dijit/_TemplatedMixin","dijit/_Container","dijit/layout/_LayoutWidget","dijit/_WidgetsInTemplateMixin","epi","epi-cms/component/ContentQueryGrid","dojo/text!./templates/Tasks.html","epi/i18n!epi/cms/nls/episerver.cms.components.tasks"],function(dojo,_13b8,array,lang,_13b9,_13ba,topic,_13bb,_13bc,_13bd,_13be,_13bf,epi,_13c0,_13c1,_13c2){return _13b8([_13bd,_13be,_13bc,_13bf],{templateString:_13c1,resources:_13c2,querySelection:null,_selectionChangedEventHandler:null,postCreate:function(){this.inherited(arguments);var _13c3=array.map(this.queries,function(item){return {label:item.displayName,value:item.name};},this);this.querySelection=new _13bb({name:"QuerySelection",options:_13c3});_13b9.place(this.querySelection.domNode,this.reloadButton.domNode,"before");this.own(this.querySelection.on("change",lang.hitch(this,this._reloadQuery)),topic.subscribe("/epi/cms/action/refreshmytasks",lang.hitch(this,this._reloadQuery)));},startup:function(){this.inherited(arguments);this._reloadQuery();},resize:function(_13c4){this.inherited(arguments);this.contentQuery.resize(this._caculateContentQuerySize(_13c4));},_caculateContentQuerySize:function(_13c5){var _13c6=_13ba.getMarginBox(this.toolbar);return {w:_13c5.w,h:_13c5.h-_13c6.h};},_reloadQuery:function(){var query=this.querySelection.get("value");array.some(this.queries,function(item,index){if(item.name===query){this.contentQuery.set("ignoreVersionWhenComparingLinks",!item.versionSpecific);return true;}},this);this.contentQuery.set("queryName",query);}});});},"epi-cms/component/ContentQueryGrid":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/aspect","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_GridWidgetBase"],function(_13c7,lang,when,_13c8,_13c9,_13ca){return _13c7([_13ca],{queryName:null,queryParameters:null,dndTypes:["epi.cms.contentreference"],postMixInProperties:function(){this.storeKeyName="epi.cms.content.search";this.inherited(arguments);},buildRendering:function(){this.inherited(arguments);var _13cb=lang.mixin({columns:{name:{renderCell:lang.hitch(this,this._renderContentItem)},status:{className:"epi-width35",renderCell:function(item,value,node,_13cc){node.innerHTML=_13c9.getVersionStatus(value);}}},store:this.store,dndSourceType:this.dndTypes},this.defaultGridMixin);this.grid=new this._gridClass(_13cb,this.domNode);this.grid.set("showHeader",false);this.own(_13c8.around(this.grid,"insertRow",lang.hitch(this,this._aroundInsertRow)));},fetchData:function(){when(this._getCurrentItem(),lang.hitch(this,function(_13cd){this.set("currentItem",_13cd);}));this.grid.set("queryOptions",{ignore:["query"],sort:[{attribute:"name",descending:true}]});var _13ce=this.queryParameters||{};_13ce.query=this.queryName;this.grid.set("query",_13ce);},_setQueryNameAttr:function(value){this.queryName=value;this.fetchData();}});});},"url:epi-cms/component/templates/Tasks.html":"<div>\n    <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"toolbar\">\n        <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"reloadButton\" data-dojo-attach-event=\"onClick: _reloadQuery\"\n            class=\"epi-chromelessButton epi-iconReload epi-input-margin--left dijitInline dijitReset\">\n        </div>\n    </div>\n    <div data-dojo-type=\"epi-cms/component/ContentQueryGrid\" data-dojo-attach-point=\"contentQuery\">\n    </div>\n</div>\n","epi-cms/component/Trash":function(){define(["dojo/_base/declare","dojo/dom-construct","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_FocusableMixin","epi-cms/widget/Trash","epi-cms/widget/viewmodel/TrashViewModel"],function(_13cf,_13d0,_13d1,_13d2,_13d3,_13d4,Trash,_13d5){return _13cf([_13d1,_13d2,_13d3,_13d4],{templateString:"<div class=\"epi-trashComponent\"><div data-dojo-type='epi-cms/widget/Trash' data-dojo-attach-point='trash'></div></div>",updateView:function(data){if(data){this.trash.set("typeIdentifiers",data.typeIdentifiers);}if(this._trashModel){this._trashModel.destroy();}this.trash.set("model",this._trashModel=new _13d5());},destroy:function(){this._trashModel.destroy();this.inherited(arguments);}});});},"epi-cms/widget/Trash":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/Deferred","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/TabContainer","dijit/layout/ContentPane","dijit/registry","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Alert","epi/shell/command/withConfirmation","epi-cms/widget/TrashItemList","epi-cms/widget/EmptyTrashMenu","epi-cms/widget/TrashViewModelConfirmation","epi-cms/widget/command/EmptyTrash","epi-cms/widget/command/RestoreContent","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/Trash.html"],function(array,_13d6,lang,_13d7,_13d8,_13d9,_13da,_13db,_13dc,_13dd,_13de,_13df,_13e0,_13e1,Alert,_13e2,_13e3,_13e4,_13e5,_13e6,_13e7,_13e8,_13e9){return _13d6([_13db,_13dc,_13dd,_13e1,_13d9],{resources:_13e8,templateString:_13e9,_restoreContentCommand:null,typeIdentifiers:null,modelBindingMap:{contentStore:["store"],queryOptions:["queryOptions"],actionResponse:["actionResponse"],trashes:["trashes"]},postCreate:function(){this.inherited(arguments);this.tabContainer.watch("selectedChildWidget",lang.hitch(this,function(name,_13ea,_13eb){if(_13eb.itemListId){var _13ec=_13e0.byId(_13eb.itemListId);_13ec.bindUserSelector(_13eb.trash.deletedByUsers);}this.model.set("currentTrash",_13eb.trash);}));this._restoreContentCommand=new _13e7({model:this.model});this.watch("model",lang.hitch(this,function(){this.model=_13e5(this.model);this._restoreContentCommand.set("model",this.model);}));this.on("itemClick",this._onItemClick);this.on("deletedByChange",this._onDeletedByChange);},_setTrashesAttr:function(_13ed){this.tabContainer.destroyDescendants();var _13ee=[];array.forEach(_13ed,function(trash){if(trash&&trash.active){this._addTrash(trash);var _13ef=new _13e6({hasDeleteAccess:trash.hasDeleteAccess,label:trash.name,tooltip:trash.name,trashId:trash.wasteBasketLink,model:this.model});_13ee.push(_13e2(_13ef,null,{title:_13e8.emptytrash.title,description:this.model.getEmptyTrashConfirmMessage(trash.name),onShow:lang.hitch(this,function(){var _13f0=this.tabContainer.selectedChildWidget.getChildren()[0];_13f0.clearSelection();})}));}},this);this.emptyTrashMenu.set("commands",_13ee);if(_13ed&&_13ed.length===1){_13d7.add(this.tabContainer.domNode,"hide-tablist");}this.tabContainer.startup();this.tabContainer.layout();},_addTrash:function(trash){var _13f1=null;if(trash.active){trash.isRequireLoad=true;var item=new _13df({title:trash.name,trash:trash});this.tabContainer.addChild(item);if(this._isSelected(trash)){_13f1=item;}}if(_13f1){this.tabContainer.selectChild(_13f1);}},_isSelected:function(trash){var _13f2=false;array.some(trash.typeIdentifiers,lang.hitch(this,function(_13f3){return array.some(this.typeIdentifiers,function(type){if(_13f3===type){_13f2=true;return false;}});}));return _13f2;},_setQueryOptionsAttr:function(_13f4){if(_13f4){var _13f5=this.tabContainer.selectedChildWidget;if(_13f5){var _13f6=this.get("store"),_13f7=null;if(_13f5.itemListId){_13f7=_13e0.byId(_13f5.itemListId);_13f7.set("queryOptions",_13f4);}else{_13f7=new _13e3({queryOptions:_13f4,store:_13f6,model:this.model});_13f7.on("itemClick",lang.hitch(this,function(row){this.emit("itemClick",row);}));_13f7.on("deletedByChange",lang.hitch(this,function(_13f8){this.emit("deletedByChange",_13f8);}));_13f7.on("searchBoxChange",lang.hitch(this,this._onSearchBoxChange));_13f5.set("content",_13f7);_13f5.itemListId=_13f7.id;}_13f7.updateRemovedBy(_13f4);}}},_setActionResponseAttr:function(_13f9){if(!_13f9){return;}this._showNotificationMessage(_13f9);},_showNotificationMessage:function(_13fa){new Alert({description:_13fa?_13fa:""}).show();},_onItemClick:function(row){if(row&&row.data&&this.model.get("currentTrash")){this._restoreContentCommand.set("content",row.data);this._restoreContentCommand.execute();}},_onDeletedByChange:function(_13fb){var _13fc=this.model.get("currentTrash");_13fc.deletedBy=_13fb;_13fc.isRequireLoad=true;this.model.set("currentTrash",_13fc);},_onSearchBoxChange:function(_13fd){var _13fe=this.model.get("currentTrash");_13fe.queryText=_13fd;_13fe.isRequireLoad=true;this.model.set("currentTrash",_13fe);}});});},"epi-cms/widget/TrashItemList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/keys","dojo/Evented","dojo/query","dojo/html","dojo/Stateful","dojo/string","dojo/when","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Select","dojox/widget/Standby","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dgrid/tree","dgrid/extensions/ColumnResizer","dgrid/util/mouse","put-selector/put","epi","epi/dependency","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/TypeDescriptorManager","epi/shell/widget/SearchBox","epi/shell/widget/_ModelBindingMixin","epi/datetime","epi/username","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/TrashItemList.html"],function(array,_13ff,lang,_1400,_1401,_1402,_1403,_1404,_1405,keys,_1406,query,html,_1407,_1408,when,_1409,_140a,_140b,_140c,_140d,_140e,_140f,_1410,Tree,_1411,_1412,put,epi,_1413,_1414,_1415,_1416,_1417,_1418,_1419,_141a,_141b,_141c){return _13ff([_1409,_140a,_140b,_1406,_1407,_1418],{resources:_141b,epi:epi,templateString:_141c,_grid:null,_observers:{},_setQueryOptionsAttr:function(_141d){this._set("queryOptions",_141d);this._initialize();},updateRemovedBy:function(_141e){var _141f=this.model.get("currentTrash");if(this.model.isEmptyTrash){this.bindDefaultUserSelector();return;}var _1420=this.store.query({referenceId:_141e.query.referenceId,query:"getblockrootchildren"});var _1421=lang.hitch(this,function(item,_1422,_1423){var _1424=_141f.isDefaultProvider?"":_141f.name;when(this.model.trashStore.query({providerName:_1424}),lang.hitch(this,function(trash){if(trash){var _1425=trash.deletedByUsers;_141f.deletedByUsers=_1425;this.bindUserSelector(_1425);}}));});var id=_141f.name,_1426=this._observers[id];if(_1426){_1426.cancel();delete this._observers[id];}this._observers[id]=_1420.observe(_1421,true);},destroy:function(){for(var id in this._observers){this._observers[id].cancel();delete this._observers[id];}if(this._standby){this._standby.destroyRecursive();this._standby=null;}if(this._grid){this._grid.destroy();this._grid=null;}this.inherited(arguments);},clearSelection:function(){this._grid.clearSelection();this._grid._lastSelected=null;},postCreate:function(){this.inherited(arguments);this.bindUserSelector(this.model.get("currentTrash").deletedByUsers);this.searchBox.encodeSearchText=true;this.searchBox.on("searchBoxChange",lang.hitch(this,function(_1427){this.emit("searchBoxChange",_1427);}));this.removedBy._updateSelection=function(){this._set("value",this._getValueFromOpts());var val=this.value;if(!lang.isArray(val)){val=[val];}array.forEach(this._getChildren(),function(child){var _1428=array.some(val,function(v){return child.option&&(v===child.option.value);});_1401.toggle(child.domNode,this.baseClass+"SelectedOption",_1428);child.domNode.setAttribute("aria-selected",_1428);},this);};},resize:function(){if(this._grid){var top=_1403.position(this._grid.domNode).y;var _1429=_1403.position(_1400.body()).h;_1404.set(this._grid.domNode,"height",(_1429-top)+"px");}},_initialize:function(){this.searchBox.set("disabled",!this.queryOptions.query.isSearchable);if(!this._grid){this._grid=this._createGrid(this.store,this.queryOptions);_1402.place(this._grid.domNode,this.gridContainerNode);}else{this._showStandby(true);if(this.queryOptions){this._grid.set("queryOptions",this.queryOptions.options);this._grid.set("query",this.queryOptions.query);}}this.resize();},bindDefaultUserSelector:function(){this.removedBy._onChangeActive=false;this.removedBy.removeOption(this.removedBy.options);this.removedBy.addOption({label:epi.resources.text.anyone,value:""});this.removedBy._onChangeActive=true;},bindUserSelector:function(_142a){if(_142a){var _142b=this.removedBy.get("value");this.bindDefaultUserSelector();this.removedBy._onChangeActive=false;array.forEach(_142a,function(_142c){this.removedBy.addOption({label:this._createUserFriendlyUsername(_142c),value:_142c});},this);this.removedBy.set("value",_142b);this.removedBy._onChangeActive=true;}},_createGrid:function(store,_142d){var _142e=_13ff([_140e,_140f,_1410,_1414,_1411]);var grid=new _142e({store:store,columns:{name:Tree({field:"name",label:epi.resources.header.name,renderCell:lang.hitch(this,this._renderTreeNode)}),removedOn:{field:"deleted",label:epi.resources.header.removed,formatters:[this._localizeDate,_1415.ellipsis]},by:{field:"deletedBy",label:epi.resources.header.by,formatters:[this._createUserFriendlyUsername,_1415.ellipsis]},action:{label:" ",formatter:this._renderActionMenu,sortable:false}},minWidth:100,noDataMessage:this._getNoDataMessage(),selectionMode:"single"});this._standby=new _140d({target:grid.domNode,color:"#fff"}).placeAt(document.body);this._standby.startup();this.own(_1405.after(grid,"expand",function(_142f){var row=_142f.element?_142f:grid.row(_142f),_1430=query(row.element).parent()[0];if(_1430){_1404.set(_1430,"height","");}},true));_1405.after(grid,"_processScroll",lang.hitch(this,function(){this._showStandby(false);}));this._showStandby(true);_1405.before(grid,"adjustRowIndices",function(_1431){if(_1431){array.forEach(query("div.dgrid-no-data",this.contentNode),function(div){html.set(div,"");});}});_1405.around(grid,"insertRow",lang.hitch(this,this._aroundInsertRow));_1405.before(grid,"renderArray",lang.hitch(this,function(_1432,_1433,_1434){var _1435=this.queryOptions.query;if(_1435&&_1435.query==="searchdeletedcontent"){_1432.map(function(_1436){if(_1436){_1436.hasChildren=false;}});}}));if(_142d){grid.set("queryOptions",_142d.options);grid.set("query",_142d.query);}var _1437="epi-dgrid-mouseover";grid.on(_1412.enterRow,function(evt){_1401.add(this,_1437);});grid.on(_1412.leaveRow,function(evt){_1401.remove(this,_1437);});grid.on(".epi-gridAction:click",lang.hitch(this,function(evt){var row=grid.row(evt);this.emit("itemClick",row);}));grid.on(".dgrid-column-action:keydown",lang.hitch(this,function(e){if(e.keyCode===keys.ENTER&&!e.shiftKey&&!e.altKey&&!e.ctrlKey){var row=grid.row(e);this.emit("itemClick",row);}}));return grid;},_renderTreeNode:function(_1438,data,td,_1439){if(_1438&&_1438.thumbnailUrl){var image=_1402.create("img",{src:_1438.thumbnailUrl+_1408.substitute("?${0}",[new Date().getTime()]),"class":"epi-thumbnail"},td);_1402.place(_1415.ellipsis(_1415.htmlEncode(data)),td);}else{var _143a=_1416.getValue(_1438.typeIdentifier,"iconClass")||"epi-iconObjectPage";_1402.place(_1415.icon(_143a+" epi-objectIcon",_1415.ellipsis(_1415.htmlEncode(data))),td);}},_renderActionMenu:function(value){var data={title:_141b.restore.tooltip,label:_141b.restore.label};return lang.replace("<a class=\"epi-gridAction epi-visibleLink\" title=\"{title}\">{label}</a>",data);},_localizeDate:function(value){return _1419.toUserFriendlyString(value);},_createUserFriendlyUsername:function(name){return _141a.toUserFriendlyString(_1415.htmlEncode(name));},_onDeletedByChange:function(_143b){if(this.model.isEmptyTrash){this.model.isEmptyTrash=false;return;}this.emit("deletedByChange",_143b);},_showStandby:function(_143c){if(!this._standby){return;}if(_143c){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},_getNoDataMessage:function(){return "<span><span class=\"dijitReset dijitInline\">"+_141b.trashitemempty+"</span></span>";},_aroundInsertRow:function(_143d){return lang.hitch(this,function(_143e,_143f,_1440,i,_1441){var row=_143d.apply(this._grid,arguments);if(_143e&&_143e.thumbnailUrl){_1401.add(row,"epi-mediaContent");}return row;});}});});},"dgrid/tree":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/Deferred","dojo/query","dojo/on","dojo/aspect","./util/has-css3","./Grid","dojo/has!touch?./util/touch","put-selector/put"],function(_1442,_1443,_1444,_1445,on,_1446,has,Grid,_1447,put){function _1448(level,_1449,_144a,_144b){var dir=this.grid.isRTL?"right":"left",cls=".dgrid-expando-icon",node;if(_1449){cls+=".ui-icon.ui-icon-triangle-1-"+(_144a?"se":"e");}node=put("div"+cls+"[style=margin-"+dir+": "+(level*(this.indentWidth||9))+"px; float: "+dir+"]");node.innerHTML="&nbsp;";return node;};function _144c(event){var _144d=this,_144e=this.style.height;if(_144e){this.style.display=_144e=="0px"?"none":"block";}if(event){put(this,".dgrid-tree-resetting");setTimeout(function(){put(_144d,"!dgrid-tree-resetting");});}this.style.height="";};function tree(_144f){var _1450=_144f.renderCell||Grid.defaultRenderCell;var _1451,_1452;if(!_144f){_144f={};}_144f.shouldExpand=_144f.shouldExpand||function(row,level,_1453){return _1453;};_1446.after(_144f,"init",function(){var grid=_144f.grid,_1454=".dgrid-content .dgrid-column-"+_144f.id,_1455=[];grid.cleanEmptyObservers=false;if(!grid.store){throw new Error("dgrid tree column plugin requires a store to operate.");}if(!_144f.renderExpando){_144f.renderExpando=_1448;}_1455.push(grid.on(_144f.expandOn||".dgrid-expando-icon:click,"+_1454+":dblclick,"+_1454+":keydown",function(event){var row=grid.row(event);if((!grid.store.mayHaveChildren||grid.store.mayHaveChildren(row.data))&&(event.type!="keydown"||event.keyCode==32)&&!(event.type=="dblclick"&&_1452&&_1452.count>1&&row.id==_1452.id&&event.target.className.indexOf("dgrid-expando-icon")>-1)){grid.expand(row);}if(event.target.className.indexOf("dgrid-expando-icon")>-1){if(_1452&&_1452.id==grid.row(event).id){_1452.count++;}else{_1452={id:grid.row(event).id,count:1};}}}));if(has("touch")){_1455.push(grid.on(_1447.selector(_1454,_1447.dbltap),function(){grid.expand(this);}));}if(!grid._expanded){grid._expanded={};}_1455.push(_1446.after(grid,"insertRow",function(_1456){var row=this.row(_1456),_1457=_144f.shouldExpand(row,_1451,this._expanded[row.id]);if(_1457){this.expand(_1456,true,true);}return _1456;}));_1455.push(_1446.before(grid,"removeRow",function(_1458,_1459){var _145a=_1458.connected;if(_145a){_1445(">.dgrid-row",_145a).forEach(function(_145b){grid.removeRow(_145b,true);});if(!_1459){put(_145a,"!");}}}));if(_144f.collapseOnRefresh){_1455.push(_1446.after(grid,"cleanup",function(){this._expanded={};}));}grid._calcRowHeight=function(_145c){var _145d=_145c.connected;return _145c.offsetHeight+(_145d?_145d.offsetHeight:0);};grid.expand=function(_145e,_145f,_1460){var row=_145e.element?_145e:grid.row(_145e),_1461=has("transitionend"),dfd=new _1444(),_1462=dfd.promise;dfd.resolve();_145e=row.element;_145e=_145e.className.indexOf("dgrid-expando-icon")>-1?_145e:_1445(".dgrid-expando-icon",_145e)[0];_1460=_1460||_144f.enableTransitions===false;if(_145e&&_145e.mayHaveChildren&&(_1460||_145f!==!!this._expanded[row.id])){var _1463=_145f===undefined?!this._expanded[row.id]:_145f;put(_145e,".ui-icon-triangle-1-"+(_1463?"se":"e")+"!ui-icon-triangle-1-"+(_1463?"e":"se"));var _1464=row.element,_1465=_1464.connected,_1466,_1467,_1468={originalQuery:this.query};if(!_1465){_1465=_1468.container=_1464.connected=put(_1464,"+div.dgrid-tree-container");var query=function(_1469){return grid.store.getChildren(row.data,_1469);};if(_144f.allowDuplicates){_1468.parentId=row.id;}if("level" in _145e){query.level=_145e.level;}_1462=_1462.then(function(){if(grid.renderQuery){return grid.renderQuery(query,_1468);}var _146a=put(_1465,"div");var rows=grid.renderArray(query(_1468),_146a,"level" in query?{queryLevel:query.level}:{});_1444.when(rows,function(){put(_146a,"!");});return rows;});if(_1461){on(_1465,_1461,_144c);}else{_144c.call(_1465);}}_1465.hidden=!_1463;_1466=_1465.style;if(!_1461||_1460){_1466.display=_1463?"block":"none";_1466.height="";}else{if(_1463){_1466.display="block";_1467=_1465.scrollHeight;_1466.height="0px";}else{put(_1465,".dgrid-tree-resetting");_1466.height=_1465.scrollHeight+"px";}setTimeout(function(){put(_1465,"!dgrid-tree-resetting");_1466.height=_1463?(_1467?_1467+"px":"auto"):"0px";});}if(_1463){this._expanded[row.id]=true;}else{delete this._expanded[row.id];}}return _1462;};_1446.after(_144f,"destroy",function(){_1443.forEach(_1455,function(l){l.remove();});delete grid.expand;delete grid._calcRowHeight;});});_144f.renderCell=function(_146b,value,td,_146c){var grid=_144f.grid,level=Number(_146c&&_146c.queryLevel)+1,_146d=!grid.store.mayHaveChildren||grid.store.mayHaveChildren(_146b),_146e=_146c.parentId,_146f,node;level=_1451=isNaN(level)?0:level;_146f=_144f.renderExpando(level,_146d,grid._expanded[(_146e?_146e+"-":"")+grid.store.getIdentity(_146b)],_146b);_146f.level=level;_146f.mayHaveChildren=_146d;node=_1450.call(_144f,_146b,value,td,_146c);if(node&&node.nodeType){put(td,_146f);put(td,node);}else{td.insertBefore(_146f,td.firstChild);}};return _144f;};tree.defaultRenderExpando=_1448;return tree;});},"dgrid/extensions/ColumnResizer":function(){define(["dojo/_base/declare","dojo/on","dojo/query","dojo/_base/lang","dojo/dom","dojo/dom-geometry","dojo/has","../util/misc","put-selector/put","dojo/_base/html","xstyle/css!../css/extensions/ColumnResizer.css"],function(_1470,_1471,query,lang,dom,geom,has,_1472,put){function _1473(table,span,_1474,_1475,id){for(var i=1;i<span;i++){table[_1474+i][_1475]=id;}};function _1476(_1477){var i=_1477.length,l=i,_1478=_1477[0].length,table=new Array(i);while(i--){table[i]=new Array(_1478);}var _1479={};for(i=0;i<l;i++){var row=table[i],_147a=_1477[i];for(var j=0,js=0;j<_1478;j++){var cell=_147a[js],k;if(typeof row[j]!="undefined"){continue;}row[j]=cell.id;if(cell.rowSpan&&cell.rowSpan>1){_1473(table,cell.rowSpan,i,j,cell.id);}if(i>0&&cell.colSpan&&cell.colSpan>1){for(k=1;k<cell.colSpan;k++){row[++j]=cell.id;if(cell.rowSpan&&cell.rowSpan>1){_1473(table,cell.rowSpan,i,j,cell.id);}}}_1479[cell.id]=_1477[0][j].id;js++;}}return _1479;};function _147b(grid,colId,width,_147c,_147d){if(width<=0){return;}var _147e=grid.columns[colId],event,rule;if(!_147e){return;}event={grid:grid,columnId:colId,width:width,bubbles:true,cancelable:true};if(_147c){event.parentType=_147c;}if(!grid._resizedColumns||_1471.emit(grid.headerNode,"dgrid-columnresize",event)){if(width==="auto"){delete _147e.width;}else{_147e.width=width;width+="px";}rule=grid._columnSizes[colId];if(rule){rule.set("width",width);}else{rule=_1472.addCssRule("#"+_1472.escapeCssIdentifier(grid.domNode.id)+" .dgrid-column-"+_1472.escapeCssIdentifier(colId,"-"),"width: "+width+";");}grid._columnSizes[colId]=rule;if(_147d!==false){grid.resize();}return true;}};var _147f,_1480=0;var _1481={create:function(){_147f=put("div.dgrid-column-resizer");},destroy:function(){put(_147f,"!");_147f=null;},show:function(grid){var pos=geom.position(grid.domNode,true);_147f.style.top=pos.y+"px";_147f.style.height=pos.h+"px";put(document.body,_147f);},move:function(x){_147f.style.left=x+"px";},hide:function(){_147f.parentNode.removeChild(_147f);}};return _1470(null,{resizeNode:null,minWidth:40,adjustLastColumn:true,_resizedColumns:false,buildRendering:function(){this.inherited(arguments);if(!_1480++){_1481.create();}},destroy:function(){this.inherited(arguments);for(var name in this._columnSizes){this._columnSizes[name].remove();}if(!--_1480){_1481.destroy();}},resizeColumnWidth:function(colId,width){return _147b(this,colId,width);},configStructure:function(){var _1482=this._oldColumnSizes=lang.mixin({},this._columnSizes),k;this._resizedColumns=false;this._columnSizes={};this.inherited(arguments);for(k in _1482){if(!(k in this._columnSizes)){_1482[k].remove();}}delete this._oldColumnSizes;},_configColumn:function(_1483){this.inherited(arguments);var colId=_1483.id,rule;if("width" in _1483){if((rule=this._oldColumnSizes[colId])){rule.set("width",_1483.width+"px");}else{rule=_1472.addCssRule("#"+_1472.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+_1472.escapeCssIdentifier(colId,"-"),"width: "+_1483.width+"px;");}this._columnSizes[colId]=rule;}},renderHeader:function(){this.inherited(arguments);var grid=this;var assoc;if(this.columnSets&&this.columnSets.length){var csi=this.columnSets.length;while(csi--){assoc=lang.mixin(assoc||{},_1476(this.columnSets[csi]));}}else{if(this.subRows&&this.subRows.length>1){assoc=_1476(this.subRows);}}var _1484=query(".dgrid-cell",grid.headerNode),i=_1484.length;while(i--){var _1485=_1484[i],id=_1485.columnId,col=grid.columns[id],_1486=_1485.childNodes,_1487;if(!col||col.resizable===false){continue;}var _1488=put("div.dgrid-resize-header-container");_1485.contents=_1488;while(_1486.length>0){put(_1488,_1486[0]);}_1487=put(_1485,_1488,"div.dgrid-resize-handle.resizeNode-"+_1472.escapeCssIdentifier(id,"-"));_1487.columnId=assoc&&assoc[id]||id;}if(!grid.mouseMoveListen){_1471(grid.headerNode,".dgrid-resize-handle:mousedown"+(has("touch")?",.dgrid-resize-handle:touchstart":""),function(e){grid._resizeMouseDown(e,this);grid.mouseMoveListen.resume();grid.mouseUpListen.resume();});grid._listeners.push(grid.mouseMoveListen=_1471.pausable(document,"mousemove"+(has("touch")?",touchmove":""),_1472.throttleDelayed(function(e){grid._updateResizerPosition(e);})));grid._listeners.push(grid.mouseUpListen=_1471.pausable(document,"mouseup"+(has("touch")?",touchend":""),function(e){grid._resizeMouseUp(e);grid.mouseMoveListen.pause();grid.mouseUpListen.pause();}));grid.mouseMoveListen.pause();grid.mouseUpListen.pause();}},_resizeMouseDown:function(e,_1489){e.preventDefault();dom.setSelectable(this.domNode,false);this._startX=this._getResizeMouseLocation(e);this._targetCell=query(".dgrid-column-"+_1472.escapeCssIdentifier(_1489.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(e);_1481.show(this);},_resizeMouseUp:function(e){var _148a=this._columnSizes,_148b,_148c,_148d;if(this.adjustLastColumn){_148d=this.headerNode.clientWidth-1;}if(!this._resizedColumns){_148b=query(".dgrid-cell",this.headerNode);if(this.columnSets&&this.columnSets.length){_148b=_148b.filter(function(node){var idx=node.columnId.split("-");return idx[0]=="0"&&!(node.columnId in _148a);});}else{if(this.subRows&&this.subRows.length>1){_148b=_148b.filter(function(node){return node.columnId.charAt(0)=="0"&&!(node.columnId in _148a);});}}_148c=_148b.map(function(_148e){return _148e.offsetWidth;});_148b.forEach(function(_148f,i){_147b(this,_148f.columnId,_148c[i],null,false);},this);this._resizedColumns=true;}dom.setSelectable(this.domNode,true);var cell=this._targetCell,delta=this._getResizeMouseLocation(e)-this._startX,_1490=cell.offsetWidth+delta,obj=this._getResizedColumnWidths(),_1491=obj.totalWidth,_1492=obj.lastColId,_1493=query(".dgrid-column-"+_1472.escapeCssIdentifier(_1492,"-"),this.headerNode)[0].offsetWidth;if(_1490<this.minWidth){_1490=this.minWidth;}if(_147b(this,cell.columnId,_1490,e.type)){if(cell.columnId!=_1492&&this.adjustLastColumn){if(_1491+delta<_148d){_147b(this,_1492,"auto",e.type);}else{if(_1493-delta<=this.minWidth){_147b(this,_1492,this.minWidth,e.type);}}}}_1481.hide();delete this._startX;delete this._targetCell;},_updateResizerPosition:function(e){if(!this._targetCell){return;}var _1494=this._getResizeMouseLocation(e),delta=_1494-this._startX,width=this._targetCell.offsetWidth,left=_1494;if(width+delta<this.minWidth){left=this._startX-(width-this.minWidth);}_1481.move(left);},_getResizeMouseLocation:function(e){var posX=0;if(e.pageX){posX=e.pageX;}else{if(e.clientX){posX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;}}return posX;},_getResizedColumnWidths:function(){var _1495=0,_1496=query((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode);var i=_1496.length;if(!i){return {};}var _1497=_1496[i-1].columnId;while(i--){_1495+=_1496[i].offsetWidth;}return {totalWidth:_1495,lastColId:_1497};}});});},"url:epi-cms/widget/templates/TrashItemList.html":"<div>\n    <div class=\"epi-trashHeader clearfix\">\n        <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxContainer\">\n            <div data-dojo-type=\"epi/shell/widget/SearchBox\" data-dojo-attach-point=\"searchBox\"></div>\n        </div>\n        <span class=\"epi-removedByContainer\">\n            <label for=\"removedBy_${id}\">${resources.removedby}</label>\n            <select data-dojo-type=\"dijit/form/Select\" data-dojo-attach-point=\"removedBy\" id=\"removedBy_${id}\" data-dojo-attach-event='onChange: _onDeletedByChange'>\n            </select>\n        </span>\n    </div>\n    <div data-dojo-attach-point=\"gridContainerNode\"></div>\n</div>","epi-cms/widget/EmptyTrashMenu":function(){define(["dojo/_base/declare","dijit/layout/_LayoutWidget","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/MenuAssembler","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(_1498,_1499,_149a,_149b,_149c,_149d){return _1498([_1499],{resources:_149d,_setCommandsAttr:function(_149e){this._set("commands",_149e);this._bindEmptyTrashMenu(_149e);},_bindEmptyTrashMenu:function(_149f){this.destroyDescendants();if(!_149f||_149f.length<1){return;}var _14a0=_149f.length>1;var _14a1=null;if(_14a0){_14a1=new _149b({settings:{label:_149d.emptytrash.title,dropDownPosition:["below-alt"]}});}else{_14a1=new _149a({settings:{label:_149d.emptytrash.title}});this.commands[0].label=_149d.emptytrash.title;}new _149c({configuration:[{builder:_14a1,target:this}],commandSource:this}).build();},getCommands:function(){return this.get("commands");}});});},"epi-cms/widget/TrashViewModelConfirmation":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/aspect","dojo/when","epi/dependency","epi/string","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi/shell/widget/dialog/Confirmation","epi/shell/widget/dialog/Alert","epi-cms/widget/ContentSelectorDialog","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(array,_14a2,_14a3,lang,_14a4,when,_14a5,_14a6,_14a7,_14a8,_14a9,Alert,_14aa,_14ab,_14ac){return function(model){var _14ad=function(title,_14ae,_14af){var _14b0=new _14a3();var _14b1=new _14a9({description:_14a6.toHTML(_14ae),title:_14a6.toHTML(title),onAction:function(_14b2){_14b2?_14b0.resolve(_14af):_14b0.cancel();}});_14b1.show();return _14b0;};var _14b3=function(_14b4,roots,_14b5){var _14b6=function(_14b7){var _14b8=_14a5.resolve("epi.cms.contentRepositoryDescriptors");var _14b9=[];for(var key in _14b8){_14b8[key].containedTypes.forEach(function(type){if(_14a7.isBaseTypeIdentifier(_14b7.typeIdentifier,type)){_14b9=_14b9.concat(_14b8[key].containedTypes);}});}return _14b9;};var df=new _14a3(),_14ba=_14ac.restore.dialog,_14bb=_14a7.getValue(_14b4.typeIdentifier,"containerTypes"),_14bc=_14b6(_14b4),_14bd={showButtons:false,roots:roots,multiRootsMode:true,canSelectOwnerContent:false,allowedTypes:_14bb||_14bc,selectedContentType:_14b4.typeIdentifier,showAllLanguages:true};var _14be=new _14aa(_14bd);var _14bf=new _14a8({title:_14a6.toHTML(_14ba.title),description:_14b5||_14a6.toHTML(_14ba.description),confirmActionText:_14a6.toHTML(_14ac.restore.label),content:_14be});var _14c0=function(value){when(model.contentStore.query({id:value}),function(_14c1){_14bf.onActionPropertyChanged({name:"ok"},"disabled",!_14c1);});};_14be.on("change",function(value){if(value){_14c0(value);}else{_14bf.onActionPropertyChanged({name:"ok"},"disabled",true);}});_14bf.on("execute",function(){df.resolve(_14be.get("value"));});_14bf.on("onHide",function(){df.cancel();});_14bf.show();_14be.onChange(null);return df;};var _14c2=function(_14c3,_14c4){var _14c5=_14ab.action.Create,_14c6=_14ab.providerCapabilities.Create,_14c7=_14c4&&!(_14c4.isWastebasket||_14c4.isDeleted)&&_14ab.isActionAvailable(_14c4,_14c5,_14c6,true,true);if(!_14c7){var _14c8=new Alert({description:_14a6.toHTML(_14ac.restore.userdonothavepermission)});_14c8.show();return false;}return true;};var _14c9=function(_14ca){var _14cb=_14a5.resolve("epi.cms.contentRepositoryDescriptors");var roots=[];for(var key in _14cb){_14cb[key].containedTypes.forEach(function(type){if(_14a7.isBaseTypeIdentifier(_14ca.typeIdentifier,type)){_14cb[key].roots.forEach(function(root){if(roots.indexOf(root)===-1){roots.push(root);}});}});}return roots;};var _14cc=function(model,_14cd,_14ce,_14cf,_14d0,_14d1){var _14d2;if(!_14d0||!model||!_14cd){return false;}if(_14cf&&_14ce){_14d2=_14ad(_14ac.restore.label,_14ac.restore.confirmquestion,_14ce);}else{_14d2=_14b3(_14cd,_14c9(_14cd),_14d1);}when(_14d2,function(_14d3){when(model.contentStore.get(_14d3),function(_14d4){if(!_14c2(_14cd,_14d4)){return false;}return _14d0.apply(model,[_14cd,_14d3]);});},function(){return false;});};_14a4.around(model,"restore",function(_14d5){return function(_14d6,_14d7){var _14d8;return when(model.contentStore.query({id:_14d6.contentLink}),lang.hitch(this,function(_14d9){var _14da=null;var _14db=null;if(_14d9.hasOwnProperty("statusCode")&&(_14d9.statusCode===401||_14d9.statusCode===403)){_14da=_14a6.toHTML(_14ac.restore.userdonothavepermission);}if(_14d9.hasOwnProperty("isDeleted")&&!_14d9.isDeleted){_14da=_14a6.toHTML(_14ac.restore.contentalreadyrestored);_14db=function(){model.updateTrash(model.get("currentTrash"));};}if(_14da){var _14dc=new Alert({description:_14da,onAction:_14db});_14dc.show();return false;}var _14dd=model.get("currentTrash");if(_14d9.parentLink!==_14dd.wasteBasketLink){return when(_14b3(_14d9,_14c9(_14d9)),function(_14de){when(model.contentStore.get(_14de),function(_14df){if(!_14c2(_14d9,_14df)){return false;}return _14d5.apply(model,[_14d9,_14de]);});},function(){return false;});}else{return when(model.getOldParent(_14d9.contentLink),function(_14e0){var _14e1=_14e0?_14e0.contentLink:null;_14cc(model,_14d9,_14e1,_14e1!=null,_14d5);});}}),lang.hitch(this,function(error){var _14e2=new Alert({description:_14a6.toHTML(_14ac.restore.contentdeletedpermanently),onAction:function(){model.updateTrash(model.get("currentTrash"));}});_14e2.show();return false;}));};});return model;};});},"epi-cms/widget/command/EmptyTrash":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_14e3,_14e4){return _14e3([_14e4],{label:null,tooltip:null,hasDeleteAccess:false,trashId:null,_execute:function(){this.model.emptyTrash(this.trashId);},_onModelChange:function(){var _14e5=this.model&&this.hasDeleteAccess&&!!this.trashId;this.set("canExecute",_14e5);}});});},"epi-cms/widget/command/RestoreContent":function(){define(["dojo/_base/declare","epi/shell/command/_Command"],function(_14e6,_14e7){return _14e6([_14e7],{content:null,_execute:function(){if(this.canExecute&&this.content){this.model.restore(this.content);}},_onModelChange:function(){var _14e8=!!this.model;this.set("canExecute",_14e8);}});});},"url:epi-cms/widget/templates/Trash.html":"<div class=\"epi-trash\">\n    <div class=\"epi-listingTopContainer\">\n        <h1 class=\"dijitInline\">${resources.heading}</h1>\n        <div class=\"epi-mediumButton epi-button--bold epi-emptyCommand\" data-dojo-attach-point=\"emptyTrashMenu\" data-dojo-type=\"epi-cms/widget/EmptyTrashMenu\"\n            data-dojo-props=\"title: '${resources.emptytrash.tooltip}'\"></div>\n    </div>\n    <div data-dojo-attach-point=\"stackContainer\">\n        <div data-dojo-type=\"dijit/layout/TabContainer\" data-dojo-attach-point=\"tabContainer\" data-dojo-props=\"doLayout:false, useMenu:true, useSlider:false\"> <!-- doLayout=\"false\" for flexible height -->\n        </div>\n    </div>\n</div>\n","epi-cms/widget/viewmodel/TrashViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/topic","dojo/Stateful","dojo/_base/json","epi/epi","epi/shell/_StatefulGetterSetterMixin","epi/shell/TypeDescriptorManager","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.trash"],function(array,_14e9,_14ea,lang,topic,_14eb,json,epi,_14ec,_14ed,_14ee,_14ef){return _14e9([_14eb,_14ec],{resources:_14ef,trashes:null,currentTrash:null,queryOptions:null,isEmptyTrash:false,storeRegistry:null,contentStore:null,trashStore:null,showAllLanguages:true,_contentRepositoryDescriptors:null,postscript:function(){this.inherited(arguments);this.storeRegistry=_14ee.resolve("epi.storeregistry");this.contentStore=this.contentStore||this._getStore();this.trashStore=this.trashStore||this.storeRegistry.get("epi.cms.wastebasket");this._contentRepositoryDescriptors=_14ee.resolve("epi.cms.contentRepositoryDescriptors");if(!this.trashes){this._createTrashes();}},destroy:function(){epi.removeDelegateAspects(this.contentStore);},_getStore:function(){var store=this.storeRegistry.get("epi.cms.content.light"),model=this;var _14f0=epi.delegate(store,{getChildren:function(_14f1,_14f2){var _14f3=model.get("currentTrash"),_14f4=model._createQueryOptions(_14f3);lang.mixin(_14f4.query,{referenceId:_14f1.contentLink});return this.query(_14f4.query,_14f4.options);},mayHaveChildren:function(_14f5){return _14f5.hasChildren;}},["notify"]);return _14f0;},_createTrashes:function(){_14ea.when(this.trashStore.query(),lang.hitch(this,function(_14f6){this.set("trashes",lang.clone(_14f6));}));},_setCurrentTrashAttr:function(trash){this._set("currentTrash",trash);if(trash.isRequireLoad){this.updateTrash(trash);trash.isRequireLoad=false;}},getEmptyTrashConfirmMessage:function(_14f7){var _14f8=_14ef.emptytrash.singleproviderdescription;if(this.trashes.length>1){_14f8=_14ef.emptytrash.description.replace("{0}",_14f7);}return _14f8;},updateTrash:function(trash){if(trash&&trash.active){this.set("queryOptions",this._createQueryOptions(trash));}else{this.set("queryOptions",null);}},_createQueryOptions:function(trash){var query={referenceId:trash.wasteBasketLink,query:"getchildren"};var _14f9={ignore:["query"],comparers:this._createComparers()};if(this.showAllLanguages){lang.mixin(query,{allLanguages:this.showAllLanguages});_14f9.ignore.push("allLanguages");}if(trash.deletedBy){lang.mixin(query,{deletedBy:trash.deletedBy});}if(trash.isSearchable){lang.mixin(query,{isSearchable:trash.isSearchable});_14f9.ignore.push("isSearchable");}if(trash.queryText){lang.mixin(query,{query:"searchdeletedcontent"});lang.mixin(query,{matchProvider:true});lang.mixin(query,{queryText:trash.queryText});}return {query:query,options:_14f9};},_createComparers:function(){return {referenceId:function(_14fa,_14fb){return _14fa===_14fb.parentLink;}};},emptyTrash:function(_14fc){if(_14fc){_14ea.when(this.trashStore.executeMethod("Empty",_14fc),lang.hitch(this,function(_14fd){var _14fe=array.filter(this.get("trashes"),function(trash){return trash&&trash.wasteBasketLink===_14fc;});array.forEach(_14fe,function(trash){trash.deletedByUsers=[];trash.isRequireLoad=true;trash.deletedByUsers=[];});this.isEmptyTrash=true;topic.publish("/epi/cms/trash/empty",_14fd.extraInformation);if(this.currentTrash.wasteBasketLink===_14fc){this.set("currentTrash",this.currentTrash);}}),lang.hitch(this,function(_14ff){if(_14ff.status===403){this.set("actionResponse",_14ef.emptytrash.accessdenied);}}));}},restore:function(_1500,_1501){if(_1500&&_1500.contentLink&&_1500.isDeleted&&_1501){_14ea.when(this.contentStore.move(_1500.contentLink,{targetId:_1501}),lang.hitch(this,function(_1502){if(_1502){this.contentStore.refresh(_1500.contentLink);if(_1500.parentLink!==this.currentTrash.wasteBasketLink){this.contentStore.refresh(_1500.parentLink).then(lang.hitch(this,function(){this.updateTrash(this.currentTrash);}));}var _1503=this.contentStore.get(_1501);if(_1503&&!_1503.hasChildren){this.contentStore.refresh(_1501).then(function(_1504){topic.publish("/epi/cms/contentdata/restored",_1504);});}}}),lang.hitch(this,function(_1505){this.set("actionResponse",_1505.xhr?json.fromJson(_1505.xhr.responseText):_14ef.restore.error);}));}},getOldParent:function(_1506){var df=new _14ea();_14ea.when(this.contentStore.query({referenceId:_1506,query:"getrestorepoint",allLanguages:true}),function(_1507){var _1508=_1507&&lang.isArray(_1507)&&_1507.length>0?_1507[0]:null;df.resolve(_1508);});return df;}});});},"epi-cms/component/Versions":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/string","dojo/topic","dojo/when","dojox/html/entities","dgrid/OnDemandGrid","dgrid/Selection","epi-cms/dgrid/formatters","epi","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/withConfirmation","epi/shell/widget/_FocusableMixin","epi/shell/widget/dialog/Alert","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/component/command/DeleteVersion","epi-cms/component/command/DeleteLanguageBranch","epi-cms/component/command/SetCommonDraft","epi-cms/command/ShowAllLanguages","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/_GridWidgetBase","epi/i18n!epi/cms/nls/episerver.cms.components.versions"],function(array,_1509,lang,_150a,_150b,_150c,topic,when,_150d,_150e,_150f,_1510,epi,_1511,_1512,_1513,_1514,_1515,Alert,_1516,_1517,_1518,_1519,_151a,_151b,_151c,_151d,_151e,_151f){return _1509([_151e,_1513,_1515,_1516],{showAllLanguages:true,isMultilingual:false,postMixInProperties:function(){this._commonDrafts={};this.storeKeyName="epi.cms.contentversion";this.ignoreVersionWhenComparingLinks=false;this.inherited(arguments);this._currentContentLanguage=_1517.currentContentLanguage;var _1520=_1511.resolve("epi.storeregistry");this._contentStore=_1520.get("epi.cms.contentdata");},buildRendering:function(){this.inherited(arguments);var _1521=_1509([_150e,_150f]);this.grid=new _1521({columns:{language:{label:epi.resources.header.language},status:{label:epi.resources.header.status,renderCell:_1510.commonDraft},savedDate:{label:epi.resources.header.saved,formatter:this._localizeDate},savedBy:{label:epi.resources.header.by,formatter:this._createUserFriendlyUsername}},selectionMode:"single",selectionEvents:"click,dgrid-cellfocusin",sort:[{attribute:"savedDate",descending:true}]},this.domNode);},postCreate:function(){this.inherited(arguments);this.add("commands",new _151c({model:this}));this._commonDraftCommand=new _151b();this._deleteVersionCommand=new _1519();this._deleteLanguageBranchCommand=new _151a();this.own(_150a.after(this._commonDraftCommand,"execute",lang.hitch(this,function(_1522){_1522.then(lang.hitch(this,this.fetchData),lang.hitch(this,this._onSetCommonDraftFailure));})),_150a.after(this._deleteVersionCommand,"execute",lang.hitch(this,function(_1523){_1523.then(lang.hitch(this,this._onDeleteVersionSuccess),lang.hitch(this,this._onDeleteVersionFailure));})),_150a.after(this._deleteLanguageBranchCommand,"execute",lang.hitch(this,function(_1524){_1524.then(lang.hitch(this,this._onDeleteLanguageBranchSuccess),lang.hitch(this,this._onDeleteVersionFailure));})));this.add("commands",this._commonDraftCommand);this.add("commands",_1514(this._deleteVersionCommand,null,{title:_151f.deletemenuitemtitle,heading:_151f.deleteversion.note,description:_151f.deleteversion.confirmquestion}));this._deleteLanguageBranchSettings={cancelActionText:epi.resources.action.cancel,setFocusOnConfirmButton:false};this.add("commands",_1514(this._deleteLanguageBranchCommand,null,this._deleteLanguageBranchSettings));},startup:function(){if(this._started){return;}this.inherited(arguments);this.own(_150a.around(this.grid,"renderRow",lang.hitch(this,this._aroundRenderRow)));this._toggleLanguage(this.showAllLanguages);this.fetchData();},_setShowAllLanguagesAttr:function(value){this._set("showAllLanguages",value);this._toggleFilterByLanguage(value);},contextChanged:function(_1525,_1526){this.inherited(arguments);!this._isContentContext(_1525)&&this.grid.set("store",null);},fetchData:function(){when(this.getCurrentContent(),lang.hitch(this,function(item){if(!item){return;}this._setQuery(item.contentLink,this._showAllLanguages);this.set("isMultilingual",true);}));},_aroundRenderRow:function(_1527){return lang.hitch(this,function(item){if(item.isCommonDraft){var _1528=this._commonDrafts[item.language];if(_1528&&_1528!==item.contentLink){this._removeCommonDraft(_1528);}this._commonDrafts[item.language]=item.contentLink;}this._versionsByLanguage[item.language]=this._versionsByLanguage[item.language]||[];if(array.every(this._versionsByLanguage[item.language],function(ver){return ver!==item.contentLink;})){this._versionsByLanguage[item.language].push(item.contentLink);}var row=_1527.apply(this.grid,arguments);_150b.toggle(row,"dgrid-row-published",item.status===_151d.versionStatus.Published);return row;});},_onError:function(e){if(e.error&&e.error.status===403){when(this.getCurrentContent(),lang.hitch(this,function(item){this._showErrorMessage(epi.resources.messages.nopermissiontoviewdata);this.set("isMultilingual",false);this._updateMenu(item);}));}else{this.inherited(arguments);}},_onSelect:function(e){var item=e.rows[0].data;this._updateMenu(item);this.inherited(arguments);},_updateMenu:function(item){this._commonDraftCommand.set("model",item);this._deleteVersionCommand.set("model",item);when(this._contentStore.get(item.contentLink),lang.hitch(this,function(_1529){if(_1529&&_1529.currentLanguageBranch){var _152a=lang.replace(_151f.deletelanguagebranch.label,[_1529.currentLanguageBranch.name]),_152b=_1512.getResourceValue(_1529.typeIdentifier,"deletelanguagebranchdescription");lang.mixin(this._deleteLanguageBranchSettings,{confirmActionText:_152a,description:lang.replace(_152b,[_150d.encode(_1529.name),_1529.currentLanguageBranch.name]),title:_152a});this._deleteLanguageBranchCommand.set("label",_152a);}this._deleteLanguageBranchCommand.set("model",_1529);}));},_showNotificationMessage:function(_152c){var _152d=new Alert({title:_151f.notificationtitle,description:_152c});_152d.show();},_selectCommonDraftVersion:function(uri,_152e){var _152f={sender:this};if(_152e){_152f.forceReload=_152e;}topic.publish("/epi/shell/context/request",{uri:uri},_152f);},_onDeleteLanguageBranchSuccess:function(){return when(this._onDeleteVersionSuccess(arguments),lang.hitch(this,function(){var _1530=this._deleteLanguageBranchCommand.model.currentLanguageBranch.languageId;array.forEach(this._versionsByLanguage[_1530],lang.hitch(this,function(ver){this.store.notify(undefined,new _1518(ver));}));}));},_onDeleteVersionSuccess:function(){var self=this;return when(this.getCurrentContent(),function(_1531){var _1532=new _1518(_1531.contentLink);var _1533=_1532.createVersionUnspecificReference().toString();self._selectCommonDraftVersion("epi.cms.contentdata:///"+_1533,true);});},_onDeleteVersionFailure:function(_1534){if(!_1534||!_1534.status){return;}else{if(_1534.status===403){this._showNotificationMessage(_151f.deleteversion.cannotdeletepublished);}else{this._showNotificationMessage(_151f.deleteversion.cannotdelete);}}},_onSetCommonDraftFailure:function(){this._showNotificationMessage(_151f.setcommondraft.failuremessage);},_removeCommonDraft:function(_1535){if(_1535){var item=this.grid.row(_1535).data;if(item){item.isCommonDraft=false;}}},_toggleFilterByLanguage:function(_1536){when(this.getCurrentContext(),lang.hitch(this,function(_1537){if(!this._isContentContext(_1537)){this.grid.set("store",null);}else{this._setQuery(_1537.id,_1536);this._toggleLanguage(_1536);this._showAllLanguages=_1536;}}));},_setQuery:function(_1538,_1539){var query={contentLink:new _1518(_1538).createVersionUnspecificReference().toString()};if(!_1539){query.language=this._currentContentLanguage;}this.grid.set("query",query);if(!this.grid.store){this.grid.set("store",this.store);}this._versionsByLanguage={};},_toggleLanguage:function(_153a){var value=_153a?"table-cell":"none";this.grid.styleColumn("language",_150c.substitute("display:${0};",[value]));}});});},"epi-cms/component/command/DeleteVersion":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi-cms/ApplicationSettings","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/shell/command/_Command"],function(_153b,lang,when,_153c,_153d,_153e,_153f,_1540){return _153b([_1540],{label:_153f.deletemenuitemtitle,iconClass:"epi-iconTrash",category:"context",postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_153e.resolve("epi.storeregistry");this._content=this.storeRegistry.get("epi.cms.contentdata");this._versions=this.storeRegistry.get("epi.cms.contentversion");},_execute:function(){return this._versions.remove(this.model.contentLink);},_onModelChange:function(){if(_153c.disableVersionDeletion){this.set("isAvailable",false);return;}this.set("isAvailable",true);if(!this.model.allowToDelete){this.set("canExecute",false);return;}when(this._content.get(this.model.contentLink),lang.hitch(this,function(_1541){var _1542=_153d.action,_1543=_1541&&_153d.isActionAvailable(_1541,_1542.Delete);this.set("canExecute",_1543);}));}});});},"epi-cms/component/command/DeleteLanguageBranch":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi/shell/command/_Command","epi-cms/_MultilingualMixin","epi-cms/ApplicationSettings","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport"],function(_1544,lang,when,_1545,_1546,_1547,_1548,_1549,_154a){return _1544([_1546,_1547],{label:"",iconClass:"",category:"context",postscript:function(){this.inherited(arguments);this.storeRegistry=this.storeRegistry||_1545.resolve("epi.storeregistry");this._versions=this.storeRegistry.get("epi.cms.contentversion");this._structure=this.storeRegistry.get("epi.cms.content.light");},_execute:function(){var _154b=_1549.toContentReference(this.model.contentLink);return when(this._versions.remove(_154b,{deleteLanguageBranch:true}),lang.hitch(this,function(){return this._structure.refresh(_154b.createVersionUnspecificReference().toString());}));},_onModelChange:function(){var model=this.model,_154c=!!(model&&model.currentLanguageBranch&&model.capabilities.deleteLanguageBranch&&!_1548.disableVersionDeletion),_154d=_154c&&!model.currentLanguageBranch.isMasterLanguage&&_154a.isActionAvailable(model,_154a.action.Delete);this.set("canExecute",_154d);this.set("isAvailable",_154c);}});});},"epi-cms/component/command/SetCommonDraft":function(){define(["dojo/_base/declare","dojo/topic","epi-cms/contentediting/ContentActionSupport","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.components.versions","epi/shell/command/_Command"],function(_154e,topic,_154f,_1550,_1551,_1552){return _154e([_1552],{label:_1551.setcommondraftitemtitle,iconClass:"epi-iconPrimary",category:"context",constructor:function(){var _1553=_1550.resolve("epi.storeregistry");this.store=_1553.get("epi.cms.contentversion");},_execute:function(){var store=this.store;return store.patch({isCommonDraft:true,contentLink:this.model.contentLink},{id:this.model.contentLink}).then(function(item){topic.publish("/epi/cms/content/statuschange/","common-draft",{id:item.contentLink});return store.patchCache(item);});},_onModelChange:function(){var model=this.model,_1554=_154f.versionStatus,_1555=model&&!model.isCommonDraft&&(model.status===_1554.CheckedOut||model.status===_1554.Rejected);this.set("canExecute",!!_1555);}});});},"epi-cms/content-approval/ApprovalComponent":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/Deferred","dojo/dom-style","epi/shell/DialogService","epi/shell/command/builder/ButtonBuilder","epi/shell/widget/dialog/Confirmation","epi-cms/content-approval/ApprovalDefinitionStatus","epi-cms/content-approval/viewmodels/ContentApprovalViewModel","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ApprovalComponent.html","epi/i18n!epi/nls/episerver.cms.contentapproval.component","epi/i18n!epi/nls/episerver.shared.action","dijit/Toolbar","dijit/form/RadioButton","dijit/form/Select","epi-cms/widget/Breadcrumb","epi-cms/widget/NotificationStatusBar","epi-cms/content-approval/ApprovalStepList"],function(lang,_1556,_1557,_1558,_1559,_155a,_155b,_155c,_155d,_155e,_155f,_1560,_1561,_1562,_1563,_1564){return _1556([_155e,_155f,_1560,_1561],{templateString:_1562,languageWarningTemplate:" <span class='dijitInline dijitReset dijitIcon epi-iconWarning' title='"+_1563.languagefilter.warningmessage+"'></span>",resources:_1563,modelBindingMap:{currentContentLink:["breadcrumbContentLink","notificationContext"],isReadOnly:["isReadOnly"],filterOptions:["filterOptions"],status:["status"]},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _155d();this.own(this.model);},buildRendering:function(){this.inherited(arguments);var _1565=new _155a(),_1566=this.model.get("commands");_1566.forEach(function(_1567){_1565.create(_1567,this.commandNode);},this);},postCreate:function(){this.inherited(arguments);this.stepList.set("model",this.model);this.own(this.enableButton.on("click",this._updateStatus.bind(this,_155c.enabled)),this.disableButton.on("click",this._updateStatus.bind(this,_155c.disabled)),this.inheritButton.on("click",this._updateStatus.bind(this,_155c.inheritEnabled)),this.languageFilter.on("change",this._updateSelectedLanguage.bind(this)));},_isEnabled:function(){return this.status===_155c.enabled||this.status===_155c.inheritEnabled;},_updateSelectedLanguage:function(_1568){this.model.set("selectedLanguage",_1568);},_setNotificationContextAttr:function(){this.validation.set("notificationContext",{contextTypeName:"epi.cms.approval",contextId:this.model.currentContentLink});},_setBreadcrumbContentLinkAttr:function(){this.breadcrumb.set("contentLink",this.model.currentContentLink);},_setStatusAttr:function(_1569){this._set("status",_1569);this.enableButton.set("checked",_1569===_155c.enabled);this.disableButton.set("checked",_1569===_155c.disabled);this.inheritButton.set("checked",_1569===_155c.inheritEnabled||_1569===_155c.inheritDisabled);var _156a=this._isEnabled();_1558.set(this.stepList.domNode,"display",_156a?"":"none");_1558.set(this.filterNode,"display",_156a&&!!this.model.get("filterOptions")?"":"none");_1558.set(this.disabledWarningNode,"display",_156a?"none":"");},_setIsReadOnlyAttr:function(_156b){this._set("isReadOnly",_156b);this.enableButton.set("disabled",_156b);this.disableButton.set("disabled",_156b);this.inheritButton.set("disabled",_156b);},_setFilterOptionsAttr:function(_156c){var _156d=!!_156c&&this._isEnabled();_1558.set(this.filterNode,"display",_156d?"":"none");if(!_156c){return;}_156c=lang.clone(_156c);var _156e=this.model.get("selectedLanguage")||"";_156c.forEach(function(_156f){if(!_156f.isValid&&this.model.get("showValidations")){_156f.label+=this.languageWarningTemplate;}_156f.selected=_156e===_156f.value;},this);this.languageFilter.set("options",_156c);this.languageFilter.set("value",_156e);},_updateStatus:function(_1570){var _1571;switch(_1570){case _155c.inheritEnabled:case _155c.inheritDisabled:_1571=this._confirmInherit();break;case _155c.enabled:this.model.enable();_1571=new _1557().resolve();break;case _155c.disabled:_1571=this._confirmDisable();break;}_1571.otherwise(this.set.bind(this,"status",this.status));},_confirmDisable:function(){var _1572={title:this.resources.disable.title,description:this.resources.disable.description,confirmActionText:_1564.disable,cancelActionText:_1564.cancel};return _1559.confirmation(_1572).then(this.model.disable.bind(this.model));},_confirmInherit:function(){var _1573={title:this.resources.inherit.title,description:this.resources.inherit.description,confirmActionText:this.resources.inherit.okbutton,cancelActionText:_1564.cancel,setFocusOnConfirmButton:false};return _1559.confirmation(_1573).then(this.model.inheritDefinition.bind(this.model));}});});},"epi-cms/content-approval/ApprovalDefinitionStatus":function(){define({enabled:0,disabled:1,inheritEnabled:2,inheritDisabled:3});},"epi-cms/content-approval/viewmodels/ContentApprovalViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/when","epi/epi","epi/dependency","epi/shell/DialogService","epi-cms/content-approval/ApprovalDefinitionStatus","epi-cms/content-approval/viewmodels/ApprovalStepViewModel","epi/shell/command/withConditionalConfirmation","dojo/Stateful","epi/shell/DestroyableByKey","epi/shell/_ContextMixin","epi-cms/content-approval/command/SaveApprovalDefinition","epi-cms/content-approval/command/CancelChanges","epi/shell/store/SortableMemory","dojo/store/Observable","epi/i18n!epi/nls/episerver.cms.contentapproval","epi/i18n!epi/nls/episerver.cms.languageselector","epi/i18n!epi/nls/episerver.shared.action"],function(_1574,lang,on,when,epi,_1575,_1576,_1577,_1578,_1579,_157a,_157b,_157c,_157d,_157e,_157f,_1580,_1581,_1582,_1583){return _1574([_157a,_157b,_157c],{approvalSteps:null,approvalService:null,userStore:null,commands:null,isDirty:false,selectedLanguage:null,currentContentLink:null,isValid:true,isReadOnly:false,languages:null,filterOptions:null,languageOptions:null,showValidations:false,status:_1577.inheritEnabled,_approvalStepsQuery:null,_originalDefinition:null,_validationMessageIds:[],_contextService:null,_messageService:null,constructor:function(_1584,_1585,_1586,_1587,_1588){this.approvalService=_1585||_1575.resolve("epi.cms.ApprovalService");this._contextService=_1586||_1575.resolve("epi.shell.ContextService");this._messageService=_1587||_1575.resolve("epi.shell.MessageService");this.userStore=_1588||_1575.resolve("epi.storeregistry").get("epi.cms.notification.users");},postscript:function(){this.inherited(arguments);when(this.getCurrentContext()).then(this.contextChanged.bind(this));},destroy:function(){this.inherited(arguments);this._removeEventListeners();},contextChanged:function(_1589){this.set("currentContentLink",_1589.id);this.approvalService.getDefinition(_1589.id).then(this.loadApprovalDefinition.bind(this));},createApprovalStep:function(_158a){if(!this._canEditApprovalSteps()){return;}var steps=this.approvalSteps,_158b=steps.getSibling(_158a),_158c;_158c=new _1578({languages:this.languages,approvers:[],userStore:this.userStore,showValidations:this.showValidations});this._addEventListeners(_158c);steps.add(_158c,{before:_158b});},inheritDefinition:function(){var _158d=this.get("currentContentLink"),_158e=this.status;this.set("status",_1577.inheritEnabled);return this.approvalService.inheritDefinition(_158d).then(this.loadApprovalDefinition.bind(this)).otherwise(this.set.bind(this,"status",_158e));},moveApprovalStep:function(_158f,up){if(!this._canEditApprovalSteps()){return;}var steps=this.approvalSteps,_1590=steps.getSibling(_158f,up);if(!_1590){return;}if(!up){_1590=steps.getSibling(_1590);}steps.put(_158f,{before:_1590});},removeApprovalStep:function(_1591){if(!this._canEditApprovalSteps()){return;}if(_1591.canBeDeleted){this.approvalSteps.remove(_1591.id);}},loadApprovalDefinition:function(_1592){this._originalDefinition=null;this.set({languages:_1592.languages,status:_1592.status,isReadOnly:_1592.isReadOnly,showValidations:false});this._createApprovalSteps(_1592.approvalSteps);this._originalDefinition=this.serialize();},saveApprovalDefinition:function(){var _1593=this.serialize();return this.approvalService.saveDefinition(_1593).then(this.loadApprovalDefinition.bind(this));},serialize:function(){var _1594=this.approvalSteps.data.map(function(step){return step.serialize();});return {contentLink:this.currentContentLink,approvalSteps:_1594,status:this.status};},validate:function(){var _1595=null;this.approvalSteps.data.forEach(function(step){step.validate();});if(this._stepsMissingApprover().length>0){_1595={level:"error",dialog:{description:_1581.validationmessage.notenoughapproversmessage.description}};}else{if(this._stepsMissingLanguageApprover().length>0){_1595={level:"warning",dialog:{title:_1581.validationmessage.notenoughlanguagesmessage.title,description:_1581.validationmessage.notenoughlanguagesmessage.description,confirmActionText:_1581.action.saveanyway,cancelActionText:_1583.cancel}};}}return _1595;},enable:function(){this.set("status",_1577.enabled);},disable:function(){this.set("showValidations",false);this.set("status",_1577.disabled);return this.saveApprovalDefinition().otherwise(function(){this.set("showValidations",true);this.enable();}.bind(this));},_createApprovalSteps:function(steps){var _1596=(steps||[this._createEmptyStep()]).map(this._createStepViewModel.bind(this)),store=_1580(new _157f({data:_1596}));this.set("approvalSteps",store);this.set("isDirty",false);this._approvalStepsQuery=store.query();this._updateApprovalSteps();this.destroyByKey("observeHandle");this.ownByKey("observeHandle",this._approvalStepsQuery.observe(function(){this._updateApprovalSteps();}.bind(this)));},_createEmptyStep:function(){return {approvers:[]};},_createStepViewModel:function(step,index){step=lang.clone(step);var _1597=new _1578({id:index,languages:this.languages,approvers:step.approvers,name:step.name,userStore:this.userStore});this._addEventListeners(_1597);return _1597;},_updateApprovalSteps:function(){var _1598=this._approvalStepsQuery;if(_1598){var _1599=_1598.length>1,_159a=!this._canEditApprovalSteps(),_159b=this.selectedLanguage;_1598.forEach(function(step){step.set({canBeDeleted:_1599,isReadOnly:_159a});step.filterApprovers(_159b);});this._onApprovalStepsChanged();}},_resetValidationMessageIds:function(){this._validationMessageIds.forEach(lang.hitch(this,function(_159c){this._messageService.remove({id:_159c});}));this._validationMessageIds=[];if(this.showValidations){this._approvalStepsQuery.forEach(lang.hitch(this,function(step){var _159d;if(!step.isValid){if(step.validationMessage.level==="error"){_159d={level:"error",text:step.validationMessage.value};}else{if(step.validationMessage.level==="warning"){_159d={level:"warn",text:step.validationMessage.value};}}var _159e=this._messageService.put(_159d.level,_159d.text,"epi.cms.approval",this.currentContentLink);this._validationMessageIds.push(_159e);}}));}},_onApprovalStepsChanged:function(){this._resetValidationMessageIds();this._validateFilterOptions();var _159f=this.serialize();var equal=epi.areEqual(_159f,this._originalDefinition);this._originalDefinition&&this.set("isDirty",!equal);},_addEventListeners:function(step){this.own(step.on("create-step",this.createApprovalStep.bind(this)),step.on("remove-step",this.removeApprovalStep.bind(this)),step.on("change",this._onApprovalStepsChanged.bind(this)),step.watch("isValid",this._onApprovalStepsChanged.bind(this)));},_canEditApprovalSteps:function(){return !this.isReadOnly&&this.status===_1577.enabled;},_commandsGetter:function(){if(this.commands===null){this.commands=[new _157d({model:this,order:10}),new _157e({model:this,order:20})];}return this.commands;},_createLanguageOptions:function(_15a0){if(!_15a0){this.set("languageOptions",null);this.set("filterOptions",null);return;}var _15a1=_15a0.map(function(_15a2){return {label:_15a2.text,value:_15a2.value};});this.set("languageOptions",_15a1);var _15a3=lang.clone(_15a1);_15a3.unshift(this._getDefaultLanguageOption());this.set("filterOptions",_15a3);},_getDefaultLanguageOption:function(){return {label:_1582.alllanguages,value:"",selected:true};},_validateFilterOptions:function(){if(!this.filterOptions){return;}var _15a4=this._stepsMissingLanguageApprover();this.filterOptions.forEach(function(_15a5){_15a5.isValid=_15a4.every(function(step){return step.validationMessage.languages.indexOf(_15a5.value)===-1;});});this.set("filterOptions",this.filterOptions);},_stepsMissingApprover:function(){return this.approvalSteps.data.filter(function(step){return !step.isValid&&!step.validationMessage.languages;});},_stepsMissingLanguageApprover:function(){return this.approvalSteps.data.filter(function(step){return !step.isValid&&step.validationMessage.languages;});},_isDirtySetter:function(_15a6){this.isDirty=_15a6;if(!_15a6){this._removeEventListeners();return;}if(this._interceptor){return;}this._beforeUnloadHandler=on(window,"beforeunload",function(e){var _15a7=_1581.command.cancelchanges.description;e.returnValue=_15a7;return _15a7;});this._interceptor=this._contextService.registerRequestInterceptor(function(){var _15a8={title:_1581.command.cancelchanges.title,description:_1581.command.cancelchanges.description};return _1576.confirmation(_15a8).then(this._removeEventListeners.bind(this));}.bind(this));},_isReadOnlySetter:function(value){this.isReadOnly=value;this._updateApprovalSteps();},_languagesSetter:function(value){this.languages=value;this._createLanguageOptions(this.languages);this._updateApprovalSteps();},_selectedLanguageSetter:function(_15a9){this.selectedLanguage=!_15a9?null:_15a9;this._updateApprovalSteps();},_showValidationsSetter:function(_15aa){this.showValidations=_15aa;if(this.approvalSteps&&this.approvalSteps.data){this.approvalSteps.data.forEach(function(step){step.set("showValidations",_15aa);});}},_statusSetter:function(_15ab){this.status=_15ab;this._updateApprovalSteps();},_removeEventListeners:function(){this._interceptor&&this._interceptor.remove();this._interceptor=null;this._beforeUnloadHandler&&this._beforeUnloadHandler.remove();this._beforeUnloadHandler=null;}});});},"epi-cms/content-approval/viewmodels/ApprovalStepViewModel":function(){define(["dojo/_base/declare","epi-cms/content-approval/viewmodels/ApproverViewModel","dojo/Stateful","dojo/Evented","epi/shell/DestroyableByKey","epi-cms/content-approval/command/AddApprovalStep","epi-cms/content-approval/command/RemoveApprovalStep","dojo/store/Memory","dojo/store/Observable","epi/i18n!epi/nls/episerver.cms.contentapproval"],function(_15ac,_15ad,_15ae,_15af,_15b0,_15b1,_15b2,_15b3,_15b4,_15b5){return _15ac([_15ae,_15b0,_15af],{approvers:null,commands:null,userStore:null,canBeDeleted:true,isReadOnly:false,name:"",isValid:true,validationMessage:null,languages:null,showValidations:false,addApprover:function(_15b6){_15b6.languages=_15b6.languages||[];this.approvers.add(this._createApprover(_15b6));},filterOutExistingUsers:function(users){var _15b7=this.get("approvers");return users=users.filter(function(user){return !_15b7.get(user.userName);},this);},filterApprovers:function(_15b8){this.approvers.query().forEach(function(_15b9){if(_15b8===null||_15b9.languages.length===0){_15b9.set("canApprove",true);return;}var _15ba=_15b9.languages.some(function(_15bb){return _15bb===_15b8;});_15b9.set("canApprove",_15ba);});},createApprovalStep:function(){this.emit("create-step",this);},removeApprovalStep:function(){this.emit("remove-step",this);},removeApprover:function(_15bc){if(this.isReadOnly){return;}this.approvers.remove(_15bc);},serialize:function(){var _15bd=this.approvers.data.map(function(_15be){return _15be.serialize();});return {name:this.name,approvers:_15bd};},validate:function(){if(!this.approvers){return;}var _15bf=this.approvers.query(),_15c0=this._validateApprovers(_15bf);if(!_15c0){_15c0=this._validateLanguages(_15bf);}this.set("validationMessage",_15c0);this.set("isValid",!_15c0);},_createApprover:function(_15c1){var _15c2=new _15ad(_15c1);this.own(_15c2.watch("languages",function(){this.validate();this.emit("change");}.bind(this)));this.validate();return _15c2;},_nameSetter:function(value){value=value||"";if(value===this.name){return;}this.name=value;this.emit("change");},_nameGetter:function(){return this.name||_15b5.step.header.placeholder;},_approversSetter:function(_15c3){var _15c4=_15c3.map(function(_15c5){return this._createApprover(_15c5);},this);this.approvers=_15b4(new _15b3({idProperty:"userName",data:_15c4}));this.destroyByKey("approversObserveHandle");this.ownByKey("approversObserveHandle",this.approvers.query().observe(function(){this.validate();this.emit("change");}.bind(this)));this.validate();},_commandsGetter:function(){if(this.commands===null){this.commands=[new _15b1({model:this}),new _15b2({model:this})];}return this.commands;},_validateLanguages:function(_15c6){var _15c7=null;if(!this.languages){return _15c7;}this.languages.forEach(function(_15c8){var _15c9=_15c6.some(function(_15ca){if(_15ca.languages.length===0){return true;}return _15ca.languages.some(function(_15cb){return _15cb===_15c8.value;});});if(!_15c9){if(_15c7){_15c7.languages.push(_15c8.value);}else{_15c7={value:_15b5.validationmessage.notenoughlanguagesmessage.title,languages:[_15c8.value],level:"warning"};}}});return _15c7;},_validateApprovers:function(_15cc){var _15cd=null;var _15ce=_15cc.length>0;if(!_15ce){_15cd={value:_15b5.validationmessage.notenoughapproversmessage.title,languages:null,level:"error"};}return _15cd;}});});},"epi-cms/content-approval/viewmodels/ApproverViewModel":function(){define(["dojo/_base/declare","dojo/Stateful"],function(_15cf,_15d0){return _15cf([_15d0],{displayName:null,userName:null,languages:null,canApprove:true,serialize:function(){return {userName:this.userName,displayName:this.displayName,languages:this.languages};}});});},"epi-cms/content-approval/command/AddApprovalStep":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.shared.action","epi/shell/command/_PropertyWatchCommand"],function(_15d1,_15d2,_15d3){return _15d1([_15d3],{label:_15d2.add,iconClass:"epi-icon--inverted epi-iconPlus",category:"add",propertiesToWatch:["isReadOnly"],_execute:function(){this.model.createApprovalStep();},_onPropertyChanged:function(){var _15d4=!this.model.isReadOnly;this.set({canExecute:_15d4,isAvailable:_15d4});}});});},"epi-cms/content-approval/command/RemoveApprovalStep":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.cms.contentapproval.command.removeapprovalstep","epi/shell/command/_PropertyWatchCommand"],function(_15d5,_15d6,_15d7){return _15d5([_15d7],{label:_15d6.label,iconClass:"epi-iconClose",category:"remove",propertiesToWatch:["canBeDeleted","isReadOnly"],_execute:function(){this.model.removeApprovalStep();},_onPropertyChanged:function(){var model=this.model,_15d8=!model.isReadOnly&&model.canBeDeleted;this.set({canExecute:_15d8,isAvailable:_15d8});}});});},"epi/shell/command/withConditionalConfirmation":function(){define("epi/shell/command/withConditionalConfirmation",["dojo/Deferred","dojo/when","epi/shell/DialogService"],function(_15d9,when,_15da){return function(_15db,_15dc){var _15dd=_15db._execute,_15de=_15dc.property||"requiresConfirmation";_15db._execute=function(){var _15df=_15db[_15de]?_15da.confirmation(_15dc):new _15d9().resolve();return _15df.then(function(){return when(_15dd.apply(_15db,arguments));});};return _15db;};});},"epi-cms/content-approval/command/SaveApprovalDefinition":function(){define(["dojo/_base/declare","epi/i18n!epi/nls/episerver.shared.action","epi/shell/DialogService","epi/shell/command/_PropertyWatchCommand"],function(_15e0,_15e1,_15e2,_15e3){return _15e0([_15e3],{label:_15e1.save,isAvailable:true,canExecute:false,propertiesToWatch:["isDirty","isValid","isReadOnly"],_execute:function(){this.model.set("showValidations",true);var _15e4=this.model.validate();if(!_15e4){this.model.saveApprovalDefinition();return;}switch(_15e4.level){case "error":_15e2.alert(_15e4.dialog);break;case "warning":_15e2.confirmation(_15e4.dialog).then(function(){this.model.saveApprovalDefinition();}.bind(this));break;}},_onPropertyChanged:function(){this.set("isAvailable",!this.model.isReadOnly);this.set("canExecute",this.model.isDirty&&this.model.isValid);this.set("label",!!this.model.isDirty?_15e1.save:_15e1.saved);}});});},"epi-cms/content-approval/command/CancelChanges":function(){define(["dojo/_base/declare","epi/dependency","epi/i18n!epi/nls/episerver.shared.action","epi/shell/command/_PropertyWatchCommand"],function(_15e5,_15e6,_15e7,_15e8){return _15e5([_15e8],{label:_15e7.cancel,canExecute:true,propertiesToWatch:["isDirty"],contextHistory:null,postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_15e6.resolve("epi.cms.BackContextHistory");},_execute:function(){this.contextHistory.closeAndNavigateBack(this);},_onPropertyChanged:function(){var _15e9=!!this.model.isDirty;this.set("label",_15e9?_15e7.cancel:_15e7.close);}});});},"epi/shell/store/SortableMemory":function(){define("epi/shell/store/SortableMemory",["dojo/_base/declare","epi/shell/store/queryUtils","dojo/store/Memory"],function(_15ea,_15eb,_15ec){return _15ea(_15ec,{getSibling:function(_15ed,_15ee){var data=this.data,index=this.index,id=this.getIdentity(_15ed);if(!(id in index)){throw new Error("Object specified in options.before does not exist");}var delta=_15ee?-1:1,pos=index[id]+delta;if(pos<0||pos>=data.length){return null;}return data[pos];},put:function(_15ef,_15f0){var data=this.data,_15f1=this.idProperty;var id=_15ef[_15f1]=(_15f0&&"id" in _15f0)?_15f0.id:_15f1 in _15ef?_15ef[_15f1]:Math.random();var _15f2=false;if(id in this.index){_15f2=true;}if(_15f0){if(_15f0.overwrite===false){if(_15f2){throw new Error("Object already exists");}}if(_15f0.before||(_15f0.before===null&&_15f2)){var _15f3=this.index[id],_15f4=data.length;if(_15f0.before){var _15f5=this.getIdentity(_15f0.before);_15f4=this.index[_15f5];}if(_15f3<_15f4){--_15f4;}if(_15f4!==undefined){if(_15f2){this.remove(id);}data.splice(_15f4,0,_15ef);this.setData(data);return id;}else{throw new Error("Object specified in options.before does not exist");}}}if(_15f2){data[this.index[id]]=_15ef;}else{this.index[id]=data.push(_15ef)-1;}return id;},queryEngine:function(query,_15f6){query=_15eb.createFilter(query,_15f6);function _15f7(){return this.data.filter(query);};_15f7.matches=query;return _15f7.bind(this);}});});},"url:epi-cms/content-approval/templates/ApprovalComponent.html":"<div class=\"epi-content-approval\">\n    <div class=\"epi-localToolbar epi-viewHeaderContainer\" data-dojo-type=\"dijit/Toolbar\">\n        <div class=\"epi-toolbarGroupContainer\">\n            <div class=\"epi-toolbarGroup epi-toolbarLeading\">\n                <div data-dojo-attach-point=\"breadcrumb\" data-dojo-type=\"epi-cms/widget/Breadcrumb\"></div>\n            </div>\n            <div class=\"epi-toolbarGroup epi-toolbarTrailing\" data-dojo-attach-point=\"commandNode\">\n                <div data-dojo-attach-point=\"validation\" data-dojo-type=\"epi-cms/widget/NotificationStatusBar\"></div>\n            </div>\n        </div>\n    </div>\n    <div data-dojo-attach-point=\"containerNode\" class=\"epi-content-approval__container\">\n        <div class=\"epi-content-approval__header\">\n            <h1>${resources.title}</h1>\n            <p>\n                ${resources.instructions.part1}\n                <em>${resources.instructions.part2}</em>\n                ${resources.instructions.part3}\n            </p>\n            <p>${resources.instructions.part4}</p>\n            <div class=\"epi-content-approval__settings\">\n                <span class=\"dijitInline\">\n                    <input id=\"enable-approval\" data-dojo-attach-point=\"enableButton\" data-dojo-type=\"dijit/form/RadioButton\">\n                    <label class=\"dijitInline\" for=\"enable-approval\">${resources.enabled}</label>\n                </span>\n                <span class=\"dijitInline\">\n                    <input id=\"inherit-approval\" data-dojo-attach-point=\"inheritButton\" data-dojo-type=\"dijit/form/RadioButton\">\n                    <label class=\"dijitInline\" for=\"inherit-approval\">${resources.inherited}</label>\n                </span>\n                <span class=\"dijitInline\">\n                    <input id=\"disabled-approval\" data-dojo-attach-point=\"disableButton\" data-dojo-type=\"dijit/form/RadioButton\">\n                    <label class=\"dijitInline\" for=\"disabled-approval\">${resources.disabled}</label>\n                </span>\n            </div>\n        </div>\n        <div class=\"epi-content-approval__disabled-warning\" data-dojo-attach-point=\"disabledWarningNode\">\n            ${resources.disabledwarning}\n        </div>\n        <div class=\"epi-content-approval__filter\" data-dojo-attach-point=\"filterNode\">\n            <span class=\"dijitInline\">${resources.languagefilter.description}</span>\n            <div data-dojo-attach-point=\"languageFilter\" data-dojo-type=\"dijit/form/Select\" class=\"epi-chromeless epi-chromeless--with-arrow epi-visibleLink\"></div>\n        </div>\n        <div data-dojo-attach-point=\"stepList\" data-dojo-type=\"epi-cms/content-approval/ApprovalStepList\"></div>\n    </div>\n</div>\n","epi-cms/content-approval/ApprovalStepList":function(){define(["dojo/_base/declare","dojo/keys","epi-cms/content-approval/ApprovalStep","dijit/_WidgetBase","dijit/_TemplatedMixin","epi/shell/widget/_ModelBindingMixin","dgrid/List","dgrid/Keyboard","dgrid/extensions/DijitRegistry","dgrid/extensions/DnD","epi/shell/dgrid/SingleQuery","epi/shell/dgrid/WidgetRow","dojo/text!./templates/ApprovalStepList.html","epi/i18n!epi/nls/episerver.cms.contentapproval.steplist"],function(_15f8,keys,_15f9,_15fa,_15fb,_15fc,List,_15fd,_15fe,DnD,_15ff,_1600,_1601,_1602){var _1603=_15f8([List,_15ff,DnD,_15fd,_15fe,_1600]);return _15f8([_15fa,_15fb,_15fc],{model:null,modelBindingMap:{approvalSteps:["approvalSteps"]},templateString:_1601,resources:_1602,buildRendering:function(){this.inherited(arguments);this.list=new _1603({className:"epi-chromeless",dndParams:{withHandles:true,creator:this._createAvatar.bind(this),skipForm:true},maintainOddEven:false,renderRow:this._renderRow.bind(this),selectionMode:"single"},this.listNode);this.own(this.list.addKeyHandler(keys.DELETE,this._removeStep.bind(this)),this.list.addKeyHandler(keys.DOWN_ARROW,this._moveStep.bind(this,false)),this.list.addKeyHandler(keys.UP_ARROW,this._moveStep.bind(this,true)),this.list.on(".dgrid-row:keypress",this._createStep.bind(this)));},startup:function(){this.inherited(arguments);this.list.startup();},_createAvatar:function(item){var step=new _15f9({model:item});step.startup();var node=step.domNode.cloneNode(true);step.destroyRecursive();return {node:node,type:this.list.dndSourceType,data:item};},_createStep:function(event){if(!event.ctrlKey&&String.fromCharCode(event.which)==="+"){var row=this.list.row(event);this.model.createApprovalStep(row.data);}},_moveStep:function(_1604,event){if(event.ctrlKey){var row=this.list.row(event);this.list.focus(row);this.model.moveApprovalStep(row.data,_1604);}},_removeStep:function(event){var row=this.list.row(event);this.model.removeApprovalStep(row.data);},_renderRow:function(_1605){var _1606=this.model.get("languageOptions");var step=new _15f9({model:_1605,languageOptions:_1606});return step.domNode;},_setApprovalStepsAttr:function(_1607){this.list.set("store",_1607);}});});},"epi-cms/content-approval/ApprovalStep":function(){define(["dojo/_base/declare","dojo/aspect","dojo/dom-class","dojo/keys","epi/shell/command/builder/ButtonBuilder","epi/shell/command/builder/MenuAssembler","epi-cms/content-approval/viewmodels/ApproverViewModel","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dgrid/List","epi/shell/dgrid/SingleQuery","epi/shell/dgrid/Formatter","dgrid/Keyboard","dgrid/extensions/DijitRegistry","epi/shell/dgrid/WidgetRow","dijit/form/ComboBox","./Approver","dojo/text!./templates/ApprovalStep.html","epi/i18n!epi/nls/episerver.cms.contentapproval.step","dijit/form/TextBox"],function(_1608,_1609,_160a,keys,_160b,_160c,_160d,_160e,_160f,_1610,_1611,List,_1612,_1613,_1614,_1615,_1616,_1617,_1618,_1619,_161a,_161b){var _161c=_1608([List,_1614,_1615,_1613,_1612,_1616]);var _161d=_1608([_1617],{_onKey:function(evt){if(evt.keyCode===keys.UP_ARROW&&!this._opened){this.onMoveUp(evt);return;}if(evt.keyCode===keys.ENTER&&this._hasSuggestions()&&this._hasNoItemSelected()){this.set("item",this.dropDown.items[0]);}this.inherited(arguments);},onMoveUp:function(){},_hasSuggestions:function(){return this._opened&&!!this.get("value")&&this.dropDown.items.length>0;},_hasNoItemSelected:function(){return !this.item;}});return _1608([_160e,_160f,_1610,_1611],{model:null,modelBindingMap:{isReadOnly:["isReadOnly"],isValid:["isValid"]},templateString:_1619,resources:_161a,buildRendering:function(){this.inherited(arguments);var store=this.model.get("approvers");this.headerTextbox.set("value",this.model.name);this.list=new _161c({className:"epi-chromeless",maintainOddEven:false,store:store,renderRow:this._renderApprover.bind(this)},this.listNode);this.own(this.list.addKeyHandler(keys.DOWN_ARROW,function(evt){evt.stopPropagation();if(evt.target===evt.currentTarget.lastElementChild){this.searchBox.focus();}}.bind(this)),this.list.addKeyHandler(keys.UP_ARROW,function(evt){evt.stopPropagation();}),this.headerTextbox.on("change",function(value){this.model.set("name",value);}.bind(this)));var _161e={"class":"epi-approval-step__add-step__button",showLabel:false,tabIndex:-1},_161f=new _160b({settings:_161e}),_1620=[{category:"add",builder:_161f,target:this.arrowNode},{category:"remove",builder:_161f,target:this.removeNode}];new _160c({configuration:_1620,commandSource:this});var _1621=this.model.get("userStore");this.searchBox=new _161d({labelAttr:"displayName",queryExpr:"${0}",store:_1621,searchAttr:"userName",autoComplete:false},this.searchNode);this.own(_1609.before(this.searchBox,"onSearch",this._searchBoxOnSearch.bind(this)),this.searchBox.on("change",this._searchBoxOnChange.bind(this)),this.searchBox.on("moveUp",function(evt){_1614.moveFocusEnd.call(this.list,evt);}.bind(this)),this.searchBox.on("keypress",function(evt){evt.stopPropagation();}));},_renderApprover:function(model){var _1622=new _1618({model:model,languageOptions:this.languageOptions});this.own(_1622.on("remove-approver",function(_1623){this.model.removeApprover(_1623.userName);}.bind(this)));return _1622.domNode;},_searchBoxOnSearch:function(users,query,_1624){users=this.model.filterOutExistingUsers(users);return [users,query,_1624];},_searchBoxOnChange:function(value){if(!value||!this.searchBox.item){return;}this.model.addApprover(this.searchBox.item);this.searchBox.set("value","");},startup:function(){if(this._started){return;}this.inherited(arguments);this.list.startup();this.searchBox.startup();this.list.contentNode.tabIndex=-1;},getCommands:function(){return this.model.get("commands");},_setIsReadOnlyAttr:function(_1625){_160a.toggle(this.domNode,"epi-approval-step--read-only",_1625);this.headerTextbox.set({readOnly:_1625,tabIndex:_1625?-1:0});},_setIsValidAttr:function(_1626){var _1627=!_1626&&this.model.get("showValidations");_160a.toggle(this.domNode,"epi-approval-step--error",_1627&&this.model.validationMessage.level==="error");_160a.toggle(this.domNode,"epi-approval-step--warning",_1627&&this.model.validationMessage.level==="warning");}});});},"epi/shell/dgrid/SingleQuery":function(){define("epi/shell/dgrid/SingleQuery",["dojo/_base/declare","dgrid/_StoreMixin"],function(_1628,_1629){return _1628(_1629,{refresh:function(){this.inherited(arguments);if(!this._started||!this.store){return;}return this._trackError(function(){var _162a=this.get("queryOptions"),_162b=this.store.query(this.query,_162a);return this.renderArray(_162b,null,_162a);}.bind(this));},renderArray:function(){var rows=this.inherited(arguments);this._lastCollection=null;return rows;}});});},"epi/shell/dgrid/WidgetRow":function(){define("epi/shell/dgrid/WidgetRow",["dojo/_base/declare","dijit/registry"],function(_162c,_162d){return _162c(null,{insertRow:function(){var row=this.inherited(arguments),_162e=_162d.byNode(row);_162e.startup();return row;},removeRow:function(_162f,_1630){this.inherited(arguments);var _1631=_162f.element||_162f,_1632=_162d.byNode(_1631);if(_1632){_1632.destroyRecursive(_1630);}}});});},"epi-cms/content-approval/Approver":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/keys","dojo/store/Memory","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/Approver.html","epi/i18n!epi/nls/episerver.cms.contentapproval.approver","epi-cms/contentediting/editors/CheckboxListDropDown"],function(_1633,_1634,_1635,_1636,keys,_1637,_1638,_1639,_163a,_163b,_163c,_163d){return _1633([_1638,_1639,_163a,_163b],{model:null,modelBindingMap:{canApprove:["canApprove"]},templateString:_163c,resources:_163d,postMixInProperties:function(){if(!this.model){throw new Error("An instance of ApproverViewModel must be provided in order to create an Approver component.");}},buildRendering:function(){this.inherited(arguments);this.set("displayName",this.model.displayName);var store=new _1637({idProperty:"value",data:this.languageOptions||[]});this.languageSelector.set("store",store);if(this.model.languages){this.languageSelector.set("value",this.model.languages,false);}_1634.toggle(this.languageSelector.domNode,"dijitHidden",!this.languageOptions);this.own(this.on(".epi-approver__remove-button:click",this._removeApprover.bind(this)),this.on("keydown",this._removeApprover.bind(this)),this.languageSelector.on("change",function(_163e){this.model.set("languages",_163e);this._renderSelectedLanguages();}.bind(this)));this._renderSelectedLanguages();},_removeApprover:function(evt){if(evt.type==="click"||evt.keyCode===keys.DELETE){evt.stopPropagation();this.emit("remove-approver",this.model);}},_renderSelectedLanguages:function(){_1635.empty(this.languageSettingsNode);if(!this.languageOptions){return;}var self=this;function _163f(_1640){var _1641=self.languageSelector.store.get(_1640),_1642="dijitInline epi-lozenge";if(!_1641&&self.model.languages.length>0){_1642+=" epi-lozenge--inactive";}var _1643={innerHTML:_1640,"class":_1642,title:_1641?_1641.label:_1640};_1635.create("span",_1643,self.languageSettingsNode);};if(this.model.languages){if(this.model.languages.length<1){_163f(_163d.alllanguages);return;}this.model.languages.forEach(_163f);}},_setDisplayNameAttr:{node:"userDisplayNameNode",type:"innerText"},_setCanApproveAttr:function(_1644){_1636.set(this.domNode,"display",_1644?"":"none");}});});},"url:epi-cms/content-approval/templates/Approver.html":"<div class=\"epi-approver\">\n    <button class=\"epi-button--round epi-approver__remove-button\"\n            tabindex=\"-1\"\n            data-dojo-type=\"dijit/form/Button\"\n            type=\"button\">\n        <span class=\"dijitInline dijitIcon dijitReset epi-iconMinus epi-icon--inverted\"></span>\n    </button>\n    <span class=\"dijitInline dijitIcon epi-iconUser\"></span>\n    <span class=\"dijitInline epi-approver__name\"\n          data-dojo-attach-point=\"userDisplayNameNode\"></span>\n    <span class=\"epi-approver__language-selector epi-chromeless epi-chromeless--icon-only epi-chromeless--with-arrow\"\n          data-dojo-attach-point=\"languageSelector\"\n          data-dojo-type=\"epi-cms/contentediting/editors/CheckboxListDropDown\"\n          data-dojo-props=\"iconClass: 'epi-iconWebsite', header: '${resources.selectlanguage}', selectAllText: '${resources.anylanguage}'\"></span>\n    <span class=\"dijitInline\" data-dojo-attach-point=\"languageSettingsNode\"></span>\n</div>\n","epi-cms/contentediting/editors/CheckboxListDropDown":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojox/html/entities","epi/epi","epi/i18n!epi/nls/episerver.shared.action","./CheckboxList","dijit/form/_FormValueWidget","epi/shell/widget/DeferredDropDownButton","dijit/form/ToggleButton"],function(_1645,lang,on,_1646,epi,_1647,_1648,_1649,_164a){return _1645([_164a,_1649],{value:null,store:null,sort:null,query:null,enableSelectAll:true,selectAllText:_1647.selectall,header:_1647.select,buildRendering:function(){this.own(this.dropDown=new _1648({baseClass:"dijitMenu",header:this.header,enableSelectAll:this.enableSelectAll,selectAllText:this.selectAllText,onExecute:function(){}}),on(this.dropDown,"change",lang.hitch(this,function(e){this.set("value",e.value,true);}),true));this.inherited(arguments);},startup:function(){if(this._started){return;}this.inherited(arguments);this.dropDown.startup();if(this.enableSelectAll&&!this.value){this.set("value",null);}},compare:function(_164b,_164c){return epi.areEqual(_164b,_164c)?0:-1;},loadAndOpenDropDown:function(){var args=arguments;var _164d=this.dropDown.refresh();return _164d.then(lang.hitch(this,function(){return this.inherited(args);}));},isLoaded:function(){if(this.enableSelectAll){return false;}return this.inherited(arguments);},_getQueryAttr:function(){return this.query||{};},_setQueryAttr:function(value){this._set("query",value);if(this.dropDown){this.dropDown.set("query",value);}},_setStoreAttr:function(store){this._set("store",store);if(this.dropDown){this.dropDown.set("store",store);}},_setLabelAttr:function(value){this.inherited(arguments,[_1646.encode(value||"")]);},_setValueAttr:function(value,_164e){!_164e&&this.dropDown&&this.dropDown.set("selectedItems",value);this.inherited(arguments);}});});},"epi-cms/contentediting/editors/CheckboxList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/when","dojo/dom-class","dojox/html/entities","epi/epi","dojo/text!./templates/CheckboxList.html","epi/i18n!epi/shell/ui/nls/episerver.shared.action","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","dgrid/Keyboard","dgrid/Selection","dgrid/util/mouse","put-selector/put","epi/shell/dgrid/Focusable","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_KeyNavContainer"],function(_164f,lang,keys,when,_1650,_1651,epi,_1652,_1653,_1654,_1655,_1656,_1657,mouse,put,_1658,_1659,_165a,_165b,_165c){return _164f([_1659,_165a,_165b,_165c],{templateString:_1652,store:null,query:null,enableSelectAll:true,selectAllText:_1653.selectall,header:_1653.select,_setHeaderAttr:{node:"headerNode",type:"innerText"},buildRendering:function(){this.inherited(arguments);this.list=new (_164f([_1654,_1655,_1657,_1656,_1658]))({className:"epi-grid--no-alternating-rows epi-grid-max-height--300",cleanEmptyObservers:false,deselectOnRefresh:false,selectionEvents:"click",selectionMode:"toggle",query:this.get("query"),renderRow:this.renderRow},this.listNode);this.list.on("change",function(e){e.stopPropagation();});this.own(this.list,this.list.on("dgrid-select,dgrid-deselect",lang.hitch(this,"_itemsSelected")),this.list.on("dgrid-refresh-complete",lang.hitch(this,"_refreshComplete")),this.list.addKeyHandler(keys.UP_ARROW,lang.hitch(this,"_listNavigateUp")),this.list.addKeyHandler(keys.PAGE_UP,lang.hitch(this,"_listNavigateUp")),this.list.on(mouse.enterRow,lang.hitch(this,"_listMouseover")),this.selectAll.on("click",lang.hitch(this,"_selectAllSelected")),this.selectAll.on("keypress",lang.hitch(this,"_selectAllKeypress")),this.selectAll.on("mouseover",lang.hitch(this,"_selectAllMouseover")));if(this.enableSelectAll){this.list.keyMap[keys.HOME]=lang.hitch(this,"_listNavigateHome");}else{_1650.add(this.selectAll.domNode,"dijitHidden");}this.selectAll.set({iconClass:"dijitCheckBoxIcon",label:_1651.encode(this.selectAllText),title:this.selectAllText});},startup:function(){if(this._started){return;}this.inherited(arguments);this.list.startup();this.list.set("store",this.store);},focus:function(){if(this.enableSelectAll){this.selectAll.focus();}else{this.list.focus();}},resize:function(){this.inherited(arguments);this.list.resize();},renderRow:function(item,_165d){var _165e=put("div.epi-selector-list__type-wrapper",put("span.dijit.dijitReset.dijitInline.dijitCheckBox"));var label=put("label.epi-selector-list__title.dojoxEllipsis","span",{title:item.label,textContent:item.label});return put("div",[_165e,label]);},refresh:function(){if(!this._started){return;}return this.list.refresh();},_itemsSelected:function(e){var _165f=[];Object.keys(e.grid.selection).forEach(function(key){_165f.push(key);});if(!epi.areEqual(_165f,this.get("selectedItems"))){this.set("selectedItems",_165f,true);this.emit("change",{value:_165f});}this._updateView();},_refreshComplete:function(evt){when(evt.results.total,lang.hitch(this,function(total){this.emit("loaded");_1650.toggle(this.separatorNode,"dijitHidden",!total||!this.enableSelectAll);}));},_selectAllSelected:function(){this.set("selectedItems",null);},_selectAllKeypress:function(e){var _1660;switch(e.keyCode){case keys.DOWN_ARROW:_1660=_1656.moveFocusHome;break;case keys.PAGE_DOWN:_1660=_1656.moveFocusPageDown;break;case keys.END:_1660=_1656.moveFocusEnd;break;default:return;}_1660.apply(this.list,[e]);},_selectAllMouseover:function(){this.selectAll.focus();},_listNavigateUp:function(e){var list=this.list,row=list.row(e),_1661=list.up(row,1,true);if(row.id===_1661.id){this.selectAll.focus();}},_listNavigateHome:function(){this.selectAll.focus();},_listMouseover:function(e){var row=this.list.row(e);this.list.focus(row);},_setSelectedItemsAttr:function(_1662,_1663){this._set("selectedItems",_1662);if(!_1663){this.list.clearSelection();if(_1662){_1662.forEach(function(item){this.list.select(item);}.bind(this));}}this._updateView();},_updateView:function(){this.selectAll.set("checked",!this.selectedItems||this.selectedItems.length===0);}});});},"url:epi-cms/contentediting/editors/templates/CheckboxList.html":"<div class=\"epi-selector-list epi-menu--inverted\">\n    <div class=\"epi-menuInverted epi-invertedTooltip\">\n        <div class=\"epi-tooltipDialogTop\">\n            <span data-dojo-attach-point=\"headerNode\"></span><div class=\"dijitTooltipConnector\"></div>\n        </div>\n        <button class=\"epi-selector-list-btn epi-chromeless\" data-dojo-attach-point=\"selectAll\" data-dojo-type=\"dijit/form/ToggleButton\" data-dojo-props=\"iconClass:'dijitcheckboxicon'\"></button>\n        <div data-dojo-attach-point=\"separatorNode\" class=\"epi-selector-list__separator dijitHidden\"></div>\n        <div data-dojo-attach-point=\"listNode\"></div>\n    </div>\n</div>\n","url:epi-cms/content-approval/templates/ApprovalStep.html":"<div class=\"epi-approval-step\">\n    <div class=\"epi-approval-step__header\">\n        <div class=\"dijitInline dojoDndHandle\">\n            <span class=\"dijitInline epi-iconDnD\"></span>\n        </div>\n        <div placeholder=\"${resources.header.placeholder}\" title=\"${resources.header.tooltip}\" data-dojo-attach-point=\"headerTextbox\" data-dojo-type=\"dijit/form/TextBox\"></div>\n        <div class=\"dijitInline\" data-dojo-attach-point=\"removeNode\"></div>\n    </div>\n    <div class=\"epi-approval-step__container\">\n        <div data-dojo-attach-point=\"listNode\"></div>\n        <div class=\"epi-approver__add\">\n            <span class=\"dijitInline dijitIcon epi-iconUser\"></span>\n            <div class=\"dijitInline\" data-dojo-attach-point=\"searchNode\"></div>\n        </div>\n    </div>\n    <div class=\"epi-approval-step__add-step\" data-dojo-attach-point=\"arrowNode\"></div>\n</div>\n","dgrid/extensions/DnD":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/aspect","dojo/on","dojo/topic","dojo/has","dojo/dnd/Source","dojo/dnd/Manager","dojo/_base/NodeList","put-selector/put","../Selection","dojo/has!touch?../util/touch","dojo/has!touch?./_DnD-touch-autoscroll","xstyle/css!dojo/resources/dnd.css"],function(_1664,lang,_1665,_1666,_1667,on,topic,has,_1668,_1669,_166a,put,_166b,_166c){var _166d=_1664(_1668,{grid:null,getObject:function(node){var grid=this.grid;return grid.store.get(node.id.slice(grid.id.length+5));},_legalMouseDown:function(evt){var legal=this.inherited(arguments);return legal&&evt.target!=this.grid.bodyNode;},onDrop:function(_166e,nodes,copy){var _166f=this,_1670=this._targetAnchor=this.targetAnchor,grid=this.grid,store=grid.store;if(!this.before&&_1670){_1670=_1670.nextSibling;}_1670=_1670&&grid.row(_1670);_1666.when(_1670&&store.get(_1670.id),function(_1671){if(_166f!=_166e){_166f.onDropExternal(_166e,nodes,copy,_1671);}else{_166f.onDropInternal(nodes,copy,_1671);}});},onDropInternal:function(nodes,copy,_1672){var grid=this.grid,store=grid.store,_1673=this,_1674=_1673._targetAnchor,_1675,_1676;if(_1674){_1675=this.before?_1674.previousSibling:_1674.nextSibling;}_1676=grid.row(nodes[0]);if(!copy&&(_1675===nodes[0]||(!_1672&&_1676&&grid.down(_1676).element==nodes[0]))){return;}nodes.forEach(function(node){_1666.when(_1673.getObject(node),function(_1677){var id=store.getIdentity(_1677);store[copy&&store.copy?"copy":"put"](_1677,{before:_1672});if(_1673._selectedNodes[id]){_1673._selectedNodes[id]=grid.row(id).element;}});});},onDropExternal:function(_1678,nodes,copy,_1679){var store=this.grid.store,_167a=_1678.grid;nodes.forEach(function(node,i){_1666.when(_1678.getObject(node),function(_167b){if(!copy){if(_167a){_1666.when(_167a.store.getIdentity(_167b),function(id){!i&&_1678.selectNone();_1678.delItem(node.id);_167a.store.remove(id);});}else{_1678.deleteSelectedNodes();}}store[store.copy?"copy":"put"](_167b,{before:_1679});});});},onDndStart:function(_167c,nodes,copy){this.inherited(arguments);if(_167c==this){if(this.grid.cancelTouchScroll){this.grid.cancelTouchScroll();}_1669.manager().avatar.node.style.width=this.grid.domNode.offsetWidth/2+"px";}},onMouseDown:function(evt){if(has("touch")&&this.isDragging&&_166c.countCurrentTouches(evt,this.grid.touchNode)>1){topic.publish("/dnd/cancel");_1669.manager().stopDrag();}else{this.inherited(arguments);}},onMouseMove:function(evt){if(!has("touch")||_166c.countCurrentTouches(evt,this.grid.touchNode)<=1){this.inherited(arguments);}},checkAcceptance:function(_167d,nodes){return _167d.getObject&&_1668.prototype.checkAcceptance.apply(this,arguments);},getSelectedNodes:function(){if(!this.grid.selection){return this.inherited(arguments);}var t=new _166a(),id;for(id in this.grid.selection){t.push(this._selectedNodes[id]);}return t;}});var DnD=_1664(_166b,{dndSourceType:"dgrid-row",dndParams:null,dndConstructor:_166d,postMixInProperties:function(){this.inherited(arguments);this.dndParams=lang.mixin({accept:[this.dndSourceType]},this.dndParams);},postCreate:function(){this.inherited(arguments);this.dndSource=new (this.dndConstructor||_166d)(this.bodyNode,lang.mixin(this.dndParams,{grid:this,dropParent:this.contentNode}));var _167e=this.dndSource._selectedNodes={};function _167f(row){_167e[row.id]=row.element;};function _1680(row){delete _167e[row.id];put(row.element,"!dojoDndItemSelected!dojoDndItemAnchor");};this.on("dgrid-select",function(event){_1665.forEach(event.rows,_167f);});this.on("dgrid-deselect",function(event){_1665.forEach(event.rows,_1680);});_1667.after(this,"destroy",function(){delete this.dndSource._selectedNodes;_167e=null;this.dndSource.destroy();},true);},insertRow:function(_1681){var row=this.inherited(arguments),type=typeof this.getObjectDndType=="function"?this.getObjectDndType(_1681):[this.dndSourceType];put(row,".dojoDndItem");this.dndSource.setItem(row.id,{data:_1681,type:type instanceof Array?type:[type]});return row;},removeRow:function(_1682){this.dndSource.delItem(this.row(_1682));this.inherited(arguments);}});DnD.GridSource=_166d;return DnD;});},"url:epi-cms/content-approval/templates/ApprovalStepList.html":"<div class=\"epi-approval-step-list\">\n    <div class=\"epi-approval-step-list__status\">\n        <span class=\"epi-approval-step-list__status-icon epi-approval-step-list__status-icon--review\"></span><h2 class=\"dijitInline\">${resources.readytoreview}</h2>\n    </div>\n    <div data-dojo-attach-point=\"listNode\"></div>\n\n    <div class=\"epi-approval-step-list__status\">\n        <span class=\"epi-approval-step-list__status-icon epi-approval-step-list__status-icon--publish\"></span><h2 class=\"dijitInline\">${resources.readytopublish}</h2>\n    </div>\n</div>\n","epi-cms/contentediting/ContentDetails":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/url","dojo/_base/window","dojo/dom-style","dojo/dom-construct","dojo/on","dojo/topic","dijit/_TemplatedMixin","dijit/_WidgetBase","dijit/_WidgetsInTemplateMixin","epi","epi/shell/widget/_ModelBindingMixin","epi/shell/command/builder/MenuBuilder","epi/shell/command/builder/MenuAssembler","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails","dojo/text!./templates/ContentDetails.html"],function(dojo,array,_1683,lang,url,win,_1684,_1685,on,topic,_1686,_1687,_1688,epi,_1689,_168a,_168b,res,_168c){return _1683([_1687,_1686,_1688,_1689],{templateString:_168c,_setContentTypeNameAttr:function(value){this.typeNode.textContent=value;this.typeNode.title=value;},_setContentIdAttr:{node:"idNode",type:"innerHTML"},_setExistingLanguagesAttr:function(_168d){this.languagesNode.innerHTML="";array.forEach(_168d,function(item,idx){var elm,_168e=idx===_168d.length-1;if(item.isCurrentLanguage){elm=_1685.create("span",{innerHTML:item.urlSegment});}else{var url=new dojo._Url(window.top.location.href);elm=_1685.create("a",{innerHTML:item.urlSegment,href:[url.scheme,"://",url.authority,url.path,"?language=",item.text,"#context=epi.cms.contentdata:///",item.contentLink].join(""),"class":"epi-visibleLink"});}_1685.place(elm,this.languagesNode);if(!_168e){_1685.place(win.doc.createTextNode(", "),this.languagesNode);}},this);},_setVisibleToAttr:function(_168f){this.visibleToNode.innerHTML=_168f?res.visibleto.everyone:res.visibleto.restricted;},_setManageAccessRightsVisibleAttr:function(value){_1684.set(this.manageAccessRightsButton.domNode,"display",value?"":"none");},resources:null,modelBindingMap:{contentTypeName:["contentTypeName"],contentId:["contentId"],existingLanguages:["existingLanguages"],visibleToEveryOne:["visibleTo"]},_menuAssembler:null,postMixInProperties:function(){this.inherited(arguments);this.resources=dojo.mixin({},epi.resources.action,res);},postCreate:function(){this.inherited(arguments);var _1690=new _168a();this._menuAssembler=new _168b({configuration:[{builder:_1690,target:this.additionalActionsMenu}],commandSource:this.model});this.dropdownButton.set("title",this.resources.toolsbutton.tooltip);},destroy:function(){if(this._menuAssembler){this._menuAssembler.destroy();}this.inherited(arguments);if(this.model){this.model.destroy();}},_setModelAttr:function(value){this.inherited(arguments);if(this._menuAssembler){this._menuAssembler.set("commandSource",this.model);}if(this.model&&this.model.accessRightsCommand){this.own(this.model.accessRightsCommand.watch("canExecute",lang.hitch(this,function(){this.set("manageAccessRightsVisible",this.model.accessRightsCommand.canExecute);})));}},_onManageAccessRightsClick:function(){if(this.model&&this.model.accessRightsCommand){this.model.accessRightsCommand.execute();}}});});},"url:epi-cms/contentediting/templates/ContentDetails.html":"<ul class=\"epi-form-container__section\">\n    <ul data-dojo-type=\"epi/shell/layout/SimpleContainer\" data-dojo-attach-point=\"widgetContainer\"></ul>\n    <li class=\"epi-form-container__section__row\">\n        <label>${resources.visibleto.title}</label>\n        <div class=\"epi-previewableTextBox-wrapper dijitInline\">\n            <span data-dojo-attach-point=\"visibleToNode\" class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\"></span>\n            <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"manageAccessRightsButton\" data-dojo-attach-event=\"onClick: _onManageAccessRightsClick\" class=\"epi-chromelessButton epi-chromelessLinkButton epi-functionLink epi-valign--top\">${resources.manage}</div>\n        </div>\n    </li>\n    <li class=\"epi-form-container__section__row\">\n        <label>${resources.existinglanguages}</label>\n        <span data-dojo-attach-point=\"languagesNode\" class=\"epi-previewableTextBox-text dijitInline\"></span>\n    </li>\n    <li class=\"epi-form-container__section__row\">\n        <label>${resources.idandtypename}</label>\n        <div class=\"epi-previewableTextBox-wrapper dijitInline\">\n            <span class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\">\n                <span data-dojo-attach-point=\"idNode\"></span>, <span data-dojo-attach-point=\"typeNode\"></span>\n            </span>\n        </div>\n    </li>\n    <li class=\"epi-form-container__section__row\">\n        <label></label>\n        <div data-dojo-attach-point=\"dropdownButton\" data-dojo-type=\"dijit/form/DropDownButton\" class=\"dijit dijitReset dijitInline epi-mediumButton\">\n            <span>${resources.toolsbutton.label}</span>\n            <div data-dojo-type=\"dijit/DropDownMenu\" data-dojo-attach-point=\"additionalActionsMenu\"></div>\n        </div>\n    </li>\n</ul>","epi-cms/contentediting/CreateContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-style","dojo/dom-class","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/layout/StackContainer","epi/dependency","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Dialog","epi-cms/contentediting/NewContentNameInputDialog","epi-cms/contentediting/viewmodel/CreateContentViewModel","epi-cms/widget/ContentTypeList","epi-cms/widget/PropertiesForm","epi-cms/widget/Breadcrumb","epi-cms/widget/BreadcrumbCurrentItem","dojo/text!./templates/CreateContent.html","epi/i18n!epi/nls/episerver.shared"],function(_1691,lang,_1692,_1693,_1694,topic,when,_1695,_1696,_1697,_1698,_1699,_169a,_169b,_169c,_169d,_169e,_169f,_16a0,_16a1,_16a2,_16a3,_16a4,_16a5,_16a6){return _1691([_1698,_1695,_1696,_169d],{templateString:_16a5,sharedResources:_16a6,modelType:_16a0,_contextService:null,_beingSuspended:null,modelBindingMap:{parent:["parent"],requestedType:["requestedType"],metadata:["metadata"],isContentTypeSelected:["isContentTypeSelected"],headingText:["headingText"],createAsLocalAssetHelpText:["createAsLocalAssetHelpText"],contentName:["contentName"],contentNameHelpText:["contentNameHelpText"],wizardStep:["wizardStep"],showAllProperties:["showAllProperties"],createAsLocalAsset:["createAsLocalAsset"],seamlessTopPanel:["seamlessTopPanel"],namePanelIsVisible:["namePanelIsVisible"],headingPanelIsVisible:["headingPanelIsVisible"],saveButtonIsVisible:["saveButtonIsVisible"],saveButtonDisabled:["saveButtonDisabled"],showCurrentNodeOnBreadcrumb:["showCurrentNodeOnBreadcrumb"],notificationContext:["notificationContext"],actualParentLink:["actualParentLink"],propertyFilter:["propertyFilter"],allowedTypes:["allowedTypes"],restrictedTypes:["restrictedTypes"]},_setParentAttr:function(_16a7){if(_16a7){this.toolbar.setItemProperty("currentcontent","currentItemInfo",{name:_16a7.name,dataType:_16a7.typeIdentifier});}},_setPropertyFilterAttr:function(_16a8){this._set("propertyFilter",_16a8);this.propertiesForm.propertyFilter=_16a8;},_setAllowedTypesAttr:function(value){this.contentTypeList.set("allowedTypes",value);},_setRestrictedTypesAttr:function(value){this.contentTypeList.set("restrictedTypes",value);},_setRequestedTypeAttr:function(_16a9){this.contentTypeList.set("requestedType",_16a9);},_setMetadataAttr:function(_16aa){if(_16aa){this.propertiesForm.set("metadata",_16aa);}},_setHeadingTextAttr:function(_16ab){this.headingTextNode.textContent=this.subHeadingTextNode.textContent=_16ab;},_setContentNameHelpTextAttr:{node:"contentNameHelpTextNode",type:"innerText"},_setCreateAsLocalAssetAttr:function(_16ac){this._set("createAsLocalAsset",_16ac);var _16ad=this.model.get("parent");if(_16ad){this.toolbar.setItemProperty("breadcrumbs","contentLink",_16ac?_16ad.assetsFolderLink:_16ad.contentLink);}this.contentTypeList.set("localAsset",_16ac);},_setCreateAsLocalAssetHelpTextAttr:{node:"subHeadingDescNode",type:"innerHTML"},_setContentNameAttr:function(_16ae){this.nameTextBox.set("value",_16ae);},_setWizardStepAttr:function(_16af){var _16b0;var child;if(_16af<0||_16af===this.wizardStep){return;}_16b0=this.stackContainer.getChildren();if(_16af<_16b0.length){child=_16b0[_16af];this.stackContainer.selectChild(child);this._set("wizardStep",_16af);}},_setShowAllPropertiesAttr:function(_16b1){this._set("showAllProperties",_16b1);this.propertiesForm.set("showAllProperties",_16b1);},_setSeamlessTopPanelAttr:function(value){_1694.toggle(this.topPanel.domNode,"epi-listingTopContainer",value);},_setNamePanelIsVisibleAttr:function(_16b2){_1693.set(this.namePanel,"display",_16b2?"":"none");},_setHeadingPanelIsVisibleAttr:function(_16b3){_1693.set(this.headingPanel,"display",_16b3?"":"none");_1693.set(this.subHeadingPanel,"display",_16b3?"none":"");},_setSaveButtonIsVisibleAttr:function(_16b4){this.toolbar.setItemVisibility("saveButton",_16b4);},_setSaveButtonDisabledAttr:function(_16b5){this.toolbar.setItemProperty("saveButton","disabled",_16b5);},_setShowCurrentNodeOnBreadcrumbAttr:function(show){this.toolbar.setItemProperty("breadcrumbs","showCurrentNode",show);this.toolbar.setItemVisibility("currentcontent",!show);},_setNotificationContextAttr:function(_16b6){this.toolbar.setItemProperty("notificationCenter","notificationContext",_16b6);},_setActualParentLinkAttr:function(_16b7){this.contentTypeList.set("parentLink",_16b7);},_setContentTypeNameAttr:{type:"innerHTML",node:"contentTypeNameNode"},postMixInProperties:function(){this.inherited(arguments);this.model=new this.modelType();this.own(this.model.on("saveSuccess",lang.hitch(this,this._onSaveSuccess)));this.own(this.model.on("saveError",lang.hitch(this,this._onSaveError)));this.own(this.model.on("invalidContentName",lang.hitch(this,this._onInvalidContentName)));},postCreate:function(){this.inherited(arguments);this._contextService=this._contextService||_169c.resolve("epi.shell.ContextService");this._setupToolbar();},layout:function(){if(this._started){this.layoutContainer.resize(this._containerContentBox||this._contentBox);_1694.add(this.stackContainer.domNode,"epi-animation-node-reset");}},updateView:function(data){if(data&&((data.parent&&data.requestedType)||(data.contentData&&data.languageBranch))){this.view=data.view;this._setCreateMode();this._beingSuspended=false;this.set("contentTypeName","");when(this.model.update(data),lang.hitch(this,function(){this.layout();if(this.nameTextBox){this.nameTextBox.focus();this.nameTextBox.textbox.select();}}),function(err){});}},_onSaveSuccess:function(_16b8){this._clearCreateMode();this._beingSuspended=true;if(_16b8.changeContext){this._changeContext(_16b8.newContentLink);}else{this._backToCurrentContext();}if(this.createAsLocalAsset===true){topic.publish("/epi/cms/action/createlocalasset");}},_onSaveError:function(){this._clearCreateMode();topic.publish("/epi/cms/action/showerror");},_onInvalidContentName:function(_16b9){var _16ba=new _169f({defaultContentName:_16b9});var _16bb=new _169e({defaultActionsVisible:false,autofocus:true,content:_16ba,title:_16ba.title});this.own(_1692.after(_16bb,"onExecute",lang.hitch(this,function(){var name=_16ba.get("value");if(name===_16b9){this.model.set("ignoreDefaultNameWarning",true);}this.model.set("contentName",name);this.model.save();}),true),_1692.after(_16bb,"onCancel",lang.hitch(this,function(){if(this.contentTypeList.shouldSkipContentTypeSelection){this._cancel();}else{this.model.set("isContentTypeSelected",false);}}),true));_16bb.show();},_onContentTypeSelected:function(item){if(!this.isContentTypeSelected){this.model.set("contentTypeId",item.id);this.set("contentTypeName",item.localizedName);}},_onPropertyValidStateChange:function(_16bc,error){if(error){this.model.addInvalidProperty(_16bc,error);}else{this.model.removeInvalidProperty(_16bc);}},_onBlurVerifyContent:function(){if(this.nameTextBox.get("value")===""){this.nameTextBox.set("value",this.model.defaultName);}},_onContentNameChange:function(name){this.model.set("contentName",name);},_onSave:function(){if(this._beingSuspended){return;}this.propertiesForm.validate();this.model.set("properties",this.propertiesForm.get("value"));this.model.save();},_onCancel:function(){this._cancel();},_cancel:function(){this._clearCreateMode();this.model.cancel();this._backToCurrentContext();},_setupToolbar:function(){var _16bd=[{name:"leading",type:"toolbargroup",settings:{region:"leading"}},{name:"trailing",type:"toolbargroup",settings:{region:"trailing"}}];var _16be=[{parent:"leading",name:"breadcrumbs",widgetType:"epi-cms/widget/Breadcrumb",settings:{showCurrentNode:false}},{parent:"leading",name:"currentcontent",widgetType:"epi-cms/widget/BreadcrumbCurrentItem"},{parent:"trailing",name:"notificationCenter",widgetType:"epi-cms/widget/NotificationStatusBar"},{parent:"trailing",name:"saveButton",title:_16a6.action.create,label:_16a6.action.create,type:"button",action:lang.hitch(this,this._onSave),settings:{"class":"epi-button--bold epi-primary"}},{parent:"trailing",name:"cancelButton",title:_16a6.action.cancel,label:_16a6.action.cancel,type:"button",action:lang.hitch(this,this._onCancel),settings:{"class":"epi-button--bold"}}];when(this.toolbar.add(_16bd),lang.hitch(this,function(){this.toolbar.add(_16be);}));},_changeContext:function(_16bf){topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_16bf},{sender:this,viewName:this.view,forceContextChange:true,forceReload:true});},_backToCurrentContext:function(){topic.publish("/epi/shell/action/changeview/back");},_setCreateMode:function(){lang.mixin(this._contextService.currentContext,{currentMode:"create"});topic.publish("/epi/cms/action/togglecreatemode",true);},_clearCreateMode:function(){_1694.remove(this.stackContainer.domNode,"epi-animation-node-reset");lang.mixin(this._contextService.currentContext,{currentMode:undefined});topic.publish("/epi/cms/action/togglecreatemode",false);}});});},"epi-cms/contentediting/NewContentNameInputDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/keys","dijit/_CssStateMixin","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/TextBox","epi","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/NewContentNameInputDialog.html","epi/i18n!epi/cms/nls/episerver.cms.widget.newcontentnamedialog"],function(_16c0,lang,_16c1,keys,_16c2,_16c3,_16c4,_16c5,_16c6,epi,_16c7,_16c8,_16c9,_16ca,res){return _16c0([_16c3,_16c4,_16c5,_16c9,_16c7,_16c2],{templateString:_16ca,res:res,defaultContentName:null,message:null,title:null,nameLabel:epi.resources.header.name,_setMessageAttr:{node:"messageNode",type:"innerHTML"},postMixInProperties:function(){this.inherited(arguments);this.message=lang.replace(this.res.warningtext,{defaultname:this.defaultContentName});this._set("message",this.message);this.title=res.title;},postCreate:function(){this.inherited(arguments);this.contentNameTextbox.set("value",this.defaultContentName);this.contentNameTextbox.on("keyup",lang.hitch(this,function(evt){var _16cb=this.contentNameTextbox.isValid();if(evt.keyCode===keys.ENTER&&_16cb){this.executeDialog();}}));this.on("focus",lang.hitch(this,function(){this.contentNameTextbox.textbox.select();}));},_getValueAttr:function(){return this.contentNameTextbox.get("value");},_onBlurVerifyContent:function(){if(this.contentNameTextbox.get("value")===""){this.contentNameTextbox.set("value",this.defaultContentName);}},getActions:function(){this._actions=[{name:"ok",label:epi.resources.action.ok,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.contentNameTextbox.isValid()){this.executeDialog();}else{this.contentNameTextbox.focus();}})},{name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"url:epi-cms/contentediting/templates/NewContentNameInputDialog.html":"<div class=\"epi-formContainer\">\n    <div data-dojo-attach-point=\"messageNode\"></div>\n    <br />\n    <div>\n        <label data-dojo-attach-point=\"contentNameLabelNode\">${nameLabel}</label>\n        <input type=\"text\" size=\"40\" maxlength=\"255\"  data-dojo-attach-point=\"contentNameTextbox\" data-dojo-type=\"dijit/form/ValidationTextBox\"\n                data-dojo-props=\"required: true, trim:true, selectOnClick: true\"\n                data-dojo-attach-event=\"onBlur: _onBlurVerifyContent\"\n                missingMessage: \"${res.errormessage.missingmessage}\" />\n    </div>\n</div>","epi-cms/contentediting/viewmodel/CreateContentViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/Stateful","dojo/string","dojo/when","dojo/Evented","epi/dependency","epi/shell/TypeDescriptorManager","epi-cms/core/ContentReference","epi-cms/contentediting/ContentEditingValidator","epi/i18n!epi/shell/ui/nls/episerver.shared.messages","epi/i18n!epi/cms/nls/episerver.cms.components.requiredproperties"],function(array,_16cc,lang,json,_16cd,_16ce,when,_16cf,_16d0,_16d1,_16d2,_16d3,_16d4,_16d5){return _16cc([_16cd,_16cf],{_topLevelContainerType:"epi/shell/layout/SimpleContainer",_groupContainerType:"epi-cms/layout/CreateContentGroupContainer",contentDataStore:null,metadataManager:null,typeIdentifierManager:null,validator:null,parent:null,contentTypeId:null,requestedType:null,createAsLocalAsset:null,autoPublish:false,addToDestination:null,wizardStep:0,startWizardStep:0,contentName:null,ignoreDefaultNameWarning:null,properties:null,headingText:null,contentNameHelpText:"",createAsLocalAssetHelpText:null,namePanelIsVisible:null,headingPanelIsVisible:null,seamlessTopPanel:null,saveButtonIsVisible:null,saveButtonDisabled:null,showAllProperties:null,showCurrentNodeOnBreadcrumb:null,actualParentLink:null,metadata:null,postscript:function(){this.inherited(arguments);if(!this.contentDataStore){var _16d6=_16d0.resolve("epi.storeregistry");this.contentDataStore=_16d6.get("epi.cms.contentdata");}this.metadataManager=this.metadataManager||_16d0.resolve("epi.shell.MetadataManager");this.projectService=this.projectService||_16d0.resolve("epi.cms.ProjectService");this.validator=this.validator||new _16d3({contextTypeName:"epi.cms.contentdata"});this.set("propertyFilter",lang.hitch(this,this._propertyFilter));},update:function(_16d7){this.set("ignoreDefaultNameWarning",false);this.set("properties",null);this.set("saveButtonIsVisible",false);this.set("wizardStep",this.startWizardStep);this.set("isContentTypeSelected",false);this.set("namePanelIsVisible",true);this.set("headingPanelIsVisible",true);this.set("showCurrentNodeOnBreadcrumb",true);this.set("seamlessTopPanel",true);if(_16d7){array.forEach(["allowedTypes","restrictedTypes","requestedType","parent","createAsLocalAsset","autoPublish","addToDestination","contentTypeId"],function(_16d8){this.set(_16d8,_16d7[_16d8]);},this);}if(this.parent){var _16d9=this.parent.contentLink+"_new_content";this.validator.clearErrorsBySource();this.validator.setContextId(_16d9);this.set("notificationContext",{contextTypeName:"epi.cms.contentdata",contextId:_16d9});}},save:function(){this.set("saveButtonDisabled",true);if(!this.ignoreDefaultNameWarning&&(!this.contentName||this.contentName===""||this.contentName===this.defaultName)){var _16da=this.contentName;if(this.metadata&&this.metadata.additionalValues&&this.metadata.additionalValues.modelTypeIdentifier){_16da=_16d1.getResourceValue(this.metadata.additionalValues.modelTypeIdentifier,"newitemdefaultname");}this._emitSaveEvent("invalidContentName",_16da);return;}this.validator.clearErrorsBySource(this.validator.validationSource.server);when(this.validator.validate(),lang.hitch(this,function(_16db){if(_16db){this._emitSaveEvent("validationError");return;}var _16dc=this.buildContentObject();this.projectService.getCurrentProjectId().then(function(_16dd){_16dc.autoPublish=_16dc.autoPublish&&!_16dd;this.contentDataStore.put(_16dc).then(lang.hitch(this,this._saveSuccessHandler),lang.hitch(this,this._saveErrorHandler));}.bind(this));}),lang.hitch(this,function(){this._emitSaveEvent("validationError");}));},_emitSaveEvent:function(_16de,_16df){this.set("saveButtonDisabled",false);this.emit(_16de,_16df);},cancel:function(){this.addToDestination&&(typeof this.addToDestination.cancel==="function")&&this.addToDestination.cancel();},_propertyFilter:function(_16e0,_16e1){var _16e2=_16e1.originalGroupName!=="EPiServerCMS_SettingsPanel"&&_16e1.originalGroupName!=="Advanced";var _16e3=this._isRequiredProperty(_16e0,_16e1);if(this.showAllProperties){return _16e2||_16e3;}else{return _16e3;}},_saveSuccessHandler:function(_16e4){var ref=new _16d2(_16e4),_16e5=ref.createVersionUnspecificReference(),_16e6=lang.hitch(this,function(_16e7){this._emitSaveEvent("saveSuccess",{newContentLink:_16e7,changeContext:true});});when(this.contentDataStore.refresh(_16e4),lang.hitch(this,function(_16e8){if(this.addToDestination){this.addToDestination.save({contentLink:_16e5.toString(),name:_16e8.name,typeIdentifier:this.requestedType});this._emitSaveEvent("saveSuccess",{changeContext:false});}else{_16e6(_16e5.toString());}}));},_saveErrorHandler:function(err){if(err&&err.responseText){var _16e9=json.fromJson(err.responseText);array.forEach(_16e9,function(item){if(item.propertyName){this.validator.setPropertyErrors(item.propertyName,[{severity:item.severity,errorMessage:item.errorMessage}],this.validator.validationSource.server);}else{this.validator.setGlobalErrors([{severity:item.severity,errorMessage:item.errorMessage}],this.validator.validationSource.server);}},this);}else{if(err){this.validator.setGlobalErrors([{severity:this.validator.severity.error,errorMessage:err.message}],this.validator.validationSource.server);}}this._emitSaveEvent("saveError",err);},buildContentObject:function(){return {name:_16ce.trim(this.contentName+""),parentLink:this._getParentLink(),contentTypeId:this.contentTypeId,properties:this.properties,createAsLocalAsset:this.createAsLocalAsset,autoPublish:this.autoPublish};},addInvalidProperty:function(_16ea,_16eb){this.validator.setPropertyErrors(_16ea,[{severity:this.validator.severity.error,errorMessage:_16eb}],this.validator.validationSource.client);},removeInvalidProperty:function(_16ec){this.validator.clearPropertyErrors(_16ec);},_contentTypeIdSetter:function(_16ed){this.contentTypeId=_16ed;if(_16ed&&this.parent){this.set("isContentTypeSelected",true);this.validator.clearErrorsBySource(this.validator.validationSource.server);when(this._getMetadata(this.parent.contentLink,_16ed),lang.hitch(this,function(_16ee){_16ee=this._regroupProperties(_16ee);this.set("metadata",_16ee);if(this.autoPublish||this._hasRequiredProperties(_16ee)){this.set("wizardStep",1);this.set("saveButtonIsVisible",true);}else{this.save();}}),lang.hitch(this,function(){this.set("isContentTypeSelected",false);this.validator.setGlobalErrors([{severity:this.validator.severity.error,errorMessage:_16d4.unexpectederror}],this.validator.validationSource.server);}));}},_createAsLocalAssetSetter:function(_16ef){this.createAsLocalAsset=_16ef;if(this.parent){this.set("actualParentLink",this._getParentLink());}},_autoPublishSetter:function(_16f0){this.set("showAllProperties",_16f0);this.autoPublish=_16f0;},_parentSetter:function(_16f1){this.parent=_16f1;var _16f2=this.parent.typeIdentifier,_16f3=_16d1.getResourceValue(this.requestedType,"name"),_16f4=_16d1.getResourceValue(_16f2,"name"),_16f5=_16d1.getResourceValue(_16f2,"createaslocalassethelptext");if(_16f3&&_16f4){_16f5=lang.replace(_16f5,[_16f3.toLowerCase(),_16f4.toLowerCase()]);}this.set("createAsLocalAssetHelpText",_16f5);},_requestedTypeSetter:function(_16f6){var _16f7=_16d1.getResourceValue(_16f6,"create"),_16f8=_16d1.getResourceValue(_16f6,"newitemdefaultname");this.defaultName=_16f8;this.set("headingText",_16f7);this.set("contentName",_16f8);this.requestedType=_16f6;},_getParentLink:function(){if(!this.parent){return null;}if(this.createAsLocalAsset){return this.parent.ownerContentLink?this.parent.ownerContentLink:this.parent.contentLink;}return this.parent.contentLink;},_hasRequiredProperties:function(_16f9){return array.some(_16f9.properties,function(_16fa){return this._isRequiredProperty(_16f9,_16fa);},this);},_isRequired:function(_16fb){return _16fb.settings&&_16fb.settings.required;},_isRequiredProperty:function(_16fc,_16fd){var _16fe=!_16fd.additionalValues.hasValue;var _16ff=_16fd.showForEdit&&array.every(_16fc.groups,function(group){return (group.name!==_16fd.groupName&&group.name!==_16fd.originalGroupName)||group.displayUI;});var _1700=array.some(_16fd.properties,function(_1701){return this._isRequiredProperty(_16fd,_1701);},this);return (this._isRequired(_16fd)||_1700)&&_16fe&&_16ff&&(_16fd.name!=="icontent_name");},_regroupProperties:function(_1702){_1702=lang.clone(_1702);_1702.layoutType=this._topLevelContainerType;array.forEach(_1702.properties,function(prop){var _1703=this._isRequiredProperty(_1702,prop);prop.originalGroupName=prop.groupName;prop.groupName=_1703?"required":"additional";},this);_1702.groups=[{name:"required",displayUI:true,title:_16d5.groups.required,uiType:this._groupContainerType},{name:"additional",displayUI:true,title:_16d5.groups.additional,uiType:this._groupContainerType}];return _1702;},_getMetadata:function(_1704,_1705){return this.metadataManager.getMetadataForType("EPiServer.Core.ContentData",{parentLink:_1704,contentTypeId:_1705});}});});},"epi-cms/widget/ContentTypeList":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/Deferred","dojo/promise/all","dojo/when","dijit/layout/_LayoutWidget","epi/dependency","epi/shell/TypeDescriptorManager","epi-cms/widget/ContentTypeGroup","epi/i18n!epi/cms/nls/episerver.cms.widget.contenttypelist"],function(array,_1706,lang,_1707,_1708,all,when,_1709,_170a,_170b,_170c,i18n){return _1706([_1709],{store:null,parentLink:null,groups:null,requestedType:null,shouldSkipContentTypeSelection:null,allowedTypes:null,restrictedTypes:null,contentTypeService:null,postMixInProperties:function(){this.inherited(arguments);this.groups={};this.contentTypeService=this.contentTypeService||_170a.resolve("epi.cms.ContentTypeService");if(!this.store){var _170d=_170a.resolve("epi.storeregistry");this.store=_170d.get("epi.cms.contenttype");}},buildRendering:function(){this.inherited(arguments);var _170e=new _170c();this.connect(_170e,"onSelect",function(item){this.onContentTypeSelected(item);});this.addChild(_170e);this._suggestedContentTypes=_170e;},refresh:function(){this.clear();this._setupWidgetTemplate();when(all({types:this._getSuggestedContentTypes(this.requestedType),groups:this._groupContentTypes()}),lang.hitch(this,function(_170f){var types=_170f.types,_1710=_170f.groups,_1711=_1710.grouped,_1712=_1710.contentTypes;if(types.length<=0){this._suggestedContentTypes.setVisibility(false);}else{_1707.add(this._suggestedContentTypes.titleNode,"epi-ribbonHeaderSpecial");this._suggestedContentTypes.set("title",this._suggestedTypesTitle);this._suggestedContentTypes.set("contentTypes",types);this._suggestedContentTypes.setVisibility(true);}var key,group;for(key in _1711){group=this._getOrCreateGroup(key);group.set("contentTypes",_1711[key]);}if(_1712 instanceof Array&&_1712.length===1){this.setVisibility(false);this.set("shouldSkipContentTypeSelection",true);this.onContentTypeSelected(_1712[0]);}else{this.set("shouldSkipContentTypeSelection",false);}}));},setVisibility:function(_1713){this.getChildren().forEach(function(group){group.setVisibility(_1713);},this);},_setupWidgetTemplate:function(){this._suggestedTypesTitle=_170b.getResourceValue(this.requestedType,"suggestedtypes");this._otherTypesTitle=_170b.getResourceValue(this.requestedType,"othertypes");},clear:function(){this._suggestedContentTypes.clear();for(var key in this.groups){this.groups[key].destroyRecursive();delete this.groups[key];}},_getOrCreateGroup:function(name){var group=this.groups[name];if(!group){group=new _170c({title:name});this.connect(group,"onSelect",function(item){this.onContentTypeSelected(item);});this.addChild(group);this.groups[name]=group;}return group;},_getAvailableContentTypes:function(type){return this.contentTypeService.getAcceptedChildTypes(this.parentLink,this.get("localAsset"),[type],this.allowedTypes,this.restrictedTypes);},_getSuggestedContentTypes:function(type){var _1714=this.store.query({query:"getsuggestedcontenttypes",localAsset:this.get("localAsset"),parentReference:this.parentLink,requestedTypes:[type]});return this.contentTypeService.filterQueryResult(_1714,this.allowedTypes,this.restrictedTypes);},_groupContentTypes:function(){var _1715={},_1716=new _1708(),_1717=this._otherTypesTitle;when(this._getAvailableContentTypes(this.requestedType),lang.hitch(this,function(_1718){var count=_1718.length;array.forEach(_1718,function(item){when(item,function(type){var _1719=type.groupName||_1717,group=_1715[_1719]||[];group.push(type);_1715[_1719]=group;count--;if(count===0){_1716.resolve({grouped:_1715,contentTypes:_1718});}});});}));return _1716;},_setLocalAssetAttr:function(_171a){this._set("localAsset",_171a);if(this.requestedType&&this.parentLink){this.refresh();}},_setParentLinkAttr:function(value){this._set("parentLink",value);if(this.requestedType){this.refresh();}},onContentTypeSelected:function(){}});});},"epi-cms/widget/ContentTypeGroup":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-style","dojo/text!./templates/ContentTypeGroup.html","dijit/_TemplatedMixin","dijit/layout/_LayoutWidget","epi-cms/widget/ContentType","dojo/keys","dijit/_KeyNavContainer"],function(_171b,lang,array,_171c,_171d,_171e,_171f,_1720,keys,_1721){return _171b([_171f,_171e,_1721],{title:"",contentTypes:null,templateString:_171d,buildRendering:function(){this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.render();this.connectKeyNavHandlers(this.isLeftToRight()?[keys.LEFT_ARROW,keys.UP_ARROW]:[keys.RIGHT_ARROW,keys.DOWN_ARROW],this.isLeftToRight()?[keys.RIGHT_ARROW,keys.DOWN_ARROW]:[keys.LEFT_ARROW,keys.UP_ARROW]);},render:function(){this.clear();array.forEach(this.contentTypes,function(type){var child=new _1720({contentType:type});this.connect(child,"onSelect",this.onSelect);this.addChild(child);},this);},clear:function(){array.forEach(this.getChildren(),function(child){this.removeChild(child);child.destroyRecursive();},this);},_setTitleAttr:{node:"titleNode",type:"innerText"},_setContentTypesAttr:function(value){this._set("contentTypes",value);if(this._created){this.render();}},onSelect:function(){},setVisibility:function(_1722){var value=(_1722?"block":"none");_171c.set(this.domNode,"display",value);}});});},"url:epi-cms/widget/templates/ContentTypeGroup.html":"<div class=\"epi-listingContainer\" data-dojo-attach-point=\"focusNode\" tabIndex=\"${tabIndex}\">\n    <h2 data-dojo-attach-point=\"titleNode\" class=\"epi-ribbonHeader\"></h2>\n    <ul data-dojo-attach-point=\"containerNode\" class=\"epi-advancedListing\"></ul>\n</div>","epi-cms/widget/ContentType":function(){define(["dojo","dojo/dom-class","dojo/string","dijit/focus","dijit/_Widget","dijit/_TemplatedMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.pagetype","dojo/text!./templates/ContentType.html"],function(dojo,_1723,_1724,focus,_1725,_1726,i18n,_1727){return dojo.declare([_1725,_1726],{templateString:_1727,contentType:null,iconTemplate:"<img src=\"${0}\" alt=\"${1}\" class=\"epi-preview\" />",emptyIconTemplate:_1724.substitute("<div class=\"epi-noPreviewIcon\"><span class=\"epi-noPreview\">${0}</span></div>",[i18n.nopreview]),buildRendering:function(){this.inherited(arguments);this.connect(this.domNode,"onclick",this._onClick);this.render();},render:function(){var type=this.contentType;if(type){this.set("name",type.localizedName);this.set("description",type.localizedDescription||i18n.nodescription);this.set("icon",type.imagePath);}},_setContentTypeAttr:function(value){this._set("contentType",value);if(this._created){this.render();}},_setNameAttr:{node:"nameNode",type:"innerText"},_setDescriptionAttr:{node:"descriptionNode",type:"innerText"},_setIconAttr:function(value){this._set("icon",value);this.iconNode.innerHTML=value?_1724.substitute(this.iconTemplate,[value,this.name]):this.emptyIconTemplate;},focus:function(){this.inherited(arguments);_1723.add(this.focusNode,"epi-advancedListingItemActive");focus.focus(this.focusNode);},_onBlur:function(){this.inherited(arguments);_1723.remove(this.focusNode,"epi-advancedListingItemActive");},_onKeyPress:function(e){if(e.keyCode===13||e.keyCode===32){this.onSelect(this.contentType);}},_onClick:function(){this.onSelect(this.contentType);},_onMouseOver:function(){_1723.add(this.focusNode,"epi-advancedListingItemActive");},_onMouseOut:function(){_1723.remove(this.focusNode,"epi-advancedListingItemActive");},onSelect:function(item){}});});},"url:epi-cms/widget/templates/ContentType.html":"<li class=\"clearfix\" data-dojo-attach-event=\"onkeypress:_onKeyPress, onmouseover:_onMouseOver, onmouseout:_onMouseOut\" data-dojo-attach-point=\"focusNode\">\n    <div class=\"epi-browserWindow\"><div class=\"epi-browserWindowContent\" data-dojo-attach-point=\"iconNode\">${emptyIconTemplate}</div></div>\n    <h3 data-dojo-attach-point=\"nameNode\"></h3>\n    <p data-dojo-attach-point=\"descriptionNode\"></p>\n</li>","epi-cms/widget/PropertiesForm":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/layout/_LayoutWidget","epi/shell/widget/FormContainer"],function(array,_1728,lang,when,_1729,_172a){return _1728([_1729],{metadata:null,showAllProperties:false,propertyFilter:null,_setMetadataAttr:function(value){this._set("metadata",value);setTimeout(lang.hitch(this,function(){this._setupForm();}),0);},_setupForm:function(){if(this._form){this._form.destroy();}this._form=new _172a({metadata:this.metadata,doLayout:false,propertyFilter:lang.hitch(this,this.propertyFilter)});this.connect(this._form,"onFieldCreated",function(_172b,_172c){this.own(_172c.watch("state",lang.hitch(this,function(name,_172d,value){if(_172d==="Error"&&value!=="Error"){this.onPropertyValidStateChange(_172b);}else{if(_172d!=="Error"&&value==="Error"){this.onPropertyValidStateChange(_172b,_172c.getErrorMessage());}}})));});this._form.placeAt(this.domNode);this.domNode.scrollTop=0;this.own(this._form);},validate:function(){return this._form.validate();},onPropertyValidStateChange:function(_172e,_172f){},_getValueAttr:function(){return this._form.get("value");}});});},"url:epi-cms/contentediting/templates/CreateContent.html":"<div class=\"epi-createContent\">\n    <div data-dojo-attach-point=\"layoutContainer\" data-dojo-type=\"dijit/layout/BorderContainer\" data-dojo-props=\"gutters: false, livesplitters: false\">\n        <div class=\"epi-static-node\" data-dojo-attach-point=\"topPanel\" data-dojo-type=\"dijit/layout/ContentPane\" data-dojo-props=\"region:'top'\">\n            <div data-dojo-attach-point=\"headingPanel\">\n                <h1><span data-dojo-attach-point=\"headingTextNode\"></span>:&nbsp;<span data-dojo-attach-point=\"contentTypeNameNode\"></span></h1>\n            </div>\n            <div data-dojo-attach-point=\"toolbar\" class=\"epi-localToolbar epi-viewHeaderContainer\" data-dojo-type=\"epi/shell/widget/ToolbarSet\" data-dojo-props=\"region:'top'\"></div>\n            <div data-dojo-attach-point=\"namePanel\">\n                <label>${sharedResources.header.name}</label>\n                <input data-dojo-attach-point=\"nameTextBox\"\n                       data-dojo-type=\"dijit/form/ValidationTextBox\"\n                       data-dojo-props=\"selectOnClick: true, required: true, trim:true\"\n                       data-dojo-attach-event=\"onChange: _onContentNameChange, onBlur: _onBlurVerifyContent\"\n                       maxlength=\"255\" />\n                <span data-dojo-attach-point=\"contentNameHelpTextNode\" class=\"dijitInline dgrid-no-data\"></span>\n            </div>\n        </div>\n        <div class=\"epi-newContentContainer epi-animation-node\" data-dojo-attach-point=\"stackContainer\" data-dojo-type=\"dijit/layout/StackContainer\" data-dojo-props=\"region: 'center'\">\n            <div data-dojo-attach-point=\"contentTypeList\" data-dojo-type=\"epi-cms/widget/ContentTypeList\" data-dojo-attach-event=\"onContentTypeSelected: _onContentTypeSelected\">\n                <div data-dojo-attach-point='subHeadingPanel' class=\"push-padding--left\">\n                    <h1 data-dojo-attach-point=\"subHeadingTextNode\"></h1>\n                    <p data-dojo-attach-point=\"subHeadingDescNode\"></p>\n                </div>\n            </div>\n            <div data-dojo-attach-point=\"propertiesForm\" data-dojo-type=\"epi-cms/widget/PropertiesForm\" data-dojo-attach-event=\"onPropertyValidStateChange: _onPropertyValidStateChange\">\n            </div>\n        </div>\n    </div>\n</div>","epi-cms/contentediting/CreateLanguageBranch":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/CreateContent","epi-cms/contentediting/viewmodel/CreateLanguageBranchViewModel"],function(_1730,lang,_1731,_1732){return _1730([_1731],{modelType:_1732,_setCreateMode:function(){lang.mixin(this._contextService.currentContext,{currentMode:"translate"});}});});},"epi-cms/contentediting/viewmodel/CreateLanguageBranchViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/contentediting/viewmodel/CreateContentViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.createpage.translate"],function(_1733,lang,when,_1734,_1735,res){return _1733([_1735],{languageBranch:null,masterLanguageVersionId:null,contentNameHelpText:res.namehelptext,postscript:function(){this.wizardStep=1;this.startWizardStep=1;this.inherited(arguments);this._languageStore=this._languageStore||_1734.resolve("epi.storeregistry").get("epi.cms.language");},update:function(_1736){var _1737=_1736.contentData;var _1738=_1736.languageBranch;this.set("contentNameHelpText",_1737.publicUrl?res.namehelptext:"");var self=this;return when(this.contentDataStore.get(_1737.parentLink)).then(function(_1739){var _173a=_1735.prototype.update.apply(self,[{requestedType:_1737.typeIdentifier,parent:_1739,contentTypeId:_1737.contentTypeID}]);self.set("languageBranch",_1738);self.set("masterLanguageVersionId",_1737.contentLink);self.set("contentName",_1737.name);return _173a;}).then(function(_173b){return when(self._languageStore.get(self.languageBranch)).then(function(_173c){self.set("headingText",lang.replace(res.namelabel,[_173c.name]));return _173b;});});},_hasRequiredProperties:function(){return true;},_isRequired:function(_173d){return this.inherited(arguments)&&(!this.languageBranch||_173d.settings.isLanguageSpecific===true);},buildContentObject:function(){var _173e=this.inherited(arguments);lang.mixin(_173e,{languageBranch:this.languageBranch,masterLanguageVersionId:this.masterLanguageVersionId});return _173e;}});});},"epi-cms/contentediting/DateTimeNowEditor":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/text!./templates/DateTimeNowEditor.html","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/Tooltip","epi/shell/widget/_ValueRequiredMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.datetimenow"],function(_173f,_1740,lang,_1741,_1742,_1743,_1744,_1745,_1746,_1747,_1748){return _1740([_1743,_1744,_1745,_1747],{templateString:_1742,value:null,resources:_1748,_selectorWatchHandle:null,postCreate:function(){this.inherited(arguments);this._selectorWatchHandle=this.dateTimeSelector.watch("value",lang.hitch(this,function(value,_1749,_174a){this._set("value",_174a);this.onChange(_174a);}));},onChange:function(_174b){this.validate();},validate:function(){var _174c=this.inherited(arguments);if(_174c){var value=this.get("value");_174c=this.disabled||!value||!this.minimumValue||value>this.minimumValue;this._set("state",_174c?"":"Error");if(_174c){_1746.hide(this.domNode);}else{_1746.show(this.minimumValueMessage,this.domNode);}}return _174c;},_setValueAttr:function(value){this.dateTimeSelector.set("value",value);this._set("value",value);},_getValueAttr:function(){return this.dateTimeSelector.get("value");},_onExpireNowClick:function(){this.set("value",new Date());},destroy:function(){if(this._selectorWatchHandle){this._selectorWatchHandle.unwatch();}_1746.hide(this.domNode);}});});},"url:epi-cms/contentediting/templates/DateTimeNowEditor.html":"<div class=\"dijitInline dijitInputContainer\">\n    <div data-dojo-type=\"epi/shell/widget/DateTimeSelectorDropDown\" data-dojo-attach-point=\"dateTimeSelector\"></div\n    ><a class=\"epi-visibleLink\" style=\"padding-left:10px\" data-dojo-attach-event=\"onclick:_onExpireNowClick\">${resources.now}</a>\n</div>","epi-cms/contentediting/DialogEditorWrapper":function(){define(["epi","dojo","epi-cms/contentediting/_EditorWrapperBase","epi/shell/widget/dialog/Dialog"],function(epi,dojo,_174d,_174e){return dojo.declare([_174d],{closeOnChange:true,showButtons:false,_dialog:null,buildRendering:function(){this.inherited(arguments);if(!this.editorWidget){dojo["require"](this.editorWidgetType);var cls=dojo.getObject(this.editorWidgetType);var _174f=this.editorParams||{};if("displayedValue" in cls.prototype||"value" in cls.prototype){_174f["displayedValue" in cls.prototype?"displayedValue":"value"]=this.value;}this.editorWidget=new cls(_174f);}var ew=this.editorWidget;var _1750=new _174e({content:ew,title:this.propertyDisplayName,defaultActionsVisible:this.showButtons,contentClass:"epi-dialog-fullWidth",destroyOnHide:false});this.connect(ew,"onKeyPress",this._onKeyPress);this.connect(ew,"onCancel",this._onCancel);this.connect(ew,"onResize",dojo.hitch(this,function(){this._dialog.resize();}));if("intermediateChanges" in ew){ew.set("intermediateChanges",true);}this.connect(ew,"onChange","_onChange");this.connect(_1750,"onHide",this._onHide);this.connect(_1750,"onCancel",this._onCancel);this._dialog=_1750;},destroy:function(){this._dialog.destroyRecursive();this.inherited(arguments);},_onKeyPress:function(e){if(this.editing){if(e.altKey||e.ctrlKey){return;}if(e.keyCode===dojo.keys.ESCAPE){dojo.stopEvent(e);this.cancel();}else{if(e.keyCode===dojo.keys.ENTER&&e.target.tagName==="INPUT"){dojo.stopEvent(e);this._stopEdit();}}}},_onCancel:function(){this.cancel();this.editorWidget.set("value",this.value);if(this._dialog.open){this._dialog.hide();}},_onChange:function(){this.inherited(arguments);if(this.closeOnChange){this._stopEdit();}},_onHide:function(){if(this.editing){this._stopEdit();}},startEdit:function(){this.inherited(arguments);this._dialog.show();},_stopEdit:function(){this.inherited(arguments);if(this._dialog.open){this._dialog.hide();}},_setTitleAttr:function(title){if(this._dialog){this._dialog.set("title",title);}this._set("title",title);}});});},"epi-cms/contentediting/editors/CheckBoxListEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/on","dojox/html/entities","dijit/focus","dijit/_TemplatedMixin","dijit/_Widget","dijit/form/CheckBox","epi/shell/widget/_ValueRequiredMixin"],function(array,_1751,lang,_1752,on,_1753,_1754,_1755,_1756,_1757,_1758){return _1751([_1756,_1755,_1758],{templateString:"<div class=\"dijit dijitReset dijitInline\"></div>",baseClass:"epi-checkBoxList",valueIsCsv:true,valueIsInclusive:true,value:null,constructor:function(){this._checkboxes=[];this._labelClickHandles=[];},buildRendering:function(){this.inherited(arguments);array.forEach(this.selections,this._addCheckBoxForItem,this);},destroy:function(){var _1759;while((_1759=this._checkboxes.pop())){_1759.destroyRecursive();}var _175a;while((_175a=this._labelClickHandles.pop())){_175a.remove();}this.inherited(arguments);},focus:function(){try{if(this._checkboxes.length>0){_1754.focus(this._checkboxes[0].domNode);}}catch(e){}},onChange:function(){},onBlur:function(){},onFocus:function(){},_calculateValue:function(){var _175b=[];var _175c=this.valueIsInclusive;array.forEach(this._checkboxes,function(_175d){if(_175c===_175d.checked){_175b.push(_175d.value);}});this._set("value",this.valueIsCsv?_175b.join(","):_175b);},_setValueAttr:function(value){this._set("value",value);var _175e=[];if(value){_175e=this.valueIsCsv?value.split(","):value;}var _175f=this.valueIsInclusive;var _1760=this._compareCheckboxValue;array.forEach(this._checkboxes,function(_1761){_1761.set("checked",_175f===array.some(_175e,function(v){return _1760(_1761,v);}));});},_compareCheckboxValue:function(_1762,value){var _1763=_1762.value;if(_1763===undefined||_1763===null){return false;}return _1763.toString()===value.toString();},_onBlur:function(){this.inherited(arguments);this.onBlur();},_addCheckBoxForItem:function(item){var _1764=_1752.create("div",{"class":"epi-checkboxContainer"},this.domNode);var _1765=new _1757({value:item.value});_1765.placeAt(_1764);this.own(on(_1765,"change",lang.hitch(this,function(){this._calculateValue();this.onChange(this.value);})));_1765.set("readOnly",!!this.readOnly);this._checkboxes.push(_1765);var label=_1752.create("label",{"for":_1765.id},_1764);label.textContent=item.text;this._labelClickHandles.push(on(label,"click",lang.hitch(this,function(){_1754.focus(_1765.domNode);})));}});});},"epi-cms/contentediting/editors/CollectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/dom-class","dojo/json","dojo/on","dojo/Stateful","dojo/when","dijit/_TemplatedMixin","dijit/_Widget","dgrid/Keyboard","dgrid/OnDemandGrid","dgrid/Selection","dgrid/extensions/ColumnResizer","dgrid/extensions/ColumnReorder","put-selector/put","epi/shell/dgrid/Formatter","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/FormContainer","epi/string","epi/shell/command/withConfirmation","epi-cms/contentediting/editors/model/CollectionEditorModel","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/contentediting/_EditorWrapperBase","epi-cms/dgrid/DnD","epi-cms/dgrid/formatters","epi-cms/dgrid/WithContextMenu","epi-cms/contentediting/editors/DefaultGridAssembler","./_AddItemDialogMixin","dojo/text!./templates/CollectionEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.collectioneditor"],function(array,_1766,lang,_1767,_1768,_1769,json,on,_176a,when,_176b,_176c,_176d,_176e,_176f,_1770,_1771,put,_1772,_1773,_1774,_1775,_1776,_1777,_1778,_1779,DnD,_177a,_177b,_177c,_177d,_177e,_177f){return _1766([_176c,_176b,_1773,_177d],{templateString:_177e,multiple:true,baseClass:"epi-collection-editor",value:null,model:null,modelType:_1777,itemType:null,generateColumns:true,excludedColumns:null,includedColumns:null,gridType:_1766([_176e,_1772,_176f,_176d,DnD,_1770,_1771,_177b]),gridAssemblerType:_177c,gridSettings:null,itemModelType:null,itemEditorType:_1774,useFullWidth:true,_noDataMessage:"<span><span class=\"dijitReset dijitInline\">"+_177f.noitems+"</span></span>",_currentProviderHandler:null,postMixInProperties:function(){this.inherited(arguments);this.itemModelType=this.itemModelType||_1778;this.model=this.model||new this.modelType({itemType:this.itemType,itemModelType:this.itemModelType,data:this.value,availableCommands:this.commands});this.own(on(this.model,"itemsChanged",lang.hitch(this,this._onItemsChanged)));this.gridSettings=lang.mixin(this.gridSettings||{},{noDataMessage:this._noDataMessage});if(this.readOnly){this.allowedDndTypes=[];this.gridSettings.dndDisabled=true;}this.gridSettings.dndParams={copyOnly:true,accept:this.allowedDndTypes||[],creator:lang.hitch(this,this._dndNodeCreator)};},postCreate:function(){this.inherited(arguments);when(this.model.initialize(),lang.hitch(this,function(){this._setupGrid();}));},onChange:function(value){},_setValueAttr:function(value){this._set("value",value);if(this.model){this.model.set("data",value);}},_dndNodeCreator:function(item,hint){var node=_1768.create("div");return {node:node,type:this.allowedDndTypes,data:item};},_setupGrid:function(){var _1780=this._getGridDefinition();var _1781=new this.gridAssemblerType({gridType:this.gridType,gridSettings:this.gridSettings,columnDefinitions:_1780,listCommands:this.readOnly?[]:this.model.getListCommands(),itemCommandsFactory:lang.hitch(this,function(item,_1782){return this.readOnly?[]:this.model.getItemCommands(item,this.commands,_1782);})});this.own(this.grid=_1781.build(this.gridNode,this.commandTargetNode));_1769.add(this.gridNode,"epi-plain-grid-modal epi-plain-grid--margin-bottom epi-plain-grid--cell-borders");if(!this.gridSettings.dndDisabled){this._setupDnD();}var items=this.model.get("items");this.grid.renderArray(items);if(!items||items.length<=0){this._renderNoDataMessage();}this.own(this.grid.on(".dgrid-row:click",lang.hitch(this,this.onGridRowClick)));this.own(this.grid.on(".dgrid-row:dblclick",lang.hitch(this,this.onGridRowDblClick)));},_setupDnD:function(){this.own(_1767.after(this.grid.dndSource,"onDropData",lang.hitch(this,this.onDndDrop),true));},onDndDrop:function(_1783,_1784,nodes,copy){var i;if(this.grid.dndSource===_1784){for(i=0;i<nodes.length;i++){this.model.moveItem(this.grid.dndSource.getItem(nodes[i].id).data,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}}else{this.onDropping&&this.onDropping();this.onFocus();for(i=0;i<_1783.length;i++){this._addItem(_1783[i]);if(_1784&&_1784.grid&&_1784.grid.consumer&&_1784.grid.consumer!==this){_1784.grid.consumer.model.removeItem(this.grid.dndSource.getItem(nodes[i].id).data);}}}},_addItem:function(item){when(this._dndGetItemData(item),lang.hitch(this,function(_1785){this.model.addItem(_1785,this.grid.dndSource.current!=null?this.grid.dndSource.getItem(this.grid.dndSource.current.id).data:null,this.grid.dndSource.before);}));},_dndGetItemData:function(item){return item.data;},_getGridDefinition:function(){var _1786=this.generateColumns?this.model.generateColumnsDefinition(this.excludedColumns):this.includedColumns||{};return this.model.generateFormatters(_1786);},_onGridRowSelect:function(e){if(!this.grid.itemCommandProviderMap){return;}if(this._currentProviderHandler){this._currentProviderHandler.removeProvider();}var item=this.grid.row(e).data;this._currentProviderHandler=this.grid.contextMenu.addProvider(this.grid.itemCommandProviderMap[json.stringify(item)]);},onGridRowClick:function(e){this._onGridRowSelect(e);},onGridRowDblClick:function(e){var item={model:this.grid.row(e).data};this.model.editItemDelegate(item);},_getDialogConfirmActionText:function(){return this.gridSettings.confirmActionText?this.gridSettings.confirmActionText:this.inherited(arguments);},onExecuteDialog:function(){var item=this._itemEditor.get("value");if(this._editingItemIndex!==undefined){this.model.saveItem(item,this._editingItemIndex);}else{this.model.addItem(item);}},_onItemsChanged:function(items){if(this.grid){for(var item in this.grid.itemCommandProviderMap){delete this.grid.itemCommandProviderMap[item];}this.grid.refresh();this.grid.renderArray(items);if(!items||items.length<=0){this._renderNoDataMessage();}}var value=this.model.get("data");this._set("value",value);if(!this.readOnly){this.onChange(value);}},_renderNoDataMessage:function(){if(this.grid.noDataNode){return;}this.grid.noDataNode=put(this.grid.contentNode,"div.dgrid-no-data");this.grid.noDataNode.innerHTML=this.grid.noDataMessage;}});});},"dgrid/extensions/ColumnReorder":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/on","dojo/query","dojo/dnd/Source","put-selector/put","xstyle/css!../css/extensions/ColumnReorder.css"],function(lang,_1787,_1788,on,query,_1789,put){var _178a=/(\d+)(?:-(\d+))?$/;function _178b(grid,match){var _178c=match[2],_178d=grid[_178c?"columnSets":"subRows"][match[1]];return _178c?_178d[match[2]]:_178d;};function _178e(grid,match,_178f){if(match[2]){grid.columnSets[match[1]][match[2]]=_178f;}else{grid.subRows[match[1]]=_178f;}};function _1790(_1791){return "dgrid-"+_1791+"-";};function _1792(_1793,_1794){return _1794.slice(_1790(_1793).length);};var _1795=_1787(_1789,{copyState:function(){return false;},checkAcceptance:function(_1796,nodes){return _1796==this;},_legalMouseDown:function(evt){return evt.target.className.indexOf("dgrid-resize-handle")>-1?false:this.inherited(arguments);},onDropInternal:function(nodes){var grid=this.grid,match=_178a.exec(_1792(grid.id,nodes[0].getAttribute("dndType"))),_1797=match[2]?"columnSets":"subRows",_1798=_178b(grid,match),_1799=grid.columns;this.inherited(arguments);if(!match){return;}setTimeout(function(){var _179a=_1788.map(nodes[0].parentNode.childNodes,function(col){return _1799[col.columnId];}),_179b;_178e(grid,match,_179a);_179b={grid:grid,subRow:_179a,column:_1799[nodes[0].columnId],bubbles:true,cancelable:true,parentType:"dnd"};_179b[_1797]=grid[_1797];if(on.emit(grid.domNode,"dgrid-columnreorder",_179b)){grid.set(_1797,grid[_1797]);}else{_178e(grid,match,_1798);grid.renderHeader();if(this._sort&&this._sort.length){this.updateSortArrow(this._sort);}}},0);}});var _179c=_1787(null,{columnDndConstructor:_1795,_initSubRowDnd:function(_179d,_179e){var _179f,c,len,col,th;for(c=0,len=_179d.length;c<len;c++){col=_179d[c];if(col.reorderable===false){continue;}th=col.headerNode;if(th.tagName!="TH"){th=th.parentNode;}put(th,".dojoDndItem[dndType="+_179e+"]");if(!_179f){_179f=th.parentNode;}}if(_179f){this._columnDndSources.push(new this.columnDndConstructor(_179f,{horizontal:true,grid:this}));}},renderHeader:function(){var _17a0=_1790(this.id),_17a1,cs;this.inherited(arguments);this._columnDndSources=[];if(this.columnSets){for(cs=0,_17a1=this.columnSets.length;cs<_17a1;cs++){_1788.forEach(this.columnSets[cs],function(_17a2,sr){this._initSubRowDnd(_17a2,_17a0+cs+"-"+sr);},this);}}else{_1788.forEach(this.subRows,function(_17a3,sr){this._initSubRowDnd(_17a3,_17a0+sr);},this);}},_destroyColumns:function(){if(this._columnDndSources){_1788.forEach(this._columnDndSources,function(_17a4){_17a4.destroy();});}this.inherited(arguments);}});_179c.ColumnDndSource=_1795;return _179c;});},"epi-cms/contentediting/editors/model/CollectionEditorModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/when","dojo/promise/all","dijit/Destroyable","dojox/mvc/StatefulArray","epi/dependency","epi/string","epi/shell/command/DelegateCommand","epi-cms/contentediting/editors/model/CollectionEditorItemModel","epi-cms/dgrid/formatters","epi/i18n!epi/nls/episerver.shared"],function(array,_17a5,lang,_17a6,_17a7,_17a8,_17a9,when,all,_17aa,_17ab,_17ac,_17ad,_17ae,_17af,_17b0,_17b1){var _17b2={none:0,add:1,edit:2,remove:4,moveUp:8,moveDown:16};var _17b3=_17a5([_17a9,_17a8,_17aa],{data:null,itemType:null,itemModelType:null,itemMetadata:null,metadataManager:null,availableCommands:null,_itemModels:null,_itemsUnchanged:false,postscript:function(){this.inherited(arguments);this.metadataManager=this.metadataManager||_17ac.resolve("epi.shell.MetadataManager");this.itemModelType=this.itemModelType||_17af;},initialize:function(){return when(this.metadataManager.getMetadataForType(this.itemType),lang.hitch(this,function(_17b4){this.set("itemMetadata",_17b4);return this._initData();}));},_initData:function(){this._itemModels=new _17ab([]);_17a6.before(this._itemModels,"sort",lang.hitch(this,function(){this._itemsUnchanged=true;},true));this.own(this._itemModels.watchElements(lang.hitch(this,function(){if(!this._itemsUnchanged){this.emit("itemsChanged",this.get("items"));}this._itemsUnchanged=false;})));var _17b5=array.map(this.data,function(item){var _17b6=new this.itemModelType();return when(_17b6.fromItemData(item,this.itemType),function(){return _17b6;});},this);return when(all(_17b5),lang.hitch(this,function(_17b7){this._itemModels.splice.apply(this._itemModels,[0,this._itemModels.length].concat(_17b7));}));},getListCommands:function(_17b8){return [new _17ae({name:"add",tooltip:_17b1.action.add,iconClass:"epi-iconPlus",canExecute:true,isAvailable:this._commandIsAvailable(_17b2.add,_17b8),delegate:lang.hitch(this,this.addItemDelegate)})];},getItemCommands:function(item,_17b9,_17ba){return [new _17ae({name:"edit",category:_17ba,label:_17b1.action.edit,iconClass:"epi-iconPen",model:item,canExecute:true,isAvailable:this._commandIsAvailable(_17b2.edit,_17b9),delegate:lang.hitch(this,this.editItemDelegate)}),new _17ae({name:"moveUp",category:_17ba,label:_17b1.action.moveup,iconClass:"epi-iconUp",model:item,canExecute:this._itemModels.indexOf(item)>0,isAvailable:this._commandIsAvailable(_17b2.moveUp,_17b9),delegate:lang.hitch(this,this.moveItemUpDelegate)}),new _17ae({name:"moveDown",category:_17ba,label:_17b1.action.movedown,iconClass:"epi-iconDown",model:item,canExecute:this._itemModels.indexOf(item)<this._itemModels.length-1,isAvailable:this._commandIsAvailable(_17b2.moveDown,_17b9),delegate:lang.hitch(this,this.moveItemDownDelegate)}),new _17ae({name:"remove",category:_17ba,label:_17b1.action.remove,iconClass:"epi-iconTrash",model:item,canExecute:true,isAvailable:this._commandIsAvailable(_17b2.remove,_17b9),delegate:lang.hitch(this,this.removeItemDelegate)})];},_commandIsAvailable:function(_17bb,_17bc){_17bc=_17bc||this.availableCommands;return !!(_17bb&_17bc);},generateColumnsDefinition:function(_17bd){var _17be={};array.forEach(array.filter(this.itemMetadata.properties,function(_17bf){return array.every(_17bd,function(col){return col!==_17bf.name;});}),function(_17c0){var _17c1=_17ad.pascalToCamel(_17c0.name);_17be[_17c1]={label:_17c0.displayName||_17c0.name};});return _17be;},generateFormatters:function(_17c2){for(var _17c3 in _17c2){array.some(this.itemMetadata.properties,function(_17c4){if(_17c3===_17ad.pascalToCamel(_17c4.name)){this._setTypeFormatter(_17c4,_17c2[_17c3]);this._setSelectionFactoryFormatter(_17c4,_17c2[_17c3]);this._setWrappingFormatter(_17c2[_17c3]);return true;}},this);}return _17c2;},_typeFormatterMap:{"System.DateTime":_17b0.localizedDate,"System.Boolean":_17b0.friendlyBoolean},_wrappingFormatterMap:{SecondaryText:function(_17c5){if(_17c5){return function(value){return _17b0.secondaryText(_17c5(value),true);};}return function(value){return _17b0.secondaryText(value);};},VisibleLink:function(_17c6){if(_17c6){return function(value){return _17b0.visibleLink(_17c6(value),true);};}return function(value){return _17b0.visibleLink(value);};}},_setTypeFormatter:function(_17c7,_17c8){for(var _17c9 in this._typeFormatterMap){if(_17c7.modelType.indexOf(_17c9)>-1){_17c8.formatter=this._typeFormatterMap[_17c9];break;}}},_setSelectionFactoryFormatter:function(_17ca,_17cb){if(_17ca.selections&&_17ca.selections.length>0){var _17cc=_17ca.selections;if(_17cb){_17cb.formatter=function(value){var _17cd=value;_17cc.forEach(function(_17ce){if(_17ce.value===value){_17cd=_17ce.text;}});return _17cd;};}}},_setWrappingFormatter:function(_17cf){if(_17cf.wrappingFormatter&&this._wrappingFormatterMap[_17cf.wrappingFormatter]){_17cf.formatter=this._wrappingFormatterMap[_17cf.wrappingFormatter](_17cf.formatter);}},addItemDelegate:function(){this.emit("toggleItemEditor",null);},editItemDelegate:function(cmd){if(this._commandIsAvailable(_17b2.edit,this.availableCommands)){var item=cmd.model;var index=this._itemModels.indexOf(item);this.emit("toggleItemEditor",item,index);}},removeItemDelegate:function(cmd){this.removeItem(cmd.model);},moveItemUpDelegate:function(cmd){var item=cmd.model;var index=this._itemModels.indexOf(item);var _17d0=index-1;if(_17d0>=0){this.moveItem(item,this._itemModels[_17d0],true);}},moveItemDownDelegate:function(cmd){var item=cmd.model;var index=this._itemModels.indexOf(item);var _17d1=index+1;if(_17d1<this._itemModels.length){this.moveItem(item,this._itemModels[_17d1],false);}},saveItem:function(item,index){var _17d2=new this.itemModelType();return when(_17d2.fromItemData(item,this.itemType),lang.hitch(this,function(){this._itemModels.splice(index,1,_17d2);}));},addItem:function(item,_17d3,_17d4){var _17d5=new this.itemModelType();return when(_17d5.fromItemData(item,this.itemType),lang.hitch(this,function(){var _17d6;if(!_17d3){_17d6=this._itemModels.length;}else{_17d6=this._itemModels.indexOf(_17d3);if(!_17d4){_17d6++;}}this._itemModels.splice(_17d6,0,_17d5);}));},moveItem:function(item,_17d7,_17d8){this._itemsUnchanged=true;var _17d9=this._itemModels.indexOf(item);this._itemModels.splice(_17d9,1);var _17da=this._itemModels.indexOf(_17d7);var _17db=_17d8?_17da:_17da+1;_17db=_17da===-1?_17d9:_17db;this._itemModels.splice(_17db,0,item);},removeItem:function(item){var index=this._itemModels.indexOf(item);this._itemModels.splice(index,1);},_dataSetter:function(value){this.data=value;this._initData();},_dataGetter:function(){return array.map(this._itemModels,function(_17dc){return _17dc.toItemData();},this);},_itemsGetter:function(){return this._itemModels;}});_17b3.commandMask=_17b2;return _17b3;});},"dojox/mvc/StatefulArray":function(){define("dojox/mvc/StatefulArray",["dojo/_base/lang","dojo/Stateful"],function(lang,_17dd){function _17de(a){if(a._watchElementCallbacks){a._watchElementCallbacks();}return a;};var _17df=function(a){var array=lang._toArray(a||[]);var ctor=_17df;ctor._meta={bases:[_17dd]};array.constructor=ctor;return lang.mixin(array,{pop:function(){return this.splice(this.get("length")-1,1)[0];},push:function(){this.splice.apply(this,[this.get("length"),0].concat(lang._toArray(arguments)));return this.get("length");},reverse:function(){return _17de([].reverse.apply(this,lang._toArray(arguments)));},shift:function(){return this.splice(0,1)[0];},sort:function(){return _17de([].sort.apply(this,lang._toArray(arguments)));},splice:function(idx,n){var l=this.get("length");idx+=idx<0?l:0;var p=Math.min(idx,l),_17e0=this.slice(idx,idx+n),adds=lang._toArray(arguments).slice(2);[].splice.apply(this,[idx,n].concat(new Array(adds.length)));for(var i=0;i<adds.length;i++){this.set(p+i,adds[i]);}if(this._watchElementCallbacks){this._watchElementCallbacks(idx,_17e0,adds);}if(this._watchCallbacks){this._watchCallbacks("length",l,l-_17e0.length+adds.length);}return _17e0;},unshift:function(){this.splice.apply(this,[0,0].concat(lang._toArray(arguments)));return this.get("length");},concat:function(a){return new _17df([].concat.apply(this,arguments));},join:function(sep){var list=[];for(var l=this.get("length"),i=0;i<l;i++){list.push(this.get(i));}return list.join(sep);},slice:function(start,end){var l=this.get("length");start+=start<0?l:0;end=(end===void 0?l:end)+(end<0?l:0);var slice=[];for(var i=start||0;i<Math.min(end,this.get("length"));i++){slice.push(this.get(i));}return new _17df(slice);},watchElements:function(_17e1){var _17e2=this._watchElementCallbacks,_17e3=this;if(!_17e2){_17e2=this._watchElementCallbacks=function(idx,_17e4,adds){for(var list=[].concat(_17e2.list),i=0;i<list.length;i++){list[i].call(_17e3,idx,_17e4,adds);}};_17e2.list=[];}_17e2.list.push(_17e1);var h={};h.unwatch=h.remove=function(){for(var list=_17e2.list,i=0;i<list.length;i++){if(list[i]==_17e1){list.splice(i,1);break;}}};return h;}},_17dd.prototype,{set:function(name,value){if(name=="length"){var old=this.get("length");if(old<value){this.splice.apply(this,[old,0].concat(new Array(value-old)));}else{if(value>old){this.splice.apply(this,[value,old-value]);}}return this;}else{var _17e5=this.length;_17dd.prototype.set.call(this,name,value);if(_17e5!=this.length){_17dd.prototype.set.call(this,"length",this.length);}return this;}}});};return lang.setObject("dojox.mvc.StatefulArray",_17df);});},"epi/shell/command/DelegateCommand":function(){define("epi/shell/command/DelegateCommand",["dojo/_base/declare","epi/shell/command/_Command"],function(_17e6,_17e7){return _17e6([_17e7],{delegate:null,_execute:function(){return this.delegate?this.delegate.apply(this,[this].concat(arguments)):null;}});});},"epi-cms/contentediting/editors/model/CollectionEditorItemModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful"],function(array,_17e8,lang,_17e9){return _17e8([_17e9],{_itemDataPropertyNames:null,_nameGetter:function(){return this.name||this.text||"*";},fromItemData:function(_17ea,_17eb){lang.mixin(this,_17ea);this._itemDataPropertyNames=[];for(var _17ec in _17ea){if(_17ea.hasOwnProperty(_17ec)){this._itemDataPropertyNames.push(_17ec);}}this.typeIdentifier=_17eb&&_17eb.toLowerCase();},toItemData:function(){var _17ed={};array.forEach(this._itemDataPropertyNames,function(_17ee){_17ed[_17ee]=this.get(_17ee);},this);return _17ed;}});});},"epi-cms/contentediting/editors/DefaultGridAssembler":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/json","dojo/Stateful","epi","epi/shell/command/builder/ButtonBuilder","epi/shell/command/withConfirmation","epi-cms/dgrid/formatters"],function(array,_17ef,lang,json,_17f0,epi,_17f1,_17f2,_17f3){var _17f4=_17ef([],{gridType:null,gridSettings:null,columnDefinitions:null,listCommands:null,itemCommandsFactory:null,constructor:function(_17f5){lang.mixin(this,_17f5);},build:function(_17f6,_17f7){},instantiateGrid:function(_17f8,_17f9,_17fa,node){return new _17f8(lang.mixin(_17f9,{columns:_17fa,className:"epi-plain-grid"}),node);}});return _17ef([_17f4],{itemCommandProviderMap:null,constructor:function(){this.itemCommandProviderMap={};},build:function(_17fb,_17fc){this.columnDefinitions["_epiGrid_Action"]={renderHeaderCell:function(){},renderCell:lang.hitch(this,function(item,value,node,_17fd){var _17fe=this._getItemCommands(item);this.itemCommandProviderMap[json.stringify(item)]=new _17f0({commands:_17fe});this.renderActionMenu(item,node,_17fe);}),className:"epi-columnNarrow",sortable:false};var grid=this.instantiateGrid(this.gridType,this.gridSettings,this.columnDefinitions,_17fb);grid.itemCommandProviderMap=this.itemCommandProviderMap;this._setupCommands(this.listCommands,_17fc);return grid;},renderActionMenu:function(item,node,_17ff){node.innerHTML=_17ff&&_17ff.length>0?_17f3.menu({title:epi.resources.action.options}):"";},_getItemCommands:function(item){var _1800=this.itemCommandsFactory(item,"context");array.some(_1800,function(_1801){if(_1801.name==="remove"&&this.gridSettings.useDeleteWithConfirmation){_1801=_17f2(_1801,null,{title:this.gridSettings.deleteConfirmationTitle,description:this.gridSettings.deleteConfirmationMessage});return true;}},this);return _1800;},_setupCommands:function(_1802,_1803){var _1804=this.getListCommandBuilder();array.forEach(_1802,function(_1805){_1804.create(_1805,_1803);},this);},getListCommandBuilder:function(){return new _17f1({settings:{showLabel:true},optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"});}});});},"epi-cms/contentediting/editors/_AddItemDialogMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/dialog/Dialog","../../widget/_HasChildDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.collectioneditor","epi/i18n!epi/nls/episerver.shared"],function(_1806,lang,on,_1807,_1808,_1809,_180a,_180b){return _1806([_1807,_1809],{itemEditorType:null,_itemEditor:null,_dialog:null,dialogParams:null,_editingItemIndex:null,postCreate:function(){this.inherited(arguments);this.own(on(this.model,"toggleItemEditor",lang.hitch(this,this._onToggleItemEditor)));},_onToggleItemEditor:function(item,index){this._setupItemEditor();this._itemEditor.set("value",item);this._editingItemIndex=index;this.isShowingChildDialog=true;this._dialog.show();this._setDialogConfirmActionText(item);this._setDialogTitle(item);this._setDialogConfirmActionStatus(item);},_setupItemEditor:function(){this._itemEditor=this._createItemEditor();this.own(this._dialog=new _1808(lang.mixin({title:this._getDialogTitleText(),content:this._itemEditor},this.dialogParams)));this._dialog.own(this._itemEditor,this.connect(this._itemEditor,"onChange","_setDialogConfirmActionStatus"),on(this._dialog,"execute",lang.hitch(this,this._onDialogExecute)),on(this._dialog,"hide",lang.hitch(this,this._onCancelDialog)));},_createItemEditor:function(){return new this.itemEditorType({metadata:this.model.get("itemMetadata"),doLayout:false});},_setDialogTitle:function(_180c){this._dialog.set("title",this._getDialogTitleText(_180c));},_getDialogTitleText:function(_180d){return _180a.title;},_onCancelDialog:function(){this.isShowingChildDialog=false;this.onCancelDialog();},_onDialogExecute:function(){if(this.validate()){this.onExecuteDialog();}},onExecuteDialog:function(){},onCancelDialog:function(){},_setDialogConfirmActionText:function(_180e){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"label",this._getDialogConfirmActionText(_180e));},_getDialogConfirmActionText:function(_180f){return _180f?_180b.action.ok:_180b.action.add;},_setDialogConfirmActionStatus:function(item){this._dialog.onActionPropertyChanged({name:this._dialog._okButtonName},"disabled",!item||item==="");}});});},"epi-cms/widget/_HasChildDialogMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom","dijit/_FocusMixin","dijit/popup"],function(_1810,lang,_1811,dom,_1812,popup){return _1810([_1812],{isShowingChildDialog:false,_openedChildDialog:null,_waitingForFocus:false,startup:function(){if(!this._started){this.own(_1811.before(popup,"open",lang.hitch(this,"_onPopupOpen"),true),_1811.after(popup,"close",lang.hitch(this,"_onPopupClosed"),true));}this.inherited(arguments);},_onPopupOpen:function(_1813){var popup=_1813.popup;if(popup&&popup.popupParent){return;}var _1814=popup&&popup.currentTarget;if(_1814&&dom.isDescendant(_1814,this.domNode)){this._openedChildDialog=popup;this.isShowingChildDialog=true;}},_onPopupClosed:function(popup){if(this._openedChildDialog===popup){this._openedChildDialog=null;this.isShowingChildDialog=false;this._waitingForFocus=true;setTimeout(lang.hitch(this,"_waitForFocus"),0);}},_waitForFocus:function(){if(this._waitingForFocus){this._waitingForFocus=false;this._onBlur();}},_onBlur:function(){if(this.isShowingChildDialog){return;}this.inherited(arguments);},_onFocus:function(){this._waitingForFocus=false;if(this.isShowingChildDialog){return;}this.inherited(arguments);}});});},"url:epi-cms/contentediting/editors/templates/CollectionEditor.html":"<div class=\"dijitInline\" style=\"width:100%;\">\n    <div data-dojo-attach-point=\"commandTargetNode\"></div>\n    <div data-dojo-attach-point=\"gridNode\"></div>\n</div>","epi-cms/contentediting/editors/ContentAreaEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-style","dojo/on","dojo/topic","dojo/when","dijit/registry","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_CssStateMixin","dijit/_WidgetsInTemplateMixin","epi/shell/dnd/Target","epi/shell/command/_CommandProviderMixin","./_ContentAreaTree","./_ContentAreaTreeModel","./_TextWithActionLinksMixin","epi-cms/_ContentContextMixin","epi-cms/contentediting/viewmodel/ContentAreaViewModel","epi/shell/widget/ContextMenu","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/overlay/Block","epi-cms/widget/command/CreateContentFromSelector","epi-cms/widget/_HasChildDialogMixin","epi-cms/contentediting/command/BlockRemove","epi-cms/contentediting/command/BlockEdit","epi-cms/contentediting/command/MoveToPrevious","epi-cms/contentediting/command/MoveToNext","epi-cms/contentediting/command/MoveOutsideGroup","epi-cms/contentediting/command/Personalize","epi-cms/contentediting/command/SelectDisplayOption","dojo/text!./templates/ContentAreaEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea"],function(_1815,lang,_1816,_1817,on,topic,when,_1818,_1819,_181a,_181b,_181c,_181d,_181e,_181f,_1820,_1821,_1822,_1823,_1824,_1825,_1826,_1827,_1828,_1829,_182a,_182b,_182c,_182d,_182e,_182f,_1830,_1831){return _1815([_1819,_181a,_181c,_181b,_1825,_1822,_181e,_1828,_1821],{baseClass:"epi-content-area-editor",res:_1831,templateString:_1830,value:null,multiple:true,parent:null,overlayItem:null,model:null,intermediateChanges:true,editMode:"onpageedit",_preventOnBlur:false,_dndTarget:null,allowedTypes:null,restrictedTypes:null,constructor:function(){this.allowedDndTypes=[];},onChange:function(value){},_handleModelChange:function(value){this.validate();this.onChange(value);},_onBlur:function(){if(this._preventOnBlur){return;}this.inherited(arguments);},focus:function(){if(this.tree&&this.model.get("value").length>0){this._focusManager.focus(this.tree.domNode);}else{this.textWithLinks.focus();}},postMixInProperties:function(){this.inherited(arguments);this.commands=this._commands||[new _182a(),new _182f(),new _182e({category:null}),new _182d(),new _182b(),new _182c(),new _1829()];this.own(this.model=this.model||new _1823(),this.treeModel=this.treeModel||new _1820({model:this.model}),this.model.watch("selectedItem",lang.hitch(this,function(name,_1832,_1833){this.updateCommandModel(_1833);})),on(this.model,"changed",lang.hitch(this,function(){if(!this._started||this._supressValueChanged){return;}this._set("value",this.model.get("value"));this._handleModelChange(this.value);})));},buildRendering:function(){this.inherited(arguments);this.contextMenu=new _1824();this.contextMenu.addProvider(this);this.own(this.contextMenu);this.setupActionLinks(this.actionsContainer);this.own(this._dndTarget=new _181d(this.actionsContainer,{accept:this.allowedDndTypes,reject:this.restrictedDndTypes,isSource:false,alwaysCopy:false,insertNodes:function(){}}));this.own(_1816.after(this._dndTarget,"onDropData",lang.hitch(this,function(_1834,_1835,nodes,copy){var model=_1834[0].data;this.model.modify(lang.hitch(this,function(){this.model.addChild(model);}));if(!this.tree){this._createTree();}}),true));this.own(_1816.after(this._dndTarget,"onDrop",lang.hitch(this,"focus")));},postCreate:function(){this.inherited(arguments);this.set("emptyMessage",_1831.emptymessage);if(this.parent&&this.overlayItem){this.connect(this.parent,"onStartEdit",function(){this._selectFromOverlay(this.overlayItem.model);});}this.own(topic.subscribe("/dnd/start",lang.hitch(this,this._startDrag)));},startup:function(){if(this._started){return;}this.inherited(arguments);this.tree&&this.tree.startup();this.contextMenu.startup();},destroy:function(){this.tree&&this.tree.destroyRecursive();this.inherited(arguments);},isCreateLinkVisible:function(){return this.model.canCreateBlock(this.allowedTypes,this.restrictedTypes);},executeAction:function(_1836){if(_1836==="createnewblock"){this._preventOnBlur=true;this.validate(false);var _1837=new _1827({creatingTypeIdentifier:"episerver.core.blockdata",createAsLocalAsset:true,autoPublish:true,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes});_1837.set("model",{save:lang.hitch(this,function(block){this._preventOnBlur=false;var value=lang.clone(this.get("value"),true)||[];value.push(block);this.set("value",value);this.parent.set("editing",true);this.onChange(value);this.onBlur();}),cancel:lang.hitch(this,function(){this._preventOnBlur=false;this.onBlur();})});_1837.execute();}},isValid:function(_1838){return (this._preventOnBlur||!this.required||this.model.get("value").length>0);},_setReadOnlyAttr:function(_1839){this._set("readOnly",_1839);_1817.set(this.actionsContainer,"display",_1839?"none":"");if(this._source){this._source.isSource=!this.readOnly;}if(this.model){this.model.set("readOnly",_1839);}this.tree&&this.tree.set("readOnly",_1839);},_checkAcceptance:function(_183a,nodes){return this.readOnly?false:this._source.defaultCheckAcceptance(_183a,nodes);},_createTree:function(){this.tree=new _181f({accept:this.allowedDndTypes,reject:this.restrictedDndTypes,contextMenu:this.contextMenu,model:this.treeModel,readOnly:this.readOnly}).placeAt(this.domNode,"first");this.tree.own(_1816.after(this.tree.dndController,"onDndEnd",lang.hitch(this,"focus")));},_selectFromOverlay:function(_183b){var child=_183b&&_183b.selectedItem&&_183b.selectedItem.serialize(),model=this.model,path=["root"];if(!child){return;}if(child.contentGroup){model=model.getChild({name:child.contentGroup});path.push(model.id);}model=model.getChild(child);if(!model){return;}path.push(model.id);model.set("selected",true);model.set("ensurePersonalization",_183b.selectedItem.ensurePersonalization);this.tree&&this.tree.set("path",path);},_startDrag:function(_183c,nodes,copy){var _183d=_1818.getEnclosingWidget(nodes[0]);if(_183d.isInstanceOf(_1826)&&this.parent.cancel){this.parent.set("isModified",false);this.parent.cancel();}},_setValueAttr:function(value){this.tree&&this.tree.destroyRecursive();this._set("value",value||[]);this._supressValueChanged=true;this.model.set("value",value);this._supressValueChanged=false;this._createTree();}});});},"epi-cms/contentediting/editors/_ContentAreaTree":function(){define(["dojo/_base/declare","dojo/aspect","dojo/_base/event","dojo/_base/array","dojo/_base/lang","dojo/dom-class","dijit/registry","epi/dependency","epi/shell/conversion/ObjectConverterRegistry","epi/shell/dnd/tree/dndSource","epi/shell/TypeDescriptorManager","epi/shell/widget/Tree","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","./_BlockTreeNode","./_GroupTreeNode"],function(_183e,_183f,event,array,lang,_1840,_1841,_1842,_1843,_1844,_1845,Tree,_1846,_1847,_1848,_1849){return _183e([Tree],{showRoot:false,dndController:_1844,betweenThreshold:8,postMixInProperties:function(){this.inherited(arguments);this.accept.push("personalizationarea");},postCreate:function(){this.inherited(arguments);_1840.add(this.domNode,"epi-tree-mngr");this.own(_183f.after(this.dndController,"onDndItemRemoved",lang.hitch(this,function(_184a){if(_184a[0]&&_184a[0].data){this.model.deleteItem(_184a[0].data);}}),true));this.own(_183f.after(this,"_onItemChildrenChange",lang.hitch(this,function(_184b,_184c){array.forEach(_184c,function(child){var _184d=this._itemNodesMap[this.model.getIdentity(child)];if(child.expandOnAdd){this._expandNode(_184d[0]);}if(child.contentGroup&&child.ensurePersonalization&&child.hasAnyRoles&&!child.hasAnyRoles()){_184d[0].showPersonalizationSelector();}},this);}),true));},getTooltip:function(item){return item.label||"";},_setReadOnlyAttr:function(_184e){this._set("readOnly",_184e);if(this.dndController){this.dndController.isSource=!_184e;}},getItemType:function(item){if(!item.typeIdentifier){if(item.contentGroup!==undefined){return ["personalizationarea"];}else{return null;}}return this.accept;},checkItemAcceptance:function(_184f,_1850,_1851,copy){if(this.tree.readOnly){return false;}var _1852=_1841.getEnclosingWidget(_184f);var _1853=_1852.item;var _1854=true;_1850.forInSelectedItems(function(item){_1854=this.tree.model.checkItemAcceptance(_1853,item.data.item,_1851);},this);return _1854;},_onNodeMouseEnter:function(node){node.set("mouseHover",true);},_onNodeMouseLeave:function(node){node.set("mouseHover",false);},_createTreeNode:function(model){var node;if(model.item instanceof _1847){node=new _1849(model);}else{if(model.item instanceof _1846){node=new _1848(model);}else{node=this.inherited(arguments);}}node.set("contextMenu",this.contextMenu);node.set("dndData",model.item);return node;},onClick:function(item,node,e){if(node instanceof _1849){if(node.isExpanded){this._collapseNode(node);}else{this._expandNode(node);}}}});});},"epi-cms/contentediting/viewmodel/ContentBlockViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/promise/all","dojox/html/entities","epi","epi/dependency","./_ViewModelMixin","epi-cms/widget/viewmodel/ContentStatusViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1855,lang,when,all,_1856,epi,_1857,_1858,_1859,_185a){return _1855([_1859,_1858],{label:null,store:null,hasSiblings:true,isVisible:true,settings:{displayOptionsAttributeName:"data-epi-content-display-option",contentGroupAttributeName:"data-contentgroup"},roles:null,constructor:function(){this.roleIdentities=this.roleIdentities||[];this.attributes={};},postscript:function(){this.inherited(arguments);if(!this.store){var _185b=_1857.resolve("epi.storeregistry");this.store=_185b.get("epi.cms.visitorgroup");}this.set("label",this.name);this._reloadRoles();},serialize:function(){return {contentGroup:this.contentGroup,contentLink:this.contentLink,name:this.name,roleIdentities:this.roleIdentities,typeIdentifier:this.typeIdentifier,attributes:this.attributes};},equals:function(item){for(var prop in item){if(!epi.areEqual(this[prop],item[prop])){return false;}}return true;},isRoleSelected:function(_185c){if(!this.roleIdentities){return false;}return this.roleIdentities.indexOf(_185c)>-1;},hasAnyRoles:function(){if(!this.roleIdentities){return false;}return this.roleIdentities.length>0;},moveNext:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index+1);},this);},movePrevious:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index-1);},this);},moveOutsideGroup:function(){if(!this.contentGroup){return;}this.parent.modify(function(){this.parent.moveOutsideGroup(this);},this);},remove:function(){this.parent.modify(function(){this.parent.removeChild(this);},this);},personalize:function(){this.parent.modify(function(){this.parent.personalize(this);},this);},selectRole:function(_185d,_185e){var _185f=(this.roles||[]).map(function(role){return role.id;});var index=_185f.indexOf(_185d);if(index>=0){if(!_185e){_185f.splice(index,1);}}else{if(_185e){_185f.push(_185d);}}this.set("roleIdentities",_185f);},resetRoleIdentities:function(){this.set("visible",true);this.set("roleIdentities",null);},_displayOptionSetter:function(_1860){this.attributes[this.settings.displayOptionsAttributeName]=_1860;},_displayOptionGetter:function(){return this.attributes[this.settings.displayOptionsAttributeName];},_roleIdentitiesSetter:function(_1861){this.roleIdentities=_1861||[];this._reloadRoles();},_parentSetter:function(_1862){this.parent=_1862;this.set("contentGroup",this.parent.name);},_contentGroupSetter:function(_1863){if(_1863===undefined){_1863="";}this.contentGroup=_1863;this.attributes[this.settings.contentGroupAttributeName]=_1863;this._reloadRoles();},_reloadRoles:function(){var store=this.store;if(!store){return;}var _1864=all(this.roleIdentities.map(function(id){return when(store.get(id)).otherwise(function(){console.warn("Could not load visitor group with id: "+id);});}));_1864.then(lang.hitch(this,"set","roles"));return _1864;},_hasSiblingsSetter:function(_1865){this.hasSiblings=_1865;this._updateRolesString();},_selectedSetter:function(_1866){this.selected=_1866;if(_1866){this.emit("selected",this);}},_updateRolesString:function(){if(!this.contentGroup||this.roles===null){this.set("rolesString","");return;}if(!this.hasAnyRoles()){if(this.hasSiblings){this.set("rolesString",_185a.everyoneelsesee);}else{this.set("rolesString",_185a.everyonesees);}return;}if(!this.roles.length){this.set("rolesString",_185a.groupcannotsees);return;}var _1867=this.roles.map(function(r){return "<em>"+_1856.encode(r.name)+"</em>";}).sort().join(", ");var names=_1867.replace(/, (?=[^,]+$)/," "+_185a.groupsand);var _1868="";if(this.roles.length>1){_1868=lang.replace(_185a.groupssee,{groupNames:names});}else{_1868=lang.replace(_185a.groupsees,{groupName:names});}this.set("rolesString",_1868);},_rolesSetter:function(roles){this.roles=roles.filter(function(role){return !!role;});this._updateRolesString();}});});},"epi-cms/contentediting/viewmodel/_ViewModelMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","dojo/Evented","dijit/Destroyable"],function(array,_1869,_186a,_186b,_186c){return _1869([_186a,_186b,_186c],{modify:function(_186d,scope,_186e){this._isBeingModified=true;if(scope){_186d.apply(scope);}else{_186d();}this._isBeingModified=false;if(_186e||_186e===undefined){this.emit("changed");}},emit:function(type,event){if(type==="changed"&&this._isBeingModified){return;}this.inherited(arguments);}});});},"epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/_ContainerViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(array,_186f,lang,_1870,_1871){return _186f([_1870],{name:null,label:_1871.grouplabel,addChild:function(child,index){this.inherited(arguments,[child,index||0]);this._handles[child.id]=[child.on("selected",lang.hitch(this,"emit","selected",child)),child.on("changed",lang.hitch(this,"emit","changed"))];},serialize:function(){return array.map(this.getChildren(),function(child){return child.serialize();});},equals:function(item){return this.name===item.name;},moveNext:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index+1);},this);},moveOutsideGroup:function(child){this.parent.moveOutsideGroup(child);},movePrevious:function(){var index=this.parent.indexOf(this);this.parent.modify(function(){this.parent.move(this,index-1);},this);},remove:function(){this.parent.modify(lang.hitch(this,function(){this.parent.removeChild(this);}));},_hash:function(child){return child.contentLink+"_"+Date.now();},_selectedSetter:function(_1872){this.selected=_1872;if(_1872){this.emit("selected",this);}},_visibleGetter:function(){return array.some(this._data,function(item){return item.get("visible");});}});});},"epi-cms/contentediting/viewmodel/_ContainerViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","./_ViewModelMixin"],function(array,_1873,_1874){return _1873([_1874],{constructor:function(){this._data=[];this._handles={};},addChild:function(child,index){child.set("parent",this);child.set("readOnly",this.readOnly);if(!child.id){child.id=this._hash(child);}if(typeof index=="number"){this._data.splice(index,0,child);}else{this._data.push(child);}this._emitChildrenChanged();},getChild:function(item){var _1875=this._data;for(var i=_1875.length-1;i>=0;i--){if(_1875[i].equals(item)){return _1875[i];}}return null;},getChildById:function(id){var _1876=this._data;for(var i=_1876.length-1;i>=0;i--){if(_1876[i].id===id){return _1876[i];}}return null;},getChildByIndex:function(index){return this._data[index];},getChildren:function(){return this._data;},removeChild:function(child,_1877){var index=this.indexOf(child),_1878=this._handles[child.id];if(index<0&&_1877){array.forEach(this.getChildren(),function(item){if(typeof item.removeChild==="function"){item.removeChild(child,_1877);}});return;}else{if(index<0){return;}}if(_1878){array.forEach(_1878,function(_1879){_1879.remove();});delete this._handles[child.id];}this._data.splice(index,1);this._emitChildrenChanged();},move:function(child,index){var _187a=this.indexOf(child);this._data.splice(_187a,1);this._data.splice(index,0,child);this._emitChildrenChanged();},indexOf:function(child){return this._data.indexOf(child);},_hash:function(child){},_readOnlySetter:function(_187b){this.readOnly=_187b;array.forEach(this.getChildren(),function(child){child.set("readOnly",_187b);},this);},_emitChildrenChanged:function(_187c){var _187d=this._data.length;array.forEach(this._data,function(child,index){child.set("canMoveNext",index<(_187d-1));child.set("canMovePrevious",index>0&&index<=(_187d-1));child.set("hasSiblings",_187d>1);});this.set("count",_187d||0);this.emit("childrenChanged",_187c?_187c:this);}});});},"epi-cms/contentediting/editors/_BlockTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/dom-class","dijit/Tree","dijit/focus","dijit/_HasDropDown","epi-cms/widget/PersonalizationSelector","epi-cms/dgrid/formatters","./_ContentAreaTreeNodeMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize","dojo/text!./templates/_BlockTreeNode.html"],function(_187e,lang,keys,_187f,Tree,_1880,_1881,_1882,_1883,_1884,_1885,_1886,_1887){return _187e([Tree._TreeNode,_1884,_1881],{templateString:_1887,_contextMenuClass:"epi-iconContextMenu",isExpandable:false,dropDownPosition:["before"],resources:lang.mixin(_1885,_1886),buildRendering:function(){this.inherited(arguments);this.dropDown=new _1882({model:this.item});this.own(this.dropDown);this.aroundNode=this.domNode;this.set("readOnly",this.item.readOnly);_187f.add(this.domNode,"epi-tree-mngr--block");var node=this.rolesNode;var icon=_1883.contentIcon(this.item.typeIdentifier);_187f.add(this.iconNode,icon);node.innerHTML=this.item.get("rolesString");this.own(this.item.watch("rolesString",lang.hitch(this,function(_1888,_1889,_188a){node.innerHTML=_188a;})));this.own(this.item.watch("readOnly",lang.hitch(this,function(){this.set("readOnly",this.item.readOnly);})));},setSelected:function(_188b,_188c){this.inherited(arguments);this.item.set("selected",_188b);_187f.toggle(this.iconNodeMenu,this._contextMenuClass,_188b);},showPersonalizationSelector:function(){if(this.readOnly){return;}this.item.set("ensurePersonalization",false);_1880.focus(this.labelNode);this.loadAndOpenDropDown();},focus:function(){this.labelNode.focus();},_onKey:function(e){if(this.dropDown&&this._opened&&e.keyCode===keys.ESCAPE){this.closeDropDown();}},_onKeyUp:function(){}});});},"epi-cms/widget/PersonalizationSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/when","dojox/html/entities","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/CheckedMenuItem","epi/dependency","epi/shell/_StatefulGetterSetterMixin","dojo/text!./templates/PersonalizationSelector.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize","dijit/Menu","epi/shell/widget/RadioMenuItem"],function(array,_188d,lang,_188e,when,_188f,_1890,_1891,_1892,_1893,_1894,_1895,_1896,_1897){return _188d([_1890,_1891,_1892],{templateString:_1896,model:null,resources:_1897,postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _1898=_1894.resolve("epi.storeregistry");this.store=_1898.get("epi.cms.visitorgroup");}},postCreate:function(){this.inherited(arguments);this.own(this.rdEveryone.on("change",lang.hitch(this,"restoreDefault")),this.model.watch("roleIdentities",lang.hitch(this,function(){if(!this.rdEveryone.checked&&this.model.roleIdentities&&this.model.roleIdentities.length===0){this.restoreDefault();}})));when(this.store.query(),lang.hitch(this,function(_1899){if(!this._destroyed){this.set("visitorGroups",_1899);}}));},restoreDefault:function(){array.forEach(this.visitorGroupsMenu.getChildren(),function(item){item.set("checked",false);});this.rdEveryone.set("checked",true);this.model.set("roleIdentities",null);},_setVisitorGroupsAttr:function(_189a){this._set("visitorGroups",_189a);if(!this.model.hasAnyRoles()){this.rdEveryone.set("checked",true);}array.forEach(_189a,function(group){var item=new _1893({label:_188f.encode(group.name),visitorgroupId:group.id,checked:this.model.isRoleSelected(group.id)});this.own(item.watch("checked",lang.hitch(this,function(_189b,_189c,_189d){this.model.selectRole(group.id,_189d);this.rdEveryone.set("checked",!this.model.hasAnyRoles());})));this.visitorGroupsMenu.addChild(item);},this);}});});},"url:epi-cms/widget/templates/PersonalizationSelector.html":"<div>\n    <div class=\"epi-dijitTooltipContainer\">\n        <div class=\"epi-invertedTooltip\">\n            <div class=\"epi-tooltipDialogTop\">\n                <span data-dojo-attach-point=\"header\">${resources.whocansee}</span>\n                <div data-dojo-attach-point=\"lastPublishedIcon\" class=\"dijitTooltipConnector\"></div>\n            </div>\n        </div>\n        <div class=\"epi-tooltipDialogContent--max-height\">\n            <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"visitorGroupsMenu\" style=\"width:100%\"></div>\n            <div class=\"epi-menuSeparator\" tabindex=\"-1\"></div>\n            <div data-dojo-type=\"dijit/Menu\" data-dojo-attach-point=\"filterOptionsMenu\" style=\"width:100%\">\n                <div data-dojo-attach-point=\"rdEveryone\" data-dojo-type=\"epi/shell/widget/RadioMenuItem\" data-dojo-props=\"label:'${resources.everyone}', value: ''\"></div>\n            </div>\n        </div>\n    </div>\n</div>","epi/shell/widget/RadioMenuItem":function(){require({cache:{"url:epi/shell/widget/templates/RadioMenuItem.htm":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemradio\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\"><span class=\"dijitInline dijitReset dijitIcon\" data-dojo-attach-point=\"labelIconNode\"></span> <span data-dojo-attach-point=\"containerNode, labelNode\"></span></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>"}});define("epi/shell/widget/RadioMenuItem",["dojo/_base/declare","dojo/_base/array","dojo/dom-class","dijit/CheckedMenuItem","dojo/text!./templates/RadioMenuItem.htm"],function(_189e,array,_189f,_18a0,_18a1){return _189e([_18a0],{baseClass:"dijitMenuItem epi-radioMenuItem",iconClass:null,templateString:_18a1,_onClick:function(e){this._resetState();this.inherited(arguments);},_resetState:function(){array.forEach(this._getChildren(),function(child,index){child.set("checked",false);});},_getChildren:function(){return this.getParent().getChildren();},_setIconClassAttr:function(_18a2){this._set("iconClass",_18a2);_189f.add(this.labelIconNode,_18a2);}});});},"url:epi/shell/widget/templates/RadioMenuItem.htm":"<tr class=\"dijitReset dijitMenuItem\" data-dojo-attach-point=\"focusNode\" role=\"menuitemradio\" tabIndex=\"-1\">\n\t<td class=\"dijitReset dijitMenuItemIconCell\" role=\"presentation\">\n\t\t<img src=\"${_blankGif}\" alt=\"\" class=\"dijitMenuItemIcon dijitCheckedMenuItemIcon\" data-dojo-attach-point=\"iconNode\"/>\n\t\t<span class=\"dijitCheckedMenuItemIconChar\">&#10003;</span>\n\t</td>\n\t<td class=\"dijitReset dijitMenuItemLabel\" colspan=\"2\"><span class=\"dijitInline dijitReset dijitIcon\" data-dojo-attach-point=\"labelIconNode\"></span> <span data-dojo-attach-point=\"containerNode, labelNode\"></span></td>\n\t<td class=\"dijitReset dijitMenuItemAccelKey\" style=\"display: none\" data-dojo-attach-point=\"accelKeyNode\"></td>\n\t<td class=\"dijitReset dijitMenuArrowCell\" role=\"presentation\">&#160;</td>\n</tr>","epi-cms/contentediting/editors/_ContentAreaTreeNodeMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/focus","dojo/_base/event","dojo/dom-class"],function(_18a3,lang,on,_18a4,event,_18a5){return _18a3([],{destroy:function(){this._unBindContextMenu();this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.own(on(this.iconNodeMenu,"click",lang.hitch(this.labelNode,this.labelNode.focus)));},_unBindContextMenu:function(){if(this.contextMenu){this.contextMenu.unBindDomNode(this.iconNodeMenu);}},_setContextMenuAttr:function(_18a6){this._unBindContextMenu();this._set("contextMenu",_18a6);this.contextMenu.bindDomNode(this.iconNodeMenu);},_setMouseHoverAttr:function(hover){this._set("hover",hover);if(this.item.get("selected")){return;}_18a5.toggle(this.iconNodeMenu,this._contextMenuClass,this.hover);}});});},"url:epi-cms/contentediting/editors/templates/_BlockTreeNode.html":"<div class=\"dijitTreeNode\" role=\"presentation\">\n    <div class=\"epi-tree-mngr--node-wrapper\" data-dojo-attach-point=\"rowNode\">\n        <span data-dojo-attach-point=\"rolesNode, _buttonNode\" class=\"epi-tree-mngr--view-settings\"></span>\n        <div class=\"dijitTreeRow dijitInline\" role=\"presentation\">\n            <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\"></span>\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\n                <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\n                    <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" title=\"${resources.settingstooltip}\" role=\"presentation\">&nbsp;</span>\n                </span>\n                <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"/>\n                <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\n\n            </span>\n        </div>\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\n    </div>\n</div>\n","epi-cms/contentediting/editors/_GroupTreeNode":function(){define(["dojo/aspect","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit/Tree","./_ContentAreaTreeNodeMixin","dojo/text!./templates/_GroupTreeNode.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea"],function(_18a7,array,_18a8,lang,_18a9,_18aa,Tree,_18ab,_18ac,_18ad){return _18a8([Tree._TreeNode,_18ab],{templateString:_18ac,_contextMenuClass:"epi-iconContextMenu",resources:_18ad,buildRendering:function(){this.inherited(arguments);_18a9.remove(this.iconNode,"dijitFolderClosed");this.own(_18a7.after(this,"expand",lang.hitch(this,function(_18ae){_18ae.then(lang.hitch(this,function(){if(this._destroyed){return;}_18a9.add(this.domNode,"epi-treeNodeOpen");array.forEach(this.getChildren(),function(_18af){var child=_18af.item;if(child.contentGroup&&child.ensurePersonalization&&child.hasAnyRoles&&!child.hasAnyRoles()){child.set("ensurePersonalization",false);_18af.showPersonalizationSelector();}},this);}));return _18ae;})));this.own(_18a7.after(this,"collapse",lang.hitch(this,function(_18b0){_18b0.then(lang.hitch(this,function(){_18a9.remove(this.domNode,"epi-treeNodeOpen");}));return _18b0;})));this.own(this.item.watch("readOnly",lang.hitch(this,function(){this._toggleDropMoreMessageNode();})));},postCreate:function(){this.inherited(arguments);this.own(this.item.watch("count",lang.hitch(this,function(_18b1,_18b2,_18b3){this.set("count",_18b3);})));if(this.item){this.set("count",this.item.count);}},setSelected:function(_18b4){this.inherited(arguments);this.item.set("selected",_18b4);_18a9.remove(this.rowNode,"dijitTreeRowSelected");_18a9.toggle(this.domNode,"dijitTreeRowSelected",_18b4);},_setCountAttr:function(count){this._set("count",count);this._toggleDropMoreMessageNode();},_toggleDropMoreMessageNode:function(){_18aa.set(this.dropMoreMessageNode,"display",!this.item.readOnly&&this.count===1?"":"none");}});});},"url:epi-cms/contentediting/editors/templates/_GroupTreeNode.html":"<div class=\"dijitTreeNode epi-tree-mngr--group\" role=\"presentation\" data-dojo-attach-point=\"rowNode\">\n    <div class=\"dijitTreeRow dijitInline epi-tree-mngr--group-header\" role=\"presentation\">\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\n        <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"/>\n        <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-extraIconsContainer\" role=\"presentation\">\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-extraIcon epi-pt-contextMenu\" role=\"presentation\">&nbsp;</span>\n            </span>\n            <img src=\"${_blankGif}\" alt=\"\" data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon epi-iconUsers\" role=\"presentation\"/>\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel\" role=\"treeitem\" tabindex=\"-1\" aria-selected=\"false\"></span>\n        </span>\n    </div>\n    <hr />\n    <span data-dojo-attach-point=\"dropMoreMessageNode\" class=\"epi-tip epi-tip--block\">${resources.groupdropmoremessage}</span>\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\n</div>\n","epi-cms/contentediting/editors/_ContentAreaTreeModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/tree/model","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel"],function(array,_18b5,lang,_18b6,_18b7,_18b8){return _18b5([_18b6],{model:null,root:{id:"root",name:"root"},constructor:function(_18b9){_18b5.safeMixin(this,_18b9);},pasteItem:function(_18ba,_18bb,_18bc,bCopy,_18bd,_18be){var _18bf=_18bb.id==="root"?this.model:this.model.getChildById(_18bb.id);var child=_18bf.getChildById(_18ba.id);var _18c0=_18bc.id==="root"?this.model:this.model.getChildById(_18bc.id);if(child instanceof _18b7&&!child.hasAnyRoles()){child.set("ensurePersonalization",true);}if(_18bf===_18c0){this.model.modify(function(){_18c0.move(child,_18bd);});return;}this.model.modify(function(){_18bf.removeChild(child);_18c0.addChild(child,_18bd);});},deleteItem:function(item){this.model.modify(lang.hitch(this,function(){this.model.removeChild(item,true);}));},newItem:function(args,_18c1,_18c2,_18c3){if(args.dndData&&args.dndData.data){var _18c4=_18c1.id==="root"?this.model:this.model.getChildById(_18c1.id);var item=args.dndData.data;if(!(item instanceof _18b7)&&!(item instanceof _18b8)){item=new _18b7(item);}item.set("ensurePersonalization",true);this.model.modify(function(){_18c4.addChild(item,_18c2);});}},checkItemAcceptance:function(_18c5,item,_18c6){if(_18c6==="over"){if(!(_18c5 instanceof _18b8)){return false;}if(!(item instanceof _18b7)){return false;}}if(_18c5 instanceof _18b7&&item instanceof _18b8&&_18c5.contentGroup){return false;}return true;},getRoot:function(_18c7){_18c7(this.root);},getLabel:function(item){return item.label;},mayHaveChildren:function(item){if(typeof item.getChildren=="function"||item.id==="root"){return true;}return false;},getIdentity:function(item){return item.id;},getChildren:function(_18c8,_18c9){var _18ca;if(_18c8.id==="root"){_18ca=this.model.getChildren();_18c9(_18ca);this.model.on("childrenChanged",lang.hitch(this,function(index,_18cb,adds){this.onChildrenChange(this.root,this.model.getChildren());}));}else{var model=this.model.getChildById(_18c8.id);if(model&&typeof model.getChildren=="function"){_18ca=model.getChildren();_18c9(_18ca);model.on("childrenChanged",lang.hitch(this,function(index,_18cc,adds){this.onChildrenChange(_18c8,model.getChildren());}));}else{_18c9([]);}}}});});},"dijit/tree/model":function(){define("dijit/tree/model",["dojo/_base/declare"],function(_18cd){return _18cd("dijit.tree.model",null,{destroy:function(){},getRoot:function(_18ce){},mayHaveChildren:function(item){},getChildren:function(_18cf,_18d0){},isItem:function(_18d1){},fetchItemByIdentity:function(_18d2){},getIdentity:function(item){},getLabel:function(item){},newItem:function(args,_18d3,_18d4,_18d5){},pasteItem:function(_18d6,_18d7,_18d8,bCopy,_18d9,_18da){},onChange:function(item){},onChildrenChange:function(_18db,_18dc){}});});},"epi-cms/contentediting/editors/_TextWithActionLinksMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","dojo/when","epi/shell/widget/TextWithActionLinks","epi/i18n!epi/cms/nls/episerver.cms.widget.overlay.blockarea"],function(_18dd,lang,_18de,on,when,_18df,_18e0){return _18dd(null,{textWithLinks:null,actionsResource:_18e0,isCreateLinkVisible:function(){return true;},getTemplateString:function(){var _18e1=new _18de();var _18e2=this.actionsResource.emptyactions;when(this.isCreateLinkVisible(),function(_18e3){var _18e4=_18e3?_18e2.template:_18e2.templatewithoutcreate;_18e1.resolve({templateString:_18e4,actions:_18e2.actions});});return _18e1.promise;},setupActionLinks:function(_18e5){when(this.getTemplateString(),lang.hitch(this,function(_18e6){if(!_18e6){return;}this.textWithLinks=new _18df({contentString:_18e6.templateString,namedActions:_18e6.actions});this.own(on(this.textWithLinks,"onActionClick",lang.hitch(this,this.executeAction)));if(_18e5){this.textWithLinks.placeAt(_18e5);}}));},executeAction:function(_18e7){}});});},"epi/shell/widget/TextWithActionLinks":function(){define("epi/shell/widget/TextWithActionLinks",["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/Evented","dojo/on","dojo/query","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/focus","dojox/html/entities"],function(array,_18e8,event,lang,_18e9,on,query,_18ea,_18eb,_18ec,_18ed){return _18e8([_18ea,_18eb,_18e9],{tagName:"span",templateString:"<{0}>{1}</{0}>",contentString:"",namedActions:null,_actionMap:null,_eventHandlers:null,postMixInProperties:function(){this.inherited(arguments);this._actionMap=[];this._eventHandlers=[];var _18ee={};var _18ef=this.contentString;var _18f0;var id=0;if(this.namedActions){for(var _18f1 in this.namedActions){_18f0=_18ed.encode(this.namedActions[_18f1]);_18ee[_18f1]="<a class=\"epi-visibleLink\" href=\"#\" data-dojo-attach-point=\"action"+(id++)+"\">"+_18f0+"</a>";this._actionMap.push(_18f1);}_18ef=lang.replace(_18ef,_18ee);}this.templateString=lang.replace(this.templateString,[this.tagName,_18ef]);},postCreate:function(){this.inherited(arguments);array.forEach(this._actionMap,function(_18f2,id){var link=this["action"+id];if(link){var _18f3=on(link,"click",(function(_18f4,_18f5){return function(evt){event.stop(evt);_18f4.emit("onActionClick",_18f5);};})(this,_18f2));this._eventHandlers.push(_18f3);}},this);},destroy:function(){array.forEach(this._eventHandlers,function(_18f6){_18f6.remove();},this);this._eventHandlers=null;this.inherited(arguments);},focus:function(){var links=query("a",this.domNode);if(links.length>0){_18ec.focus(links[0]);}}});});},"epi-cms/contentediting/viewmodel/ContentAreaViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/when","dojox/uuid/generateRandomUuid","epi/dependency","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/viewmodel/_ContainerViewModel","epi-cms/_ContentContextMixin"],function(array,_18f7,lang,all,when,_18f8,_18f9,_18fa,_18fb,_18fc,_18fd,_18fe){return _18f7([_18fd,_18fe],{selectedItem:null,postscript:function(){this.inherited(arguments);this.contentTypeService=this.contentTypeService||_18f9.resolve("epi.cms.ContentTypeService");if(!this._contentTypeStore){var _18ff=_18f9.resolve("epi.storeregistry");this._contentTypeStore=_18ff.get("epi.cms.contenttype");}},addChild:function(child){if(!(child instanceof _18fa)&&!(child instanceof _18fb)){var model=new _18fa(child);this.own(model.watch("roleIdentities",lang.hitch(this,function(){this.emit("changed");})));if(model.contentGroup){child=this._groups[model.contentGroup];if(!child){child=this._createGroup(model.contentGroup);}child.addChild(model);}else{child=model;}}else{child.set("contentGroup",null);if(child instanceof _18fb){this.own(child.on("childrenChanged",lang.hitch(this,function(){this._emitChildrenChanged(child);if(child.getChildren().length===0){this.removeChild(child);}})));}else{if(child instanceof _18fa){child.resetRoleIdentities();this.own(child.watch("roleIdentities",lang.hitch(this,function(){this.emit("changed");})));}}}this.own(child.on("changed",lang.hitch(this,function(){this.emit("changed");})));this.inherited(arguments);this._handles[child.id]=child.on("selected",lang.hitch(this,"set","selectedItem"));},canCreateBlock:function(_1900,_1901){var _1902=this.contentTypeService;return all([this.getCurrentContext(),this.getCurrentContent()]).then(function(_1903){var _1904=_1903[0],_1905=_1903[1];if(!_1904||!_1905){return false;}var _1906=_18fc.isActionAvailable(_1905,_18fc.action.Create,_18fc.providerCapabilities.Create,true);if(!_1906||!_1904.capabilities.resourceable||_1904.currentMode==="create"||_1904.currentMode==="translate"){return false;}return when(_1902.getAcceptedChildTypes(_1905.contentLink,true,["episerver.core.blockdata"],_1900,_1901)).then(function(_1907){return !!_1907.length;});});},moveVisible:function(child,_1908){var _1909=array.filter(this.getChildren(),function(item){return item.get("visible");}),delta=_1908?1:-1,_190a=array.indexOf(_1909,child)+delta,index=this.indexOf(_1909[_190a]);this.modify(lang.hitch(this,function(){this.move(child,index);}));},moveOutsideGroup:function(child){if(!child.contentGroup){return;}var group=this.getChild({name:child.contentGroup}),index=this.indexOf(group);this.modify(lang.hitch(this,function(){group.removeChild(child);this.addChild(child,index);}));},personalize:function(child){var index=this.indexOf(child);this.removeChild(child);var group=new _18fb({name:"group_"+Date.now(),expandOnAdd:true});child.set("ensurePersonalization",true);group.addChild(child);this.addChild(group,index);},_valueGetter:function(){var value=[];array.forEach(this.getChildren(),function(child){value=value.concat(child.serialize());});return value;},_valueSetter:function(value){this._transformValueToModels(value);},_selectedItemSetter:function(value){if(this.selectedItem){this.selectedItem.set("selected",false);}this.selectedItem=value;},_transformValueToModels:function(value){this.modify(function(){var _190b=this.getChildren();for(var i=_190b.length-1;i>=0;i--){this.removeChild(_190b[i]);}this._groups={};array.forEach(value,function(child){var model=new _18fa(child);this.own(model.watch("roleIdentities",lang.hitch(this,function(){this.emit("changed");})));if(model.contentGroup){var group=this._groups[model.contentGroup];if(!group){group=this._createGroup(model.contentGroup);this.addChild(group);}group.addChild(model,group.getChildren().length);}else{this.addChild(model);}},this);},this,false);},_createGroup:function(name){var group=new _18fb({name:name});this._groups[name]=group;return group;},_hash:function(child){return (child.contentLink||child.name)+"_"+_18f8();}});});},"dojox/uuid/generateRandomUuid":function(){define("dojox/uuid/generateRandomUuid",["./_base"],function(){dojox.uuid.generateRandomUuid=function(){var _190c=16;function _190d(){var _190e=Math.floor((Math.random()%1)*Math.pow(2,32));var _190f=_190e.toString(_190c);while(_190f.length<8){_190f="0"+_190f;}return _190f;};var _1910="-";var _1911="4";var _1912="8";var a=_190d();var b=_190d();b=b.substring(0,4)+_1910+_1911+b.substring(5,8);var c=_190d();c=_1912+c.substring(1,4)+_1910+c.substring(4,8);var d=_190d();var _1913=a+_1910+b+_1910+c+d;_1913=_1913.toLowerCase();return _1913;};return dojox.uuid.generateRandomUuid;});},"dojox/uuid/_base":function(){define("dojox/uuid/_base",["dojo/_base/kernel","dojo/_base/lang"],function(dojo){dojo.getObject("uuid",true,dojox);dojox.uuid.NIL_UUID="00000000-0000-0000-0000-000000000000";dojox.uuid.version={UNKNOWN:0,TIME_BASED:1,DCE_SECURITY:2,NAME_BASED_MD5:3,RANDOM:4,NAME_BASED_SHA1:5};dojox.uuid.variant={NCS:"0",DCE:"10",MICROSOFT:"110",UNKNOWN:"111"};dojox.uuid.assert=function(_1914,_1915){if(!_1914){if(!_1915){_1915="An assert statement failed.\n"+"The method dojox.uuid.assert() was called with a 'false' value.\n";}throw new Error(_1915);}};dojox.uuid.generateNilUuid=function(){return dojox.uuid.NIL_UUID;};dojox.uuid.isValid=function(_1916){_1916=_1916.toString();var valid=(dojo.isString(_1916)&&(_1916.length==36)&&(_1916==_1916.toLowerCase()));if(valid){var _1917=_1916.split("-");valid=((_1917.length==5)&&(_1917[0].length==8)&&(_1917[1].length==4)&&(_1917[2].length==4)&&(_1917[3].length==4)&&(_1917[4].length==12));var _1918=16;for(var i in _1917){var part=_1917[i];var _1919=parseInt(part,_1918);valid=valid&&isFinite(_1919);}}return valid;};dojox.uuid.getVariant=function(_191a){if(!dojox.uuid._ourVariantLookupTable){var _191b=dojox.uuid.variant;var _191c=[];_191c[0]=_191b.NCS;_191c[1]=_191b.NCS;_191c[2]=_191b.NCS;_191c[3]=_191b.NCS;_191c[4]=_191b.NCS;_191c[5]=_191b.NCS;_191c[6]=_191b.NCS;_191c[7]=_191b.NCS;_191c[8]=_191b.DCE;_191c[9]=_191b.DCE;_191c[10]=_191b.DCE;_191c[11]=_191b.DCE;_191c[12]=_191b.MICROSOFT;_191c[13]=_191b.MICROSOFT;_191c[14]=_191b.UNKNOWN;_191c[15]=_191b.UNKNOWN;dojox.uuid._ourVariantLookupTable=_191c;}_191a=_191a.toString();var _191d=_191a.charAt(19);var _191e=16;var _191f=parseInt(_191d,_191e);dojox.uuid.assert((_191f>=0)&&(_191f<=16));return dojox.uuid._ourVariantLookupTable[_191f];};dojox.uuid.getVersion=function(_1920){var _1921="dojox.uuid.getVersion() was not passed a DCE Variant UUID.";dojox.uuid.assert(dojox.uuid.getVariant(_1920)==dojox.uuid.variant.DCE,_1921);_1920=_1920.toString();var _1922=_1920.charAt(14);var _1923=16;var _1924=parseInt(_1922,_1923);return _1924;};dojox.uuid.getNode=function(_1925){var _1926="dojox.uuid.getNode() was not passed a TIME_BASED UUID.";dojox.uuid.assert(dojox.uuid.getVersion(_1925)==dojox.uuid.version.TIME_BASED,_1926);_1925=_1925.toString();var _1927=_1925.split("-");var _1928=_1927[4];return _1928;};dojox.uuid.getTimestamp=function(_1929,_192a){var _192b="dojox.uuid.getTimestamp() was not passed a TIME_BASED UUID.";dojox.uuid.assert(dojox.uuid.getVersion(_1929)==dojox.uuid.version.TIME_BASED,_192b);_1929=_1929.toString();if(!_192a){_192a=null;}switch(_192a){case "string":case String:return dojox.uuid.getTimestamp(_1929,Date).toUTCString();break;case "hex":var _192c=_1929.split("-");var _192d=_192c[0];var _192e=_192c[1];var _192f=_192c[2];_192f=_192f.slice(1);var _1930=_192f+_192e+_192d;dojox.uuid.assert(_1930.length==15);return _1930;break;case null:case "date":case Date:var _1931=3394248;var _1932=16;var _1933=_1929.split("-");var _1934=parseInt(_1933[0],_1932);var _1935=parseInt(_1933[1],_1932);var _1936=parseInt(_1933[2],_1932);var _1937=_1936&4095;_1937<<=16;_1937+=_1935;_1937*=4294967296;_1937+=_1934;var _1938=_1937/10000;var _1939=60*60;var _193a=_1931;var _193b=_193a*_1939;var _193c=_193b*1000;var _193d=_1938-_193c;var _193e=new Date(_193d);return _193e;break;default:dojox.uuid.assert(false,"dojox.uuid.getTimestamp was not passed a valid returnType: "+_192a);break;}};return dojox.uuid;});},"epi-cms/widget/overlay/Block":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/on","dojo/when","epi/shell/widget/overlay/_Base","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi-cms/widget/overlay/_OverlayItemInfoMixin","epi-cms/contentediting/command/ContentAreaCommands","epi-cms/ContentLanguageHelper","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","dojo/text!../templates/Block.html","dijit/form/DropDownButton","epi/shell/widget/ContextMenu"],function(_193f,event,lang,_1940,_1941,on,when,_1942,_1943,_1944,_1945,_1946,_1947,_1948,_1949){return _193f([_1942,_1943,_1944,_1945],{templateString:_1949,res:_1948,_setMissingRendererAttr:function(value){_1940.toggle(this.domNode,"epi-overlay-item-missing-renderer",value);},buildRendering:function(){this.inherited(arguments);_1941.set(this.personalizedIcon,"display",this.viewModel.contentGroup?"":"none");},postCreate:function(){this.inherited(arguments);this._injectDynamicStyles();this.commandProvider=this.commandProvider||new _1946({model:this.viewModel});this.own(this.viewModel.watch("statusMessage",lang.hitch(this,function(_194a,_194b,_194c){when(_1947.getMissingLanguageMessage(this.viewModel.content),lang.hitch(this,function(_194d){_1941.set(this.warningIcon,"display",_194d?"":"none");}));_1941.set(this.iconsContainer,"display",this.viewModel.contentGroup||_194c?"":"none");})));this.viewModel.loadStatus();this.contextMenu.addProvider(this.commandProvider);if(this.blockInfo&&this.blockInfo.missingrenderer){this.set("missingRenderer",this.blockInfo.missingrenderer);}this.own(on(this.domNode,"click",lang.hitch(this.viewModel,"set","selected",true)),on(this.settingsButton,"click",lang.hitch(this,"_onContextMenuClick")),on(this.domNode,"mouseout",lang.hitch(this,function(e){if(this.contextMenu&&this.contextMenu.isShowingNow){event.stop(e);}})));},_injectDynamicStyles:function(){var node=this.sourceItemNode,_194e=_1941.get(node,"display"),_194f=/inline|inline-block/.test(_194e)?"-inline":"";_1940.add(node,"epi-injected-minSize"+_194f);},_onContextMenuClick:function(){this.commandProvider.set("model",this.viewModel);this.viewModel.set("selected",true);return false;}});});},"epi-cms/widget/overlay/_OverlayItemInfoMixin":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/on","dojo/when","dojo/mouse","epi/shell/TypeDescriptorManager","epi/shell/widget/overlay/OverlayItemInfo","epi-cms/widget/viewmodel/ContentStatusViewModel"],function(_1950,lang,_1951,on,when,mouse,_1952,_1953,_1954){return _1950(null,{disableTooltip:false,useIconOnBlock:false,postCreate:function(){this.own(this.viewModel.watch("contentStatus",lang.hitch(this,"_setupIcon")));this.own(this.viewModel.watch("statusMessage",lang.hitch(this,function(_1955,_1956,_1957){this.set("statusMessage",_1957);})));this.subscribe("/dnd/start",lang.hitch(this,function(){if(!this.disableTooltip){this._set("disableTooltip",true);this._showStatusMessage(false);}}));this.subscribe("/dnd/cancel",lang.hitch(this,function(){this._set("disableTooltip",false);}));this.subscribe("/dnd/drop",lang.hitch(this,function(){this._set("disableTooltip",false);}));var node=this.get("containerDomNode");if(node){this.own(on(node,mouse.enter,lang.hitch(this,function(){this._showStatusMessage(!this.get("disableTooltip"));})));this.own(on(node,mouse.leave,lang.hitch(this,function(){this._showStatusMessage(false);})));}this.inherited(arguments);},destroy:function(){if(this._overlayItemInfo){this._overlayItemInfo.destroyRecursive();this._overlayItemInfo=null;}this.inherited(arguments);},_setStatusIconAttr:function(_1958){var _1959=this.get("overlayItemInfo");if(!_1959){return;}_1959.set("statusIcon",_1958);},_setStatusMessageAttr:function(_195a){var _195b=this.get("overlayItemInfo");if(!_195b){return;}_195b.set("statusMessage",_195a);},_getContainerDomNodeAttr:function(){return this.containerDomNode||this.domNode;},_getOverlayItemInfoAttr:function(){if(!this._overlayItemInfo){this._overlayItemInfo=new _1953();_1951.place(this._overlayItemInfo.domNode,this.get("containerDomNode"));}return this._overlayItemInfo;},_setupIcon:function(){var _195c,_195d,_195e,_195f;_195c=this.get("overlayItemInfo");_195c.set("class",!this.viewModel.get("isVisibleOnSite")?"epi-overlay-content-invisible":"");var _1960=(this.viewModel.content&&this.viewModel.content.typeIdentifier)||this.viewModel.typeIdentifier;if(this.viewModel.get("isVisibleOnSite")&&_1960){_195d=_1952.getValue(_1960,"useIconOnBlock");_195e=_1952.getValue(_1960,"iconClass");_195f=_1952.getValue(_1960,"description");if(_195d){_195c.set("class","epi-overlay-content-info");this.set("useIconOnBlock",true);this.set("statusIcon",_195e);this.set("statusMessage",_195f);}}},_showStatusMessage:function(_1961){if(this._overlayItemInfo){this._overlayItemInfo.showStatusMessage(_1961);}}});});},"epi/shell/widget/overlay/OverlayItemInfo":function(){require({cache:{"url:epi/shell/widget/overlay/templates/OverlayItemInfo.html":"<span class=\"epi-overlay-content\">\n    <span data-dojo-attach-point=\"highlightArea\" class=\"epi-overlay-content-highlight-area\"></span>\n</span>"}});define("epi/shell/widget/overlay/OverlayItemInfo",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dijit/_WidgetBase","dijit/_TemplatedMixin","dojox/html/entities","epi/string","epi/shell/widget/Tooltip","dojo/text!./templates/OverlayItemInfo.html"],function(array,_1962,lang,_1963,_1964,_1965,_1966,_1967,_1968,_1969,_196a,_196b){return _1962([_1966,_1967],{templateString:_196b,postCreate:function(){this.inherited(arguments);this.showStatusMessage(false);},destroy:function(){this.inherited(arguments);this._destroyTooltip();},showStatusMessage:function(_196c){if(this._tooltip){_196c?this._tooltip.open(this.domNode):this._tooltip.close();}},_setStatusIconAttr:function(_196d){var _196e=lang.isArray(_196d);if(_196e){array.forEach(_196d,function(_196f){_1963.add(this.highlightArea,_196f);},this);}else{_1963.add(this.highlightArea,_196d);}},_setStatusMessageAttr:function(_1970){if(!_1970){return;}var _1971=lang.isArray(_1970);if(this._tooltip){if(_1971){this._tooltip.tooltipRows=_1970;}else{this._tooltip.label=_1968.encode(_1970);}}else{var _1972=_1964.create("div",{"class":"epi-overlay-content-tooltip",innerHTML:_1969.toHTML(_1968.encode(_1970))}),_1973=_1971?{tooltipRows:_1970}:{label:_1972.outerHTML};this._tooltip=new _196a(_1973);}},_destroyTooltip:function(){if(this._tooltip){this._tooltip.destroyRecursive();this._tooltip=null;}}});});},"url:epi/shell/widget/overlay/templates/OverlayItemInfo.html":"<span class=\"epi-overlay-content\">\n    <span data-dojo-attach-point=\"highlightArea\" class=\"epi-overlay-content-highlight-area\"></span>\n</span>","epi-cms/contentediting/command/ContentAreaCommands":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/Stateful","./BlockRemove","./BlockEdit","./MoveVisibleToPrevious","./MoveVisibleToNext","./Personalize","./SelectDisplayOption"],function(array,_1974,_1975,_1976,Edit,_1977,_1978,_1979,_197a){return _1974([_1975],{commands:null,constructor:function(){this.commands=[new Edit(),new _197a(),new _1979(),new _1977(),new _1978(),new _1976()];},_modelSetter:function(model){this.model=model;array.forEach(this.commands,function(_197b){_197b.set("model",model);});}});});},"epi-cms/contentediting/command/BlockRemove":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_197c,epi,_197d){return _197c([_197d],{name:"remove",label:epi.resources.action.remove,tooltip:epi.resources.action.remove,_execute:function(){this.model.remove();},_onModelValueChange:function(){this.set("canExecute",!!this.model&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/_ContentAreaCommand":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/shell/command/_Command"],function(_197e,lang,_197f){return _197e([_197f],{_onModelChange:function(){var model=this.model;if(this._handles){for(var i=0;i<this._handles.length;i++){this._handles[i].remove();}}this._handles=[];if(!model){this.set("canExecute",false);return;}this._watch("readOnly",function(){this._onModelValueChange();},this);this._onModelValueChange();},_watch:function(_1980,_1981,scope){if(scope){this._handles.push(this.model.watch(_1980,lang.hitch(scope,_1981)));}else{this._handles.push(this.model.watch(_1980,_1981));}},_getItem:function(){return this.model.contentGroup?this.model.parent:this.model;},_getContainer:function(){var _1982=function(item){if(item.parent){return _1982(item.parent);}return item;};return _1982(this.model);},_onModelValueChange:function(){}});});},"epi-cms/contentediting/command/BlockEdit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi","epi/dependency","epi-cms/contentediting/command/_ContentAreaCommand","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1983,lang,topic,when,epi,_1984,_1985,_1986,_1987){return _1983([_1985],{name:"edit",label:epi.resources.action.edit,tooltip:epi.resources.action.edit,iconClass:"epi-iconPen",category:"menuWithSeparator",constructor:function(){this.contentActionSupport=this.contentActionSupport||_1986;var _1988=_1984.resolve("epi.storeregistry");this._store=_1988.get("epi.cms.content.light");},_execute:function(){var _1989=this.model.contentLink;topic.publish("/epi/shell/context/request",{uri:"epi.cms.contentdata:///"+_1989},{});},_onModelValueChange:function(){var item=this.model;if(!item||!item.contentLink){this.set("canExecute",false);return;}var _198a=item&&this._store.get(item.contentLink);when(_198a,lang.hitch(this,function(_198b){this.set("canExecute",_198b&&!_198b.isDeleted);if(_198b&&_198b.accessMask){if(this.contentActionSupport.hasAccess(_198b.accessMask,this.contentActionSupport.accessLevel[this.contentActionSupport.action.Edit])){this.set("label",_1987.edit);this.set("iconClass","epi-iconPen");}else{this.set("label",_1987.view);this.set("iconClass","epi-iconSearch");}}}));}});});},"epi-cms/contentediting/command/MoveVisibleToPrevious":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/contentediting/command/MoveToPrevious"],function(array,_198c,_198d){return _198c([_198d],{_execute:function(){this._getContainer().moveVisible(this._getItem(),false);},_onModelChange:function(){this.inherited(arguments);this._watch("visible",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){var _198e=array.filter(this._getContainer().getChildren(),function(child){return child.get("visible");}),index=array.indexOf(_198e,this._getItem());this.set("canExecute",index>0);}});});},"epi-cms/contentediting/command/MoveToPrevious":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_198f,epi,_1990){return _198f([_1990],{label:epi.resources.action.moveup,tooltip:epi.resources.action.moveup,iconClass:"epi-iconUp",_execute:function(){this.model.movePrevious();},_onModelChange:function(){this.inherited(arguments);this._watch("canMovePrevious",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){this.set("canExecute",this.model.get("canMovePrevious")&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/MoveVisibleToNext":function(){define(["dojo/_base/array","dojo/_base/declare","epi-cms/contentediting/command/MoveToNext"],function(array,_1991,_1992){return _1991([_1992],{_execute:function(){this._getContainer().moveVisible(this._getItem(),true);},_onModelChange:function(){this.inherited(arguments);this._watch("visible",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){var _1993=array.filter(this._getContainer().getChildren(),function(child){return child.get("visible");}),index=array.indexOf(_1993,this._getItem());this.set("canExecute",index!==-1&&index<_1993.length-1);}});});},"epi-cms/contentediting/command/MoveToNext":function(){define(["dojo/_base/declare","epi","epi-cms/contentediting/command/_ContentAreaCommand"],function(_1994,epi,_1995){return _1994([_1995],{label:epi.resources.action.movedown,tooltip:epi.resources.action.movedown,iconClass:"epi-iconDown",category:"menuWithSeparator",_execute:function(){this.model.moveNext();},_onModelChange:function(){this.inherited(arguments);this._watch("canMoveNext",function(){this._onModelValueChange();},this);},_onModelValueChange:function(){this.set("canExecute",this.model.get("canMoveNext")&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/Personalize":function(){define(["dojo/_base/declare","epi-cms/contentediting/viewmodel/PersonalizedGroupViewModel","epi-cms/contentediting/command/_ContentAreaCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_1996,_1997,_1998,_1999){return _1996([_1998],{label:_1999.label,iconClass:"epi-iconUsers",category:"menuWithSeparator",_execute:function(){if(!this.model.contentGroup){this.model.personalize();}},_onModelValueChange:function(){this.set("canExecute",!!this.model&&this.model.contentLink&&!this.model.contentGroup&&!this.model.get("readOnly"));}});});},"epi-cms/contentediting/command/SelectDisplayOption":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/dependency","epi-cms/contentediting/command/_ContentAreaCommand","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/widget/DisplayOptionSelector","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.displayoptions"],function(_199a,lang,when,_199b,_199c,_199d,_199e,_199f){return _199a([_199c],{label:_199f.label,category:"popup",_labelAutomatic:lang.replace(_199f.label,[_199f.automatic]),constructor:function(){this.popup=new _199e();},postscript:function(){this.inherited(arguments);if(!this.store){var _19a0=_199b.resolve("epi.storeregistry");this.store=_19a0.get("epi.cms.displayoptions");}when(this.store.get(),lang.hitch(this,function(_19a1){this._setCommandAvailable(_19a1);this.popup.set("displayOptions",_19a1);}));},_onModelChange:function(){this.inherited(arguments);var _19a2=this.popup.displayOptions,_19a3=this.model.get("displayOption"),_19a4=_19a2&&_19a2.length>0;_19a4=_19a4&&(this.model instanceof _199d);this._setCommandAvailable(_19a2);if(!_19a4){this.set("label",this._labelAutomatic);return;}this.popup.set("model",this.model);if(!_19a3){this.set("label",this._labelAutomatic);}else{this._setLabel(_19a3);}this._watch("displayOption",function(_19a5,_19a6,_19a7){if(!_19a7){this.set("label",this._labelAutomatic);}else{this._setLabel(_19a7);}},this);},_setCommandAvailable:function(_19a8){this.set("isAvailable",_19a8&&_19a8.length>0&&this.model instanceof _199d);},_setLabel:function(_19a9){when(this.store.get(_19a9),lang.hitch(this,function(_19aa){this.set("label",lang.replace(_199f.label,[_19aa.name]));}),lang.hitch(this,function(error){this.set("label",this._labelAutomatic);}));},_onModelValueChange:function(){this.set("canExecute",!!this.model&&this.model.contentLink&&!this.model.get("readOnly"));}});});},"epi-cms/widget/DisplayOptionSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","dijit/MenuSeparator","epi-cms/widget/SelectorMenuBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.displayoptions","epi/shell/widget/RadioMenuItem"],function(array,_19ab,lang,when,_19ac,_19ad,_19ae,_19af){return _19ab([_19ad],{model:null,headingText:_19ae.title,_rdAutomatic:null,_separator:null,postCreate:function(){this.inherited(arguments);this.own(this._rdAutomatic=new _19af({label:_19ae.automatic,value:""}));this.addChild(this._rdAutomatic);this._rdAutomatic.on("change",lang.hitch(this,this._restoreDefault));this.own(this._separator=new _19ac({baseClass:"epi-menuSeparator"}));this.addChild(this._separator);},_restoreDefault:function(){this.model.modify(function(){this.model.set("displayOption",null);},this);},_setModelAttr:function(model){this._set("model",model);this._setup();},_setDisplayOptionsAttr:function(_19b0){this._set("displayOptions",_19b0);this._setup();},_setup:function(){if(!this.model||!this.displayOptions){return;}this._removeMenuItems();var _19b1=this.model.get("displayOption");array.forEach(this.displayOptions,function(_19b2){var item=new _19af({label:_19b2.name,iconClass:_19b2.iconClass,displayOptionId:_19b2.id,checked:_19b1===_19b2.id,title:_19b2.description});this.own(item.watch("checked",lang.hitch(this,function(_19b3,_19b4,_19b5){if(!_19b5){return;}this.model.modify(function(){this.model.set("displayOption",_19b2.id);},this);})));this.addChild(item);},this);this._rdAutomatic.set("checked",!_19b1);},_removeMenuItems:function(){var items=this.getChildren();items.forEach(function(item){if(item===this._rdAutomatic||item===this._separator){return;}this.removeChild(item);item.destroy();},this);}});});},"url:epi-cms/widget/templates/Block.html":"<div class=\"dojoDndItem epi-overlay-block\">\n    <div data-dojo-attach-point=\"containerDomNode\"></div>\n    <span class=\"epi-personalized\" data-dojo-attach-point=\"iconsContainer\">\n        <span class=\"epi-overlayControls epi-mediumButton \">\n            <span class=\"dijitReset dijitInline dijitIcon epi-iconWarning\" data-dojo-attach-point=\"warningIcon\"></span>\n            <span class=\"dijitReset dijitInline dijitIcon epi-iconUsers\" data-dojo-attach-point=\"personalizedIcon\"></span>\n        </span>\n    </span>\n    <button class=\"epi-chromelessButton epi-overlayControls epi-settingsButton epi-mediumButton\" data-dojo-attach-point=\"settingsButton\" data-dojo-type=\"dijit/form/DropDownButton\" data-dojo-props=\"showLabel:false, title:'${res.settingstooltip}', iconClass:'epi-iconContextMenu'\">\n        <div data-dojo-attach-point=\"contextMenu\" data-dojo-type=\"epi/shell/widget/ContextMenu\"></div>\n    </button>\n</div>","epi-cms/contentediting/command/MoveOutsideGroup":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/_ContentAreaCommand","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.contentarea.personalize"],function(_19b6,_19b7,_19b8){return _19b6([_19b7],{label:_19b8.moveoutsidegroup,tooltip:_19b8.moveoutsidegroup,iconClass:"",category:"menuWithSeparator",_execute:function(){this.model.moveOutsideGroup();},_onModelValueChange:function(){this.set("canExecute",this.model.contentGroup&&!this.model.get("readOnly"));}});});},"url:epi-cms/contentediting/editors/templates/ContentAreaEditor.html":"<div class=\"dijitInline\" tabindex=\"-1\" role=\"presentation\">\n    <div data-dojo-attach-point=\"treeNode\"></div>\n    <div data-dojo-attach-point=\"actionsContainer\" class=\"epi-content-area-actionscontainer\"></div>\n</div>\n","epi-cms/contentediting/editors/ItemCollectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/event","dojo/aspect","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/dom-geometry","dojo/keys","dojo/mouse","dojo/on","dojo/query","dojo/topic","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","epi/shell/dgrid/Formatter","epi/shell/dnd/Target","epi/shell/widget/_ValueRequiredMixin","epi/shell/widget/ContextMenu","epi/shell/TypeDescriptorManager","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","epi-cms/dgrid/formatters","epi-cms/dgrid/DnD","epi-cms/extension/events","epi-cms/contentediting/command/NewItem","epi-cms/contentediting/viewmodel/ItemCollectionViewModel","epi-cms/contentediting/command/ItemCollectionCommands","epi-cms/widget/_HasChildDialogMixin","./_TextWithActionLinksMixin","dojo/text!./templates/ItemCollectionEditor.html","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editors.itemcollection"],function(array,_19b9,lang,event,_19ba,_19bb,_19bc,_19bd,_19be,keys,mouse,on,query,topic,when,_19bf,_19c0,_19c1,_19c2,_19c3,_19c4,_19c5,_19c6,_19c7,_19c8,_19c9,_19ca,DnD,_19cb,_19cc,_19cd,_19ce,_19cf,_19d0,_19d1,_19d2){return _19b9([_19c1,_19bf,_19c0,_19c4,_19cf,_19d0],{baseClass:"epi-item-collection-editor",multiple:true,res:_19d2,actionsResource:_19d2,templateString:_19d1,value:null,model:null,contextMenu:null,grid:null,commandProviderClass:_19ce,_newItemCommand:null,_gridClass:_19b9([_19c8,_19c2,_19c9,DnD,_19c7]),_mouseOverClass:"epi-dgrid-mouseover",actionsVisible:true,customTypeIdentifier:null,onChange:function(value){},postMixInProperties:function(){this.inherited(arguments);this.setupAllowedTypes();},postCreate:function(){this.inherited(arguments);this.set("model",new _19cd(this.value,{itemModelType:this.itemModelType,readOnly:this.readOnly}));this.setupCommands();this.setupList();this.setupActionContainer();this.setupEvents();},startup:function(){this.inherited(arguments);this.contextMenu.startup();},setupActionContainer:function(){this.own(this._dndTarget=new _19c3(this.actionsContainer,{accept:this.get("allowedDndTypes"),isSource:false,alwaysCopy:false,insertNodes:function(){}}));this.setupActionLinks(this.actionsContainer);this._displayActionsContainer();},setupCommands:function(){this.contextMenu=this.contextMenu||new _19c5();this.commandProvider=this.commandProvider||new this.commandProviderClass({model:this.model,commandOptions:this.commandOptions});this.contextMenu.addProvider(this.commandProvider);this.own(this.contextMenu,this.commandProvider,this._newItemCommand=new _19cc({model:this.model,dialogContentParams:this.commandOptions?this.commandOptions.dialogContentParams:{}}));},setupList:function(){var menu={hasMenu:!!this.contextMenu,settings:{title:this.res?this.res.menutooltip:""}},_19d3=function(data,_19d4,row){return "<div class='epi-rowIcon'><span class='dijitInline dijitIcon epi-iconLink epi-objectIcon'></span></div>"+data;},_19d5={selectionMode:"single",selectionEvents:"click,dgrid-cellfocusin",formatters:[_19ca.contentItemFactory("text","title","typeIdentifier",menu),_19d3],dndParams:{copyOnly:true,accept:this.get("allowedDndTypes"),creator:lang.hitch(this,this._dndNodeCreator),isSource:!this.readOnly},dndSourceTypes:this.customTypeIdentifier?[this.customTypeIdentifier]:[],consumer:this},_19d6=function(_19d7){var types=_19c6.getAndConcatenateValues(this.dndSourceTypes,"dndTypes");if(types.length===0){types=this.dndSourceTypes;}return types;};if(this.customTypeIdentifier){_19d5._getDndType=_19d6;}this.own(this.grid=new this._gridClass(_19d5,this.itemsContainer));this.grid.set("showHeader",false);this.grid.renderArray(this.model.get("data"));this.grid.startup();},setupEvents:function(){var self=this,_19d8=on.selector;this.own(self.model.on("selectedItem",lang.hitch(this,this.focus)),self.model.on("initCompleted",lang.hitch(this,this._renderUI)),self.grid.on(_19d8(".dgrid-row",mouse.enter),function(e){_19bb.add(self,self._mouseOverClass);}),self.grid.on(_19d8(".dgrid-row",mouse.leave),function(e){_19bb.remove(self,self._mouseOverClass);}),self.grid.on("dgrid-select",function(e){self.model.set("selectedItem",e.rows[0].data);self.commandProvider.set("model",self.model);}),self.grid.on(_19d8(".dgrid-row",_19cb.keys.del),function(e){self.model.remove();}),self.grid.on(_19d8(".dgrid-row",_19cb.keys.shiftf10),function(e){self._showContextMenu(e);}),self.grid.on(_19d8(".dgrid-row",_19cb.contextmenu),function(e){var item=self.grid.row(e).data;self.model.set("selectedItem",item);self.select(item);self._showContextMenu(e);}),self.grid.on(".epi-iconContextMenu:click",function(e){self.contextMenu.scheduleOpen(self,null,{x:e.pageX,y:e.pageY});}),_19ba.around(self.grid.dndSource,"checkAcceptance",function(_19d9){return function(_19da,nodes){return !self.readOnly&&_19d9.apply(self.grid.dndSource,arguments);};}),_19ba.after(self.grid.dndSource,"onDropData",function(_19db,_19dc,nodes,copy){var i;if(self.grid.dndSource===_19dc){for(i=0;i<nodes.length;i++){self.model.moveTo(self.grid.dndSource.getItem(nodes[i].id).data,self.grid.dndSource.current!=null?self.grid.dndSource.getItem(self.grid.dndSource.current.id).data:null,self.grid.dndSource.before);}}else{var item;for(i=0;i<_19db.length;i++){when(_19db[i].data,lang.hitch(this,function(_19dd){self.model.addTo(_19dd,self.grid.dndSource.current!=null?this.grid.dndSource.getItem(self.grid.dndSource.current.id).data:null,self.grid.dndSource.before);if(_19dc&&_19dc.grid&&_19dc.grid.consumer&&_19dc.grid.consumer!==self){_19dc.grid.consumer.model.set("selectedItem",_19dd);_19dc.grid.consumer.model.remove();}}));}}},true),_19ba.around(self.grid,"insertRow",lang.hitch(self,self._aroundInsertRow)),this.model.on("changed",lang.hitch(this,function(){this.onChange(this.value=this.model.get("value")||[]);this._renderUI();this.focus();})),_19ba.after(this.grid.dndSource,"onDndStart",lang.hitch(this,function(_19de,nodes,copy){var _19df=this.grid.dndSource,_19e0=_19df.accept&&_19df.checkAcceptance(_19de,nodes);_19bb[_19e0?"remove":"add"](this.container,"dojoDndTargetDisabled");}),true),_19ba.after(this._dndTarget,"onDropData",lang.hitch(this,function(_19e1,_19e2,nodes,copy){var item;for(var i=0;i<_19e1.length;i++){when(_19e1[i].data,lang.hitch(this,function(_19e3){this.model.addTo(_19e3,null,false);if(_19e2&&_19e2.grid&&_19e2.grid.consumer&&_19e2.grid.consumer!==this){_19e2.grid.consumer.model.set("selectedItem",_19e3);_19e2.grid.consumer.model.remove();}}));}this.focus();}),true));var _19e4=this.commandProvider.commands.concat(this._newItemCommand);_19e4.forEach(function(_19e5){this.own(_19ba.after(_19e5,"onDialogOpen",function(){self.set("isShowingChildDialog",true);self.validate();}),_19ba.after(_19e5,"onDialogHideComplete",function(){self.set("isShowingChildDialog",false);self.focus();}));},this);},executeAction:function(_19e6){if(_19e6==="createnewitem"){if(this._newItemCommand){this._newItemCommand.execute();}}},setupAllowedTypes:function(){var _19e7=this.itemConverterKey;this.allowedDndTypes=this.allowedDndTypes||[];if(_19e7){this.allowedDndTypes=this.allowedDndTypes.map(function(type){return type+"."+_19e7;});}if(this.customTypeIdentifier){this.allowedDndTypes.unshift(this.customTypeIdentifier);}},focus:function(){if(this.grid&&this.value&&this.value.length>0){this.grid.focus();if(this.model){var _19e8=this.model.get("selectedItem"),_19e9=this.model.getItemIndex(_19e8);if(_19e8){this.grid.focus(this.grid.row(_19e9).element);}}}else{this.textWithLinks.focus();}},select:function(item){this.grid.clearSelection();if(item){this.grid.select(this.model.getItemIndex(item));}},isValid:function(){return (!this.required||(this.model&&this.model.get("value").length>0));},_onBlur:function(){if(this.contextMenu&&this.contextMenu.isShowingNow){return;}this.inherited(arguments);},_getValueAttr:function(){return this.model.get("value");},_setValueAttr:function(val){this._set("value",val);if(!val||!(val instanceof Array)){this._set("value",[]);}if(this._started){this.model?this.model.set("data",this.value):(this.model=new _19cd(this.value,{readOnly:this.readOnly}));this._renderUI();}},_setReadOnlyAttr:function(_19ea){this._set("readOnly",_19ea);this._displayActionsContainer();if(this.model){this.model.set("readOnly",_19ea);}},_dndNodeCreator:function(item,hint){var _19eb=this.allowedDndTypes,node=_19bc.create("div").appendChild(document.createTextNode(item.text));if(item.typeIdentifier){_19eb=_19c6.getAndConcatenateValues(item.typeIdentifier,"dndTypes");}return {node:node,type:_19eb,data:item};},_aroundInsertRow:function(_19ec){return lang.hitch(this,function(_19ed,_19ee,_19ef,i,_19f0){var row=_19ec.apply(this.grid,arguments);var _19f1=this.model.get("selectedItem");if(_19f1&&_19f1.id===_19ed.id){this.select(_19f1);}return row;});},_renderUI:function(){this.grid.refresh();this.grid.renderArray(this.model.get("data"));},_showContextMenu:function(e){if(this.readOnly){return;}var _19f2=this.model.get("selectedItem"),_19f3=this.model.getItemIndex(_19f2);if(_19f2){event.stop(e);this.contextMenu.scheduleOpen(this,null,_19be.position(query(".epi-iconContextMenu",this.grid.row(_19f3).element)[0],true));}},_displayActionsContainer:function(){_19bd.set(this.actionsContainer,"display",this.readOnly||!this.actionsVisible?"none":"");}});});},"epi-cms/contentediting/command/NewItem":function(){define(["dojo/_base/declare","epi/shell/command/_Command","epi-cms/contentediting/command/_CommandWithDialogMixin","epi-cms/widget/LinkEditor"],function(_19f4,_19f5,_19f6,_19f7){return _19f4([_19f5,_19f6],{dialogContentClass:_19f7,dialogContentParams:null,defaultActionsVisible:false,_execute:function(){this.set("value",null);this.showDialog();},_onModelChange:function(){if(!this.model){this.set("canExecute",false);return;}this.set("canExecute",true);},onDialogExecute:function(){this.inherited(arguments);if(this.dialogContent){this.value=this.dialogContent.get("value");}if(this.model){this.model.addTo(this.value,null,null);}}});});},"epi-cms/contentediting/command/_CommandWithDialogMixin":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/when","dijit/Destroyable","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink","epi/i18n!epi/nls/episerver.shared"],function(array,_19f8,lang,_19f9,when,_19fa,_19fb,_19fc,_19fd){return _19f8([_19fa],{res:_19fc,title:null,dialogClass:"epi-dialog-portrait",dialogContentClass:null,dialogParams:null,dialogContentParams:null,dialogContent:null,defaultActionsVisible:true,confirmActionText:_19fd.action.ok,cancelActionText:_19fd.action.cancel,value:null,_dialog:null,_getTitle:function(){return this.title||lang.replace(this.value?this.res.title.template.edit:this.res.title.template.create,this.res.title.action);},onDialogOpen:function(){},onDialogExecute:function(){},onDialogCancel:function(){},onDialogHideComplete:function(){},showDialog:function(){if(this.dialogContent){this.dialogContent.destroy();this.dialogContent=null;}this.dialogContent=new this.dialogContentClass(this.dialogContentParams);this._dialog=new _19fb(lang.mixin({title:this._getTitle(),dialogClass:this.dialogClass,content:this.dialogContent,defaultActionsVisible:this.defaultActionsVisible,confirmActionText:this.confirmActionText,cancelActionText:this.cancelActionText},this.dialogParams));this._dialog.startup();this.dialogContent.set("value",this.value);this.own(this.dialogContent,_19f9.after(this._dialog,"onExecute",lang.hitch(this,this.onDialogExecute),true),_19f9.after(this._dialog,"onCancel",lang.hitch(this,this.onDialogCancel),true),_19f9.after(this._dialog,"onHide",lang.hitch(this,this.onDialogHideComplete),true),this._dialog.watch("open",lang.hitch(this,function(name,_19fe,_19ff){if(!_19ff){return;}this.onDialogOpen();})));this._dialog.show();}});});},"epi-cms/widget/LinkEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dijit/_CssStateMixin","epi","epi/dependency","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ActionProviderWidget","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/viewmodel/LinkEditorViewModel","epi-cms/widget/HyperLinkSelector"],function(array,_1a00,lang,_1a01,_1a02,_1a03,epi,_1a04,_1a05,_1a06,_1a07,_1a08,_1a09,_1a0a){return _1a00([_1a06,_1a07,_1a05,_1a03,_1a08],{_metadataManager:null,modelClassName:_1a09,hiddenFields:[],postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;this._metadataManager=this._metadataManager||_1a04.resolve("epi.shell.MetadataManager");if(!this.model&&this.modelClassName){var _1a0b=_1a00(this.modelClassName);this.model=new _1a0b();}this._actions=[{name:"ok",label:epi.resources.action.ok,settings:{type:"button","class":"Salt"},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog({action:"ok"});}})},{name:"delete",label:epi.resources.action.deletelabel,settings:{type:"button",disabled:true},action:lang.hitch(this,function(){array.forEach(this.form._getDescendantFormWidgets(),function(_1a0c){_1a0c.set("value","");},this);this.executeDialog({action:"delete"});})},{name:"cancel",label:epi.resources.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];},postCreate:function(){if(this.modelType){this.metadata=this._metadataManager.getMetadataForType(this.modelType);}this.inherited(arguments);},_setValueAttr:function(value){this.inherited(arguments);this._handleActions(value);},onFormCreated:function(_1a0d){array.forEach(this.form._getDescendantFormWidgets(),function(_1a0e){if(this.hiddenFields&&this.hiddenFields.indexOf(_1a0e.name)>-1){var _1a0f=this._getAncestorNode(_1a0e.domNode,"epi-form-container__section__row");_1a01.set(_1a0f,{display:"none"});_1a0e.set("required",false);}},this);this._handleActions(this.value);},_handleActions:function(value){if(this.hasAction("delete")){this.setActionProperty("delete","disabled",this.model._isEmptyObject(value));}},getFormWidget:function(_1a10){var _1a11=array.filter(this.form._getDescendantFormWidgets(),function(_1a12){return _1a12&&_1a12.name===_1a10;},this);return _1a11?_1a11[0]:null;},_getAncestorNode:function(node,_1a13){var _1a14=node?node.parentNode:null;if(!_1a14){return null;}if(!_1a02.contains(_1a14,_1a13)){return this._getAncestorNode(_1a14,_1a13);}return _1a14;},getActions:function(){return this._actions;},isValidValue:function(){return array.every(this.form._getDescendantFormWidgets(),function(_1a15){return _1a15.get("required")?!!_1a15.get("value"):true;});}});});},"epi-cms/widget/viewmodel/LinkEditorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/io-query","dojo/topic","dojo/Stateful","dojo/when","epi/shell/_StatefulGetterSetterMixin","epi/dependency"],function(array,_1a16,_1a17,lang,_1a18,topic,_1a19,when,_1a1a,_1a1b){return _1a16([_1a19,_1a1a],{_isEmptyObject:function(obj){for(var i in obj){if(obj[i]&&obj[i]!==""){return false;}}return true;}});});},"epi-cms/widget/HyperLinkSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/when","dojo/promise/all","dojo/string","dijit/_Widget","dijit/_Container","epi/dependency","epi/Url","epi/shell/widget/_ModelBindingMixin","epi-cms/widget/_HyperLinkFieldItem","epi-cms/contentediting/editors/SelectionEditor","epi-cms/widget/viewmodel/HyperLinkSelectorViewModel","epi-cms/form/EmailValidationTextBox","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink","dojo/text!./templates/_HyperLinkLanguageField.html"],function(array,_1a1c,lang,_1a1d,_1a1e,_1a1f,_1a20,when,all,_1a21,_1a22,_1a23,_1a24,Url,_1a25,_1a26,_1a27,_1a28,_1a29,_1a2a,_1a2b){return _1a1c([_1a22,_1a23,_1a25],{value:null,showLanguageSelector:true,_hasBeenBlurred:false,modelClassName:_1a28,modelBindingMap:{wrapperSettings:["wrapperSettings"],selectedWrapper:["selectedWrapper"]},_languageSelector:null,_languageSelectorWrapperNode:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _1a2c=_1a1c(this.modelClassName);this.model=new _1a2c({providers:this.providers});}this._languageStore=this._languageStore||_1a24.resolve("epi.storeregistry").get("epi.cms.language");},buildRendering:function(){this.inherited(arguments);this._createLanguageSelector();},startup:function(){this.inherited(arguments);this._languageSelector.startup();var self=this,_1a2d=this._languageSelector;when(this._languageStore.get(),function(_1a2e){if(self.get("showLanguageSelector")){if(_1a2e.length<=1){self._toggleLanguageSelector(false);}else{self._toggleLanguageSelector(true);}}var _1a2f=_1a2e.map(function(_1a30){return {text:_1a30.name,value:_1a30.languageId};});_1a2f.splice(0,0,{text:_1a2a.automaticlanguage,value:""});_1a2d.set("selections",_1a2f);_1a2d.set("value","");self._createInputWrappers();});},onSelectorsCreated:function(_1a31){},_setShowLanguageSelectorAttr:function(value){this._set("showLanguageSelector",value);this._toggleLanguageSelector(value);},_setSelectedWrapperAttr:function(_1a32){if(!_1a32){return;}array.forEach(this.wrappers,function(_1a33){_1a33.set("selected",false);});_1a32.set("selected",true);var _1a34=true;if(_1a32.settings.isContentLink){_1a34=false;}this._languageSelector.set("disabled",_1a34);},_createLanguageSelector:function(){this.own(this._languageSelector=new _1a27());this._languageSelectorWrapperNode=_1a20.toDom(_1a21.substitute(_1a2b,{id:this._languageSelector.id,language:_1a2a.language}));_1a20.place(this._languageSelectorWrapperNode,this.domNode,"first");this._languageSelector.placeAt(this._languageSelectorWrapperNode,"last");},_toggleLanguageSelector:function(_1a35){_1a1f.toggle(this._languageSelectorWrapperNode,"dijitHidden",!_1a35);},_createInputWrappers:function(){var _1a36=this.model.wrapperSettings,_1a37=[],self=this;_1a36.forEach(function(_1a38){var def=new _1a1d();_1a37.push(def.promise);require([_1a38.widgetType],function(ctor){var _1a39=new _1a26(lang.mixin(_1a38,{groupName:_1a38.groupName+this.id,inputWidgetCtor:ctor,required:self.required}));self.own(_1a39.on("radioButtonChange",lang.hitch(this,function(){self.set("selectedWrapper",_1a39);_1a39.focus();})));if(_1a38.invisible){_1a1e.set(_1a39.domNode,{display:"none"});}def.resolve(_1a39);});},this);when(all(_1a37),function(_1a3a){if(_1a3a.length===0){return;}_1a3a.forEach(function(_1a3b){self.addChild(_1a3b);});self.set("wrappers",_1a3a);var value=self.get("value");if(value){self._setValueForWidgets(value);}else{self.set("selectedWrapper",_1a3a[0]);}self.onSelectorsCreated(self);});},_getSelectedWrapper:function(){return array.filter(this.wrappers,function(_1a3c){return _1a3c.get("selected");})[0];},_getValueAttr:function(){var _1a3d=this._getSelectedWrapper();if(_1a3d){if(_1a3d.inputWidget&&_1a3d.settings.isContentLink){return this.model.getUrlValue(_1a3d.inputWidget.get("permanentLink"),this._languageSelector.get("value"),this.value);}else{return _1a3d.get("value");}}return this.value;},_setValueAttr:function(value){this._set("value",value);this._setValueForWidgets(value);},_setValueForWidgets:function(value){var _1a3e=this.get("wrappers");if(!_1a3e){return;}array.forEach(_1a3e,function(_1a3f){_1a3f.set("value",null);});if(!value){return;}var url=new Url(this.value);this._languageSelector.set("value",url.getQueryParameterValue("epslanguage"));when(this.model.getContentData(value),lang.hitch(this,function(_1a40){if(_1a40){array.every(_1a3e,function(_1a41){if(_1a41&&_1a41.settings.isContentLink){if(array.some(_1a41.settings.allowedTypes,lang.hitch(this,function(_1a42){return this.model.isBaseTypeIdentifier(_1a40.typeIdentifier,_1a42);}))){_1a41.set("value",_1a40.contentLink);this.set("selectedWrapper",_1a41);return false;}}return true;},this);}else{array.every(_1a3e,function(_1a43){if(_1a43&&!_1a43.settings.isContentLink){var _1a44=_1a43.inputWidget;if(_1a44&&this._isValidEditorWidget(value,_1a44)&&_1a44.validator(value,_1a44.constraints)){_1a43.set("value",value);this.set("selectedWrapper",_1a43);return false;}}return true;},this);}}));},_isValidEditorWidget:function(value,_1a45){if(_1a45 instanceof _1a29){return Url(value).scheme==="mailto";}return true;},validate:function(){var _1a46=this._getSelectedWrapper();if(_1a46){_1a46._hasBeenBlurred=this._hasBeenBlurred;return _1a46.validate();}return false;},focus:function(){var _1a47=this._getSelectedWrapper();if(_1a47){_1a47.focus();}},reset:function(){this._hasBeenBlurred=false;this.set("value",null);}});});},"epi-cms/widget/_HyperLinkFieldItem":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/_Widget","dijit/_TemplatedMixin","dijit/_Contained","epi/string","dojo/text!./templates/_HyperLinkFieldItem.html"],function(_1a48,lang,_1a49,_1a4a,_1a4b,_1a4c,_1a4d){return _1a48([_1a49,_1a4b,_1a4a],{templateString:_1a4d,inputWidget:null,inputWidgetCtor:null,settings:null,_hasBeenBlurred:false,buildRendering:function(){this.inherited(arguments);var _1a4e=lang.mixin({value:this.get("value")||null},this.settings);this.own(this.inputWidget=new this.inputWidgetCtor(_1a4e).placeAt(this.domNode));},_onRadioButtonChange:function(evt){this.onRadioButtonChange(this,evt);},onRadioButtonChange:function(_1a4f,evt){},validate:function(){if(this.inputWidget){this.inputWidget._hasBeenBlurred=this._hasBeenBlurred;return this.inputWidget.validate();}return true;},_setValueAttr:function(value){this._set("value",value);if(this.inputWidget){this.inputWidget.set("value",value);}},_getValueAttr:function(){if(this._started&&this.inputWidget){return this.inputWidget.get("value");}return this.value;},_setRequiredAttr:function(val){this._set("required",val);if(this.inputWidget){this.inputWidget.set("required",val);}},_setSelectedAttr:function(value){this._set("selected",value);if(this.inputWidget){this.inputWidget.set("disabled",!value);if(!value){this.inputWidget.set("state","");}}this.radioNode.checked=value;},_getSelectedAttr:function(){return this.radioNode.checked;},_setShowAllLanguagesAttr:function(val){this._set("showAllLanguages",val);if(this.inputWidget){this.inputWidget.set("showAllLanguages",val);}},focus:function(){if(this.inputWidget){this.inputWidget.focus();}}});});},"url:epi-cms/widget/templates/_HyperLinkFieldItem.html":"<div class=\"epi-form-container__section__row epi-form-container__section__row--field epi-hyperLink\">\n    <label for=\"${id}_${name}\">\n        <input type=\"radio\" name=\"${groupname}\" id=\"${id}_${name}\" value=\"${name}\" data-dojo-type=\"dijit/form/RadioButton\" data-dojo-attach-event=\"onchange:_onRadioButtonChange\" data-dojo-attach-point=\"radioNode\" />\n        ${displayName}\n    </label>\n</div>","epi-cms/contentediting/editors/SelectionEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/on","dojox/html/entities","dijit/form/Select","dijit/MenuItem","dijit/MenuSeparator","epi/shell/layout/_LayoutWidget","epi/shell/widget/_ValueRequiredMixin"],function(array,_1a50,lang,_1a51,on,_1a52,_1a53,_1a54,_1a55,_1a56,_1a57){return _1a50([_1a56,_1a53,_1a57],{actualValue:null,value:null,maxHeight:-1,postMixInProperties:function(){this.inherited(arguments);this.set("selections",this.selections);this.actualValue=this.value;},_setSelectionsAttr:function(_1a58){this.set("options",array.map(_1a58,function(item){return {label:_1a52.encode(item.text),value:item.value,selected:(item.value===this.value)||(!item.value&&!this.value)};},this));},postCreate:function(){this.inherited(arguments);on(this,"change",lang.hitch(this,function(){if(!this.disabled){this.validate();}this.onLayoutChanged();}));},_getMenuItemForOption:function(_1a59){if(_1a59.type==="separator"){return new _1a55();}else{var click=lang.hitch(this,"_setValueAttr",_1a59);var item=new _1a54({option:_1a59,label:_1a59.label||this.emptyLabel,onClick:click,disabled:_1a59.disabled||false});item.focusNode.setAttribute("role","listitem");return item;}},_getValueFromOpts:function(){var _1a5a=this.getOptions()||[];if(!this.multiple&&_1a5a.length){var _1a5b=array.filter(_1a5a,function(i){return i.selected;})[0];if(_1a5b&&_1a5b.value!==undefined){return _1a5b.value;}else{return null;}}else{if(this.multiple){return array.map(array.filter(_1a5a,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_setValueAttr:function(value,_1a5c){var _1a5d=this.getOptions()||[];if(value===null||typeof value!="object"){value=array.filter(_1a5d,function(i){return (i.value===value)||(!i.value&&!value);});}if(!lang.isArray(value)){value=[value];}if(this._onChangeActive){var _1a5e=value[0]?value[0].value:null;this._pendingOnChange=this.actualValue!==_1a5e;this.actualValue=_1a5e;}array.forEach(_1a5d,function(i){i.selected=array.some(value,function(v){return v.value===i.value;});});var val=array.map(value,function(i){return i.value;}),disp=array.map(value,function(i){return i.label;});this._set("value",this.multiple?val:val[0]);this._setDisplay(this.multiple?disp:disp[0]);this._updateSelection();this._handleOnChange(this.value,_1a5c);},_updateSelection:function(){this._set("value",this._getValueFromOpts());var value=this.value;if(value!==undefined){if(!lang.isArray(value)){value=[value];}array.forEach(this._getChildren(),function(child){var _1a5f=array.some(value,function(v){return child.option&&(v===child.option.value);});child.domNode.setAttribute("aria-selected",_1a5f);},this);}},validator:function(value,flags){}});});},"epi-cms/widget/viewmodel/HyperLinkSelectorViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/io-query","dojo/dom-style","dojo/dom-construct","dojo/when","epi/string","epi/Url","epi/shell/TypeDescriptorManager","epi/shell/_StatefulGetterSetterMixin","epi-cms/core/PermanentLinkHelper"],function(array,_1a60,lang,_1a61,_1a62,_1a63,_1a64,when,_1a65,Url,_1a66,_1a67,_1a68){return _1a60([_1a61,_1a67],{_setProvidersAttr:function(_1a69){var _1a6a=[];array.forEach(_1a69,lang.hitch(this,function(_1a6b){_1a6a.push({name:_1a6b.name,displayName:_1a6b.displayName?_1a6b.displayName:_1a6b.name,title:_1a6b.title?_1a6b.title:"",groupname:"hyperLink_",widgetType:_1a6b.widgetType,invisible:_1a6b.invisible,settings:lang.mixin({roots:_1a6b.roots,allowedTypes:_1a6b.linkableTypes,isContentLink:(_1a6b.linkableTypes&&_1a6b.linkableTypes.length>0),allowedDndTypes:[],disabled:true,value:null,searchArea:_1a6b.searchArea},_1a6b.widgetSettings)});}));this.set("wrapperSettings",_1a6a);},getContentData:function(value){if(value){return _1a68.getContent(value,{allLanguages:true});}return null;},isBaseTypeIdentifier:function(type,base){return _1a66.isBaseTypeIdentifier(type,base);},getUrlValue:function(_1a6c,_1a6d,_1a6e){if(!_1a6c){return "";}var url=new Url(_1a6c);if(_1a6e){var _1a6f=new Url(_1a6e);if(this._areEqual(_1a6f,url)){url.query=lang.mixin(_1a6f.query,url.query);}}if(_1a6d===""){delete url.query.epslanguage;}else{url.query.epslanguage=_1a6d;}return url.toString();},_areEqual:function(url1,url2){return url1.scheme===url2.scheme&&url1.authority===url2.authority&&url1.path===url2.path&&url1.fragment===url2.fragment;}});});},"epi-cms/core/PermanentLinkHelper":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","dojo/when","epi/dependency"],function(_1a70,_1a71,lang,when,_1a72){return {getContent:function(link,_1a73){if(!link){return null;}var _1a74=_1a72.resolve("epi.storeregistry"),store=_1a74.get("epi.cms.content.light"),query=lang.mixin({query:"getcontentbypermanentlink",permanentLink:link},_1a73||{});return when(store.query(query)).then(lang.hitch(this,function(_1a75){return _1a75&&_1a75 instanceof Array?_1a75[0]:_1a75;}));}};});},"epi-cms/form/EmailValidationTextBox":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/form/ValidationTextBox","epi/i18n!epi/cms/nls/episerver.cms.form.emailvalidation"],function(_1a76,lang,_1a77,res){var _1a78=_1a76([_1a77],{invalidMessage:res.invalidmessage,addMailTo:false,validator:function(value,_1a79){value=value||"";if(!this.required&&this._isEmpty(value)){return true;}value=value.replace(/\\.{1}/g,"replaced").replace(/".*?"/g,"replaced");return _1a78.validationRegex.test(value);},_getValueAttr:function(){var value=this.inherited(arguments);if(this.addMailTo){value=value?lang.trim(value):"";if(value&&value.indexOf("mailto:")!==0){value="mailto:"+value;}}return value;},_setValueAttr:function(value){value=value?value.replace("mailto:",""):"";this.inherited(arguments,[value]);}});_1a78.validationRegex=/.+@.+\..+/i;return _1a78;});},"url:epi-cms/widget/templates/_HyperLinkLanguageField.html":"<div class=\"epi-form-container__section__row epi-form-container__section__row--field epi-hyperLink\">\n    <label for=\"${id}\">${language}</label>\n</div>","epi-cms/contentediting/viewmodel/ItemCollectionViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","dojo/when","epi-cms/contentediting/viewmodel/_ViewModelMixin","epi-cms/contentediting/viewmodel/LinkItemModel"],function(_1a7a,lang,_1a7b,all,when,_1a7c,_1a7d){return _1a7a([_1a7c],{_instanceId:null,_autoId:0,_selectedItem:null,_data:null,itemModelClass:null,itemModelType:null,constructor:function(data,_1a7e){_1a7a.safeMixin(this,_1a7e);},postscript:function(data){require([this.itemModelType],lang.hitch(this,function(_1a7f){this.itemModelClass=_1a7f;this._instanceId=new Date().getTime();this._init(data);}));},moveNext:function(){this._move(1)&&this.emit("changed");},movePrevious:function(){this._move(-1)&&this.emit("changed");},remove:function(){if(!this.get("canEdit")){return;}var index=this.getItemIndex(this._selectedItem);this._data.splice(index,1);var len=this._data.length;this.set("selectedItem",this._data[index>=len?len-1:index]||null);this.emit("changed");},addTo:function(_1a80,item,_1a81){if(!_1a80){return false;}if(this.getItemIndex(_1a80)>=0){this.moveTo(_1a80,null,false);this.emit("changed");}else{var self=this;when(self._createItemModel(_1a80),function(model){if(!item){self._data.push(model);}else{var _1a82=self.getItemIndex(item)+(_1a81?0:1);self._data.splice(_1a82,0,model);}self.emit("changed",{uiChanged:false});});}},moveTo:function(_1a83,item,_1a84){if(!_1a83&&!this._selectedItem){return false;}this.set("selectedItem",_1a83||this._selectedItem);var _1a85=this.getItemIndex(this._selectedItem);this._data.splice(_1a85,1);var _1a86=(item?this.getItemIndex(item):(this._data.length-1))+(_1a84?0:1);this._data.splice(_1a86,0,this._selectedItem);this.emit("changed");},updateItemData:function(item){var index=this.getItemIndex(this._selectedItem);if(index<0){return;}var self=this;when(self._createItemModel(item),function(model){self._selectedItem=self._data[index]=model;self.emit("changed");});},swap:function(_1a87,_1a88){if(!this._data[_1a87]||!this._data[_1a88]){return false;}var temp=this._data[_1a87];this._data[_1a87]=this._data[_1a88];this._data[_1a88]=temp;return true;},getItemIndex:function(item){var index=-1;if(!item||!(item instanceof this.itemModelClass)){return index;}this._data.some(function(i,o){if(i.id===item.id){index=o;return true;}return false;},this);return index;},_init:function(data){var self=this,_1a89;this.set("selectedItem",null);if(!(data instanceof Array)){this._data=[];}else{_1a89=data.map(function(item){return this._createItemModel(item);},this);all(_1a89).then(function(_1a8a){self._data=_1a8a;self.emit("initCompleted");});}},_generateItemId:function(){return this._instanceId+"_"+this._autoId++;},_createItemModel:function(item){var _1a8b=this.itemModelClass,id={id:this._generateItemId()},model,dfd=new _1a7b();if(this.getItemIndex(item)>=0){return item;}if(item instanceof _1a8b){model=lang.mixin(lang.clone(item),id);}else{model=new _1a8b(lang.mixin(lang.clone(item),id));}when(model.parse(true),function(){dfd.resolve(model);});return dfd;},_move:function(_1a8c){var index=this.getItemIndex(this._selectedItem);if(index<0){return false;}return this.swap(index,index+_1a8c);},_canMoveNextGetter:function(){var index=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&index>=0&&index<(this._data.length-1));},_canMovePreviousGetter:function(){var index=this.getItemIndex(this._selectedItem);return !!(this._selectedItem&&index>0&&index<=(this._data.length-1));},_canEditGetter:function(){return !this.readOnly&&!!this._selectedItem;},_valueGetter:function(){return this._data.map(function(item){return item.serialize();},this);},_dataGetter:function(){return this._data||[];},_dataSetter:function(data){this._init(data);},_selectedItemGetter:function(){return this._selectedItem;},_selectedItemSetter:function(value){this._selectedItem=value;}});});},"epi-cms/contentediting/viewmodel/LinkItemModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","epi/Url","epi-cms/contentediting/viewmodel/CollectionItemModel","epi-cms/core/PermanentLinkHelper"],function(_1a8d,lang,_1a8e,when,Url,_1a8f,_1a90){return _1a8d([_1a8f],{titleKey:"publicUrl",publicUrl:null,permanentUrl:null,_defaultDataStoreName:"epi.cms.content.light",serialize:function(){return {text:this.text,href:this.href||this.url,target:this.target||null,title:this.title||"",publicUrl:this.publicUrl,typeIdentifier:this.typeIdentifier||""};},_buildPublicUrl:function(url){var _1a91=new Url(url);if(!_1a91.scheme){_1a91=new Url("",{scheme:window.location.protocol,authority:window.location.hostname,path:url});}return _1a91.toString();},_publicUrlGetter:function(){return this._buildPublicUrl(this.publicUrl||this.url||this.href);},_permanentUrlSetter:function(value){this.href=this.permanentUrl=value;},_onTryUpdateItemModel:function(){if(!this.typeIdentifier){return when(_1a90.getContent(this.href),lang.hitch(this,function(_1a92){if(_1a92){this._parseFromContent(_1a92);}}));}},_parseFromContent:function(_1a93){if(_1a93){this.typeIdentifier=_1a93.typeIdentifier;this.publicUrl=this._buildPublicUrl(_1a93.publicUrl);}}});});},"epi-cms/contentediting/viewmodel/CollectionItemModel":function(){define(["dojo/_base/declare","epi-cms/contentediting/viewmodel/_ViewModelMixin"],function(_1a94,_1a95){return _1a94([_1a95],{id:null,textKey:"text",titleKey:null,iconTypeKey:"typeIdentifier",typeIdentifier:null,serialize:function(){},parse:function(_1a96){if(_1a96){return this._onTryUpdateItemModel();}return null;},_onTryUpdateItemModel:function(){},_getPropertyValue:function(_1a97,_1a98){if(_1a97===_1a98){return this[_1a97];}return this.get(_1a97);},_nameGetter:function(){return this._getPropertyValue(this.textKey,"name");},_textGetter:function(){return this._getPropertyValue(this.textKey,"text");},_titleGetter:function(){return this._getPropertyValue(this.titleKey,"title")||this._getPropertyValue(this.textKey,"title");},_iconTypeIdentifierGetter:function(){return this._getPropertyValue(this.iconTypeKey,"iconTypeIdentifier");}});});},"epi-cms/contentediting/command/ItemCollectionCommands":function(){define(["dojo/_base/declare","./BlockRemove","./ItemEdit","./MoveToPrevious","./MoveToNext","./ContentAreaCommands"],function(_1a99,_1a9a,Edit,_1a9b,_1a9c,_1a9d){return _1a99([_1a9d],{constructor:function(_1a9e){var _1a9f=_1a9e?_1a9e.commandOptions:{};this.commands=[new Edit(_1a9f),new _1a9b(_1a9f),new _1a9c(_1a9f),new _1a9a(_1a9f)];}});});},"epi-cms/contentediting/command/ItemEdit":function(){define(["dojo/_base/declare","epi-cms/contentediting/command/BlockEdit","epi-cms/contentediting/command/_CommandWithDialogMixin","epi-cms/widget/LinkEditor"],function(_1aa0,_1aa1,_1aa2,_1aa3){return _1aa0([_1aa1,_1aa2],{dialogContentClass:_1aa3,dialogContentParams:null,defaultActionsVisible:false,_execute:function(){this.showDialog();},_onModelValueChange:function(){if(!this.model){this.set("canExecute",false);return;}this.set("value",this.model.get("selectedItem"));this.set("canExecute",this.model.get("canEdit"));},onDialogExecute:function(_1aa4){this.inherited(arguments);if(this.dialogContent){this.value=this.dialogContent.get("value");}if(this.model){if(_1aa4&&_1aa4.action==="delete"){this.model.remove();}else{this.model.updateItemData(this.value);}}}});});},"url:epi-cms/contentediting/editors/templates/ItemCollectionEditor.html":"<div class=\"dijitInline\" tabindex=\"-1\" role=\"presentation\">\n    <!-- To reuse styling of content area we wrap into a div that include content area class -->\n    <div class=\"epi-content-area-editor\" data-dojo-attach-point=\"container\">\n        <div data-dojo-attach-point=\"itemsContainer\"></div>\n        <div data-dojo-attach-point=\"actionsContainer\" class=\"epi-content-area-actionscontainer\"></div>\n    </div>\n</div>\n","epi-cms/contentediting/editors/PreviewableDateTimeEditor":function(){define(["dojo/_base/declare","epi/datetime","epi/shell/widget/DateTimeSelectorDropDown","epi-cms/contentediting/editors/_PreviewableEditor"],function(_1aa5,_1aa6,_1aa7,_1aa8){return _1aa5([_1aa8],{required:false,controlParams:["required"],buildRendering:function(){this.control=new _1aa7({datePackage:null});this.inherited(arguments);},_setLabelValueAttr:function(value){this.inherited(arguments,[_1aa6.toUserFriendlyHtml(value)]);}});});},"epi-cms/contentediting/editors/_PreviewableEditor":function(){define(["dojo/_base/array","dojo/_base/event","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit","dijit/_CssStateMixin","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/ValidationTextBox","epi","dojo/text!./templates/_PreviewableEditor.html","dojox/html/entities"],function(array,event,_1aa9,lang,_1aaa,_1aab,dijit,_1aac,_1aad,_1aae,_1aaf,_1ab0,epi,_1ab1,_1ab2){return _1aa9([_1aad,_1aac,_1aae,_1aaf],{value:null,changeLabel:epi.resources.action.change,templateString:_1ab1,control:null,controlParams:[],state:"",_setLabelValueAttr:function(value){this._set("labelValue",value);if(this._isHtml(value)){this.labelNode.innerHTML=value;}else{this.labelNode.title=value;this.labelNode.textContent=value;}},_setIsEmptyAttr:function(_1ab3){this._set("isEmpty",_1ab3);if(_1ab3){_1aaa.add(this.domNode,"epi-state-empty");}else{_1aaa.remove(this.domNode,"epi-state-empty");}},_setValueAttr:function(value){this._set("value",value);this.control.set("value",value);this.set("labelValue",typeof (value)=="string"?_1ab2.encode(value):value);this.set("isEmpty",!value);},onChange:function(val){},buildRendering:function(){this.inherited(arguments);if(!this.control){this.control=new _1ab0();this.own(this.control);}this.control.placeAt(this.domNode,"first");},postCreate:function(){this.inherited(arguments);this._setDisplay(false);this.connect(this.labelNode,"onclick",this._onChangeNodeClick);this.connect(this.changeNode,"onclick",this._onChangeNodeClick);this.connect(this.control,"onChange",this._onControlChange);this.connect(this.control,"onBlur",this._onControlBlur);this.own(this.control.watch("state",lang.hitch(this,function(name,old,value){this.set("state",value);})));this.control.validate();this.set("state",this.control.state);array.forEach(this.controlParams,function(_1ab4){this.control.set(_1ab4,this.get(_1ab4));},this);},onBlur:function(){this._setDisplay(false);},_setDisplay:function(_1ab5){if(!_1ab5&&!this.validate()){return;}this.showControl=_1ab5;_1aab.set(this.labelNode,"display",_1ab5?"none":"");_1aab.set(this.control.domNode,"display",_1ab5?"":"none");if(!this.readOnly){_1aab.set(this.changeNode,"display",_1ab5?"none":"");}},focus:function(){if(this.showControl){this.control.focus();}else{this.changeNode.focus();}},_onControlChange:function(value){this._set("value",value);this.set("labelValue",typeof (value)=="string"?_1ab2.encode(value):value);this.set("isEmpty",!value);this.onChange(value);},_onControlBlur:function(){this._setDisplay(false);},_onChangeNodeClick:function(e){event.stop(e);this._setDisplay(true&&!this.readOnly);dijit.selectInputText(this.control.focusNode);},_setReadOnlyAttr:function(_1ab6){this._set("readOnly",_1ab6);_1aab.set(this.changeNode,"display",this.readOnly?"none":"");this.readOnly&&this._setDisplay(false);},validate:function(){return this.control.validate();},isValid:function(){return this.control.isValid();},getErrorMessage:function(){return this.control.getErrorMessage();},_isHtml:function(text){return text!==_1ab2.encode(text);}});});},"url:epi-cms/contentediting/editors/templates/_PreviewableEditor.html":"<div class=\"dijitReset dijitInline epi-previewableTextBox-wrapper\">\n    <span data-dojo-attach-point=\"labelNode\" class=\"epi-previewableTextBox-text dojoxEllipsis dijitInline\"></span>\n    <a href=\"#\" data-dojo-attach-point=\"changeNode, focusNode\" class=\"epi-previewableTextBox-link epi-functionLink\">${changeLabel}</a>\n</div>\n","epi-cms/contentediting/editors/PreviewableTextEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dijit/form/ValidationTextBox","epi-cms/contentediting/editors/_PreviewableEditor"],function(array,_1ab7,_1ab8,_1ab9,_1aba){return _1ab7([_1aba],{required:false,intermediateChanges:false,controlParams:["intermediateChanges","regExp","required","invalidMessage"],_getRegExpAttr:function(){return this.regExp||"";}});});},"epi-cms/contentediting/editors/ShortcutEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/shell/widget/dialog/Dialog","epi-cms/contentediting/ShortcutDialog","../viewmodel/ShortcutDialogViewModel","../../widget/_HasChildDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.widget.shortcutblockeditor","epi/i18n!epi/nls/episerver.shared"],function(_1abb,lang,_1abc,_1abd,_1abe,_1abf,_1ac0,_1ac1,epi,_1ac2,_1ac3,_1ac4,_1ac5,_1ac6,_1ac7){return _1abb([_1abe,_1abf,_1ac0,_1ac5],{templateString:"<div class=\"dijitInline\">                            <span data-dojo-attach-point=\"shortcutTypeNameNode\" class=\"dijitInline\"></span> <div class=\"epi-chromelessButton epi-chromelessLinkButton epi-functionLink\" data-dojo-attach-point=\"button\" data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick:_showDialog\" >${resources.action.manage}</div>                          </div>",resources:epi.resources,value:null,contentLink:null,metadata:null,watchHandlers:null,destroy:function(){if(this.button){this.button.destroyRecursive();}this.inherited(arguments);},onChange:function(value){},_showDialog:function(){var _1ac8=new _1ac3({metadata:this.metadata,contentLink:this.contentLink,value:this.value,model:new _1ac4({contentLink:this.contentLink,contentName:this.contentName,value:this.value})});var _1ac9=new _1ac2({defaultActionsVisible:false,confirmActionText:_1ac7.action.save,content:_1ac8,title:_1ac6.dialogtitle});_1ac9.connect(_1ac9,"onExecute",lang.hitch(this,function(value){this.set("value",_1ac8.get("value"));this.onChange(_1ac8.get("value"));}));_1ac9.connect(_1ac9,"onHide",lang.hitch(this,function(){this.isShowingChildDialog=false;}));this.isShowingChildDialog=true;_1ac9.show();},_setShortcutTypeNameAttr:{node:"shortcutTypeNameNode",type:"innerHTML"},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1abd.set(this.button.domNode,"display",value?"none":"");},_setValueAttr:function(value){this._set("value",value);this.set("ShortcutTypeName",value&&value.pageShortcutTypeName?value.pageShortcutTypeName:"");}});});},"epi-cms/contentediting/ShortcutDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-style","dojo/dom-class","dojo/html","dijit/_CssStateMixin","dojox/validate/regexp","epi-cms/widget/Breadcrumb","epi-cms/contentediting/PageShortcutTypeSupport","epi/shell/widget/dialog/_DialogContentMixin","epi/shell/widget/FormContainer","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/_ActionProviderWidget","dojo/text!./templates/ShortcutDialog.html","epi/i18n!epi/nls/episerver.shared"],function(_1aca,lang,_1acb,_1acc,html,_1acd,_1ace,_1acf,_1ad0,_1ad1,_1ad2,_1ad3,_1ad4,_1ad5,_1ad6){return _1aca([_1ad2,_1ad4,_1ad1,_1acd,_1ad3],{templateString:_1ad5,contentLink:null,contentName:null,baseClass:"epi-statusIndicator",_externalLinkWidget:null,_shortcutLinkWidget:null,_shortcutTypeWidget:null,_targetFrameWidget:null,_switchLinkTypeFirstRunDone:false,modelBindingMap:{contentLink:["contentLink"],contentName:["contentName"],enableSaveButton:["enableSaveButton"],enableShortcutLink:["enableShortcutLink"],enableExternalLink:["enableExternalLink"],clearExternalLink:["clearExternalLink"],enableOpenIn:["enableOpenIn"]},postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;},_setContentLinkAttr:function(value){this.breadcrumb.set("contentLink",value);},_setContentNameAttr:{node:"contentNameNode",type:"innerHTML"},_setEnableSaveButtonAttr:function(value){if(this._actions&&this._actions.length){this.setActionProperty("save","disabled",!value);}},_setEnableShortcutLinkAttr:function(value){if(this._shortcutLinkWidget){this._shortcutLinkWidget.set("required",value);this._shortcutLinkWidget.set("state","");var _1ad7=this._getAncestorNode(this._shortcutLinkWidget.domNode,"epi-form-container__section__row");if(_1ad7){_1acb.set(_1ad7,"display",value?"":"none");}}},_setEnableExternalLinkAttr:function(value){if(this._externalLinkWidget){this._externalLinkWidget.set("required",value);this._externalLinkWidget.set("disabled",!value);this._externalLinkWidget._set("state","");var _1ad8=this._getAncestorNode(this._externalLinkWidget.domNode,"epi-form-container__section__row");if(_1ad8){_1acb.set(_1ad8,"display",value?"":"none");}}},_setEnableOpenInAttr:function(value){if(this._targetFrameWidget){var _1ad9=this._getAncestorNode(this._targetFrameWidget.domNode,"epi-form-container__section__row");if(_1ad9){_1acb.set(_1ad9,"display",value?"":"none");}}},_getAncestorNode:function(node,_1ada){var _1adb=node?node.parentNode:null;if(!_1adb){return null;}if(!_1acc.contains(_1adb,_1ada)){return this._getAncestorNode(_1adb,_1ada);}return _1adb;},_setClearExternalLinkAttr:function(value){if(this._externalLinkWidget&&value&&!this._switchLinkTypeFirstRunDone){this._externalLinkWidget.reset();this._switchLinkTypeFirstRunDone=true;}},onFieldCreated:function(_1adc,_1add){switch(_1adc){case "pageLinkURL":this._externalLinkWidget=_1add;this.connect(this._externalLinkWidget.domNode,"onkeyup",lang.hitch(this,function(evt){this.model.set("enableSaveButton",true);}));break;case "pageShortcutLink":this._shortcutLinkWidget=_1add;this._shortcutLinkWidget.set("contentLink",this.model.get("contentLink"));break;case "pageShortcutType":this._shortcutTypeWidget=_1add;break;case "pageTargetFrame":this._targetFrameWidget=_1add;break;default:break;}},onChange:function(value){this.inherited(arguments);this.model.set("intermediateValue",lang.mixin(value,{pageShortcutTypeName:this._shortcutTypeWidget?this._shortcutTypeWidget.get("displayedValue"):""}));var _1ade=this._shortcutTypeWidget&&this._shortcutTypeWidget.get("value");if(_1ade===_1ad0.pageShortcutTypes.Shortcut){this._shortcutLinkWidget&&this._shortcutLinkWidget.set("canSelectOwnerContent",false);}},_getValueAttr:function(){return this.model.get("intermediateValue");},getActions:function(){this._actions=[{name:"save",label:_1ad6.action.save,settings:{type:"button",disabled:true,"class":"Salt"},action:lang.hitch(this,function(){if(this.validate()){this.executeDialog();}else{this.model.set("enableSaveButton",false);}})},{name:"cancel",label:_1ad6.action.cancel,settings:{type:"button"},action:lang.hitch(this,function(){this.cancelDialog();})}];return this._actions;}});});},"dojox/validate/regexp":function(){define("dojox/validate/regexp",["dojo/_base/lang","dojo/regexp","dojox/main"],function(lang,_1adf,dojox){var _1ae0=lang.getObject("validate.regexp",true,dojox);_1ae0=dojox.validate.regexp={ipAddress:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowDottedDecimal!="boolean"){flags.allowDottedDecimal=true;}if(typeof flags.allowDottedHex!="boolean"){flags.allowDottedHex=true;}if(typeof flags.allowDottedOctal!="boolean"){flags.allowDottedOctal=true;}if(typeof flags.allowDecimal!="boolean"){flags.allowDecimal=true;}if(typeof flags.allowHex!="boolean"){flags.allowHex=true;}if(typeof flags.allowIPv6!="boolean"){flags.allowIPv6=true;}if(typeof flags.allowHybrid!="boolean"){flags.allowHybrid=true;}var _1ae1="((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";var _1ae2="(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]";var _1ae3="(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]";var _1ae4="(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|"+"4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])";var hexRE="0[xX]0*[\\da-fA-F]{1,8}";var _1ae5="([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}";var _1ae6="([\\da-fA-F]{1,4}\\:){6}"+"((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";var a=[];if(flags.allowDottedDecimal){a.push(_1ae1);}if(flags.allowDottedHex){a.push(_1ae2);}if(flags.allowDottedOctal){a.push(_1ae3);}if(flags.allowDecimal){a.push(_1ae4);}if(flags.allowHex){a.push(hexRE);}if(flags.allowIPv6){a.push(_1ae5);}if(flags.allowHybrid){a.push(_1ae6);}var _1ae7="";if(a.length>0){_1ae7="("+a.join("|")+")";}return _1ae7;},host:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowIP!="boolean"){flags.allowIP=true;}if(typeof flags.allowLocal!="boolean"){flags.allowLocal=false;}if(typeof flags.allowPort!="boolean"){flags.allowPort=true;}if(typeof flags.allowNamed!="boolean"){flags.allowNamed=false;}var _1ae8="(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)";var _1ae9="(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)";var _1aea=flags.allowPort?"(\\:\\d+)?":"";var _1aeb="((?:"+_1ae8+"\\.)+"+_1ae9+"\\.?)";if(flags.allowIP){_1aeb+="|"+_1ae0.ipAddress(flags);}if(flags.allowLocal){_1aeb+="|localhost";}if(flags.allowNamed){_1aeb+="|^[^-][a-zA-Z0-9_-]*";}return "("+_1aeb+")"+_1aea;},url:function(flags){flags=(typeof flags=="object")?flags:{};if(!("scheme" in flags)){flags.scheme=[true,false];}var _1aec=_1adf.buildGroupRE(flags.scheme,function(q){if(q){return "(https?|ftps?)\\://";}return "";});var _1aed="(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?";return _1aec+_1ae0.host(flags)+_1aed;},emailAddress:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowCruft!="boolean"){flags.allowCruft=false;}flags.allowPort=false;var _1aee="([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+";var _1aef=_1aee+"@"+_1ae0.host(flags);if(flags.allowCruft){_1aef="<?(mailto\\:)?"+_1aef+">?";}return _1aef;},emailAddressList:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.listSeparator!="string"){flags.listSeparator="\\s;,";}var _1af0=_1ae0.emailAddress(flags);var _1af1="("+_1af0+"\\s*["+flags.listSeparator+"]\\s*)*"+_1af0+"\\s*["+flags.listSeparator+"]?\\s*";return _1af1;},numberFormat:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.format=="undefined"){flags.format="###-###-####";}var _1af2=function(_1af3){return _1adf.escapeString(_1af3,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d");};return _1adf.buildGroupRE(flags.format,_1af2);},ca:{postalCode:function(){return "([A-Z][0-9][A-Z] [0-9][A-Z][0-9])";},province:function(){return "(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)";}},us:{state:function(flags){flags=(typeof flags=="object")?flags:{};if(typeof flags.allowTerritories!="boolean"){flags.allowTerritories=true;}if(typeof flags.allowMilitary!="boolean"){flags.allowMilitary=true;}var _1af4="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|"+"NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";var _1af5="AS|FM|GU|MH|MP|PW|PR|VI";var _1af6="AA|AE|AP";if(flags.allowTerritories){_1af4+="|"+_1af5;}if(flags.allowMilitary){_1af4+="|"+_1af6;}return "("+_1af4+")";}}};return _1ae0;});},"url:epi-cms/contentediting/templates/ShortcutDialog.html":"<div class=\"epi-form-container\">\n    <div data-dojo-type=\"epi-cms/widget/Breadcrumb\" data-dojo-attach-point=\"breadcrumb\" data-dojo-props=\"showCurrentNode: false\"></div>\n    <h1 data-dojo-attach-point=\"contentNameNode\" class=\"epi-breadCrumbsCurrentItem dijitInline dojoxEllipsis\"></h1>\n    <div data-dojo-type=\"dijit/form/Form\" data-dojo-attach-point=\"form\"></div>\n</div>","epi-cms/contentediting/viewmodel/ShortcutDialogViewModel":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/string","epi-cms/contentediting/PageShortcutTypeSupport","epi/epi","epi/shell/_StatefulGetterSetterMixin"],function(_1af7,_1af8,_1af9,_1afa,epi,_1afb){return _1af7([_1af8,_1afb],{value:null,intermediateValue:null,savedValue:null,contentLink:null,contentName:null,enableSaveButton:null,enableShortcutLink:null,enableExternalLink:null,enableOpenIn:true,postscript:function(){this.inherited(arguments);this.set("savedValue",this.value);},_setIntermediateValueAttr:function(value){this._set("intermediateValue",value);this.set("enableSaveButton",!epi.areEqual(this.intermediateValue,this.savedValue));this.set("enableShortcutLink",value&&(value.pageShortcutType===_1afa.pageShortcutTypes.Shortcut||value.pageShortcutType===_1afa.pageShortcutTypes.FetchData)?true:false);this.set("enableExternalLink",value&&value.pageShortcutType===_1afa.pageShortcutTypes.External?true:false);this.set("clearExternalLink",value&&value.pageShortcutType===_1afa.pageShortcutTypes.External&&this.savedValue.pageShortcutType!==_1afa.pageShortcutTypes.External?true:false);this.set("enableOpenIn",value&&!(value.pageShortcutType===_1afa.pageShortcutTypes.FetchData||value.pageShortcutType===_1afa.pageShortcutTypes.Inactive||value.pageShortcutType===_1afa.pageShortcutTypes.Normal));},_setSavedValueAttr:function(value){this._set("savedValue",value);this.set("enableSaveButton",false);},save:function(){this.set("savedValue",this.intermediateValue);}});});},"epi-cms/contentediting/editors/TinyMCEEditor":function(){define(["dojo/_base/config","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/Deferred","dojo/keys","dojo/on","dojo/when","dojo/sniff","dojox/html/entities","dijit/_TemplatedMixin","dijit/focus","epi/routes","epi/shell/conversion/ObjectConverterRegistry","epi/shell/dnd/Target","epi/shell/layout/_LayoutWidget","epi/shell/TypeDescriptorManager","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/_DndStateMixin","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/_UserResizable","epi/shell/widget/dialog/Alert","tinymce/tiny_mce_src","dojo/text!./templates/TinyMCEEditor.html","epi/i18n!epi/cms/nls/tinymce","epi/i18n!epi/cms/nls/episerver.tinymce"],function(_1afc,_1afd,lang,win,_1afe,_1aff,_1b00,_1b01,keys,on,when,has,_1b02,_1b03,_1b04,_1b05,_1b06,_1b07,_1b08,_1b09,_1b0a,_1b0b,_1b0c,_1b0d,Alert,_1b0e,_1b0f,_1b10,_1b11){_1b0e.addI18n({en:lang.mixin({},_1b10,_1b11)});return _1afd([_1b08,_1b03,_1b0c,_1b0d,_1b0a,_1b0b],{baseClass:"epiTinyMCEEditor",width:null,height:null,value:null,intermediateChanges:true,templateString:_1b0f,settings:null,dirtyCheckInterval:2000,autoResizable:false,isResized:false,tinymceRendered:null,dropTarget:null,readOnly:false,_fullScreenEditor:null,_dirtyCheckTimeout:null,_editorValue:null,postMixInProperties:function(){this.inherited(arguments);if(this.autoResizable){this.height=0;}this.tinymceRendered=new _1b01();},postCreate:function(){this.own(this.dropTarget=new _1b07(this.dndOverlay,{accept:this.allowedDndTypes,createItemOnDrop:false,readOnly:this.readOnly}));this.connect(this.dropTarget,"onDropData","onDropData");this.connect(this.dndOverlay,"onmousemove","_onOverlayMouseMove");this.inherited(arguments);},startup:function(){if(this._started){return;}this.inherited(arguments);this._initTinyMCE();},destroy:function(){if(has("trident")){this._refocus();}if(this._destroyed){return;}this._cancelDirtyCheckInterval();var ed=this.getEditor();if(ed&&ed.getParam("fullscreen_is_enabled")){var _1b12=_1b0e.get(ed.getParam("fullscreen_editor_id"));_1b12.plugins.fullscreen.saveState(ed);}ed&&ed.remove();this.inherited(arguments);},_loadLegacyPlugins:function(){var dfd=new _1b01();this.legacyPlugins.forEach(function(_1b13){var url=_1b05.getActionPath({moduleArea:"Util",path:"Editor/tinymce/plugins/"+_1b13+"/"+(_1afc.isDebug?"editor_plugin_src.js":"editor_plugin.js")});_1b0e.PluginManager.load(_1b13,url);});_1b0e.ScriptLoader.loadQueue(function(){dfd.resolve();});return dfd.promise;},canAccept:function(){return !_1aff.contains(this.dndOverlay,"dojoDndTargetDisabled");},_onDndStart:function(){_1afe.set(this.dndOverlay,"display","block");this.inherited(arguments);},_onDndCancel:function(){_1afe.set(this.dndOverlay,"display","none");this.inherited(arguments);},_onDndDrop:function(){_1afe.set(this.dndOverlay,"display","none");this.inherited(arguments);},_onOverlayMouseMove:function(evt){this._dragPosition={x:evt.pageX,y:evt.pageY};},onDropData:function(_1b14,_1b15,nodes,copy){var _1b16=_1b14?(_1b14.length?_1b14[0]:_1b14):null;if(!_1b16){return;}if(this.onDropping){this.onDropping();}this._dropDataProcessor(_1b16);},_dropDataProcessor:function(_1b17){when(_1b17.data,lang.hitch(this,function(model){var self=this,type=_1b17.type,ed=this.getEditor();function _1b18(url){ed.focus();ed.execCommand("CreateLink",false,url);};function _1b19(html){ed.focus();if(ed.execCommand("mceInsertContent",false,html)){self._onChange(ed.getContent());}};function _1b1a(data){if(!ed.selection.isCollapsed()){_1b18(data.url);}else{var _1b1b="<a href=\"{0}\" title=\"{1}\">{1}</a>";_1b19(lang.replace(_1b1b,[data.url,_1b02.encode(data.text)]));}};function _1b1c(data){var _1b1d="<img alt=\"{alt}\" src=\"{src}\" width=\"{width}\" height=\"{height}\" />";var _1b1e=data.previewUrl||data.url;var _1b1f=_1b00.create("img",{src:_1b1e,style:{display:"none;"}},win.body(),"last");on.once(_1b1f,"load",function(){_1b19(lang.replace(_1b1d,{alt:this.alt,width:this.width,height:this.height,src:_1b1e}));_1b00.destroy(_1b1f);});};if(type&&type.indexOf("link")!==-1){_1b1a(model);return;}else{if(type&&type.indexOf("fileurl")!==-1){_1b1c(model);return;}}var _1b20=model.typeIdentifier;var _1b21=_1b09.getValue(_1b20,"editorDropBehaviour");if(_1b21){if(_1b21===1){var html="<div data-contentlink=\""+model.contentLink+"\" data-classid=\"36f4349b-8093-492b-b616-05d8964e4c89\" class=\"mceNonEditable epi-contentfragment\">"+model.name+"</div>";_1b19(html);return;}var _1b22,_1b23=_1b09.getInheritanceChain(_1b20);for(var i=0;i<_1b23.length;i++){var _1b24=_1b23[i];_1b22=_1b06.getConverter(_1b24,_1b24+".link");if(_1b22){break;}}if(!_1b22){return;}when(_1b22.convert(_1b20,_1b20+".link",model),lang.hitch(this,function(data){if(!data.url){var _1b25=new Alert({description:_1b11.notabletocreatelinkforpage});_1b25.show();this.own(_1b25);}else{switch(_1b21){case 2:_1b1a(data);break;case 3:_1b1c(data);break;}}}));}}));_1afe.set(this.dndOverlay,{display:"none"});},_onFocus:function(){this.inherited(arguments);this.focus();},focus:function(){var ed=this.getEditor();if(ed){when(this.tinymceRendered,lang.hitch(this,function(){_1b04.focus(ed.contentWindow.frameElement);ed.focus();}));}},getEditor:function(){if(typeof _1b0e==="undefined"||_1b0e===null){return null;}var ed=this._fullScreenEditor;if(ed&&ed.id==="mce_fullscreen"){return ed;}return _1b0e.get(this.editorFrame.id);},getEditorDOM:function(){return (typeof _1b0e!=="undefined"&&_1b0e!==null)?_1b0e.DOM:null;},resizeEditor:function(){var ed=this.getEditor(),_1b26=0,_1b27=(_1b0e.isIE?document.body.clientHeight:window.innerHeight)-200,_1b28=(_1b0e.isIE?document.body.clientWidth:window.innerWidth)-200,d=ed.getDoc(),b=d.body,DOM=_1b0e.DOM,_1b29=this.height,_1b2a=this.width,_1b2b,_1b2c;_1b2b=b.scrollHeight;_1b2c=b.scrollWidth;if(_1b2b>_1b26){_1b29=_1b2b;}if(_1b2b>_1b27){_1b29=_1b27;}if(_1b2c>_1b28){_1b2a=_1b28;}DOM.setStyle(ed.contentWindow.frameElement,"height",_1b29+80+"px");if(ed.getBody().scrollWidth!==ed.getBody().offsetWidth){var _1b2d=20;if(_1b29===_1b27){_1b2d=30;}DOM.setStyle(ed.contentWindow.frameElement,"width",ed.getBody().scrollWidth+_1b2d+"px");}this.isResized=true;},_setValueAttr:function(_1b2e){var ed=this.getEditor(),_1b2f=_1b2e||"";this._set("value",_1b2e);if(ed&&ed.initialized){ed.setContent(_1b2f);}else{this.editorFrame.value=_1b2f;}},_updateTinySettings:function(){this.settings=lang.mixin(this.settings,{mode:"exact",width:this.width,height:this.height,relative_urls:false,elements:this.editorFrame.id,readonly:this.readOnly});},_initTinyMCE:function(){this._loadLegacyPlugins().then(function(){this._updateTinySettings();if(this.legacyPlugins&&this.legacyPlugins.length>0){this.settings.plugins=this.settings.plugins+","+this.legacyPlugins.join(",");}if(typeof _1b0e!=="undefined"){_1b0e.dom.Event.domLoaded=true;this._setupHandle=_1b0e.onAddEditor.add(lang.hitch(this,this._onAddEditor));_1b0e.init(this.settings);}else{console.error("Couldn't initialize the editor");}}.bind(this));},_isFullScreen:function(ed){return ed.editorId==="mce_fullscreen";},_onAddEditor:function(_1b30,ed){if(this.editorFrame&&ed.id===this.editorFrame.id){this._setupEditorEventHandling(_1b30,ed);}else{if(this.editorFrame&&ed.settings.fullscreen_editor_id===this.editorFrame.id){this._setupEditorEventHandling(_1b30,ed);this._fullScreenEditor=ed;}}},_handlePopupWindow:function(ed){ed.windowManager.onOpen.add(lang.hitch(this,function(){this.isShowingChildDialog=true;}));var _1b31=lang.hitch(this,function(){this.focus();this.isShowingChildDialog=this._isFullScreen(ed);if(!this.isShowingChildDialog){this._onChange(ed.getContent());}});ed.windowManager.onClose.add(lang.hitch(this,function(){setTimeout(_1b31);}));},_handlePopupMenu:function(ed){var _1b32;for(var i in ed.controlManager.controls){_1b32=ed.controlManager.controls[i];if(_1b32.onRenderMenu){_1b32.onRenderMenu.add(lang.hitch(this,function(_1b33,menu){menu.onShowMenu.add(lang.hitch(this,function(){this.isShowingChildDialog=true;}));menu.onHideMenu.add(lang.hitch(this,function(){this.isShowingChildDialog=this._isFullScreen(ed);}));}));}}},_setupEditorEventHandling:function(_1b34,ed){ed.onInit.add(lang.hitch(this,function(){!this.tinymceRendered.isResolved()&&this.tinymceRendered.resolve();this.own(_1b04.registerIframe(ed.contentWindow.frameElement));this._handlePopupMenu(ed);this._handlePopupWindow(ed);if(this.autoResizable){setTimeout(lang.hitch(this,this.resizeEditor),200);}else{this.set("isResized",true);}this._startDirtyCheckInterval();if(ed&&ed.selection){ed.selection.onSetContent.add(lang.hitch(this,function(_1b35,args){var isSet=args.set;if(isSet){this._onChange(ed.getContent());}}));}}));ed.onChange.add(lang.hitch(this,function(ed,e){this._onChange(ed.getContent());}));ed.onSetContent.add(lang.hitch(this,"onSetContent"));ed.onRemove.add(lang.hitch(this,"onEditorRemoved"));ed.onRedo.add(lang.hitch(this,"onRedo"));ed.onUndo.add(lang.hitch(this,"onUndo"));ed.onBeforeExecCommand.add(lang.hitch(this,function(ed,cmd,ui,val,a){this._onChange(ed.getContent());if(cmd==="mceFullScreen"&&ed.id!=="mce_fullscreen"){this.isShowingChildDialog=!this._isFullScreen(ed);}else{if(cmd==="mceFullScreen"&&ed.id==="mce_fullscreen"){this._fullScreenEditor=null;}}}));},onSetContent:function(ed,e){var _1b36=ed.getContent(),_1b37=this.get("_editorValue")!==_1b36;e.initial&&this.set("_editorValue",_1b36);if(_1b37){this.validate();this.onLayoutChanged();}},onEditorRemoved:function(ed){},_isMetaKey:function(e){if(e.keyCode===keys.CTRL||e.keyCode===keys.ALT||e.keyCode===keys.SHIFT||e.keyCode===keys.META){return true;}return false;},_onChange:function(val){var _1b38=this.get("_editorValue")!==val;if(_1b38){this._set("value",val);this.set("_editorValue",val);if(this.validate()){this.onChange(val);}}},onChange:function(val){},_stopEditing:function(){var ed=this.getEditor(),val=ed.getContent();this.displayMessage(null);if(ed&&ed.undoManager&&ed.undoManager.typing){ed.undoManager.typing=0;ed.undoManager.add();}this._onChange(val);},_onBlur:function(){this._stopEditing();this.inherited(arguments);},_cancelDirtyCheckInterval:function(){if(this._dirtyCheckTimeout){clearTimeout(this._dirtyCheckTimeout);this._dirtyCheckTimeout=null;}},_startDirtyCheckInterval:function(){if(this._destroyed||!this.intermediateChanges){return;}this._cancelDirtyCheckInterval();this._dirtyCheck();this._dirtyCheckTimeout=setTimeout(lang.hitch(this,this._startDirtyCheckInterval),this.dirtyCheckInterval);},_dirtyCheck:function(){var ed=this.getEditor();var _1b39=lang.getObject("plugins.spellchecker.active",false,ed)||false;if(ed&&!_1b39){this._onChange(ed.getContent());}},onRedo:function(ed,level){},onUndo:function(ed,level){},_refocus:function(){var focEl=document.activeElement;var input=document.createElement("input");input.type="text";input.style.position="absolute";input.style.left="-9000px";input.style.height="0";input.style.width="0";document.getElementsByTagName("body")[0].appendChild(input);input.focus();if(focEl){focEl.focus();}else{input.blur();}input.parentNode.removeChild(input);input=focEl=null;}});});},"epi-cms/widget/_DndStateMixin":function(){define(["dojo","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/aspect","dojo/dom-class"],function(dojo,array,_1b3a,lang,_1b3b,_1b3c,_1b3d){return _1b3a([],{baseDndStateClass:"epi-dropTarget",dndStateClass:null,dropTarget:null,_aspectAfterHandler:null,postCreate:function(){this.subscribe("/dnd/start","_onDndStart");this.subscribe("/dnd/cancel","_onDndCancel");this.subscribe("/dnd/drop","_onDndDrop");if(this.dropTarget){this._aspectAfterHandler=_1b3c.after(this.dropTarget,"onDndStart",lang.hitch(this,"_onAfterDndStart"));}},_getDndStateClassAttr:function(){var _1b3e=this.canAccept()?"Enabled":"Disabled";this.dndStateClass=this.baseDndStateClass+_1b3e;return this.dndStateClass;},canAccept:function(){return false;},_onDndStart:function(){if(!this.dropTarget){_1b3d.add(this.domNode,this.get("DndStateClass"));}},_onAfterDndStart:function(){_1b3d.add(this.domNode,this.get("DndStateClass"));},_onDndCancel:function(){_1b3d.remove(this.domNode,this.dndStateClass);},_onDndDrop:function(){_1b3d.remove(this.domNode,this.dndStateClass);},destroy:function(){this.inherited(arguments);if(this._aspectAfterHandler){this._aspectAfterHandler.remove();this._aspectAfterHandler=null;}}});});},"epi-cms/widget/_UserResizable":function(){define(["dojo/_base/declare"],function(_1b3f){return _1b3f(null,{onResizeStart:function(){},onResizeStop:function(){}});});},"url:epi-cms/contentediting/editors/templates/TinyMCEEditor.html":"<div id=\"widget_${id}\">\n    <div style=\"display: inline-block\" data-dojo-attach-point=\"stateNode, tooltipNode\">\n        <textarea data-dojo-attach-point=\"editorFrame\" id=\"${id}_editorFrame\" style=\"border: none;\"></textarea>\n    </div>\n    <div data-dojo-attach-point=\"dndOverlay\" style=\"background: rgba(0, 0, 0, 0.01); position: absolute; left: 0; top: 0; right: 0; bottom: 0; display: none\"></div>\n</div>\n","epi-cms/contentediting/editors/TinyMCEOverlayItem":function(){define(["dojo/_base/declare","epi/shell/widget/overlay/Item"],function(_1b40,Item){return _1b40([Item],{postMixInProperties:function(){this.inherited(arguments);this.allowedDndTypes=[];}});});},"epi-cms/contentediting/editors/TinyMCEInlineEditor":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dojo/on","dojo/sniff","epi/string","epi-cms/contentediting/_HasFloatingComponent","epi-cms/contentediting/editors/TinyMCEEditor","dojo/text!./templates/TinyMCEInlineEditor.html"],function(array,_1b41,lang,dom,_1b42,_1b43,_1b44,_1b45,on,sniff,_1b46,_1b47,_1b48,_1b49){return _1b41([_1b47,_1b48],{baseClass:"epiTinyMCEInlineEditor",autoResizable:true,templateString:_1b49,inlineSettings:null,supportCustomDnd:true,_lastRng:null,_maxCheckRenderedTime:10,_editorIframe:null,onEditorBlur:function(){this._stopEditing();},onEditorResizing:function(_1b4a){},onEditorResized:function(_1b4b){},isEditing:function(){return this.domNode&&_1b44.get(this.domNode,"display").toLowerCase()!=="none";},startup:function(){this._checkingTime=0;if(this._started){return;}this.inherited(arguments);if(!this.ready){return;}this.own(this.watch("state",lang.hitch(this,function(name,_1b4c,_1b4d){on.emit(this.domNode,"editorstatechanged",_1b4d);})));},destroy:function(){this._clearLocalDefers();this._externalToolbar=this._toolbarSizeBox=this._toolbarRelativeContainer=this._toolbarRefContainer=null;this._latestButtonIds=this._editorIframe=this._toolbarFinishRender=null;this._lastRng=null;this.inherited(arguments);},focus:function(){this.inherited(arguments);var _1b4e=this.getEditor();if(!_1b4e){return;}if(!sniff("trident")){_1b4e.selection.setRng(this._lastRng||_1b4e.selection.getRng());}this.resizeEditor();},resizeEditor:function(){if(_1b44.get(this.containerNode,"display")==="none"){this.onEditorResized();return;}var _1b4f=this.getEditor(),style={height:"auto"},_1b50=this._getEditorIframe();_1b44.set(_1b50,style);style.height=_1b4f.getBody().parentNode.scrollHeight+"px";this.onEditorResizing({style:style});_1b44.set(_1b50,style);this.onEditorResized(lang.hitch(this,this._floatToolbar));this.isResized=true;},tryToStopEditing:function(){if(sniff("trident")){this._refocus();}},_onBlur:function(){},_updateTinySettings:function(){this.inherited(arguments);this.settings.width=this.settings.height="100%";this.settings=lang.mixin(this.settings,this.inlineSettings);},_setupEditorEventHandling:function(_1b51,_1b52){this.inherited(arguments);this._disableSetTopStyle();this._appendEditorResizeHandler(_1b52);this._appendEditorFloatToolbarHandler(_1b52);(sniff("ie")||sniff("trident"))&&_1b52.onNodeChange.add(lang.hitch(this,function(_1b53){this._lastRng=_1b53.selection.getRng();}));},_clearLocalDefers:function(){this._deferToolbarFullSize&&this._deferToolbarFullSize.remove();this._deferOnKeyUp&&this._deferOnKeyUp.remove();},_appendEditorResizeHandler:function(_1b54){var _1b55=lang.hitch(this,this.resizeEditor);_1b54.onChange.add(_1b55);_1b54.onSetContent.add(_1b55);_1b54.onPaste.add(_1b55);_1b54.onPostRender.add(_1b55);_1b54.onKeyUp.add(lang.hitch(this,function(){this._clearLocalDefers();this._deferOnKeyUp=this.defer(_1b55,10);}));_1b54.onExecCommand.add(lang.hitch(this,function(ed,cmd){if(cmd==="mceFullScreen"&&this._isFullScreen(tinyMCE.activeEditor)){_1b42.remove(tinyMCE.activeEditor.getBody(),this.settings.body_class);}}));},_appendEditorFloatToolbarHandler:function(_1b56){_1b56.onInit.add(lang.hitch(this,this._showEditorToolbar));_1b56.onActivate.add(lang.hitch(this,this._floatToolbar));_1b56.onMouseUp.add(lang.hitch(this,this._floatToolbar));},_showEditorToolbar:function(_1b57){if(!_1b57){return;}this.focus();_1b57.dom.show(this._getExternalToolbar());this._floatToolbar();},_disableSetTopStyle:function(){this.own(_1b45.before(this.getEditorDOM(),"setStyle",lang.hitch(this,function(n,na,v){if(n===this._getExternalToolbar()&&na==="top"){return [];}return;})));},_floatToolbar:function(){this._clearLocalDefers();if(!this._getExternalToolbar()){return;}if(!this._isToolbarRendered()){this._deferToolbarFullSize=this.defer(this._floatToolbar,100);return;}this.onComponentFloat(this._getComponentFloatInfo());},_getComponentFloatInfo:function(){return {componentInfo:{component:this._getExternalToolbar(),componentSizeBox:lang.hitch(this,function(){return this._toolbarSizeBox||(this._toolbarSizeBox=dom.byId(this.editorFrame.id+"_tblext"));})(),relativeContainer:lang.hitch(this,function(){return this._toolbarRelativeContainer||(this._toolbarRelativeContainer=this._getExternalToolbar().parentNode);})(),refContainer:lang.hitch(this,function(){return this._toolbarRefContainer||(this._toolbarRefContainer=dom.byId(this.editorFrame.id+"_parent"));})()},floatingInfo:{refreshPosition:false}};},_isToolbarRendered:function(){if(this._checkingTime>this._maxCheckRenderedTime){return true;}this._checkingTime++;var _1b58=null,_1b59=0;return this._toolbarFinishRender||(this._toolbarFinishRender=this._getToolbarLatestButtonIds().every(function(_1b5a){_1b58=dom.byId(this.editorFrame.id+"_"+_1b5a);_1b59=_1b58&&_1b43.position(_1b58).w;return _1b59!==0;},this));},_getToolbarLatestButtonIds:function(){if(this._latestButtonIds){return this._latestButtonIds;}this._latestButtonIds=[];var _1b5b=null;for(var _1b5c in this.settings){if(_1b5c.toLowerCase().indexOf("theme_advanced_button")!==-1){_1b5b=this.settings[_1b5c].split(",").pop();if(!_1b46.isNullOrEmpty(_1b5b)){this._latestButtonIds.push(_1b5b);}}}return this._latestButtonIds;},_getExternalToolbar:function(){return this._externalToolbar||(this._externalToolbar=dom.byId(this.editorFrame.id+"_external"));},_getEditorIframe:function(){return this._editorIframe||(this._editorIframe=dom.byId(this.editorFrame.id+"_ifr"));}});});},"epi-cms/contentediting/_HasFloatingComponent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/dom-style"],function(_1b5d,lang,_1b5e,_1b5f){return _1b5d(null,{componentGutter:7,_floatingComponentSize:null,_floatingComponent:null,_floatingComponentSizeBox:null,_floatingRelativeContainer:null,_floatingRefContainer:null,onComponentFloat:function(_1b60){this._floatingComponent=_1b60.componentInfo.component;this._floatingComponentSizeBox=_1b60.componentInfo.componentSizeBox;this._floatingRelativeContainer=_1b60.componentInfo.relativeContainer;this._floatingRefContainer=_1b60.componentInfo.refContainer;},getComponentInfo:function(){return {component:this._floatingComponent,componentSize:this._getFloatingComponentSize(),relativeContainer:this._floatingRelativeContainer,refContainer:this._floatingRefContainer};},destroy:function(){this._floatingComponentSizeBox=this._floatingComponent=this._floatingRelativeContainer=this._floatingRefContainer=null;this._floatingComponentSize=null;this.inherited(arguments);},_getFloatingComponentSize:function(){if(this._floatingComponentSize){return this._floatingComponentSize;}var _1b61=_1b5e.getMarginBox(this._floatingComponentSizeBox);return this._floatingComponentSize={height:parseInt(_1b61.h,10)+this.componentGutter,width:parseInt(_1b61.w,10)};}});});},"url:epi-cms/contentediting/editors/templates/TinyMCEInlineEditor.html":"<div id=\"widget_${id}\" style=\"position: relative; overflow: visible;\">\n    <div data-dojo-attach-point=\"stateNode, tooltipNode\">\n        <textarea data-dojo-attach-point=\"editorFrame\" id=\"${id}_editorFrame\" style=\"border: none; visibility: hidden; position: absolute; top:0; left:0; bottom:0; right:0;\"></textarea>\n    </div>\n    <div data-dojo-attach-point=\"dndOverlay\" style=\"background: rgba(0, 0, 0, 0.01); position: absolute; left: 0; top: 0; right: 0; bottom: 0; display: none\"></div>\n</div>\n","epi-cms/contentediting/FloatingEditorWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/topic","dijit/focus","epi/dependency","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(array,_1b62,lang,_1b63,_1b64,topic,_1b65,_1b66,_1b67,_1b68){return _1b62([_1b68],{formContainerWidgetType:"epi/shell/widget/FormContainer",isOverlayDisabled:true,isUndoDisabled:true,_overlayContainer:null,postCreate:function(){this.inherited(arguments);var self=this;this.own(topic.subscribe("/epi/shell/context/request",function(_1b69,_1b6a){if(!_1b6a.contextIdSyncChange){self.tryToStopEditing(false);self._destroyDialog();}}),topic.subscribe("/epi/shell/action/changeview",function(){self._removeEditingFeatures();}));},destroy:function(){this._removeEditingFeatures();this._destroyDialog();this.inherited(arguments);},startEdit:function(_1b6b){lang.mixin(this.editorParams,_1b6b);var self=this;self._destroyDialog();return self._setupDialog().then(function(){self.own(_1b63.after(self._dialog,"onAfterShow",function(){self._startEdit(_1b6b);self._onTryToStopWithInvalidValue();}));return self._dialog.show();});},_createDialog:function(_1b6c){return new _1b67({title:this.propertyDisplayName,content:_1b6c,duration:350,snapToNode:this.blockDisplayNode,positioner:_1b66.resolve("epi.shell.layout.PositioningUtility"),showButtonContainer:false});},_setBlockDisplayNodeAttr:function(node){this.inherited(arguments);var _1b6d=this._dialog;if(_1b6d){_1b6d.set("snapToNode",node);}},_setupDialog:function(){var _1b6e={};var _1b6f=function(_1b70,_1b71){_1b6e[_1b70]=_1b71;};var _1b72=lang.hitch(this,function(_1b73){for(var _1b74 in _1b6e){var _1b75=_1b6e[_1b74];_1b75.set("parent",this);}_1b6e=null;});var _1b76=lang.mixin({intermediateChanges:true},this.editorParams);if(this.editorWidgetType===this.formContainerWidgetType){lang.mixin(_1b76,{onFieldCreated:_1b6f,onFormCreated:_1b72,doLayout:false});}var _1b77=new _1b64();require([this.editorWidgetType],lang.hitch(this,function(_1b78){var _1b79=new _1b78(_1b76);this.editorWidget=_1b79;var _1b7a=this._createDialog(_1b79);this._handlers=[this.connect(_1b7a,"onButtonClose",this._onButtonClose),this.connect(_1b7a,"onCancel",this._onDialogCancel),this.connect(_1b7a.doneButtonNode,"onClick",this._onButtonClose),this.connect(_1b79,"onChange",this._onChange),this.connect(_1b79,"onKeyPress","_onEditorKeyPress")];this._dialog=_1b7a;if(this._createdEditor&&this.editorWidget.startup){this.editorWidget.startup();}_1b77.resolve();}));return _1b77.promise;},_onDialogCancel:function(){this.cancel();},_destroyDialog:function(){array.forEach(this._handlers,function(_1b7b){_1b7b.remove();});this._handlers=null;if(this._dialog){this._dialog.destroy();this._dialog=null;}if(this.editorWidget){this.editorWidget.destroy();this.editorWidget=null;}},_removeEditingFeatures:function(){var _1b7c=this._dialog;if(_1b7c&&_1b7c.open){_1b7c.hide();}},_onTryToStopWithInvalidValue:function(){_1b65.focus(this._dialog.titleNode);if(this.editorWidget.focus){this.editorWidget.focus();}},_onButtonClose:function(){this.tryToStopEditing(false);}});});},"epi/shell/widget/dialog/LightWeight":function(){require({cache:{"url:epi/shell/widget/dialog/templates/LightWeight.html":"<div class=\"epi-lfw-dialog epi-lfw-dialog--dark dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\n    <div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\n        <span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\n         <span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onButtonClose\" title=\"${buttonCloseText}\" role=\"button\" tabIndex=\"0\">\n            <span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCloseText}\">x</span>\n        </span>\n    </div>\n    <div class=\"dijitDialogPaneContent\">\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContentArea\" data-dojo-attach-event=\"onclick:_onContainerNodeClick\"></div>\n        <div data-dojo-attach-point=\"buttonContainerNode\" class=\"dijitDialogPaneActionBar clearfix\">\n            <button data-dojo-attach-point=\"doneButtonNode\" data-dojo-type=\"dijit/form/Button\" type=\"button\">${buttonDoneText}</button>\n        </div>\n    </div>\n</div>\n"}});define("epi/shell/widget/dialog/LightWeight",["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-geometry","dojo/dom-style","dojo/has","dijit/focus","dijit/DialogUnderlay","dijit/Dialog","epi/shell/widget/dialog/_DialogMixin","dijit/_WidgetsInTemplateMixin","epi/i18n!epi/nls/episerver.shared","dojo/text!./templates/LightWeight.html"],function(_1b7d,lang,_1b7e,_1b7f,_1b80,has,focus,_1b81,_1b82,_1b83,_1b84,_1b85,_1b86){return _1b7d([_1b82,_1b83,_1b84],{templateString:_1b86,buttonCloseText:_1b85.action.close,buttonDoneText:_1b85.action.done,buttonLearnMoreText:_1b85.action.learnmore,useGlassUnderlay:false,_glassUnderlay:null,"class":"epi-lfw-dialog",snapToNode:null,positioner:null,showButtonContainer:true,destroy:function(){this._interval&&clearInterval(this._interval);this.inherited(arguments);},show:function(){return this.inherited(arguments).then(lang.hitch(this,this._onAfterShow));},_size:function(){var _1b87=this._relativePosition&&this._relativePosition.id;_1b80.set(this.containerNode,"overflow","visible");this.inherited(arguments);_1b80.set(this.containerNode,"overflow","auto");if(this.positioner){var obj={snapTo:this.snapToNode,transformIndex:_1b87};this._relativePosition=this.positioner.findPosition(this.domNode,obj);}},resize:function(){this._size();this._position();},_onAfterShow:function(){function _1b88(){var _1b89=_1b7f.position(this.domNode),_1b8a=this._relativePosition;if(_1b8a&&(Math.abs(_1b8a.w-_1b89.w)>8||Math.abs(_1b8a.h-_1b89.h)>8)){this.resize();}};if(this.content&&this.content.focus){this.content.focus();}if(this.useGlassUnderlay){this._createUnderlay();}else{if(this._moveable&&!this._attachedMoveEvents){this.connect(this._moveable,"onMoveStart",lang.hitch(this,this._createUnderlay));this.connect(this._moveable,"onMoveStop",lang.hitch(this,this._removeUnderlay));this._attachedMoveEvents=true;}if(this.content&&this.content.onResizeStart&&this.content.onResizeStop&&!this._attachedContentResizeEvents){this.own(_1b7e.after(this.content,"onResizeStart",lang.hitch(this,this._createUnderlay)),_1b7e.after(this.content,"onResizeStop",lang.hitch(this,this._removeUnderlay)));this._attachedContentResizeEvents=true;}}this._interval=setInterval(lang.hitch(this,_1b88),250);this.onAfterShow();},_createUnderlay:function(){var _1b8b=this.containerNode,_1b8c=_1b80.get(_1b8b,"width");if(has("trident")){var _1b8d=_1b8b.offsetWidth-_1b8b.clientWidth;_1b8c+=_1b7f.getPadBorderExtents(_1b8b).w+_1b8d;}_1b80.set(_1b8b,{width:_1b8c+"px"});if(this._glassUnderlay){this._glassUnderlay.show();}else{this.own(this._glassUnderlay=new _1b81());this._glassUnderlay.show();var _1b8e=_1b80.get(this.domNode,"zIndex");_1b80.set(this._glassUnderlay.domNode,"zIndex",_1b8e-1);_1b80.set(this._glassUnderlay.domNode,"opacity","0");}},_endDrag:function(){this.inherited(arguments);this._relativePosition.id=this.positioner.userSetTransformId;},_removeUnderlay:function(){this._glassUnderlay.hide();},_onContainerNodeClick:function(e){if(e.target===this.containerNode){this._getFocusItems();this._firstFocusItem&&focus.focus(this._firstFocusItem);}},_setSnapToNodeAttr:function(node){this.snapToNode=null;this._set("snapToNode",node);},onButtonClose:function(){},onAfterShow:function(){},onAfterHide:function(){},hide:function(){this._interval&&clearInterval(this._interval);this._interval=null;return this.inherited(arguments).then(lang.hitch(this,this._onAfterHide));},_onAfterHide:function(){if(this.useGlassUnderlay){this._removeUnderlay();}this.onAfterHide();},layout:function(){if(this._glassUnderlay&&_1b80.get(this._glassUnderlay.domNode,"display")!=="none"){this._glassUnderlay.layout();}var _1b8f=_1b81._singleton;var _1b90=_1b8f?_1b80.get(_1b8f.domNode,"display"):null;this.inherited(arguments);if(_1b8f){_1b80.set(_1b8f.domNode,"display",_1b90);}},_setShowButtonContainerAttr:function(_1b91){this._set("showButtonContainer",_1b91);_1b80.set(this.buttonContainerNode,"display",_1b91?"":"none");},_checkIfSingleChild:function(){this._singleChild=null;}});});},"url:epi/shell/widget/dialog/templates/LightWeight.html":"<div class=\"epi-lfw-dialog epi-lfw-dialog--dark dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\n    <div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\n        <span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\n         <span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: onButtonClose\" title=\"${buttonCloseText}\" role=\"button\" tabIndex=\"0\">\n            <span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCloseText}\">x</span>\n        </span>\n    </div>\n    <div class=\"dijitDialogPaneContent\">\n        <div data-dojo-attach-point=\"containerNode\" class=\"dijitDialogPaneContentArea\" data-dojo-attach-event=\"onclick:_onContainerNodeClick\"></div>\n        <div data-dojo-attach-point=\"buttonContainerNode\" class=\"dijitDialogPaneActionBar clearfix\">\n            <button data-dojo-attach-point=\"doneButtonNode\" data-dojo-type=\"dijit/form/Button\" type=\"button\">${buttonDoneText}</button>\n        </div>\n    </div>\n</div>\n","epi-cms/contentediting/OverlayBasedEditorWrapper":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","epi/shell/widget/IframeWithOverlay","epi-cms/contentediting/_EditorWrapperBase"],function(_1b92,lang,on,_1b93,_1b94){return _1b92([_1b94],{destroy:function(){this._iframeWithOverlay=null;this.inherited(arguments);},_onEditorResize:function(_1b95){},_onEditorResizeFinished:function(_1b96){},_getOverlayItemAttr:function(){return this.overlayItem||this.editorParams.overlayItem;},_getIframeWithOverlayAttr:function(){if(this._iframeWithOverlay){return this._iframeWithOverlay;}var _1b97=null,_1b98=this.overlayItem;while(_1b98){if(_1b98 instanceof _1b93){_1b97=_1b98;break;}_1b98=_1b98.getParent();}return this._iframeWithOverlay=_1b97;}});});},"epi-cms/contentediting/FlyoutEditorWrapper":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/number","epi/shell/widget/IframeWithOverlay","epi/shell/widget/dialog/LightWeight","epi-cms/contentediting/FloatingEditorWrapper"],function(_1b99,_1b9a,lang,_1b9b,_1b9c,_1b9d,_1b9e,_1b9f,_1ba0,_1ba1){return _1b9a([_1ba1],{_eventHandlers:null,constructor:function(){this._eventHandlers=[];},_createDialog:function(_1ba2){var _1ba3=function(_1ba4){if(!this.open||!_1ba4){return;}this._containerNodeCS=this._containerNodeCS||_1b9d.getComputedStyle(this.containerNode);if(!this._dialogChromeSize){this._chromeHeight=_1b9c.getMarginBox(this.domNode).h-_1b9c.getMarginBox(this.containerNode).h;}_1b9c.setMarginBox(this.containerNode,{h:_1ba4.h-this._chromeHeight},this._containerNodeCS);_1b9d.set(this.domNode,{top:_1ba4.t+"px",left:_1ba4.l+"px"});};var _1ba5=new _1ba0({title:this.propertyDisplayName,content:_1ba2,duration:350,draggable:false,closeIconVisible:false,region:"trailing",resize:_1ba3,overlayItem:this.overlayItem,_position:function(){},_size:function(){}});_1b9b.add(_1ba5.domNode,"epi-floatingEditorWrapperDialog");_1b9b.remove(_1ba5.domNode,"epi-lfw-dialog--dark");_1ba5.placeAt(this.get("iframeWithOverlay"));_1b9d.set(_1ba5.domNode,{top:"-10000px"});return _1ba5;},_disconnectLocal:function(_1ba6){if(lang.isArray(_1ba6)){var _1ba7;while((_1ba7=_1ba6.pop())){_1b99.disconnect(_1ba7);}}},_removeEditingFeatures:function(){this.inherited(arguments);this._disconnectLocal(this._eventHandlers);}});});},"epi-cms/contentediting/InlineEditorWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-style","dojo/Deferred","dojo/on","dojo/when","epi-cms/contentediting/OverlayBasedEditorWrapper"],function(array,_1ba8,event,lang,_1ba9,_1baa,on,when,_1bab){return _1ba8([_1bab],{width:"100%",hasInlineEditor:true,matchStyle:false,destroy:function(){this._removeLocalHandlers();this._blockDisplayNodeOpacity=null;this.inherited(arguments);},tryToStopEditing:function(){var _1bac=this.getEditorWidget();if(_1bac&&_1bac.isEditing()){_1bac.onEditorBlur();}this.inherited(arguments,[true]);},_getOrCreateEditor:function(){if(this._createdEditor){return this.editorWidget;}var _1bad=new _1baa();var _1bae=lang.mixin(this.editorParams,{value:this.value});if(this.matchStyle){_1bae.style=this._computeStyling();}require([this.editorWidgetType],lang.hitch(this,function(_1baf){var _1bb0=this.editorWidget=new _1baf(_1bae);_1bb0.placeAt(this.get("overlayItem").domNode);this.own(on(_1bb0.domNode,"editorstatechanged",lang.hitch(this,this._onEditorStateChanged)));this._handlers=[this.connect(_1bb0,"onClick",event.stop),this.connect(_1bb0,"onEditorResizing",this._onEditorResizing),this.connect(_1bb0,"onEditorResized",this._onEditorResized)];this._handlers.push(this.connect(_1bb0,"onChange","_onEditorChange"));this._handlers.push(this.connect(_1bb0,"onKeyPress","_onEditorKeyPress"));this._createdEditor=true;_1bad.resolve(_1bb0);}));return _1bad;},_computeStyling:function(){var _1bb1=_1ba9.getComputedStyle(this.blockDisplayNode),_1bb2="line-height:"+_1bb1.lineHeight+";",_1bb3=_1ba9.getComputedStyle(this.domNode);["Weight","Family","Size","Style"].forEach(function(prop){var _1bb4=_1bb1["font"+prop],_1bb5=_1bb3["font"+prop];if(_1bb5!==_1bb4){_1bb2+="font-"+prop+":"+_1bb1["font"+prop]+";";}},this);var width=this.width;if(width==="100%"){_1bb2+="width:100%;";}else{_1bb2+="width:"+(width+(Number(width)===width?"px":""))+";";}_1bb2+="position: absolute; left: 0px; top: 0px;";return _1bb2;},_onEditorChange:function(value){this._onChange(value);},_onEditorResizing:function(_1bb6){},_onEditorResized:function(_1bb7){},_onEditorStateChanged:function(_1bb8){var _1bb9=this.get("overlayItem");_1bb9&&_1bb9.set("error",_1bb8==="Error");},startEdit:function(){var _1bba=this.getInherited(arguments);when(this._getOrCreateEditor(),lang.hitch(this,function(_1bbb){this._blockDisplayNodeOpacity=_1ba9.get(this.blockDisplayNode,"opacity");_1ba9.set(_1bbb.domNode,{display:""});_1ba9.set(this.blockDisplayNode,{opacity:0.5});_1bba.apply(this);this.focus();}));},_removeLocalHandlers:function(){(this._handlers instanceof Array&&this._handlers.length>0)&&this._handlers.forEach(function(_1bbc){_1bbc.remove();});},_onTryToStopWithInvalidValue:function(){},_removeEditingFeatures:function(){(this.blockDisplayNode&&this._blockDisplayNodeOpacity)&&_1ba9.set(this.blockDisplayNode,{opacity:this._blockDisplayNodeOpacity});(this.editorWidget&&this.editorWidget.domNode)&&_1ba9.set(this.editorWidget.domNode,"display","none");},_toggleSupportCustomDnd:function(_1bbd){var _1bbe=this.get("overlayItem");if(!_1bbe){return;}var _1bbf=this.getEditorWidget();if(!_1bbf||!_1bbf.supportCustomDnd){return;}if(_1bbd===true){_1bbe.transferDndControlTo(_1bbf);}else{_1bbe.transferDndControlTo(_1bbe);}},_toggleOverlayItemZIndex:function(_1bc0){var _1bc1=this.get("overlayItem");if(!_1bc1||!_1bc1.item){return;}var _1bc2=parseInt(_1ba9.get(_1bc1.item,"zIndex"),10);_1ba9.set(_1bc1.item,{zIndex:_1bc0===true?++_1bc2:--_1bc2});}});});},"epi-cms/contentediting/SettingsPanel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/when","dojo/dom-geometry","dijit/_Container","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/layout/BorderContainer","epi/shell/layout/SimpleContainer","dojo/text!./templates/SettingsPanel.html"],function(_1bc3,lang,array,_1bc4,when,_1bc5,_1bc6,_1bc7,_1bc8,_1bc9,_1bca,_1bcb,_1bcc){return _1bc3([_1bc9,_1bc6,_1bc7,_1bc8],{templateString:_1bcc,contentViewModel:null,detailsWidgetIdentifier:"epi-cms/contentediting/ContentDetails",detailsModelIdentifier:"epi-cms/contentediting/viewmodel/ContentDetailsViewModel",detailsWidgetProperties:null,_contentDetailsDef:null,_contentDetailsModelDef:null,buildRendering:function(){this.inherited(arguments);var _1bcd=this.detailsWidgetIdentifier;var _1bce=this.detailsModelIdentifier;var _1bcf=new _1bc4();var _1bd0=new _1bc4();require([_1bcd,_1bce],lang.hitch(this,function(_1bd1,_1bd2){var _1bd3=new _1bd1({},this.contentDetails);this.own(_1bd3);var model=new _1bd2();this.own(model);_1bd3.set("model",model);_1bd3.startup();this.contentDetails=_1bd3;_1bcf.resolve(_1bd3);_1bd0.resolve(model);}));this._contentDetailsDef=_1bcf;this._contentDetailsModelDef=_1bd0;},_setContentViewModelAttr:function(_1bd4){this._set("contentViewModel",_1bd4);when(this._contentDetailsModelDef,function(model){model.set("dataModel",_1bd4);});},addChild:function(w){if(this.detailsWidgetProperties){var _1bd5=array.filter(this.detailsWidgetProperties,function(item){return item.propertyName===w.name;});if(_1bd5.length>0){when(this._contentDetailsDef,lang.hitch(this,function(_1bd6){_1bd6.addChild(w,_1bd5[0].options);}));return;}}this.widgetContainer.addChild(w);}});});},"url:epi-cms/contentediting/templates/SettingsPanel.html":"<div class=\"epi-documentHeader\">\n    <div data-dojo-type=\"epi/shell/layout/SimpleContainer\" data-dojo-attach-point=\"widgetContainer\"></div>\n    <div data-dojo-attach-point=\"contentDetails\"></div>\n</div>","epi-cms/contentediting/ValidationTextboxWithWarning":function(){define(["dojo/_base/declare","dojox/validate/regexp","dijit/form/ValidationTextBox"],function(_1bd7,_1bd8,_1bd9){return _1bd7([_1bd9],{regExpForWarning:null,acceptUrl:false,acceptMailAddress:false,_refreshState:function(){if(!this._created){return;}this.focused?this._validateWhenTyping():this.validate(false);},_isValidWhenTyping:function(){var value=this.textbox.value;return (this.acceptUrl&&(new RegExp(_1bd8.url({scheme:true}))).test(value))||(this.acceptMailAddress&&(new RegExp("mailto\\:"+_1bd8.emailAddress())).test(value))||(this.regExpForWarning&&(new RegExp("^(?:"+this.regExpForWarning+")"+(this.required?"":"?")+"$")).test(value));},_validateWhenTyping:function(){var _1bda="";var _1bdb=this.disabled||this.isValid(true);if(_1bdb){this._maskValidSubsetError=true;}var _1bdc=this._isEmpty(this.textbox.value);var _1bdd=!_1bdb&&this._isValidSubset();this._set("state",_1bdb?(this._isValidWhenTyping()?"":"Incomplete"):(((_1bdc||_1bdd)&&this._maskValidSubsetError)?"Incomplete":"Error"));this.focusNode.setAttribute("aria-invalid",_1bdb?"false":"true");if(this.state==="Error"){this._maskValidSubsetError=_1bdd;_1bda=this.getErrorMessage(true);}else{if(this.state==="Incomplete"){_1bda=this.getPromptMessage(true);this._maskValidSubsetError=!this._hasBeenBlurred;}else{if(_1bdc){_1bda=this.getPromptMessage(true);}}}this.set("message",_1bda);return _1bdb;}});});},"epi-cms/contentediting/viewmodel/ContentDetailsViewModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/when","epi","epi/datetime","epi/dependency","epi/username","epi-cms/contentediting/command/AccessRights","epi-cms/contentediting/command/LanguageSettings","epi-cms/contentediting/command/DynamicProperties","epi/shell/command/_CommandConsumerMixin","epi/shell/command/_GlobalCommandProviderMixin","epi-cms/contentediting/ContentActionSupport","epi-cms/core/ContentReference","epi-cms/contentediting/viewmodel/_ContentViewModelObserver"],function(array,_1bde,lang,when,epi,_1bdf,_1be0,_1be1,_1be2,_1be3,_1be4,_1be5,_1be6,_1be7,_1be8,_1be9){return _1bde([_1be9,_1be5,_1be6],{commandKey:"epi.cms.contentdetailsmenu",res:null,contentTypeName:null,contentId:null,visibleToEveryOne:null,existingLanguages:null,accessRightsCommand:null,languageSettingsCommand:null,dynamicPropertiesCommand:null,expirationCommand:null,constructor:function(_1bea){_1bde.safeMixin(this,_1bea);},postscript:function(){this.initializeCommandProviders();this.accessRightsCommand=new _1be2();this.languageSettingsCommand=new _1be3();this.dynamicPropertiesCommand=new _1be4();if(!this.expirationCommand){var _1beb=_1be0.resolve("epi.cms.contentEditing.command.Editing");this.expirationCommand=_1beb.manageExpiration;}if(!this.store){var _1bec=_1be0.resolve("epi.storeregistry");this.store=_1bec.get("epi.cms.contenttype");}this.inherited(arguments);},destroy:function(){this.accessRightsCommand.destroy();this.languageSettingsCommand.destroy();this.dynamicPropertiesCommand.destroy();this.inherited(arguments);},_setDataModelAttr:function(value){this.updateCommandModel(value);this.accessRightsCommand.set("model",value);this.languageSettingsCommand.set("model",value);this.dynamicPropertiesCommand.set("model",value);this.inherited(arguments);},onDataModelChange:function(name,_1bed,value){var _1bee=this.dataModel.contentData,_1bef=new _1be8(_1bee.contentLink);this.set("contentId",_1bef.id);this.set("existingLanguages",array.map(_1bee.existingLanguageBranches,function(item){return {text:item.languageId,urlSegment:item.urlSegment,isCurrentLanguage:_1bee.currentLanguageBranch&&item.languageId===_1bee.currentLanguageBranch.languageId,contentLink:new _1be8(item.commonDraftLink).createVersionUnspecificReference().toString()};}));this.set("visibleToEveryOne",_1bee.visibleToEveryOne);when(this.store.get(_1bee.contentTypeID),lang.hitch(this,function(type){this.set("contentTypeName",type.localizedName);}));this.set("commands",this.getCommands());},getCommands:function(){var _1bf0=this.inherited(arguments);return [this.dynamicPropertiesCommand,this.languageSettingsCommand,this.expirationCommand].concat(_1bf0);}});});},"epi-cms/contentediting/command/AccessRights":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.accessrights"],function(_1bf1,_1bf2,_1bf3,_1bf4){return _1bf1([_1bf3],{name:"AccessRights",label:_1bf4.label,tooltip:_1bf4.tooltip,dialogPath:"Edit/EditSecurity.aspx",raiseCloseEvent:true,_onModelChange:function(){var _1bf5=this.model.contentData,_1bf6=_1bf2.hasAccess(_1bf5.accessMask,_1bf2.accessLevel.Administer),_1bf7=this.model.canChangeContent();this.set("canExecute",_1bf5.capabilities.securable&&_1bf6&&_1bf7);}});});},"epi-cms/contentediting/command/LanguageSettings":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.languagesettings"],function(_1bf8,_1bf9,_1bfa,_1bfb){return _1bf8([_1bfa],{name:"LanguageSettings",label:_1bfb.label,tooltip:_1bfb.tooltip,dialogPath:"Edit/LanguageSettings.aspx",raiseCloseEvent:true,_onModelChange:function(){var _1bfc=this.model.contentData,_1bfd=_1bf9.hasAccess(_1bfc.accessMask,_1bf9.accessLevel.Administer);this.set("canExecute",_1bfc.capabilities.languageSettings&&_1bfd);}});});},"epi-cms/contentediting/command/DynamicProperties":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi-cms/contentediting/command/_LegacyDialogCommandBase","epi-cms/ApplicationSettings","epi/i18n!epi/cms/nls/episerver.cms.contentediting.contentdetails.command.dynamicproperties"],function(_1bfe,_1bff,_1c00,_1c01,_1c02){return _1bfe([_1c00],{label:_1c02.label,tooltip:_1c02.tooltip,dialogPath:"Edit/EditDynProp.aspx",raiseCloseEvent:true,postscript:function(){this.inherited(arguments);this.set("isAvailable",_1c01.isDynamicPropertiesEnabled);},_onModelChange:function(){var _1c03=this.model.contentData,_1c04=_1bff.hasAccess(_1c03.accessMask,_1bff.accessLevel.Administer),_1c05=this.model.canChangeContent();this.set("canExecute",_1c03.capabilities.dynamicProperties&&_1c04&&_1c05);}});});},"epi-cms/conversion/PropertyContentAreaConverter":function(){define(["dojo/_base/declare"],function(_1c06){return _1c06(null,{sourceDataType:"epi.cms.propertycontentarea",targetDataType:"runtimeType",registerDefaultConverters:function(_1c07){_1c07.registerConverter(this.sourceDataType,this.targetDataType,this);},convert:function(_1c08,_1c09,data){if(_1c08===this.sourceDataType&&_1c09===this.targetDataType){return data?data._unparsedString:data;}return null;}});});},"epi-cms/layout/CreateContentGroupContainer":function(){define(["dojo/_base/declare","dojo/dom-construct","epi/shell/layout/SimpleContainer"],function(_1c0a,_1c0b,_1c0c){return _1c0a([_1c0c],{templateString:"<div class='epi-containerLayout clearfix'>                            <div class='epi-formsHeaderContainer'>                                <h2>${title}</h2>                            </div>                            <ul data-dojo-attach-point='containerNode'></ul>                        </div>"});});},"epi-cms/layout/EditLayoutContainer":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/when","dijit/layout/TabContainer","dijit/registry","dojo/text!./templates/EditLayoutContainer.html"],function(array,_1c0d,_1c0e,when,_1c0f,_1c10,_1c11){return _1c0d([_1c0f],{templateString:_1c11,postMixInProperties:function(){this.inherited(arguments);this.doLayout=false;this.tabPosition="top";},addChild:function(_1c12,index){if(_1c12.region==="top"){this.own(_1c12.placeAt(this.topPaneContainerNode));}else{this.inherited(arguments);}},removeChild:function(_1c13){if(_1c13.region==="top"){if(this._descendantsBeingDestroyed){return;}if(this._started){this.layout();}}else{this.inherited(arguments);}},layout:function(){if(!this._contentBox||typeof (this._contentBox.l)=="undefined"){return;}var _1c14=_1c10.findWidgets(this.topPaneContainerNode);array.forEach(_1c14,function(_1c15){_1c15.resize();});return this.inherited(arguments);},selectChild:function(_1c16){if(_1c16.region==="top"){return;}else{return when(this.inherited(arguments)).then(function(_1c17){this.layout();return _1c17;}.bind(this));}}});});},"url:epi-cms/layout/templates/EditLayoutContainer.html":"<div class=\"dijitTabContainer\">\n    <div data-dojo-attach-point=\"topPaneContainerNode\"></div>\n\t<div class=\"dijitTabListWrapper\" data-dojo-attach-point=\"tablistNode\"></div>\n\t<div data-dojo-attach-point=\"tablistSpacer\" class=\"dijitTabSpacer ${baseClass}-spacer\"></div>\n\t<div class=\"dijitTabPaneWrapper ${baseClass}-container\" data-dojo-attach-point=\"containerNode\"></div>\n</div>\n","epi-cms/legacy/LegacyFormEditor":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/focus","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/dependency","epi/shell/widget/dialog/Dialog","epi-cms/widget/_HasChildDialogMixin","epi/shell/widget/_ValueRequiredMixin","epi-cms/legacy/EditPropertyWidget","epi/i18n!epi/cms/nls/episerver.cms.legacy.legacyformeditor"],function(_1c18,lang,_1c19,_1c1a,_1c1b,_1c1c,_1c1d,epi,_1c1e,_1c1f,_1c20,_1c21,_1c22,res){return _1c18([_1c1a,_1c1b,_1c1c,_1c20,_1c21],{localization:res,destroyOnHide:false,editorWidgetClass:_1c22,templateString:"            <div class=\"dijit dijitReset dijitInline dijitLeft epi-legacyFormEditor\">                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"openButton\" data-dojo-attach-event=\"onClick: openEditor\" data-dojo-props=\"label:'${localization.helptext}'\"></div>            </div>",editorWidget:null,value:null,multiple:false,contentLink:null,contentTypeId:null,contentLanguage:null,propertyName:null,_dialog:null,onChange:function(){},postCreate:function(){this.inherited(arguments);lang.mixin(this.params,{contentLink:this.contentLink});},buildRendering:function(){this.inherited(arguments);if(this.output){this.output.set("disabled",true);}},destroy:function(){if(this._dialog){this._dialog.destroyRecursive();}this.inherited(arguments);},_setReadOnlyAttr:function(value){this._set("readOnly",value);this.openButton.set("disabled",value);},_setValueAttr:function(value){this._set("value",value);if(this.editorWidget&&!epi.areEqual(value,this.editorWidget.get("value"))){this.editorWidget.set("value",value);}this.setDisplayValue(value);},_onChange:function(){var value=this.editorWidget.get("value");this.set("value",value);this.onChange(value);if(this._dialog&&this._dialog.open){this._dialog.hide();}},_onCancel:function(){this._dialog.hide();},_onDialogHide:function(){this.isShowingChildDialog=false;if(this.destroyOnHide){this.editorWidget=this._dialog=null;}},openEditor:function(){this.isShowingChildDialog=true;if(!this._dialog){this._createDialog();}this.editorWidget.set("value",this.value);this._dialog.show();},_createDialog:function(){var _1c23=this.editorWidgetClass;this.editorWidget=new _1c23(this.params);this._dialog=new _1c1f({destroyOnHide:this.destroyOnHide,content:this.editorWidget,title:this.editorWidget.title||this.label,defaultActionsVisible:false,dialogClass:"",contentClass:"epi-dialog-fullWidth"});this.connect(this.editorWidget,"onResize",lang.hitch(this,function(){this._dialog.resize();}));this.connect(this.editorWidget,"onChange","_onChange");this.connect(this.editorWidget,"onCancel","_onCancel");this.connect(this._dialog,"onHide","_onDialogHide");},setDisplayValue:function(value){if(this.output){this.output.set("value",this.localization.helptext);}},focus:function(){this.openButton.focus();}});});},"epi-cms/legacy/EditPropertyWidget":function(){define(["epi","dojo","dijit","dojo/i18n","dojo/string","dojox/html/entities","epi-cms/contentediting/RenderManager","epi-cms/legacy/LegacyDialogWrapper","epi/routes"],function(epi,dojo,dijit,i18n,_1c24,_1c25,_1c26,_1c27,_1c28){return dojo.declare([_1c27],{editorFeatures:null,value:"",contentLink:null,contentTypeId:null,contentLanguage:null,propertyName:null,fullName:null,_reloadOnNextEdit:false,onChange:function(_1c29){},postMixInProperties:function(){this.features=dojo.mixin({width:400,height:30},this.editorFeatures);this.autoFit=true;this.connect(this,"onCallback","_onCallback");this.inherited(arguments);},startup:function(){this.inherited(arguments);var _1c2a={moduleArea:"LegacyCMS",path:"edit/EditProperty.aspx",epslanguage:this.contentLanguage,propertyname:this.fullName};dojo.mixin(_1c2a,this.contentLink?{id:this.contentLink}:{contentTypeId:this.contentTypeId,parentLink:this.parentLink});this.set("url",_1c28.getActionPath(_1c2a));},_setUrlAttr:function(url){this._currentUrl=url;var value=_1c25.encode(dojo.toJson(this.value));var _1c2b=_1c24.substitute("<html><body><form method=\"post\" action=\"${0}\" ><input type=\"hidden\" name=\"value\" value=\"${1}\" /></form></body></html>",[url,value]);this.containerIframe.contentDocument.write(_1c2b);this.containerIframe.contentDocument.forms[0].submit();},_onCallback:function(_1c2c){var _1c2d=_1c2c.value;var _1c2e=dojo.fromJson(_1c2d);if(this._oldStringValue===undefined){this._oldStringValue=dojo.toJson(this.value);}if(_1c2d!==this._oldStringValue){this._oldStringValue=dojo.toJson(_1c2e);this.value=_1c2e;this.onChange(_1c2e);}else{this.onCancel();}},resize:function(){this.inherited(arguments);if(this._reloadOnNextEdit){this._reloadOnNextEdit=false;this._reloadUrl(true);}},_setValueAttr:function(value){this._set("value",value);if(this._started){this._reloadOnNextEdit=true;}}});});},"epi-cms/legacy/LegacyDialogWrapper":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/on","dojo/topic","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/has","dojo/query","dojo/string","dojo/when","dijit/_Contained","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/a11y","dijit/focus","dijit/layout/_LayoutWidget","epi/Url","epi/shell/widget/_ActionProviderWidget","epi-cms/legacy/_LegacyDialogObject","epi-cms/legacy/LegacyDialogPopup","epi/i18n!epi/cms/nls/episerver.shared.action"],function(array,_1c2f,lang,_1c30,on,topic,_1c31,_1c32,_1c33,_1c34,_1c35,has,query,_1c36,when,_1c37,_1c38,_1c39,a11y,_1c3a,_1c3b,Url,_1c3c,_1c3d,_1c3e,_1c3f){return _1c2f([_1c3b,_1c38,_1c39,_1c3c,_1c37],{_currentUrl:null,dialogArguments:null,callbackArguments:null,features:null,autoFit:false,showCloseButton:false,_isIframeInitialLoad:true,_iframeFocusRegistration:null,_scrollbarWidth:null,_iframeHandles:null,templateString:"        <div style=\"position: relative;\" tabindex=\"0\">            <iframe data-dojo-attach-point=\"containerIframe\" tabindex=\"-1\" frameborder=\"0\" style=\"border: none; position: absolute, top:0, left: 0;\" src=\"about:blank\" ></iframe>        </div>",_mappedButtons:null,postMixInProperties:function(){this.inherited(arguments);this._isIframeInitialLoad=true;this._iframeHandles=[];this.features=lang.mixin({width:320,height:240},this.features);},postCreate:function(){this.inherited(arguments);this._legacyDialog=this._createLegacyDialogObject(lang.hitch(this,function(){this.onCallback.apply(this,arguments);}),this.callbackArguments,this.dialogArguments,this.opener||window);this._resetIframeContainerSize();this.own(topic.subscribe("/IsInLegacyWrapper/NeedToBeCloseOnLoad",lang.hitch(this,function(_1c40){this.onCancel();})));},startup:function(){this.inherited(arguments);if(this.containerIframe.attachEvent){this.containerIframe.attachEvent("onload",lang.hitch(this,this._onIframeLoad));}else{this.connect(this.containerIframe,"onload",lang.hitch(this,this._onIframeLoad));}},resize:function(){this.inherited(arguments);if(this._started){this._setIframeSizeFromDomNode();}},_setUrlAttr:function(value){var url=value||"about:blank";this._currentUrl=url;_1c31.set(this.containerIframe,"src",url);},onCallback:function(_1c41){},onLoad:function(){},onCancel:function(){},onMapDialogButton:function(_1c42){return true;},onBeforePerformAction:function(_1c43){},getLegacyDialog:function(){return this._legacyDialog;},_focusIframeContent:function(){var _1c44=this.containerIframe.contentWindow,doc=_1c44&&_1c44.document,_1c45=(doc&&a11y.getFirstInTabbingOrder(doc))||this.containerIframe;_1c3a.focus(_1c45);},_onIframeLoad:function(){if(!has("ie")){this._iframeFocusRegistration=_1c3a.registerIframe(this.containerIframe);}this._focusIframeContent();this._overrideLegacyDialogUtilities();var _1c46=this.containerIframe.contentWindow;this._iframeHandles.push(on(_1c46,"unload",lang.hitch(this,this._removeIframeHandles)));if(_1c46.EPi&&_1c46.EPi.ToolButton){this._iframeHandles.push(_1c30.after(_1c46.EPi.ToolButton,"SetEnabled",lang.hitch(this,this._toolButtonChanged),true));}this._iframeHandles.push(_1c30.after(this._legacyDialog,"ButtonChanged",lang.hitch(this,this._toolButtonChanged),true));this._mapDialogButtons();this._setTitle();var _1c47=query(".epi-contentContainer",this.containerIframe.contentWindow.document)[0];if(_1c47){_1c32.add(_1c47,"epi-legacyDialog");}if(this.autoFit){this._calculateAndSetContentSize();}this.onResize();this.onResize();if(this.onLoad){this.onLoad.apply(this,arguments);}this._isIframeInitialLoad=false;},_removeIframeHandles:function(){array.forEach(this._iframeHandles,function(_1c48){_1c48.remove();});this._iframeHandles=[];this._mappedButtons=null;},_setTitle:function(){if(this.dialogTitle){this.title=this.dialogTitle;return;}var title=query("title",this.containerIframe.contentWindow.document)[0];if(title){this.title=_1c36.trim(title.innerHTML);}},_getScrollbarWidth:function(){if(this._scrollbarWidth===null){var d=_1c33.create("div",{style:"position:absolute; top:-2000; left:-2000; width:100px; height:100px; overflow:scroll"},document.body);this._scrollbarWidth=d.offsetWidth-d.clientWidth;_1c33.destroy(d);}return this._scrollbarWidth;},_boxToStyle:function(size){return {width:size.w+"px",height:size.h+"px"};},_setIframeSizeFromDomNode:function(){_1c35.set(this.containerIframe,this._boxToStyle(_1c34.getContentBox(this.domNode)));},_setContentSize:function(size){_1c35.set(this.domNode,this._boxToStyle(size));this._setIframeSizeFromDomNode();},_calculateAndSetContentSize:function(_1c49){function _1c4a(doc,dir){if(doc&&doc.body&&doc.documentElement){return Math.max(doc.documentElement["client"+dir],doc.documentElement["scroll"+dir],doc.documentElement["offset"+dir],doc.body["scroll"+dir],doc.body["offset"+dir]);}return 0;};var _1c4b=null;try{_1c4b=this.containerIframe.contentWindow.document;}catch(e){return;}var _1c4c=(_1c4b.documentElement.scrollHeight-_1c4b.documentElement.clientHeight)>0,_1c4d=_1c4c&&this.autoFit?this._getScrollbarWidth():0,_1c4e={w:_1c4a(_1c4b,"Width")+_1c4d,h:_1c4a(_1c4b,"Height")};this._setContentSize(_1c4e);},_resetIframeContainerSize:function(){this._setContentSize({w:this.features.width,h:this.features.height});},_showNode:function(_1c4f,show){if(!_1c4f){return;}_1c35.set(_1c4f,"display",show?"":"none");},_toolButtonChanged:function(_1c50,_1c51){if(typeof _1c50==="string"){var _1c52=lang.getObject("containerIframe.contentWindow.EPi",false,this);_1c50=_1c52&&_1c52._GetDomObject&&_1c52._GetDomObject(_1c50);}if(_1c50){if(this.hasAction(_1c50.id)){this.setActionProperty(_1c50.id,"disabled",_1c50.disabled);this.setActionProperty(_1c50.id,"visible",_1c50.style.display!=="none");this.setActionProperty(_1c50.id,"label",_1c50.value||_1c50.innerHTML);}var _1c53=this._mappedButtons[_1c50.id];if(_1c53){this._showNode(_1c53.containerNode,false);}}},_mapDialogButtons:function(){var _1c54=query(this.legacyButtonQuery||"[data-epi-dialog-button]",this.containerIframe.contentWindow.document);this.removeActions(this.getActions());this._mappedButtons={};array.forEach(_1c54,function(_1c55){var _1c56=_1c31.get(_1c55,"data-epi-dialog-button"),_1c57=null;switch(_1c56){case "functioner":return;case "container":_1c57=query("[data-epi-dialog-button=\"functioner\"]",_1c55)[0];break;default:if(_1c55.tagName==="INPUT"){_1c57=_1c55;if(_1c32.contains(_1c57.parentNode,"epi-cmsButton")){_1c55=_1c57.parentNode;}}else{_1c57=query("INPUT",_1c55)[0];}break;}this._mappedButtons[_1c57.id]={containerNode:_1c55,functionNode:_1c57};this._showNode(_1c55,false);when(this.onMapDialogButton(_1c57),lang.hitch(this,function(_1c58){if(_1c58){var label=_1c57.tagName==="INPUT"?_1c57.value:_1c57.innerHTML,title=_1c57.tagName==="INPUT"?_1c31.get(_1c57,"title"):_1c57.innerHTML,_1c59={name:_1c57.id,label:label,disabled:_1c57.disabled,title:title,action:lang.hitch(this,function(){this.onBeforePerformAction(_1c59,_1c57);_1c57.click();})};this.addActions(_1c59);}}));},this);if(this.showCloseButton){this.addActions({name:"close",label:_1c3f.close,action:lang.hitch(this,this.onCancel)});}},_overrideLegacyDialogUtilities:function(){var _1c5a=this.containerIframe.contentWindow;if(!_1c5a.EPi){_1c5a.EPi={};}_1c5a.EPi.CreateDialog=lang.hitch(this,this._createLegacyDialogFnc);_1c5a.EPi.GetDialog=lang.hitch(this,this._getLegacyDialogFnc);},_getLegacyDialogFnc:function(win){if(win){return win.EPi.GetDialog();}return this._legacyDialog;},_createLegacyDialogFnc:function(url,_1c5b,_1c5c,_1c5d,_1c5e,_1c5f){var _1c60=new _1c3e({url:url,dialogArguments:_1c5d,callbackArguments:_1c5c,features:_1c5e,opener:_1c5f});_1c60.on("Callback",lang.hitch(this,function(){if(_1c5b){_1c5b.apply(this,arguments);}}));_1c60.show();return _1c60.legacyDialogObject;},_createLegacyDialogObject:function(_1c61,_1c62,_1c63,_1c64){var obj=new _1c3d({callbackMethod:_1c61,callbackArguments:_1c62,dialogArguments:_1c63,_opener:_1c64?_1c64:window.top});try{this.containerIframe.contentWindow.opener=_1c64;obj._dialog=this.containerIframe.contentWindow;}catch(e){obj._dialog=null;}return obj;},_reloadUrl:function(_1c65){this._isIframeInitialLoad=_1c65;if(this._isIframeInitialLoad){this._resetIframeContainerSize();}var url=new Url(this._currentUrl);lang.mixin(url.query,{"epi.preventCache":new Date().valueOf()});this.set("url",url.toString());},cleanup:function(){var _1c66=this.containerIframe.contentWindow;_1c66.EPi.CreateDialog=null;_1c66.EPi.GetDialog=null;if(this._legacyDialog&&!this._legacyDialog.IsCleaned()){this._legacyDialog.Cleanup();}},destroy:function(){this.cleanup();if(this._iframeFocusRegistration){this._iframeFocusRegistration.remove();this._iframeFocusRegistration=null;}this.inherited(arguments);}});});},"epi-cms/legacy/_LegacyDialogObject":function(){define(["dojo/_base/declare","dojo/_base/kernel"],function(_1c67,_1c68){return _1c67(null,{_dialog:null,constructor:function(_1c69){this.callbackMethod=_1c69.callbackMethod||null;this.callbackArguments=_1c69.callbackArguments||null;this.dialogArguments=_1c69.dialogArguments||null;this._opener=(_1c69.opener?_1c69.opener.top:window.top);while(this._opener.EPiOpenedDialog&&this._opener.EPiOpenedDialog._dialog){this._opener=this._opener.EPiOpenedDialog._dialog;}this._opener.EPiOpenedDialog=this;},Close:function(_1c6a){if(typeof (this.callbackMethod)=="function"){(this.callbackMethod).call(this,_1c6a,this.callbackArguments);}},ButtonChanged:function(_1c6b){},Cleanup:function(){this._CleanDialog();if(this._opener){this._opener.EPiOpenedDialog=null;}delete this._opener;this.callbackMethod=null;this.callbackArguments=null;delete this.callbackMethod;delete this.callbackArguments;this._cleaned=true;},IsCleaned:function(){return this._cleaned;},_CleanDialog:function(){for(var prop in this){if(prop!=="callbackMethod"&&prop!=="callbackArguments"&&prop!=="_opener"){this[prop]=null;delete this[prop];}}}});});},"epi-cms/project/Overview":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-geometry","dojo/on","dojo/when","epi/shell/_ContextMixin","./_ProjectView","./viewmodels/OverviewViewModel","dojo/text!./templates/Overview.html","epi/i18n!epi/cms/nls/episerver.cms.components.project","dijit/Toolbar","dijit/form/Button","dijit/form/DropDownButton","dijit/layout/TabContainer","epi-cms/project/ActivityFeed","epi-cms/project/ProjectItemList","epi-cms/project/PublishMenu"],function(_1c6c,lang,_1c6d,on,when,_1c6e,_1c6f,_1c70,_1c71,res){return _1c6c([_1c6f],{modelBindingMap:{projectItemQuery:["projectItemQuery"],projectItemSortOrder:["projectItemSortOrder"],selectedProject:["selectedProject"],created:["created"],createdBy:["createdBy"],dndEnabled:["dndEnabled"],isActivitiesVisible:["isActivitiesVisible"],notificationMessage:["notificationMessage"],projectStatus:["projectStatus"],contentLanguage:["contentLanguage"],projectItemCountMessage:["projectItemCountMessage"],projectName:["projectName"]},res:res,templateString:_1c71,postCreate:function(){this.inherited(arguments);this.own(on(this.model,"refresh-activities",this.activityFeed.refresh.bind(this.activityFeed)));},_createViewModel:function(){return new _1c70();},layout:function(){if(!this._started){return;}var _1c72=_1c6d.getMarginBox(this.toolbar),size=lang.mixin({},this._contentBox,{h:this._contentBox.h-_1c72.h});this.tabs.resize(size);},_onShow:function(){this.model.set("isProjectOverviewActive",true);},onHide:function(){this.model.set("isProjectOverviewActive",false);},_close:function(){this.model.requestPreviousContext();},_setIsActivitiesVisibleAttr:function(_1c73){this.itemList.toggleActivities(_1c73);},_setProjectNameAttr:{node:"projectNameNode",type:"innerText"},_setProjectItemCountMessageAttr:{node:"toolbarTextNode",type:"innerText"}});});},"epi-cms/project/_ProjectView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/when","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/ButtonBuilder","epi/shell/widget/_ModelBindingMixin","./CreateNewDraftConfirmationDialog","epi/i18n!epi/cms/nls/episerver.cms.components.project"],function(_1c74,lang,_1c75,_1c76,_1c77,on,when,_1c78,_1c79,_1c7a,_1c7b,_1c7c,_1c7d,_1c7e,res){return _1c74([_1c7a,_1c78,_1c79,_1c7d],{model:null,commandProvider:null,res:res,_menuAssembler:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.own(this.model=this.commandProvider=this._createViewModel());}},_createViewModel:function(){},buildRendering:function(){this.inherited(arguments);this._setupList();this._setupProjectMenu();},startup:function(){if(this._started){return;}this.inherited(arguments);this.model.initialize();},_setupList:function(){var model=this.model,_1c7f=this.itemList;function _1c80(_1c81){if(_1c81.existingProjectItems.length!==0){new _1c7e({projectItems:_1c81.existingProjectItems,contentReferences:_1c81.contentReferences,onAction:function(_1c82){if(_1c82){model.addProjectItems(_1c81.contentReferencesToAdd).then(_1c7f.setSelection.bind(_1c7f));}}}).show();}else{if(_1c81.contentReferencesToAdd.length>0){model.addProjectItems(_1c81.contentReferencesToAdd);}}};this.own(on(this.model,"refresh",_1c7f.refresh.bind(_1c7f)),on(this.model,"selected-project-items-updated",function(_1c83){_1c7f.selectItems(_1c83);}),on(this.domNode,"selection-changed",function(e){model.updateActivityFeed(e.items);}),on(this.domNode,"active-items-changed",function(e){model.set("selectedProjectItems",e.items);}),on(this.domNode,"itemaction",function(e){model.namedCommands.editProjectItem.execute();}),on(this.domNode,"itemremove",function(){model.namedCommands.removeProjectItem.execute().then(_1c7f.focus.bind(_1c7f));}),on(this.domNode,"itemsdropped",function(e){model.canAddContent(e.items).then(_1c80);}),on(this.model,"clear-selection",function(){_1c7f.clearSelection();}));},_setupProjectMenu:function(){this.own(this._menuAssembler=new _1c7b({configuration:[{builder:new _1c7c({settings:{"class":"epi-flat epi-chromeless epi-chromeless--icon-only",showLabel:false}}),category:"projectButton",target:this.toolbarGroupNode},{builder:new _1c7c({settings:{"class":"epi-flat epi-chromeless epi-chromeless--icon-only epi-floatRight",showLabel:false}}),category:"project-comments",target:this.projectCommentsToolbar},{builder:new _1c7c({settings:{"class":"epi-flat epi-chromeless"}}),category:"project-activities",target:this.toolbarGroupNode}],commandSource:this.model}));},_publishMenuClickHandler:function(){this.model.refreshProject(false);},_setCreatedAttr:{node:"createdNode",type:"innerText"},_setCreatedByAttr:{node:"createdByNode",type:"innerText"},_setDndEnabledAttr:function(value){this.itemList.set("dndEnabled",value);},_setProjectItemQueryAttr:function(value){var store=value?this.model.projectItemStore:null;this.itemList.updateQuery(store,value);},_setProjectItemSortOrderAttr:function(value){this.itemList.set("sortOrder",value);},_setNotificationMessageAttr:function(value){this.itemList.set("notificationMessage",value);},_setProjectStatusAttr:function(value){this.projectStatusMessageNode.textContent=value;_1c76.toggle(this.projectStatusMessageNode,"dijitHidden",!value);},_setContentLanguageAttr:function(value){this.itemList.set("contentLanguage",value);}});});},"epi-cms/project/CreateNewDraftConfirmationDialog":function(){define(["dojo/_base/declare","dojo/string","dgrid/Grid","epi/shell/widget/dialog/Confirmation","epi/string","epi-cms/dgrid/listItemFormatters","epi-cms/dgrid/formatters","epi/i18n!epi/nls/episerver.shared","epi/i18n!epi/cms/nls/episerver.cms.components.project.newdraftconfirmation"],function(_1c84,_1c85,Grid,_1c86,_1c87,_1c88,_1c89,_1c8a,_1c8b){return _1c84([_1c86],{projectItems:null,contentReferences:null,title:_1c8b.allreadypartofproject,cancelActionText:_1c8a.action.cancel,dialogClass:"epi-dialog-contentReferences epi-contentReferences",setFocusOnConfirmButton:false,buildRendering:function(){this.inherited(arguments);var _1c8c={showHeader:true,"class":"epi-plain-grid epi-plain-grid--no-border",columns:{name:{sortable:false,label:_1c8a.header.name,className:"epi-grid--30 epi-cursor--default",renderCell:function(_1c8d,value,node,_1c8e){var title=_1c8d.name+", ID: "+_1c8d.contentLink;node.innerHTML=_1c88.statusFormatter(_1c89.contentItem(_1c8d.typeIdentifier,"",value,title),_1c8d,node,_1c8e);}},path:{sortable:false,label:_1c8b.path,className:"epi-grid--40 epi-cursor--default",formatter:_1c89.path},projectName:{sortable:false,className:"epi-grid--30 epi-cursor--default",label:_1c8b.project,renderCell:function(_1c8f,value,node,_1c90){node.textContent=_1c8f.projectName;}}}};this.own(this.content=new _1c84([Grid])(_1c8c));this.content.renderArray(this.projectItems);this.set("description",_1c85.substitute(_1c8b.confirmationtext,[this.projectItems.length,this.contentReferences.length]));this.set("confirmActionText",this.projectItems.length===1?_1c8b.addnewdraft:_1c8b.addnewdrafts);},_size:function(){this.inherited(arguments);this.content.resize();}});});},"epi-cms/dgrid/listItemFormatters":function(){define(["dojo/dom-class","dojo/string","dojox/html/entities","epi-cms/contentediting/ContentActionSupport","epi-cms/dgrid/formatters","epi/i18n!epi/cms/nls/episerver.cms.components.project","epi/i18n!epi/cms/nls/episerver.cms.contentediting.versionstatus","epi/i18n!epi/nls/episerver.shared","dojo/text!./templates/ListItem.html"],function(_1c91,_1c92,_1c93,_1c94,_1c95,res,_1c96,_1c97,_1c98){var _1c99;function _1c9a(item){return item.path?item.path.join(" > "):item.name;};function _1c9b(item){if(!item.contentLanguage){return null;}return item.contentLanguage!==_1c99.contentLanguage?{language:item.contentLanguage}:null;};function _1c9c(value,_1c9d,node){var _1c9e=_1c94.accessLevel,_1c9f="epi-statusIndicatorIcon epi-statusIndicator"+_1c9d.status,title=_1c94.versionLocalizations[_1c9d.status]||"";if(_1c9d.isDeleted){_1c9f="epi-iconWarning epi-icon--warning";title=_1c96.versionnotfound;_1c91.add(node,"epi-content--deleted");}else{if(!_1c94.hasAccess(_1c9d.accessMask,_1c9e.Read)){_1c9f="epi-iconLock";title=res.status.message.noreadaccess;_1c91.add(node,"epi-content--no-access");}else{if(!_1c94.hasAccess(_1c9d.accessMask,_1c9e.Publish)){_1c9f="epi-iconWarning epi-icon--warning";title=res.status.message.nopublishaccess;}}}return "<span class=\"dijitReset dijitInline dijitIcon epi-objectIcon "+_1c9f+"\" title=\""+title+"\"></span>"+value;};function _1ca0(_1ca1){return function formatter(value,_1ca2,node,_1ca3){var _1ca4=_1c9b(_1ca2),name=value.name||"",_1ca5=_1c92.substitute(res.list.card.modifiedbyuser,{modified:_1c95.localizedDate(_1ca2.modified),userName:_1c95.userName(_1ca2.userName)}),_1ca6=(_1c94.versionLocalizations[_1ca2.status]||"")+(_1ca2.delayPublishUntil?" "+_1c95.localizedDate(_1ca2.delayPublishUntil):""),map,_1ca7=_1ca2.typeIdentifier;if(!_1c94.hasAccess(_1ca2.accessMask,_1c94.accessLevel.Read)){name=res.status.message.notavailable;_1ca6=res.status.message.insufficient;_1ca5="";_1ca7="";}if(_1ca2.isDeleted){_1ca6=_1c96.versionnotfound;}map={iconResizer:_1ca2.thumbnailUrl?"epi-card__icon epi-card__icon--thumbnailresizer":"epi-card__icon",icon:_1ca2.thumbnailUrl?_1c95.thumbnail(_1ca2.thumbnailUrl):_1ca7&&_1c95.contentIcon(_1ca7," epi-icon--large")||"",name:_1c93.encode(name,_1c93.html),nameTooltip:_1c93.encode(_1c9a(_1ca2)||"",_1c93.html),statusIcon:_1c9c("",_1ca2,node,_1ca3),status:_1ca6,menu:_1c95.menu({title:_1c97.action.options}),cardTitle:_1ca5,cardTitleTooltip:res.list.card.lastmodified,contentTypeDescription:_1c95.contentTypeDescription(_1ca7)||"",languageBranch:_1ca4&&_1ca4.language||"",languageBranchClass:_1ca4&&_1ca4.language?"epi-card__language-branch":"epi-card__language-branch--hidden",commentsClass:_1ca2.hasComments?"":"dijitHidden",commentsTooltip:res.list.card.hascomments};_1c91.add(node,_1ca1);return _1c92.substitute(_1c98,map);};};_1c99={contentLanguage:null,languageSelector:_1c9b,titleSelector:_1c9a,statusFormatter:_1c9c,card:[_1ca0("epi-card")],"card-compact":[_1ca0("epi-card epi-card--compact")]};return _1c99;});},"url:epi-cms/dgrid/templates/ListItem.html":"<div class=\"epi-mo\">\n    <div class=\"epi-mo--img\">\n        <div class=\"dijitIcon ${iconResizer}\">${icon}</div>\n    </div>\n    <div class=\"epi-mo--body\">\n        <div class=\"epi-card__menu\">\n            ${menu}\n        </div>\n        <span class=\"epi-secondaryText dijitInline epi-lozenge ${languageBranchClass}\">${languageBranch}</span>\n        <div class=\"epi-card__info\">\n            <div class=\"dijitInline\">\n                <span class=\"epi-card__title\" title=\"${cardTitleTooltip}\">${cardTitle}</span>\n                <span class=\"epi-secondaryText\">\n                    ${contentTypeDescription}\n                    <span class=\"dijitInline epi-lozenge ${languageBranchClass}\">${languageBranch}</span>\n                </span>\n            </div>\n        </div>\n        <div class=\"dijitInline epi-card__title--ellipsis-wrapper\">\n            <div>\n                <span class=\"dijitInline epi-card__title dojoxEllipsis\" title=\"${nameTooltip}\">${name}</span>\n            </div>\n            ${statusIcon}<span class=\"epi-secondaryText\">${status}</span>\n            <span class=\"dijitInline dijitIcon epi-iconBubble epi-icon--warning ${commentsClass}\" title=\"${commentsTooltip}\"></span>\n        </div>\n    </div>\n</div>","epi-cms/project/viewmodels/OverviewViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/when","epi/dependency","epi-cms/project/command/RefreshProjectItems","epi-cms/project/command/ToggleProjectActivities","./_ProjectViewModel","./ActivityFeedViewModel","./ProjectCommentViewModel","epi/i18n!epi/nls/episerver.cms.components.project.overview.eventfeed"],function(_1ca8,lang,topic,when,_1ca9,_1caa,_1cab,_1cac,_1cad,_1cae,_1caf){return _1ca8([_1cac],{contextHistory:null,isProjectOverviewActive:false,_sortOrderProfileKey:"epi.project-overview-sort-order",_isActivitiesVisibleProfileKey:"epi.project-overview-is-activities-visible",postscript:function(){this.inherited(arguments);this.contextHistory=this.contextHistory||_1ca9.resolve("epi.cms.BackContextHistory");this.own(this.projectService.on("currentProjectChanged",lang.hitch(this,this.projectOverviewChanged)));this.activityFeedModel=new _1cad({noQueryMessage:_1caf.noquerymessage,noAccessMessage:_1caf.noaccessmessage,activitiesStore:this.activitiesStore});this.projectCommentFeedModel=new _1cae({noQueryMessage:_1caf.noquerymessage,activitiesStore:this.activitiesStore});},contextChanged:function(_1cb0,_1cb1){this.inherited(arguments);if(_1cb0&&_1cb0.type==="epi.cms.project"){var _1cb2=parseInt(_1cb0.id,10);when(this.projectStore.refresh(_1cb2)).then(this.set.bind(this,"selectedProject"));}else{this.set("selectedProject",null);}},projectOverviewChanged:function(_1cb3){var _1cb4=this.get("isProjectOverviewActive"),_1cb5;if(_1cb4){if(_1cb3&&_1cb3.id){_1cb5="epi.cms.project:///"+_1cb3.id;topic.publish("/epi/shell/context/request",{uri:_1cb5},{sender:this});}else{this.requestPreviousContext();}}},requestPreviousContext:function(){this.contextHistory.closeAndNavigateBack(this);},_createProjectCommands:function(){var _1cb6=this.inherited(arguments);_1cb6.refreshProject=new _1caa({model:this,category:"project-comments",order:120});return _1cb6;},_createProjectItemCommands:function(){var _1cb7=this.inherited(arguments);_1cb7.sortProjectItems.set({category:"projectButton",iconClass:"epi-iconSort"});_1cb7.toggleProjectActivities=new _1cab({model:this,order:100});return _1cb7;},updateActivityFeed:function(_1cb8){this.activityFeedModel.set({selectedProjectId:this.selectedProject&&this.selectedProject.id,selectedProjectItems:_1cb8});},_selectedProjectSetter:function(_1cb9){this.inherited(arguments);this._updateProjectFeedViewModel(_1cb9);},_updateSelectedProjectDependencies:function(_1cba){this.inherited(arguments);this._updateProjectFeedViewModel(_1cba);},_updateProjectFeedViewModel:function(_1cbb){this.projectCommentFeedModel.set({placeholderName:_1cbb&&_1cbb.name,selectedProjectId:_1cbb&&_1cbb.id});}});});},"epi-cms/project/command/RefreshProjectItems":function(){define(["dojo/_base/declare","./_ProjectCommand","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1cbc,_1cbd,res){return _1cbc([_1cbd],{label:res.refresh,iconClass:"epi-iconReload",category:"projectButton",canExecute:true,_execute:function(){this.model.refreshProject();this.model.refreshActivities();}});});},"epi-cms/project/command/_ProjectCommand":function(){define(["dojo/_base/declare","epi/shell/command/_PropertyWatchCommand"],function(_1cbe,_1cbf){return _1cbe([_1cbf],{propertiesToWatch:["selectedProject"],_onPropertyChanged:function(){}});});},"epi-cms/project/command/ToggleProjectActivities":function(){define(["dojo/_base/declare","epi/shell/command/ToggleCommand","epi/i18n!epi/cms/nls/episerver.cms.activities.togglecommand.label"],function(_1cc0,_1cc1,_1cc2){return _1cc0([_1cc1],{canExecute:true,category:"project-activities",label:_1cc2.show,property:"isActivitiesVisible",_activeSetter:function(_1cc3){this.active=_1cc3;this.set("label",_1cc3?_1cc2.hide:_1cc2.show);}});});},"epi-cms/project/viewmodels/_ProjectViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/topic","dojo/dom-class","dojo/promise/all","dojo/when","dojo/string","dijit/Destroyable","epi/epi","epi/datetime","epi/dependency","epi/username","epi/shell/_ContextMixin","epi/shell/xhr/errorHandler","../../contentediting/ContentActionSupport","epi/shell/command/withConfirmation","../command/AddProject","../command/PublishProject","../command/EditProjectItem","../command/ReadyForReviewProjectItem","../command/ReadyToPublishProjectItem","../command/RefreshProjectItems","../command/RemoveProject","../command/RemoveProjectItem","../command/RemoveProjectScheduling","../command/RenameProject","../command/SortProjectItems","../command/ScheduleProject","epi/i18n!epi/nls/episerver.cms.components.project","epi/i18n!epi/nls/episerver.shared.action"],function(_1cc4,lang,_1cc5,_1cc6,_1cc7,_1cc8,topic,_1cc9,all,when,_1cca,_1ccb,epi,_1ccc,_1ccd,_1cce,_1ccf,_1cd0,_1cd1,_1cd2,_1cd3,_1cd4,_1cd5,_1cd6,_1cd7,_1cd8,_1cd9,_1cda,_1cdb,_1cdc,_1cdd,_1cde,res,_1cdf){return _1cc4([_1cc8,_1ccb,_1cc7,_1ccf],{commands:null,namedCommands:null,created:"",createdBy:"",profile:null,contentLanguage:"",dndEnabled:false,isActivitiesVisible:false,projectStore:null,projectSortOrder:null,projectItemStore:null,projectItemQuery:null,activitiesStore:null,projectItemSortOrder:null,projectStatus:"",projectName:"",notificationMessage:"",selectedProject:null,selectedProjectItems:null,projectItemCountMessage:"",placeholderState:"noProjects",_sortOrderProfileKey:"epi.project-sort-order",_isActivitiesVisibleProfileKey:"epi.project-is-activities-visible",_messages:null,constructor:function(){this.projectItemSortOrder=[];this.projectSortOrder=[{attribute:"created",descending:true}];this.selectedProjectItems=[];},postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_1ccd.resolve("epi.cms.ProjectService");this.projectStore=this.projectStore||_1ccd.resolve("epi.storeregistry").get("epi.cms.project");this.projectItemStore=this.projectItemStore||_1ccd.resolve("epi.storeregistry").get("epi.cms.project.item");this.activitiesStore=this.activitiesStore||_1ccd.resolve("epi.storeregistry").get("epi.cms.activities");this.profile=this.profile||_1ccd.resolve("epi.shell.Profile");this._messages=this.isProjectModeEnabled()?res.status.message:lang.mixin({},res.status.message,res.status["messagelegacy"]);this._createCommands();this.own(this.projectService.on("project-item-updated",lang.hitch(this,this._updateSelectedItems)),this.projectService.on("project-updated",lang.hitch(this,this._projectUpdated)));},initialize:function(){return all(when(this.profile.get(this._sortOrderProfileKey),lang.hitch(this,function(sort){var _1ce0=this._findSortOption("key",sort)||this.namedCommands.sortProjectItems.options[0];this._changeAttrValue("projectItemSortOrder",_1ce0.value);})),when(this._loadSelectedProject(),lang.hitch(this,function(_1ce1){this._updateSelectedProjectDependencies(_1ce1);this._changeAttrValue("selectedProject",_1ce1);})),when(this.profile.getContentLanguage(),lang.hitch(this,function(_1ce2){this.set("contentLanguage",_1ce2);})),when(this.profile.get(this._isActivitiesVisibleProfileKey),lang.hitch(this,function(_1ce3){if(typeof _1ce3==="boolean"){this.set("isActivitiesVisible",_1ce3);}})));},isProjectModeEnabled:function(){return this.projectService.isProjectModeEnabled;},getCommands:function(){return this.commands;},addProject:function(_1ce4){this.projectStore.add(_1ce4).then(lang.hitch(this,function(value){this.set("selectedProject",value);})).otherwise(_1cd0.forXhr);},getProject:function(){return this.get("selectedProject");},updateProject:function(_1ce5){this.projectStore.put(_1ce5).then(lang.hitch(this,"set","selectedProject")).otherwise(_1cd0.forXhr);},publishProject:function(_1ce6,_1ce7){var self=this;return this.projectService.publishProject(_1ce6,_1ce7).then(function(_1ce8){return self._updateSelectedProjectAndRefreshContextRequest(_1ce8).then(function(){return _1ce8;});});},reactivateProject:function(_1ce9){var self=this;if(isNaN(_1ce9)){throw new Error("The given project ID is not a number.");}return this.projectService.reactivateProject(_1ce9).then(function(_1cea){return self._updateSelectedProjectAndRefreshContextRequest(_1cea).then(function(){return _1cea;});});},refreshActivities:function(){this.emit("refresh-activities");},refreshProject:function(_1ceb){var self=this;if(_1ceb===undefined){_1ceb=true;}if(this.selectedProject){return this.projectStore.refresh(this.selectedProject.id).then(function(value){self.set("selectedProject",value);if(_1ceb){self.emit("refresh");}return value;},function(ex){self.set("selectedProject",null);});}if(_1ceb){this.emit("refresh");}},removeProject:function(){var self=this,store=this.projectStore;if(!this.selectedProject){return new _1cc6().resolve();}return store.remove(this.selectedProject.id).then(function(){self.set("selectedProject",null);});},canAddContent:function(_1cec){var _1ced=this.get("selectedProject").id;return this.projectService.canAddContent(_1ced,_1cec);},canPublishProject:function(_1cee){var _1cef;function _1cf0(){return Object.keys(_1cef).some(function(key){if(key.indexOf("nopublishaccess")>-1){if(_1cef[key]>0){return true;}}});};function _1cf1(state){return _1cef[state]>0;};_1cee=_1cee||this.selectedProject;_1cef=_1cee&&_1cee.itemStatusCount;if(this.isProjectModeEnabled()){return !!_1cee&&_1cee.itemStatusCount.checkedin>0;}else{return !!_1cee&&(_1cee.status==="active"||_1cee.status==="publishfailed")&&!_1cf0()&&!_1cf1("notcreated")&&!_1cf1("rejected")&&!_1cf1("checkedout")&&(_1cf1("checkedin")||_1cf1("published")||_1cf1("previouslypublished")||_1cf1("delayedpublish"));}},addProjectItems:function(_1cf2,_1cf3){var _1cf4=this.get("selectedProject");_1cf3=_1cf3||(_1cf4&&_1cf4.id);if(!_1cf3){throw new Error("If no projectId is provided a selectedProject must be set in the context");}return this.projectService.addProjectItems(_1cf3,_1cf2);},removeSelectedProjectItems:function(){var _1cf5=this.projectService.removeProjectItems(this.selectedProjectItems);_1cf5.then(lang.hitch(this,function(){this.emit("clear-selection");}));return _1cf5;},markProjectItemsAsReadyForReview:function(){this._setStatusOnProjectItems("markAsReadyForReview");},markProjectItemsAsReadyToPublish:function(){this._setStatusOnProjectItems("markAsReadyToPublish");},_setStatusOnProjectItems:function(_1cf6){if(!this.selectedProjectItems.length){return new _1cc6().resolve();}var self=this;var _1cf7=this.selectedProjectItems.map(function(item){return item.id;});return this.projectService[_1cf6](_1cf7).then(function(){return when(self.getCurrentContext());}).then(function(ctx){var _1cf8;self.selectedProjectItems.some(function(item){if(item.contentLink===ctx.id){_1cf8=item;return true;}});if(_1cf8){self.requestContextChange(_1cf8.contentLink);}});},requestContextChange:function(_1cf9){var _1cfa=_1cf9.uri?_1cf9:{uri:"epi.cms.contentdata:///"+_1cf9};topic.publish("/epi/shell/context/request",_1cfa,{sender:this});},updateActivityFeed:function(_1cfb){},_projectUpdated:function(_1cfc){if(this.selectedProject&&this.selectedProject.id===_1cfc.id){this.set("selectedProject",_1cfc);}},_updateSelectedItems:function(item){var _1cfd=this.selectedProjectItems.length;for(var i=0;i<_1cfd;i++){if(this.selectedProjectItems[i].id===item.id){this.selectedProjectItems[i]=item;this.set("selectedProjectItems",this.selectedProjectItems);this.emit("selected-project-items-updated",this.selectedProjectItems);break;}}},_createCommands:function(){var _1cfe=lang.mixin(this._createProjectCommands(),this._createProjectItemCommands()),_1cff;_1cff=Object.keys(_1cfe).map(function(key){return _1cfe[key];}).sort(function(a,b){return a.sortOrder-b.sortOrder;});this.own.apply(this,_1cff);this.set({commands:_1cff,namedCommands:_1cfe});},_createProjectCommands:function(){return {addProject:new _1cd3({model:this,order:10}),renameProject:new _1cdc({model:this,order:20}),removeProject:new _1cd9({model:this,order:30,store:this.projectStore}),publishProject:new _1cd4({model:this,order:40}),scheduleProject:new _1cde({model:this,order:50}),removeProjectScheduling:_1cd2(new _1cdb({model:this,order:60}),null,{title:res.command.removeschedulingprojectitem.title,description:res.command.removeschedulingprojectitem.confirmation,confirmActionText:_1cdf.remove,cancelActionText:_1cdf.cancel})};},_createProjectItemCommands:function(){return {readyForReviewProjectItem:new _1cd6({model:this,order:90}),readyToPublishProjectItem:new _1cd7({model:this,order:100}),editProjectItem:new _1cd5({model:this,order:110}),removeProjectItem:_1cd2(new _1cda({model:this,order:120}),null,{title:res.command.removeprojectitem.label,description:res.command.removeprojectitem.confirmation,confirmActionText:_1cdf.remove,cancelActionText:_1cdf.cancel}),sortProjectItems:new _1cdd({model:this,order:130}),refreshProjectItems:new _1cd8({model:this,order:140})};},_loadSelectedProject:function(){return this.projectService.getCurrentProject();},_persistSelectedProject:function(_1d00){this.profile.set(this._selectedProjectProfileKey,_1d00&&_1d00.id,{location:"server"});},_persistSortOrder:function(_1d01){var _1d02=this._findSortOption("value",_1d01),key=_1d02&&_1d02.key||null;this.profile.set(this._sortOrderProfileKey,key,{location:"server"});},_persistIsActivitiesPanelVisible:function(_1d03){this.profile.set(this._isActivitiesVisibleProfileKey,_1d03,{location:"server"});},_findSortOption:function(key,term){var _1d04=this.namedCommands.sortProjectItems.options,_1d05=null;term&&_1d04.some(function(item){if(term===item[key]){_1d05=item;return true;}});return _1d05;},_updateSelectedProjectDependencies:function(_1d06){var _1d07="",_1d08="",_1d09="",_1d0a=false,_1d0b="",_1d0c=null,_1d0d="",_1d0e="",_1d0f=this.isProjectModeEnabled();if(_1d06){_1d07=_1ccc.toUserFriendlyString(new Date(_1d06.created));_1d08=_1cce.toUserFriendlyString(_1d06.createdBy,null,true);_1d0a=(_1d0f&&_1d06.status!=="publishing")||_1d06.status==="active"||_1d06.status==="publishfailed";_1d0c={projectId:_1d06.id};_1d0e=_1d06.name;if(!this.canPublishProject(_1d06)||_1d0f){_1d0d=this._messages[_1d06.status]||"";if(_1d06.status==="delayedpublished"&&!_1d0f){_1d09=_1ccc.toUserFriendlyString(_1d06.delayPublishUntil);_1d0d=lang.replace(_1d0d,{date:_1d09});_1d0b=lang.replace(res.status.state.delayedpublished,{delayPublishUntil:_1d09});}}if(_1d06.status==="publishfailed"){_1d0b=this._getProjectFailedMessage(_1d06);}}this.set({created:_1d07,createdBy:_1d08,dndEnabled:_1d0a,notificationMessage:_1d0b,projectItemQuery:_1d0c,projectStatus:_1d0d,projectName:_1d0e});},_getProjectFailedMessage:function(_1d10){var _1d11=0,_1d12="",_1d13=res.notifications.publishfailed;_1d11=this._getUnpublishedItems(_1d10.itemStatusCount);if(_1d11>0){_1d12=lang.replace(_1d11>1?_1d13.notificationtextmultipleitems:_1d13.notificationtextsingleitem,{failedItemsCount:_1d11});}return _1d12;},_getUnpublishedItems:function(_1d14){var count=0;Object.keys(_1d14).forEach(function(key){if(key.indexOf("checkedin")===0){count+=_1d14[key];}});return count;},_isActivitiesVisibleSetter:function(_1d15){if(_1d15===this.isActivitiesVisible){return;}this.isActivitiesVisible=_1d15;this._persistIsActivitiesPanelVisible(_1d15);},_selectedProjectSetter:function(_1d16){_1d16=lang.clone(_1d16);if(epi.areEqual(this.selectedProject,_1d16)){return;}if(this.selectedProject&&(!_1d16||this.selectedProject.id!==_1d16.id)){this.emit("clear-selection");}this.selectedProject=_1d16;this._updateSelectedProjectDependencies(_1d16);},_projectItemSortOrderSetter:function(_1d17){if(_1d17&&_1d17===this.projectItemSortOrder){return;}this.projectItemSortOrder=_1d17;this._persistSortOrder(_1d17);},_updateSelectedProjectAndRefreshContextRequest:function(_1d18){var self=this;self.set("selectedProject",_1d18);return when(this.getCurrentContext()).then(function(_1d19){self.requestContextChange(_1d19);return _1d19;});},_selectedProjectItemsSetter:function(_1d1a){this.selectedProjectItems=_1d1a;this._updateProjectCountMessage(_1d1a);},_updateProjectCountMessage:function(_1d1b){var items=_1d1b&&_1d1b.length>0?_1d1b.length:null,_1d1c="";function _1d1d(count,_1d1e){_1d1c=_1cca.substitute(res.notifications.selecteditems[_1d1e],{count:count});};if(items){if(items===1){_1d1d(items,"singular");}else{if(items>1){_1d1d(items,"plural");}}}this.set("projectItemCountMessage",_1d1c);}});});},"epi-cms/project/command/AddProject":function(){define(["dojo/_base/declare","./_ProjectCommand","epi-cms/project/ProjectDialogContent","epi-cms/contentediting/command/_CommandWithDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.newproject"],function(_1d1f,_1d20,_1d21,_1d22,res){return _1d1f([_1d20,_1d22],{label:res.label,title:res.label,canExecute:true,iconClass:"epi-iconPlus",defaultActionsVisible:true,dialogClass:"epi-dialog-landscape",dialogContentClass:_1d21,onDialogExecute:function(){this.model.addProject(this.dialogContent.get("value"));},_execute:function(){this.showDialog();}});});},"epi-cms/project/ProjectDialogContent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/keys","epi/dependency","epi/shell/widget/FormContainer","epi/shell/widget/dialog/_DialogContentMixin"],function(_1d23,lang,keys,_1d24,_1d25,_1d26){return _1d23([_1d25,_1d26],{_metadataManager:null,postMixInProperties:function(){this.inherited(arguments);if(!this.metadata){var _1d27=this._metadataManager||_1d24.resolve("epi.shell.MetadataManager");this.metadata=_1d27.getMetadataForType("EPiServer.Cms.Shell.UI.Rest.Projects.Internal.Models.ProjectViewModel");}},postCreate:function(){this.inherited(arguments);this.on("keypress",lang.hitch(this,function(e){if(e.keyCode===keys.ENTER&&this.isValid()){this.executeDialog();}}));}});});},"epi-cms/project/command/PublishProject":function(){define(["dojo/_base/declare","dojo/string","epi-cms/project/command/_ProjectCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.publishproject"],function(_1d28,_1d29,_1d2a,res){return _1d28([_1d2a],{category:"publishmenu-primary",label:res.label,isExecuting:false,_execute:function(){var model=this.model,self=this;self.set("isExecuting",true);model.publishProject(this.model.selectedProject.id).then(function(){self.set("isExecuting",false);},function(){self.set("isExecuting",false);});},_onPropertyChanged:function(){var _1d2b=this.model.selectedProject,_1d2c=_1d2b&&_1d2b.status,_1d2d=this.model.canPublishProject(_1d2b),_1d2e=this.model.isProjectModeEnabled();this.set({canExecute:_1d2d,isAvailable:_1d2e||(_1d2c!=="published"&&_1d2c!=="delayedpublished"),isExecuting:_1d2c==="publishing"});},_updateLabel:function(){var _1d2f=this.model&&this.model.selectedProject,_1d30=(_1d2f&&_1d2f.itemStatusCount.checkedin)||0,data={count:_1d30>0?_1d30+" ":""},label;if(this.isExecuting){label=_1d30===1?res.labelexecuting.singular:res.labelexecuting.plural;}else{if(!this.isAvailable){label=res.labelexecuted;}else{label=_1d30===1?res.label.singular:res.label.plural;}}this.set("label",_1d29.substitute(label,data));},_isExecutingSetter:function(value){this.isExecuting=value;this._updateLabel();}});});},"epi-cms/project/command/EditProjectItem":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","./_ProjectCommand","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1d31,_1d32,_1d33,_1d34){return _1d31([_1d33],{category:"menuWithSeparator",iconClass:"epi-iconPen",label:_1d34.edit,propertiesToWatch:["selectedProjectItems"],_execute:function(){var _1d35=this.model.selectedProjectItems[0];this.model.requestContextChange(_1d35.contentLink);},_onPropertyChanged:function(){var _1d36=false,_1d37;var items=this.model&&this.model.selectedProjectItems;this.set("label",_1d34.edit);this.set("iconClass","epi-iconPen");if(items&&items.length===1){_1d37=_1d32.getPermissionMap(items[0].accessMask);if(_1d37.Read&&!_1d37.Edit){_1d36=_1d37.Read;this.set("label",_1d34.view);this.set("iconClass","epi-iconSearch");}else{_1d36=_1d37.Edit;}}this.set("canExecute",!!_1d36);}});});},"epi-cms/project/command/ReadyForReviewProjectItem":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/nls/episerver.cms.components.project.command.readyforreviewprojectitem","epi-cms/project/command/_ProjectCommand"],function(_1d38,_1d39,_1d3a,_1d3b){return _1d38([_1d3b],{category:"itemContext",label:_1d3a.label,propertiesToWatch:["selectedProjectItems"],_execute:function(){return this.model.markProjectItemsAsReadyForReview();},_onPropertyChanged:function(){var items=this.model&&this.model.selectedProjectItems,_1d3c=_1d39.versionStatus,_1d3d=items&&items.length>0&&items.every(function(item){return !item.isDeleted&&item.hasApprovalDefinition&&(item.status===_1d3c.CheckedOut||item.status===_1d3c.Rejected)&&_1d39.hasAccess(item.accessMask,_1d39.accessLevel.Edit);});this.set("canExecute",!!_1d3d);}});});},"epi-cms/project/command/ReadyToPublishProjectItem":function(){define(["dojo/_base/declare","epi-cms/contentediting/ContentActionSupport","epi/i18n!epi/nls/episerver.cms.components.project.command.readytopublishprojectitem","epi-cms/project/command/_ProjectCommand"],function(_1d3e,_1d3f,_1d40,_1d41){return _1d3e([_1d41],{category:"menuWithSeparator",label:_1d40.label,propertiesToWatch:["selectedProjectItems"],_execute:function(){return this.model.markProjectItemsAsReadyToPublish();},_onPropertyChanged:function(){var items=this.model&&this.model.selectedProjectItems,_1d42=_1d3f.versionStatus,_1d43=items&&items.length>0&&items.every(function(item){return !item.isDeleted&&!item.hasApprovalDefinition&&(item.status===_1d42.CheckedOut||item.status===_1d42.Rejected)&&_1d3f.hasAccess(item.accessMask,_1d3f.accessLevel.Edit);});this.set("canExecute",!!_1d43);}});});},"epi-cms/project/command/RemoveProject":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/when","./RemoveProjectConfirmation","epi/i18n!epi/nls/episerver.cms.components.project.command.removeproject","./_ProjectCommand"],function(_1d44,lang,on,when,_1d45,res,_1d46){return _1d44([_1d46],{category:"context",label:res.label,iconClass:"epi-iconTrash",_execute:function(){var _1d47=this.model.getProject();this.model.projectService.hasScheduledProjectItems(_1d47.id).then(this._createRemoveProjectConfirmationDialog.bind(this));},_createRemoveProjectConfirmationDialog:function(_1d48){var _1d49=this.model.getProject().status==="delayedpublished",_1d4a=new _1d45({isScheduledProject:_1d48&&_1d49});on.once(_1d4a,"execute",lang.hitch(this,"_removeProject"));_1d4a.show();},_removeProject:function(_1d4b){var model=this.model,_1d4c=model.getProject(),_1d4d=!_1d4b&&model.reactivateProject(_1d4c.id);when(_1d4d).then(function(){return model.removeProject();}).otherwise(function(error){console.error("An error occured while removing the project.",error);});},_onPropertyChanged:function(){var _1d4e=this.model.getProject();this.set("canExecute",!!_1d4e&&!_1d4e.isDeleted);}});});},"epi-cms/project/command/RemoveProjectConfirmation":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/i18n!epi/nls/episerver.cms.components.project.command.removeproject","epi/i18n!epi/nls/episerver.shared.action","epi/shell/widget/dialog/Confirmation"],function(_1d4f,lang,_1d50,_1d51,_1d52){return _1d4f([_1d52],{isScheduledProject:false,dialogClass:"epi-dialog-confirm epi-dialog--wide",postMixInProperties:function(){this.inherited(arguments);this.title=this.isScheduledProject?_1d50.scheduledlabel:_1d50.label;this.description=this.isScheduledProject?_1d50.scheduledconfirmation:_1d50.confirmation;},getActions:function(){var _1d53={name:"keepScheduling",label:this.isScheduledProject?_1d50.deleteandkeepscheduling:_1d51.deletelabel,action:lang.hitch(this,"onExecute",true)},_1d54={name:"removeScheduling",label:_1d50.deleteandremovescheduling,action:lang.hitch(this,"onExecute",false)},_1d55={name:"cancel",label:_1d51.cancel,action:lang.hitch(this,this.onCancel),settings:{"class":"Salt",firstFocusable:true}};return this.isScheduledProject?[_1d53,_1d54,_1d55]:[_1d53,_1d55];}});});},"epi-cms/project/command/RemoveProjectItem":function(){define(["dojo/_base/declare","./_ProjectCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.removeprojectitem"],function(_1d56,_1d57,res){return _1d56([_1d57],{category:"itemContext",label:res.label,propertiesToWatch:["selectedProjectItems"],_execute:function(){return this.model.removeSelectedProjectItems();},_onPropertyChanged:function(){var self=this,model=this.model,_1d58=model&&model.selectedProjectItems&&model.selectedProjectItems.length,_1d59=model.selectedProject;this.set("canExecute",false);this.model.projectService.getCurrentProject().then(function(_1d5a){var _1d5b=_1d59&&(_1d59.status==="active"||_1d59.status==="publishfailed"||_1d5a);self.set("canExecute",!!(_1d58&&_1d5b));});}});});},"epi-cms/project/command/RemoveProjectScheduling":function(){define(["dojo/_base/declare","epi-cms/project/command/_ProjectCommand","epi/i18n!epi/cms/nls/episerver.cms.components.project.command"],function(_1d5c,_1d5d,res){return _1d5c([_1d5d],{category:"publishmenu",iconClass:"epi-iconClose",label:res.removeschedulingprojectitem.label,postscript:function(){this.inherited(arguments);if(!this.model.isProjectModeEnabled()){this.set("label",res.removeschedulingproject.label);}},_execute:function(){var model=this.model;return model.reactivateProject(model.selectedProject.id);},_onPropertyChanged:function(){var _1d5e=this.model.selectedProject,_1d5f;_1d5f=!!_1d5e&&(this.model.isProjectModeEnabled()?_1d5e.itemStatusCount.delayedpublish>0:_1d5e.status==="delayedpublished");this.set("canExecute",_1d5f);this.set("isAvailable",_1d5f);}});});},"epi-cms/project/command/RenameProject":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/project/ProjectDialogContent","epi-cms/project/command/_ProjectCommand","epi-cms/contentediting/command/_CommandWithDialogMixin","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.renameproject"],function(_1d60,lang,_1d61,_1d62,_1d63,_1d64){return _1d60([_1d62,_1d63],{category:"context",dialogClass:"epi-dialog-landscape",dialogContentClass:_1d61,label:_1d64.label,title:_1d64.label,iconClass:"epi-iconRename",onDialogExecute:function(){var value=lang.mixin(this.value,this.dialogContent.get("value"));this.model.updateProject(value);},_execute:function(){this.showDialog();},_onPropertyChanged:function(){var _1d65=this.model.getProject();this.set("canExecute",!!_1d65&&!_1d65.isDeleted);this.set("value",lang.clone(_1d65));}});});},"epi-cms/project/command/SortProjectItems":function(){define(["dojo/_base/declare","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.sort","epi/shell/command/OptionCommand"],function(_1d66,_1d67,_1d68){return _1d66([_1d68],{category:"context",label:_1d67.label,options:null,property:"projectItemSortOrder",constructor:function(){this.options=[{label:_1d67.nameascending,key:"+Name",value:[{attribute:"name",descending:false}]},{label:_1d67.namedescending,key:"-Name",value:[{attribute:"name",descending:true}]},{label:_1d67.status,key:"+Status",value:[{attribute:"status",descending:false},{attribute:"name",descending:false}]},{label:_1d67.type,key:"+PrimaryTypeIdentifier",value:[{attribute:"primaryTypeIdentifier",descending:false},{attribute:"name",descending:false}]},{label:_1d67.modifieddescending,key:"-Modified",value:[{attribute:"modified",descending:true},{attribute:"name",descending:false}]},{label:_1d67.modifiedascending,key:"+Modified",value:[{attribute:"modified",descending:false},{attribute:"name",descending:false}]}];}});});},"epi-cms/project/command/ScheduleProject":function(){define(["dojo/_base/declare","./_ProjectCommand","../ProjectSchedulingDialog","../ProjectSchedulingDialogViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.project.command"],function(_1d69,_1d6a,_1d6b,_1d6c,res){return _1d69([_1d6a],{category:"publishmenu",label:res.scheduleprojectitem.label,iconClass:"epi-iconClock",postscript:function(){this.inherited(arguments);if(!this.model.isProjectModeEnabled()){this.set("label",res.scheduleproject.label);}},_execute:function(){var model=this.model,_1d6d=model.selectedProject,_1d6e=new _1d6c({title:_1d6d.name,query:{projectId:_1d6d.id,scheduled:true}}),_1d6f=new _1d6b({model:_1d6e});_1d6f.on("execute",function(){model.publishProject(_1d6d.id,_1d6e.dateValue);});_1d6f.show();},_onPropertyChanged:function(){this.set("canExecute",this.model.canPublishProject());this._updateIsAvailable();},_updateIsAvailable:function(){var _1d70,_1d71=this.model.selectedProject,_1d72=_1d71&&_1d71.status;if(this.model.isProjectModeEnabled()){_1d70=true;}else{_1d70=_1d72!=="published"&&_1d72!=="delayedpublished";}this.set("isAvailable",_1d70);}});});},"epi-cms/project/ProjectSchedulingDialog":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/on","epi-cms/contentediting/ScheduledPublishSelector","epi/shell/widget/DelayableStandby","epi/shell/widget/dialog/Dialog","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.scheduleproject"],function(_1d73,lang,_1d74,on,_1d75,_1d76,_1d77,res){return _1d73([_1d77],{dialogClass:"epi-dialog-contentReferences",title:res.label,defaultActionsVisible:false,_contentLoaded:null,constructor:function(){this._contentLoaded=new _1d74();},buildRendering:function(){this.inherited(arguments);this.own(this.content=new _1d75({model:this.model}),this._standby=new _1d76({target:document.body,zIndex:999}).placeAt(document.body),on.once(this.content,"contentreferencegrid-loading-complete",this._contentLoaded.resolve));},show:function(){var _1d78=arguments;if(!this._started){this.startup();}this._standby.show();return this._contentLoaded.then(lang.hitch(this,function(){this._standby.hide();return this.inherited(_1d78);}));}});});},"epi-cms/project/ProjectSchedulingDialogViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/dependency","dojo/topic","epi-cms/dgrid/formatters","./ContentReferenceGridModel","epi-cms/contentediting/ScheduledPublishSelectorViewModel","epi/i18n!epi/cms/nls/episerver.cms.components.project.command.scheduleproject","epi/i18n!epi/cms/nls/episerver.cms.components.project.contentreferencelist","epi/i18n!epi/cms/nls/episerver.shared.action","epi/i18n!epi/cms/nls/episerver.cms.widget.scheduledpublishselector"],function(_1d79,lang,_1d7a,topic,_1d7b,_1d7c,_1d7d,_1d7e,_1d7f,_1d80,res){return _1d79([_1d7c,_1d7d],{dateLabel:res.publishchangeson,notificationText:res.alreadyscheduleditems,_totalItemsSetter:function(value){this.totalItems=value;if(value){var _1d81=(value===1?_1d7f.itemintotal:_1d7f.itemsintotal);this.set("resultSummary",lang.replace(_1d81,[value]));}},onItemClicked:function(item){topic.publish("/epi/shell/context/request",{uri:item.contentUri});},postscript:function(){this.inherited(arguments);this.store=this.store||_1d7a.resolve("epi.storeregistry").get("epi.cms.project.item");this.columns={primaryTypeIdentifier:{label:"",className:"epi-grid-column--snug epi-cursor--default",formatter:_1d7b.contentIcon},name:{label:"",className:"epi-grid--30 epi-cursor--default"},path:{label:"",formatter:_1d7b.path,className:"epi-grid--35 epi-cursor--default"},delayPublishUntil:{label:"",formatter:_1d7b.localizedDate,className:"epi-grid--25 epi-grid-column--centered epi-cursor--default dgrid-column-treePath"},contentUri:{formatter:function(){return "<a class=\"epi-visibleLink\">"+_1d80.view+"</a>";},className:"dgrid-column-view"}};}});});},"epi-cms/project/ContentReferenceGridModel":function(){define(["dojo/_base/declare","dojo/Stateful"],function(_1d82,_1d83){return _1d82([_1d83],{onItemClicked:function(item){},resultSummary:"",notificationText:"",store:null,query:null,columns:null,totalItems:null});});},"epi-cms/project/viewmodels/ActivityFeedViewModel":function(){define(["dojo/_base/declare","./_ProjectFeedViewModel"],function(_1d84,_1d85){return _1d84([_1d85],{_contentLink:null,postscript:function(){this.inherited(arguments);this.set("noDataMessage",this.noQueryMessage);},_selectedProjectItemsSetter:function(_1d86){_1d86=_1d86||[];var _1d87=_1d86.filter(function(item){return !!item.contentLink;});var _1d88=_1d86.length===1&&_1d87.length===1;this.set("isSingleItemSelected",_1d88);var _1d89=_1d88?_1d87[0].name:"";this.set("placeholderName",_1d89);this._contentLink=_1d88?_1d87[0].contentLink:null;this.set("noDataMessage",_1d86.length?this.noAccessMessage:this.noQueryMessage);this.set("store",_1d87.length?this.activitiesStore:null);var query={contentReferences:_1d87.map(function(item){return item.contentLink;}),projectId:this.selectedProjectId};this.set("query",_1d87.length?query:null);}});});},"epi-cms/project/viewmodels/_ProjectFeedViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi-cms/project/viewmodels/_ActivityViewModel","dojo/Evented"],function(_1d8a,lang,_1d8b,_1d8c,_1d8d){return _1d8a([_1d8c,_1d8d],{hideOnPost:false,isEditEnabled:false,isSingleItemSelected:false,readOnly:false,selectedProjectId:null,noDataMessage:"",_save:function(_1d8e){var _1d8f=this.activityService.addMessage(this.selectedProjectId,this._contentLink,_1d8e);_1d8f.then(this.emit.bind(this,"save"));return _1d8f;},_placeholderNameSetter:function(_1d90){this.placeholderName=_1d90;var _1d91=_1d90?lang.replace(_1d8b.textareaplaceholder,{name:_1d90}):"";this.set("placeholderText",_1d91);}});});},"epi-cms/project/viewmodels/_ActivityViewModel":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/promise/all","dojo/regexp","dojo/when","dojox/html/entities","epi/dependency","epi/string","dojo/Stateful","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi/i18n!epi/cms/nls/episerver.shared.action","epi/i18n!epi/cms/nls/episerver.cms.notification.autocomplete"],function(_1d92,_1d93,all,_1d94,when,_1d95,_1d96,_1d97,_1d98,_1d99,_1d9a,_1d9b){return _1d92([_1d98],{activityService:null,editLabel:_1d9a.edit,sendLabel:_1d9a.post,resetLabel:_1d9a.cancel,errorMessage:"",isEditEnabled:true,readOnly:true,hideOnPost:true,placeholderText:"",noNotificationUserMessage:_1d9b.nodatamessage,notificationUserStore:null,postscript:function(){this.inherited(arguments);this.activityService=this.activityService||_1d96.resolve("epi.cms.ActivityService");this.profile=this.profile||_1d96.resolve("epi.shell.Profile");this.notificationUserStore=this.notificationUserStore||_1d96.resolve("epi.storeregistry").get("epi.cms.notification.users");},save:function(_1d9c){var _1d9d=this._save(_1d9c);_1d9d.otherwise(this._handleError.bind(this));return _1d9d;},_save:function(_1d9e){},_handleError:function(){this.set("errorMessage",_1d99.errormessage);},_isEditEnabledGetter:function(){if(this.message){return (this.author||this.changedBy)===this.profile.userName;}return this.isEditEnabled;},_messageSetter:function(_1d9f){this.message=_1d9f;this._changeAttrValue("formattedMessage",this.get("formattedMessage"));},_formattedMessageGetter:function(){var _1da0=this.message;var map=_1d95.html;_1da0=_1da0&&_1d95.encode(_1da0,map);_1da0=_1da0&&_1da0.replace(/(\\n)/ig,"");if(!_1da0||!this.notificationUserStore){return new _1d93().resolve(_1d97.toHTML(_1da0));}var regex=/\B@([^\s":;|=,+*?<>[\]\/\\]+)/g,_1da1=_1da0.match(regex)||[],_1da2={},_1da3=_1da1.map(function(match){var _1da4=match.replace(/^@/,""),_1da5=encodeURIComponent(_1da4);return when(this.notificationUserStore.get(_1da5)).then(function(user){_1da2[_1da4]=user.displayName;}).otherwise(function(){});}.bind(this));return all(_1da3).then(function(){_1da0=_1da0.replace(regex,function(match,key){return _1da2[key]?"<strong>"+_1d97.encodeForWebString(_1da2[key])+"</strong>":match;});return _1d97.toHTML(_1da0);});}});});},"epi-cms/project/viewmodels/ProjectCommentViewModel":function(){define(["dojo/_base/declare","epi/i18n!epi/cms/nls/episerver.cms.activities.commentfeed","./_ProjectFeedViewModel"],function(_1da6,_1da7,_1da8){return _1da6([_1da8],{isSingleItemSelected:true,noDataMessage:_1da7.nodatamessage,_selectedProjectIdSetter:function(_1da9){this.selectedProjectId=_1da9;this.set("store",_1da9?this.activitiesStore:null);this.set("query",{projectId:_1da9,activityType:"ProjectMessageActivity"});}});});},"url:epi-cms/project/templates/Overview.html":"<div class=\"epi-project-overview\">\n    <div data-dojo-attach-point=\"toolbar\" class=\"epi-project-overview__toolbar epi-viewHeaderContainer epi-editToolbarMedium\">\n        <h2 class=\"dijitInline\">\n            <div class=\"dijitInline epi-iconObjectProject epi-icon--large\"></div>\n            <span data-dojo-attach-point=\"projectNameNode\"></span>\n        </h2>\n        <div class=\"epi-project-overview__toolbar__trailing\">\n            <div data-dojo-type=\"dijit/form/DropDownButton\"\n                 data-dojo-attach-point=\"publishContainer\"\n                 data-dojo-props=\"showLabel: true, label: this.res.overview.publishdropdown.label\"\n                 data-dojo-attach-event=\"onClick:_publishMenuClickHandler\"\n                 class=\"epi-mediumButton epi-button--bold\">\n                <span></span>\n                <div data-dojo-type=\"epi-cms/project/PublishMenu\"\n                     data-dojo-attach-point=\"publishMenu\"\n                     data-dojo-props=\"commandSource: this.model\">\n                    <section data-epi-section=\"primarySection\">\n                        <span data-dojo-attach-point=\"projectStatusMessageNode\"></span>\n                    </section>\n                    <section data-epi-section=\"statusSection\">\n                        <ul>\n                            <li>\n                                ${res.view.createdby} <span data-dojo-attach-point=\"createdByNode\" class=\"epi-username\"></span>,\n                                <span data-dojo-attach-point=\"createdNode\" class=\"epi-timestamp\"></span>\n                            </li>\n                        </ul>\n                    </section>\n                </div>\n            </div>\n            <button data-dojo-type=\"dijit/form/Button\"\n                    data-dojo-attach-point=\"closeButton\"\n                    data-dojo-attach-event=\"onClick:_close\"\n                    data-dojo-props=\"showLabel: true, label: this.res.overview.closebutton.label\"\n                    class=\"epi-mediumButton epi-button--bold\"></button>\n        </div>\n    </div>\n\n    <div data-dojo-attach-point=\"tabs\" data-dojo-type=\"dijit/layout/TabContainer\">\n        <div data-dojo-type=\"epi-cms/project/ProjectItemList\"\n             data-dojo-attach-point=\"itemList\"\n             data-dojo-props=\"title: this.res.overview.title, commandSource: this.model, res: this.res.overview\">\n\n                <section data-epi-section=\"toolbarSection\">\n                    <div data-dojo-attach-point=\"toolbarTextNode\" class=\"epi-project-item-list__item-count-message-node\"></div>\n                    <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\n                </section>\n                <section data-epi-section=\"activitySection\">\n                    <div data-dojo-type=\"epi-cms/project/ActivityFeed\"\n                         data-dojo-attach-point=\"activityFeed\"\n                         data-dojo-props=\"model: this.model.activityFeedModel\"></div>\n                </section>\n        </div>\n\n        <div data-dojo-type=\"epi-cms/project/ActivityFeed\"\n             data-dojo-attach-point=\"projectComments\"\n             data-dojo-props=\"title: this.res.comments.title, model: this.model.projectCommentFeedModel\"\n             class=\"epi-project-comment-feed\">\n            <div data-dojo-type=\"dijit/Toolbar\"\n                 data-dojo-attach-point=\"projectCommentsToolbar\"\n                 class=\"epi-project-item-list__toolbar epi-flatToolbar\">\n            </div>\n         </div>\n    </div>\n</div>\n","epi-cms/project/ActivityFeed":function(){define(["dojo/_base/declare","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dijit/focus","dijit/registry","dgrid/util/misc","epi/dependency","dijit/_WidgetBase","dijit/_CssStateMixin","epi/shell/widget/_FocusableMixin","epi/shell/widget/_ModelBindingMixin","dgrid/OnDemandList","dgrid/extensions/DijitRegistry","epi/shell/dgrid/WidgetRow","epi-cms/project/Activity","epi-cms/project/ActivityCommentForm"],function(_1daa,_1dab,_1dac,_1dad,_1dae,_1daf,_1db0,misc,_1db1,_1db2,_1db3,_1db4,_1db5,_1db6,_1db7,_1db8,_1db9,_1dba){var _1dbb=_1daa([_1db6,_1db7,_1db8]);return _1daa([_1db2,_1db3,_1db4,_1db5],{baseClass:"epi-activity-feed",noDataMessage:"",query:null,queryOptions:null,modelBindingMap:{isSingleItemSelected:["isSingleItemSelected"],query:["query"],noDataMessage:["noDataMessage"]},postMixInProperties:function(){this.inherited(arguments);this.activityService=this.activityService||_1db1.resolve("epi.cms.ActivityService");this.queryOptions=this.queryOptions||{sort:[{attribute:"created",descending:true}]};},buildRendering:function(){this.inherited(arguments);this.commentForm=new _1dba({model:this.model});_1dac.add(this.commentForm.domNode,"epi-card");this.list=new _1dbb({className:"dgrid--centered-no-data-message",cleanEmptyObservers:false,renderRow:this._renderRow.bind(this),keepScrollPosition:true});this.list.bodyNode.tabIndex=0;this.own(this.commentForm,this.model.on("save",this.focus.bind(this)),_1dab.around(this.list,"resize",this._resizeList.bind(this)));this.commentForm.placeAt(this.list.bodyNode,"first");this.domNode.appendChild(this.list.domNode);this.list.resize();},startup:function(){this.inherited(arguments);this.commentForm.startup();this.list.startup();},focus:function(){_1daf.focus(this.list.bodyNode);},refresh:function(){this.list.refresh();},_renderRow:function(value){var _1dbc=new _1db9({activity:value});_1dac.add(_1dbc.domNode,"epi-card");return _1dbc.domNode;},_resizeList:function(_1dbd){return function(){_1dbd.apply(this.list,arguments);var _1dbe=this.model.isSingleItemSelected?_1dad.getMarginBox(this.commentForm.domNode).h:0;_1dae.set(this.list.contentNode,"height","calc(100% - "+_1dbe+"px)");}.bind(this);},_setNoDataMessageAttr:function(_1dbf){this.noDataMessage=_1dbf;this.list.set("noDataMessage",_1dbf);},_setQueryAttr:function(query){this._set("query",query);if(!this._queryFunction){this._queryFunction=misc.debounce(this._setQueryCallback.bind(this),null,200);}this._queryFunction(this.model.store,query);},_setQueryCallback:function(store,query){if(this._destroyed){return;}var _1dc0=this.model.isSingleItemSelected;_1dac.toggle(this.domNode,"epi-activity-feed--single-item",_1dc0);_1dac.toggle(this.commentForm.domNode,"dijitHidden",!_1dc0);this.list.set("store",store,query,this.queryOptions);this.list.resize();}});});},"epi-cms/project/Activity":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","epi/datetime","epi/shell/TypeDescriptorManager","epi/username","epi-cms/ApplicationSettings","./ActivityComment","./viewmodels/ActivityViewModel","./viewmodels/ActivityCommentViewModel","./viewmodels/MessageActivityViewModel","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/Activity.html","epi/i18n!epi/cms/nls/episerver.cms.activities.activity","epi-cms/project/ActivityCommentForm"],function(_1dc1,lang,_1dc2,_1dc3,_1dc4,_1dc5,_1dc6,_1dc7,_1dc8,_1dc9,_1dca,_1dcb,_1dcc,_1dcd,_1dce,_1dcf,_1dd0){return _1dc1([_1dcb,_1dcc,_1dcd,_1dce],{templateString:_1dcf,model:null,modelBindingMap:{upsertActivityComment:["upsertActivityComment"]},buildRendering:function(){this.inherited(arguments);var _1dd1=this.activity;var model=new _1dc8({id:_1dd1.id,hasMessage:!!_1dd1.message,upsertActivityComment:null});this.commentForm.set("model",model);this.set("model",model);var title=_1dd1.name;var _1dd2=_1dd1.language;if(_1dd2&&_1dd2!==_1dc6.currentContentLanguage){title=lang.replace("{0} ({1})",[title,_1dd2]);}this.titleNode.textContent=title;var _1dd3=_1dc4.getValue(_1dd1.typeIdentifier,"iconClass");_1dc2.add(this.iconNode,_1dd3||"epi-iconProject");var _1dd4=lang.replace("epi-icon{0} epi-icon--{1}",[_1dd1.actionIcon,_1dd1.actionColor]);_1dc2.add(this.actionIconNode,_1dd4);_1dc2.add(this.actionNode,"epi-event--"+_1dd1.actionColor);var _1dd5=_1dd1.delayPublishUntil?_1dd0.delaypublishmessagetemplate:_1dd0.messagetemplate;this.actionTextNode.textContent=lang.replace(_1dd5,{event:_1dd1.actionText,delaypublish:_1dc3.toUserFriendlyString(_1dd1.delayPublishUntil),user:_1dc5.toUserFriendlyString(_1dd1.changedBy),date:_1dc3.toUserFriendlyString(_1dd1.created)});if(_1dd1.message){_1dc2.add(this.domNode,"epi-activity__message");this.own(this._messageForm=new _1dc7({model:new _1dca(_1dd1)},this.messageNode));}if(_1dd1.comments){_1dd1.comments.forEach(function(_1dd6){this.set("upsertActivityComment",_1dd6);},this);}},startup:function(){this.inherited(arguments);this._messageForm&&this._messageForm.startup();},_getActivityCommentComponent:function(_1dd7){var index=-1;var _1dd8=null;var _1dd9=this.getChildren()||[];for(var i=0;i<_1dd9.length;i++){index=i;var _1dda=_1dd9[i];if(_1dda.get("model").id===_1dd7){_1dd8=_1dda;break;}}return {position:(_1dd8!==null?index:-1),activityComment:_1dd8};},_setUpsertActivityCommentAttr:function(_1ddb){if(!_1ddb){return;}var _1ddc=this._getActivityCommentComponent(_1ddb.id);var _1ddd=_1ddc.activityComment;var _1dde=(_1ddc.position===-1?this.getChildren().length:_1ddc.position);if(_1ddd){var _1ddf=new Date(_1ddd.get("model").lastUpdated).getTime();var _1de0=new Date(_1ddb.lastUpdated).getTime();if(_1ddf===_1de0){return;}this.removeChild(_1ddd);_1ddd.destroyRecursive();}var _1de1=new _1dc7({model:new _1dc9(_1ddb)});this.addChild(_1de1,_1dde);}});});},"epi-cms/project/ActivityComment":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","epi/datetime","epi/username","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ActivityComment.html","epi/i18n!epi/cms/nls/episerver.cms.activities.activity.message","./ActivityCommentForm","dijit/form/Button"],function(_1de2,lang,_1de3,_1de4,_1de5,_1de6,_1de7,_1de8,_1de9,_1dea,_1deb){return _1de2([_1de6,_1de7,_1de8,_1de9],{templateString:_1dea,modelBindingMap:{hasChanged:["hasChanged"]},_setHasChangedAttr:function(_1dec){this._set("hasChanged",_1dec);var _1ded=lang.replace(_1deb.editedformat,{updated:_1de4.toUserFriendlyString(this.model.lastUpdated)});this.editedIconNode.title=_1ded;_1de3.toggle(this.editedIconNode,"dijitHidden",!_1dec);},buildRendering:function(){this.inherited(arguments);var user=this.model.changedBy||this.model.author;this.usernameNode.textContent=_1de5.toUserFriendlyString(user,null,false,false,true);this.timestampNode.textContent=_1de4.toUserFriendlyString(this.model.created);}});});},"url:epi-cms/project/templates/ActivityComment.html":"<div class=\"epi-activity-comment\">\n    <header>\n        <span class=\"dijitReset dijitInline epi-username\" data-dojo-attach-point=\"usernameNode\"></span>\n        <span class=\"dijitReset dijitInline epi-event__timestamp\" data-dojo-attach-point=\"timestampNode\"></span>\n        <span class=\"dijitReset dijitInline epi-iconEdited\" data-dojo-attach-point=\"editedIconNode\"></span>\n    </header>\n    <div data-dojo-type=\"epi-cms/project/ActivityCommentForm\"\n         data-dojo-props=\"model: this.model\"\n         data-dojo-attach-point=\"commentForm\"></div>\n</div>\n","epi-cms/project/ActivityCommentForm":function(){define(["dojo/_base/declare","dojo/dom-class","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_FocusMixin","epi/shell/widget/_ModelBindingMixin","dojo/text!./templates/ActivityCommentForm.html","epi/shell/widget/AutoCompleteTextarea","dijit/form/Button"],function(_1dee,_1def,_1df0,_1df1,_1df2,_1df3,_1df4,_1df5){return _1dee([_1df0,_1df1,_1df2,_1df3,_1df4],{templateString:_1df5,readOnly:null,hideOnPost:null,isEditEnabled:true,errorMessage:"",modelBindingMap:{readOnly:["readOnly"],editLabel:["editLabel"],isEditEnabled:["isEditEnabled"],hideOnPost:["hideOnPost"],errorMessage:["errorMessage"],placeholderText:["placeholder"],sendLabel:["sendLabel"],resetLabel:["resetLabel"],message:["value"],formattedMessage:["displayValue"],noNotificationUserMessage:["noNotificationUserMessage"],notificationUserStore:["notificationUserStore"]},postCreate:function(){this.inherited(arguments);this._commentChanged(this.get("value"));this._commentTextarea.on("save",this._postComment.bind(this));},_setModelAttr:function(model){this.inherited(arguments);this._toggleFormsButtonVisibility(!model.readOnly&&this.get("value")!=="");},_setErrorMessageAttr:function(_1df6){this._set("errorMessage",_1df6);this._errorMessage.textContent=_1df6;},_setSendLabelAttr:function(_1df7){this._set("sendLabel",_1df7);if(_1df7){this._postButton.set("label",_1df7);}},_setResetLabelAttr:function(_1df8){this._set("resetLabel",_1df8);if(_1df8){this._resetButton.set("label",_1df8);}},_setEditLabelAttr:function(_1df9){this._set("editLabel",_1df9);if(_1df9){this._editButton.set("label",_1df9);}},_setIsEditEnabledAttr:function(_1dfa){this._set("isEditEnabled",_1dfa);if(this._editButton){_1def.toggle(this._editButton.domNode,"dijitHidden",!this.isEditEnabled);}},_setNoNotificationUserMessageAttr:function(_1dfb){this._commentTextarea.set("noDataMessage",_1dfb);},_setNotificationUserStoreAttr:function(store){this._set("notificationUserStore",store);this._commentTextarea.set("store",store);},_setPlaceholderAttr:function(_1dfc){this._commentTextarea.set("placeholder",_1dfc);},_setReadOnlyAttr:function(_1dfd){this._set("readOnly",_1dfd);_1def.toggle(this._commentTextarea.domNode,"dijitHidden",this.readOnly);if(this.readOnly){this._toggleFormsButtonVisibility(false);}},_setValueAttr:function(value){this._set("value",value);this._commentTextarea.set("value",value);},_setDisplayValueAttr:function(_1dfe){_1dfe.then(function(value){this.commentNode.innerHTML=value;}.bind(this));},_getValueAttr:function(){return this._commentTextarea.get("value");},_commentChanged:function(_1dff){this._started&&this._postButton.set("disabled",!_1dff||_1dff===this.model.message);},_commentFocused:function(){this._toggleFormsButtonVisibility(true);},_reset:function(){if(this._destroyed){return;}this.hideOnPost&&this._toggleWriteComment();this.model.set("errorMessage","");this._commentTextarea.reset();this._toggleFormsButtonVisibility(false);},_postComment:function(){var value=this._commentTextarea.get("value");if(value.trim().length===0){return;}if(value===this.model.message||this._postButton.get("disabled")){this._reset();return;}this._postButton.set("disabled",true);var delay=10;this.defer(function(){_1def.add(this._postButton.domNode,"epi-button--loading");}.bind(this),delay);this.model.save(value).then(this._reset.bind(this)).always(function(){if(!this._destroyed){this._postButton.set("disabled",false);_1def.remove(this._postButton.domNode,"epi-button--loading");}}.bind(this));},_toggleWriteComment:function(){_1def.toggle(this._commentTextarea.domNode,"dijitHidden");_1def.toggle(this._editButton.domNode,"dijitHidden");_1def.toggle(this.commentNode,"dijitHidden");if(this._commentTextarea.isFocusable()){this._commentTextarea.focus();this._commentTextarea.setCaretLast();}if(this._editButton.isFocusable()){this._editButton.focus();}},_toggleFormsButtonVisibility:function(_1e00){_1def.toggle(this._commentFormButtons,"dijitHidden",!_1e00);}});});},"url:epi-cms/project/templates/ActivityCommentForm.html":"<div class=\"epi-activity-comment-form\">\n    <div class=\"epi-activity-comment__message\"\n         data-dojo-attach-point=\"commentNode\"></div>\n    <div data-dojo-attach-point=\"_commentTextarea, focusNode\"\n         data-dojo-attach-event=\"onChange:_commentChanged, onFocus: _commentFocused\"\n         data-dojo-props=\"intermediateChanges: true, searchProperty: 'userName', tagProperty: 'userName', displayProperty: 'displayName'\"\n         data-dojo-type=\"epi/shell/widget/AutoCompleteTextarea\" class=\"epi-autocomplete-textarea--chat-icon\"></div>\n    <div class=\"epi-activity-comment-form__buttons dijitHidden\"\n         data-dojo-attach-point=\"_commentFormButtons\">\n        <span class=\"epi-activity-feed__error-message\"\n              data-dojo-attach-point=\"_errorMessage\"></span>\n        <button data-dojo-type=\"dijit/form/Button\"\n                class=\"epi-primary\"\n                data-dojo-attach-event=\"onClick:_postComment\"\n                data-dojo-props=\"disabled: true\"\n                data-dojo-attach-point=\"_postButton\"></button>\n        <button data-dojo-type=\"dijit/form/Button\"\n                class=\"epi-chromeless epi-chromeless--text-only\"\n                data-dojo-attach-point=\"_resetButton\"\n                data-dojo-attach-event=\"onClick: _reset\"></button>\n    </div>\n    <button data-dojo-type=\"dijit/form/Button\"\n            class=\"epi-chromeless epi-chromeless--text-only epi-text--small\"\n            data-dojo-attach-point=\"_editButton\"\n            data-dojo-attach-event=\"onClick: _toggleWriteComment\"></button>\n</div>\n","epi/shell/widget/AutoCompleteTextarea":function(){define("epi/shell/widget/AutoCompleteTextarea",["dojo/_base/declare","dojo/_base/lang","dojo/keys","dojo/dom-style","dojo/dom-geometry","dijit/form/_FormValueWidget","dijit/_WidgetsInTemplateMixin","dijit/form/_TextBoxMixin","dgrid/OnDemandList","dgrid/Selection","dgrid/util/misc","put-selector/put","dijit/popup","epi/shell/dgrid/selection/Extensions","dijit/form/Textarea"],function(_1e01,lang,keys,_1e02,_1e03,_1e04,_1e05,_1e06,_1e07,_1e08,misc,put,popup,_1e09){var _1e0a=_1e01([_1e07,_1e08,_1e09]);return _1e01([_1e04,_1e05],{templateString:"<div><div data-dojo-type='dijit/form/Textarea' data-dojo-attach-point='_textArea, focusNode'></div><div data-dojo-attach-point='_listNode'></div></div>",baseClass:"epi-autocomplete-textarea",value:null,store:null,placeholder:"",searchProperty:"query",tagProperty:"",displayProperty:"",noDataMessage:"",_setIdAttr:"domNode",buildRendering:function(){this.inherited(arguments);var _1e0b=this._textArea;this.own(_1e0b.on("keyup",lang.hitch(this,"_onKeyUp")),_1e0b.on("keydown",lang.hitch(this,"_onKeyDown")),_1e0b.on("change",lang.hitch(this,"_handleOnChange")),this.on("blur",this._closePopup.bind(this)),this._selectList=new _1e0a({className:"epi-autocomplete-list",selectionMode:"single",renderRow:this._renderRow.bind(this)},this._listNode),this._selectList.on(".dgrid-row:click",this._insertSelection.bind(this)),this._selectList.on("dgrid-refresh-complete",lang.hitch(this._selectList,"moveSelectionDown")));popup.moveOffScreen(this._selectList);},startup:function(){this.inherited(arguments);this._selectList.startup();},focus:function(){if(this.isFocusable()){this.inherited(arguments);}},setCaretLast:function(){if(this._textArea.value){_1e06.selectInputText(this._textArea.domNode,this._textArea.value.length);}},reset:function(){this._textArea.reset();},_setIntermediateChangesAttr:function(_1e0c){this._set("intermediateChanges",_1e0c);this._textArea.set("intermediateChanges",_1e0c);},_setNoDataMessageAttr:function(_1e0d){this._selectList.set("noDataMessage",_1e0d);},_setPlaceholderAttr:function(_1e0e){this._set("placeholder",_1e0e);this._textArea.set("placeholder",_1e0e);},_setValueAttr:function(value){this._set("value",value);this._textArea.set({value:value,_resetValue:value});},_getValueAttr:function(){return this._textArea.get("value");},_onKeyUp:function(e){if(!this.store){return;}var key=e.keyCode;switch(key){case keys.LEFT_ARROW:case keys.RIGHT_ARROW:case keys.HOME:case keys.END:case keys.UP_ARROW:case keys.DOWN_ARROW:case keys.CTRL:case keys.ALT:case keys.SHIFT:return;}var _1e0f=this._textArea.textbox,_1e10=_1e0f.selectionStart,value=_1e0f.value;if(value[_1e10-1]==="@"&&(_1e10===1||/\s/.test(value[_1e10-2]))){this._tagStart=_1e10-1;this._openPopup();}if(this._isPopupOpen){var _1e11=key===keys.ESCAPE,_1e12=typeof this._tagStart=="number"&&value[this._tagStart]!=="@";if(_1e11||_1e12){this._closePopup();return;}if(key===keys.ENTER||key===keys.TAB){this._insertSelection();return;}this._tagEnd=_1e10;var query=value.substring(this._tagStart+1,_1e10);this._setQuery(query);}},_setQuery:function(query){query=(query||"").trim();if(!query){return;}if(!this._queryFunction){var _1e13=function(query){this._selectList.set("store",this.store,query);};this._queryFunction=misc.debounce(_1e13.bind(this),null,200);}var _1e14={};_1e14[this.searchProperty]=query;this._queryFunction(_1e14);},_onKeyDown:function(e){var _1e15=this._selectList,key=e.keyCode;if(this._isPopupOpen){switch(key){case keys.UP_ARROW:e.preventDefault();_1e15.moveSelectionUp();break;case keys.DOWN_ARROW:e.preventDefault();_1e15.moveSelectionDown();break;case keys.ESCAPE:case keys.ENTER:case keys.TAB:e.preventDefault();break;}return;}if(key===keys.ENTER&&!e.shiftKey){this.emit("save");e.preventDefault();}},_insertSelection:function(){var _1e16=this._textArea.textbox,_1e17=this._selectList,_1e18=this._tagEnd,value=_1e16.value;var _1e19=null;for(var id in _1e17.selection){if(_1e17.selection[id]){_1e19=_1e17.row(id).data;break;}}if(!_1e19){this._closePopup();return;}var _1e1a=_1e19[this.tagProperty];var _1e1b="";var _1e1c=0;(value.charAt(_1e18)!==" "?_1e1b=" ":_1e1c=1);var _1e1d=value.slice(0,this._tagStart+1)+_1e1a+_1e1b;var _1e1e=_1e1d.length+_1e1c;_1e1d+=value.slice(_1e18);_1e16.value=_1e1d;_1e16.setSelectionRange(_1e1e,_1e1e);this._closePopup();},_renderRow:function(item){return put("div",""+item[this.displayProperty]);},_openPopup:function(){var _1e1f=this._selectList,_1e20=_1e03.getContentBox(this.domNode),_1e21=this._closePopup.bind(this);_1e02.set(_1e1f.domNode,"width",_1e20.w+"px");popup.open({parent:this,popup:_1e1f,around:this.domNode,onExecute:_1e21,onCancel:_1e21});this._isPopupOpen=true;},_closePopup:function(){this._isPopupOpen=false;this._tagStart=null;this._tagEnd=null;this._selectList.set("store",null);popup.close(this._selectList);}});});},"epi-cms/project/viewmodels/ActivityViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dijit/Destroyable","./_ActivityViewModel","epi/i18n!epi/cms/nls/episerver.cms.activities.activity.message"],function(_1e22,lang,_1e23,_1e24,_1e25){return _1e22([_1e24,_1e23],{hasMessage:false,postscript:function(){this.inherited(arguments);this.own(this.activityService.on("activity-comment-updated",lang.hitch(this,this._activityCommentUpdated)));},_editLabelGetter:function(){return this.hasMessage?_1e25.reply.label:_1e25.comment.label;},_save:function(_1e26){return this.activityService.addComment(this.id,_1e26);},_activityCommentUpdated:function(_1e27){if(_1e27&&_1e27.activityId===this.id){this.set("upsertActivityComment",_1e27);}}});});},"epi-cms/project/viewmodels/ActivityCommentViewModel":function(){define(["dojo/_base/declare","./_ActivityViewModel","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1e28,_1e29,_1e2a){return _1e28([_1e29],{sendLabel:_1e2a.save,_save:function(_1e2b){var _1e2c=this.activityService.saveComment(this.id,_1e2b);_1e2c.then(this.set.bind(this));return _1e2c;}});});},"epi-cms/project/viewmodels/MessageActivityViewModel":function(){define(["dojo/_base/declare","./_ActivityViewModel","epi/i18n!epi/cms/nls/episerver.shared.action"],function(_1e2d,_1e2e,_1e2f){return _1e2d([_1e2e],{sendLabel:_1e2f.save,_save:function(_1e30){return this.activityService.saveMessage(this.id,_1e30);}});});},"url:epi-cms/project/templates/Activity.html":"<div class=\"epi-event epi-activity\">\n    <div class=\"epi-event__title-wrapper\">\n        <span class=\"dijitInline\" data-dojo-attach-point=\"iconNode\"></span>\n        <span class=\"epi-event__title\" data-dojo-attach-point=\"titleNode\"></span>\n    </div>\n    <div class=\"epi-event__status\" data-dojo-attach-point=\"actionNode\">\n        <span class=\"dijitInline epi-event__status__icon\">\n            <span data-dojo-attach-point=\"actionIconNode\"></span>\n        </span><span class=\"epi-event__status__message\" data-dojo-attach-point=\"actionTextNode\"></span>\n    </div><div data-dojo-attach-point=\"messageNode\"></div\n    ><div class=\"epi-activity__comments\" data-dojo-attach-point=\"containerNode\"></div>\n    <div data-dojo-type=\"epi-cms/project/ActivityCommentForm\" data-dojo-attach-point=\"commentForm\"></div>\n</div>\n","epi-cms/project/ProjectItemList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-geometry","dojo/dom-class","dojo/keys","dojo/on","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/_CssStateMixin","dgrid/Keyboard","dgrid/OnDemandList","dgrid/Selection","dgrid/extensions/DijitRegistry","epi","epi/shell/dnd/Target","epi/shell/dgrid/Focusable","epi/shell/dgrid/Formatter","epi/shell/dgrid/Responsive","epi/shell/widget/_FocusableMixin","epi/shell/widget/_SectionedTemplatedMixin","epi-cms/extension/events","epi-cms/dgrid/listItemFormatters","epi-cms/dgrid/WithContextMenu","epi/i18n!epi/cms/nls/episerver.cms.components.project","dojo/text!./templates/ProjectItemList.html"],function(_1e31,lang,_1e32,_1e33,_1e34,keys,on,_1e35,_1e36,_1e37,_1e38,_1e39,_1e3a,_1e3b,epi,_1e3c,_1e3d,_1e3e,_1e3f,_1e40,_1e41,_1e42,_1e43,_1e44,res,_1e45){return _1e31([_1e36,_1e41,_1e35,_1e37,_1e40],{contentLanguage:null,commandProvider:null,dndEnabled:false,sections:["toolbarSection","listContainer","activitySection"],templateString:_1e45,listItemType:"card",res:res,_listClass:_1e31([_1e39,_1e3e,_1e3a,_1e38,_1e44,_1e3b,_1e3d,_1e3f]),_list:null,_noDataMessageWrapper:"<span class=\"dgrid-no-data__content\">{0}</span>",buildRendering:function(){this.inherited(arguments);this._setupList();},focus:function(){if(this._list){this._list.focus();}},layout:function(){var _1e46,size;if(!this._contentBox){return;}_1e46=_1e33.getMarginBox(this.toolbar.domNode).h+_1e33.getMarginBox(this.notificationBarNode).h;size=lang.mixin({},this._contentBox,{h:this._contentBox.h-_1e46});_1e33.setMarginBox(this.listContainer,size);this._list.resize();},clearSelection:function(){this._list.clearSelection();this.emit("selection-changed",{items:[]});},refresh:function(){this._list.refresh({keepScrollPosition:true});},setSelection:function(_1e47){this.selectItems(_1e47);this.emit("selection-changed",{items:_1e47});},selectItems:function(_1e48){this._list.clearSelection();_1e48.forEach(function(item){this._list.select(item);},this);},toggleActivities:function(_1e49){_1e34.toggle(this.domNode,"epi-project-item-list--activities-visible",_1e49);},updateQuery:function(store,query){var _1e4a=!query&&this.res.noquery?this.res.noquery:this.res.nodata,_1e4b=lang.replace(this._noDataMessageWrapper,[_1e4a]);this._list.set("noDataMessage",_1e4b);if(this._list.store!==store||!epi.areEqual(this._list.query,query)){this._list.set("store",store,query);}},_setupList:function(){var list,_1e4c;_1e43.contentLanguage=this.contentLanguage;list=new this._listClass({formatters:_1e43[this.listItemType],cleanEmptyObservers:false,commandCategory:"itemContext",deselectOnRefresh:false,farOffRemoval:Infinity,refocusOnRefresh:true,responsiveMap:{"epi-card-list--narrow":570}},this.itemListNode);list.contextMenu.addProvider(this.commandSource);this.own(this._list=list,list.on("dgrid-cellfocusin, .dgrid-content:click",lang.hitch(this,function(evt){if(evt.target===list.contentNode){this.clearSelection();}var items=this._getSelectedItems(list);this.emit("selection-changed",{items:items});})),list.on("dgrid-select, dgrid-deselect",lang.hitch(this,function(evt){var items=this._getSelectedItems(list);this.emit("active-items-changed",{items:items});})),list.on(".dgrid-row:dblclick",lang.hitch(this,function(evt){var item=this._list.row(evt).data;this.emit("itemaction",{item:item});})),list.addKeyHandler(keys.ENTER,lang.hitch(this,function(evt){var item=this._list.row(evt).data;this.emit("itemaction",{item:item});})),list.on(on.selector(".dgrid-row",_1e42.keys.del),lang.hitch(this,function(evt){var item=this._list.row(evt).data;this.emit("itemremove",{item:item});})),_1e4c=new _1e3c(this.overlayNode,{createItemOnDrop:false,accept:["episerver.core.icontentdata.reference"]}),_1e32.after(_1e4c,"onDropData",lang.hitch(this,this._onDropData),true));},_getSelectedItems:function(list){var items=[];Object.keys(list.selection).forEach(function(key){if(list.selection[key]){var item=list.row(key).data;items.push(item);}});return items;},_onDropData:function(_1e4d){var items=_1e4d.map(function(item){return item.data;});this.emit("itemsdropped",{items:items});},_setDndEnabledAttr:function(value){this._set("dndEnabled",value);_1e34.toggle(this.overlayNode,"dijitHidden",!value);},_setNotificationMessageAttr:function(value){this.notificationTextNode.textContent=value;_1e34.toggle(this.notificationBarNode,"dijitHidden",!value);this.layout();},_setSortOrderAttr:function(value){if(this._list.get("sort")!==value){this._list.set("sort",value);}},_setContentLanguageAttr:function(value){this._set("contentLanguage",value);_1e43.contentLanguage=value;}});});},"epi/shell/dgrid/Responsive":function(){define("epi/shell/dgrid/Responsive",["dojo/_base/declare","dojo/dom-class","dojo/dom-geometry"],function(_1e4e,_1e4f,_1e50){return _1e4e([],{currentResponsiveClass:"",responsiveMap:null,resize:function(){this.inherited(arguments);var _1e51=Infinity,_1e52=_1e50.getContentBox(this.domNode).w,_1e53="",_1e54=this.responsiveMap;if(_1e54){Object.keys(_1e54).forEach(function(key){var _1e55=_1e54[key];if(_1e52<=_1e55&&_1e55<_1e51){_1e51=_1e55;_1e53=key;}});_1e4f.replace(this.domNode,_1e53,this.currentResponsiveClass);this.currentResponsiveClass=_1e53;}}});});},"epi/shell/widget/_SectionedTemplatedMixin":function(){define("epi/shell/widget/_SectionedTemplatedMixin",["dojo/_base/declare","dojo/query","dojo/string","dijit/_TemplatedMixin"],function(_1e56,query,_1e57,_1e58){return _1e56([_1e58],{sections:[],_fillContent:function(_1e59){this.sections.forEach(function(_1e5a){var _1e5b=this[_1e5a],_1e5c=query(_1e57.substitute("[data-epi-section=${0}]",[_1e5a]),_1e59);_1e5c.forEach(function(_1e5d){while(_1e5d.childNodes.length>0){_1e5b.appendChild(_1e5d.childNodes[0]);}});},this);}});});},"url:epi-cms/project/templates/ProjectItemList.html":"<div class=\"epi-project-item-list\">\n    <div data-dojo-type=\"dijit/Toolbar\"\n         data-dojo-attach-point=\"toolbar\"\n         class=\"epi-project-item-list__toolbar epi-flatToolbar\">\n        <span data-dojo-attach-point=\"toolbarSection\"></span>\n    </div>\n    <div data-dojo-attach-point=\"listContainer\" class=\"epi-project-item-list__container\">\n        <div data-dojo-attach-point=\"notificationBarNode\" class=\"epi-notificationBar dijitHidden\">\n            <div class=\"epi-notificationBarItem\">\n                <div class=\"epi-notificationBarText\">\n                    <p data-dojo-attach-point=\"notificationTextNode\"></p>\n                </div>\n            </div>\n        </div>\n        <div data-dojo-attach-point=\"overlayNode\"\n             class=\"epi-project-item-list__dnd-area epi-visible-dnd-area epi-project-list-area__dnd-area--empty-list dijitHidden\">\n            <span class=\"epi-project-item-list__dnd-area-content\">${res.droptoadditems}</span>\n        </div>\n        <div data-dojo-attach-point=\"itemListNode\"\n             class=\"epi-card-list dgrid--centered-no-data-message\"></div\n        ><div data-dojo-attach-point=\"activitySection\"\n              class=\"epi-activity-section\"></div>\n    </div>\n</div>\n","epi-cms/project/PublishMenu":function(){define(["dojo/_base/declare","dojo/on","dijit/DropDownMenu","dijit/registry","epi/shell/command/builder/MenuAssembler","epi/shell/command/builder/MenuBuilder","epi/shell/widget/_SectionedTemplatedMixin","./command/PublishMenuButtonBuilder","dojo/text!./templates/PublishMenu.html"],function(_1e5e,on,_1e5f,_1e60,_1e61,_1e62,_1e63,_1e64,_1e65){return _1e5e([_1e5f,_1e63],{sections:["primarySection","statusSection"],templateString:_1e65,buildRendering:function(){this.inherited(arguments);var _1e66=[{builder:new _1e64({settings:{"class":"epi-button--bold epi-button--full-width epi-success",isExecutingClass:"epi-loading"},optionClass:"epi-menu--inverted",optionItemClass:"epi-radioMenuItem"}),category:"publishmenu-primary",target:this.publishMenuNode},{builder:new _1e62(),category:"publishmenu",target:this.projectActionMenu}];this.own(this._menuAssembler=new _1e61({configuration:_1e66}));this.own(on(this.domNode,"beforeFocusedButtonRemoved",this.domNode.focus));},childSelector:function(node){var _1e67=_1e60.byNode(node);return _1e67&&_1e67.focus&&(node.parentNode===this.projectActionMenu);},getChildren:function(){return [].concat(_1e60.findWidgets(this.publishMenuNode),_1e60.findWidgets(this.projectActionMenu));},_setCommandSourceAttr:function(_1e68){this._menuAssembler.set("commandSource",_1e68);},_getCommandSourceAttr:function(){return this._menuAssembler.get("commandSource");}});});},"epi-cms/project/command/PublishMenuButtonBuilder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/form/Button","epi/shell/command/_CommandModelBindingMixin","epi/shell/command/builder/ButtonBuilder"],function(_1e69,lang,on,_1e6a,_1e6b,_1e6c){return _1e69([_1e6c],{_buttonClass:_1e69([_1e6a,_1e6b],{_setSelected:function(){},_setIsAvailableAttr:function(_1e6d){if(!_1e6d&&this.get("focused")){on.emit(this.domNode,"beforeFocusedButtonRemoved",{bubbles:true});}this.inherited(arguments);}})});});},"url:epi-cms/project/templates/PublishMenu.html":"<div tabIndex=\"${tabIndex}\" role=\"menu\" class=\"epi-invertedTooltip epi-publishActionMenu\" data-dojo-attach-point=\"containerNode\" data-dojo-attach-event=\"onkeypress:_onKeyPress\">\n    <div class=\"epi-tooltipDialogTop\">\n        <ul>\n            <li data-dojo-attach-point=\"primarySection\" class=\"epi-projectStatusMessage\"></li>\n            <li data-dojo-attach-point=\"publishMenuNode\"></li>\n        </ul>\n        <div class=\"dijitTooltipConnector\"></div>\n    </div>\n    <div data-dojo-attach-point=\"statusSection\" class=\"epi-tooltipDialogInfo\"></div>\n    <table class=\"epi-tooltipDialogMenu epi-menuInverted\" cellspacing=\"0\">\n        <tbody data-dojo-attach-point=\"projectActionMenu\"></tbody>\n    </table>\n</div>","epi-cms/project/ProjectComponent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/when","epi/shell/command/_WidgetCommandBinderMixin","./_ProjectView","./viewmodels/ProjectComponentViewModel","dojo/text!./templates/ProjectComponent.html","epi/i18n!epi/cms/nls/episerver.cms.components.project","dijit/DropDownMenu","dijit/form/Button","dijit/form/DropDownButton","dijit/Toolbar","./ProjectItemList","./ProjectSelector","./PublishMenu"],function(_1e6e,lang,_1e6f,_1e70,_1e71,on,when,_1e72,_1e73,_1e74,_1e75,res){function show(list){list.forEach(function(node){_1e70.remove(node,"dijitHidden");});};function hide(list){list.forEach(function(node){_1e70.add(node,"dijitHidden");});};var _1e76=lang.delegate(_1e73.prototype.modelBindingMap,{placeHolder:["placeHolder"]});return _1e6e([_1e73,_1e72],{"class":"epi-project-component",modelBindingMap:{projectItemQuery:["projectItemQuery"],projectItemSortOrder:["projectItemSortOrder"],selectedProject:["selectedProject"],created:["created"],createdBy:["createdBy"],createProjectInfo:["createProjectInfo"],dndEnabled:["dndEnabled"],placeholderState:["placeholderState"],notificationMessage:["notificationMessage"],projectStatus:["projectStatus"],contentLanguage:["contentLanguage"]},res:res,templateString:_1e75,layout:function(){this.inherited(arguments);this.itemList.resize(this._contentBox,this._contentBox);},_createViewModel:function(){return new _1e74();},_projectSelectorSortChanged:function(_1e77){this.model.set("projectSortOrder",_1e77);},_projectSelectorChange:function(_1e78){this.model.set("selectedProject",_1e78);},_newProjectButtonClickHandler:function(){this.model.namedCommands.addProject.execute();},_setCreateProjectInfoAttr:{node:"createProjectInfoNode",type:"innerText"},_setSelectedProjectAttr:function(value){this.projectSelector.set("value",value);},_setPlaceholderStateAttr:function(value){if(this.get("_placeholderState")===value){return;}this._set("_placeholderState",value);switch(value){case "noProjects":show([this.placeholderNode]);hide([this.projectSelector.domNode,this.publishContainer.domNode]);break;case "noSelectedProject":show([this.projectSelector.domNode,this.placeholderNode]);hide([this.publishContainer.domNode]);break;default:show([this.projectSelector.domNode,this.publishContainer.domNode]);hide([this.placeholderNode]);}}});});},"epi-cms/project/viewmodels/ProjectComponentViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","./_ProjectViewModel","epi/i18n!epi/nls/episerver.cms.components.project"],function(_1e79,lang,_1e7a,when,_1e7b,res){return _1e79([_1e7b],{createProjectInfo:"",hasProject:false,_selectedProjectProfileKey:"epi.selected-project-id",initialize:function(){this._updateHasProject();return this.inherited(arguments);},removeProject:function(){var self=this,store=this.projectStore;if(!this.selectedProject){return new _1e7a().resolve();}return store.remove(this.selectedProject.id).then(function(){self._selectNextProject();});},_loadSelectedProject:function(){var _1e7c=this.projectStore;return when(this.profile.get(this._selectedProjectProfileKey),function(_1e7d){if(!_1e7d){return null;}return when(_1e7c.get(_1e7d)).then(function(_1e7e){var _1e7f=!!_1e7e||undefined;return this._updateHasProject(_1e7f).then(function(){return _1e7e;});}.bind(this)).otherwise(function(ex){return null;});}.bind(this));},_updatePlaceholderState:function(){var _1e80=this.get("hasProject"),_1e81=!!this.get("selectedProject"),state="";if(!_1e80){state="noProjects";this.set("createProjectInfo",res.placeholder.noprojectscreated);}else{if(_1e80&&!_1e81){state="noSelectedProject";this.set("createProjectInfo",res.placeholder.noprojectselected);}}this.set("placeholderState",state);},_getProjects:function(start,count,sort){return this.projectStore.query(null,{start:start,count:count,sort:sort});},_updateHasProject:function(_1e82){return when(_1e82===true?[_1e82]:this._getProjects(0,1)).then(function(_1e83){var _1e84=_1e83.length>0;this.set("hasProject",_1e84);return _1e84;}.bind(this));},_selectNextProject:function(){when(this._getProjects(0,1,this.get("projectSortOrder")),lang.hitch(this,function(_1e85){var value=_1e85.length>0?_1e85[0]:null;this.set("selectedProject",value);this.set("hasProject",_1e85.length>0);}));},_hasProjectSetter:function(value){this.hasProject=value;this._updatePlaceholderState();},_selectedProjectSetter:function(_1e86){this.inherited(arguments);if(!this.hasProject&&_1e86){this.set("hasProject",true);}else{this._updatePlaceholderState();}this.profile.set(this._selectedProjectProfileKey,_1e86&&_1e86.id,{location:"server"});}});});},"url:epi-cms/project/templates/ProjectComponent.html":"<div>\n    <div data-dojo-type=\"epi-cms/project/ProjectItemList\"\n         data-dojo-attach-point=\"itemList\"\n         data-dojo-props=\"commandSource: this.model, listItemType: 'card-compact'\">\n        <section data-epi-section=\"toolbarSection\">\n            <span data-dojo-type=\"epi-cms/project/ProjectSelector\"\n                  data-dojo-attach-point=\"projectSelector\"\n                  data-dojo-props=\"store:this.model.projectStore\"\n                  data-dojo-attach-event=\"onSortChanged:_projectSelectorSortChanged, onChange:_projectSelectorChange\"></span>\n            <div data-dojo-type=\"dijit/form/DropDownButton\"\n                 data-dojo-attach-point=\"publishContainer\"\n                 data-dojo-props=\"iconClass: 'epi-iconPublishProject', showLabel: false, label: this.res.publishdropdown.label\"\n                 data-dojo-attach-event=\"openDropDown:_publishMenuClickHandler\"\n                 class=\"epi-flat epi-chromeless epi-chromeless--with-arrow\">\n                <span></span>\n                <div data-dojo-type=\"epi-cms/project/PublishMenu\"\n                     data-dojo-attach-point=\"publishMenu\"\n                     data-dojo-props=\"commandSource: this.model\">\n                    <section data-epi-section=\"primarySection\">\n                        <span data-dojo-attach-point=\"projectStatusMessageNode\"></span>\n                    </section>\n                    <section data-epi-section=\"statusSection\">\n                        <ul>\n                            <li>\n                                ${res.view.createdby} <span data-dojo-attach-point=\"createdByNode\" class=\"epi-username\"></span>,\n                                <span data-dojo-attach-point=\"createdNode\" class=\"epi-timestamp\"></span>\n                            </li>\n                        </ul>\n                    </section>\n                </div>\n            </div>\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\n        </section>\n\n        <section data-epi-section=\"listContainer\">\n            <div data-dojo-attach-point=\"placeholderNode\" class=\"epi-project-gadget__placeholder dijitHidden\">\n                <div class=\"epi-project-gadget__placeholder-content\">\n                    <button data-dojo-type=\"dijit/form/Button\" type=\"button\"\n                            data-dojo-props=\"iconClass: 'epi-iconPlus'\"\n                            data-dojo-attach-event=\"onClick:_newProjectButtonClickHandler\"\n                            class=\"epi-flat epi-chromeless\">${res.command.newproject.label}</button>\n                    <div data-dojo-attach-point=\"createProjectInfoNode\" class=\"epi-project-gadget__placeholder-info\"></div>\n                </div>\n            </div>\n        </section>\n    </div>\n</div>\n","epi-cms/project/ProjectSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-construct","dojo/on","dojo/Deferred","dojox/html/entities","epi","dojo/text!dijit/form/templates/Select.html","epi/i18n!epi/shell/ui/nls/episerver.shared.header","epi/i18n!epi/cms/nls/episerver.cms.components.project","./ProjectSelectorList","dijit/form/_FormValueWidget","epi/shell/widget/DeferredDropDownButton","dijit/form/ToggleButton"],function(_1e87,lang,_1e88,_1e89,on,_1e8a,_1e8b,epi,_1e8c,_1e8d,_1e8e,_1e8f,_1e90,_1e91){return _1e87([_1e91,_1e90],{"class":"epi-project-selector epi-chromeless epi-chromeless--with-arrow epi-flat",iconClass:"epi-iconProject",value:null,store:null,sort:null,query:null,enableDefaultValue:false,defaultValueText:_1e8e.preview.defaultoption,header:_1e8e.selector.title,buildRendering:function(){this.inherited(arguments);this.own(this.dropDown=new _1e8f({baseClass:"dijitMenu",header:this.header,enableDefaultValue:this.enableDefaultValue,defaultValueText:this.defaultValueText}),on(this.dropDown,"change",lang.hitch(this,function(e){this.set("value",e.value,true);this.closeDropDown(true);}),true));},startup:function(){if(this._started){return;}this.inherited(arguments);this.dropDown.startup();if(this.enableDefaultValue&&!this.value){this.set("value",null);}},compare:function(_1e92,_1e93){return epi.areEqual(_1e92,_1e93)?0:-1;},loadAndOpenDropDown:function(){var args=arguments;var _1e94=this.dropDown.refresh();return _1e94.then(lang.hitch(this,function(){return this.inherited(args);}));},isLoaded:function(){if(this.enableDefaultValue){return false;}return this.inherited(arguments);},_getQueryAttr:function(){return this.query||{};},_setQueryAttr:function(value){this._set("query",value);if(this.dropDown){this.dropDown.set("query",value);}},_setStoreAttr:function(store){this._set("store",store);if(this.dropDown){this.dropDown.set("store",store);}},_setLabelAttr:function(value){this.inherited(arguments,[_1e8b.encode(value||"")]);},_setValueAttr:function(value,_1e95){this.set("label",value&&value.name);if(this.enableDefaultValue&&!value){this.set("label",this.defaultValueText);}!_1e95&&this.dropDown&&this.dropDown.set("selectedProject",value);this.inherited(arguments);}});});},"epi-cms/project/ProjectModeToolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","dojo/on","dojo/dom-style","dojo/dom-class","dojo/string","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/layout/_LayoutWidget","dijit/form/Button","epi/shell/widget/dialog/Alert","epi/shell/widget/_ModelBindingMixin","./ProjectSelector","./viewmodels/ProjectModeToolbarViewModel","epi/dependency","epi/shell/command/builder/DropDownButtonBuilder","epi/shell/command/builder/MenuAssembler","dojo/text!./templates/ProjectModeToolbar.html","dojo/text!./templates/CurrentProjectDoesNotExistsWarning.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.toolbar"],function(_1e96,lang,has,on,_1e97,_1e98,_1e99,_1e9a,_1e9b,_1e9c,_1e9d,Alert,_1e9e,_1e9f,_1ea0,_1ea1,_1ea2,_1ea3,_1ea4,_1ea5,_1ea6){return _1e96([_1e9c,_1e9a,_1e9b,_1e9e],{templateString:_1ea4,localizations:_1ea6,_projectDoesNotExistWarning:"",postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_1ea1.resolve("epi.cms.ProjectService");},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.own(this.model=new _1ea0());}this._projectDoesNotExistWarning=_1e99.substitute(_1ea5,{warning:_1ea6.projectdoesnotexists.alert.warning,description:_1ea6.projectdoesnotexists.alert.description});},buildRendering:function(){this.inherited(arguments);this._setupContextMenu();var _1ea7=this.domNode,_1ea8=this._projectDoesNotExistWarning;this.own(this.projectOverviewButton=new _1e9d({showLabel:true,"class":"dijitHidden epi-chromeless",label:_1ea6.overview.label},this.projectOverviewButtonNode),this.projectOverviewButton.on("click",lang.hitch(this,"_openProjectOverview")),this.projectSelector=new _1e9f({iconClass:"dijitNoIcon","class":"epi-chromeless epi-chromeless--inverted epi-chromeless--with-arrow epi-project-mode-toolbar__selector",enableDefaultValue:true,defaultValueText:_1ea6.defaultoption,store:this.model.projectStore},this.projectSelectorNode),this.model.on("currentProjectDoesNotExists",function(){var _1ea9=new Alert({description:_1ea8});_1ea9.show();}));},_toggleOverviewButton:function(_1eaa){var _1eab=this.projectOverviewButton.domNode;_1e98.toggle(_1eab,"dijitHidden",!_1eaa);},startup:function(){this.inherited(arguments);this.own(this.model.watch("overviewButtonVisible",lang.hitch(this,function(_1eac,_1ead,_1eae){this._toggleOverviewButton(_1eae);})));var model=this.model;this.model.initialize().then(lang.hitch(this,function(){var _1eaf=this.domNode;this.own(this.projectSelector.watch("value",lang.hitch(this,function(_1eb0,_1eb1,_1eb2){_1e98.toggle(_1eaf,"epi-project-mode-toolbar--project-selected",!!_1eb2);_1e98.remove(_1eaf,"epi-project-mode-toolbar--project-deleted");model.set("currentProject",_1eb2);})));this.projectSelector.set("value",model.get("currentProject"));}));this.own(this.projectService.on("currentProjectChanged",lang.hitch(this,function(_1eb3){this.projectSelector.set("value",_1eb3);})));this.own(this.model.on("animateToolbar",lang.hitch(this,function(){_1e98.add(this.domNode,"epi-project-mode-toolbar--flash");var _1eb4=on(this.domNode,"animationend",lang.hitch(this,function(){_1e98.remove(this.domNode,"epi-project-mode-toolbar--flash");_1eb4.remove();}));})));this.own(this.model.watch("currentProject",lang.hitch(this,function(_1eb5,_1eb6,_1eb7){if(_1eb7&&_1eb7.isDeleted){_1e98.add(this.domNode,"epi-project-mode-toolbar--project-deleted");}})));},_openProjectOverview:function(){var _1eb8=this.projectSelector.get("value");if(_1eb8){this.model.showProjectOverview(_1eb8.id);}},_setupContextMenu:function(){this.own(new _1ea3({configuration:[{builder:new _1ea2({settings:{"class":"epi-chromeless",iconClass:"epi-iconContextMenu epi-icon--inverted",showLabel:false,label:_1ea6.contextmenu.label},optionClass:""}),category:"context",target:this.contextMenu}],commandSource:this.model}));}});});},"epi-cms/project/viewmodels/ProjectModeToolbarViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/Evented","dojo/Stateful","dojo/topic","dojo/when","dijit/Destroyable","epi/shell/command/_CommandProviderMixin","epi/epi","epi/dependency","epi-cms/_ContentContextMixin","../command/AddProject","../command/RenameProject","../command/RemoveProject","epi/shell/xhr/errorHandler"],function(_1eb9,lang,_1eba,_1ebb,_1ebc,_1ebd,topic,when,_1ebe,_1ebf,epi,_1ec0,_1ec1,_1ec2,_1ec3,_1ec4,_1ec5){return _1eb9([_1ebd,_1ebe,_1ebc,_1ec1,_1ebf],{projectStore:null,currentProject:null,overviewButtonVisible:false,postscript:function(){this.inherited(arguments);this.projectService=this.projectService||_1ec0.resolve("epi.cms.ProjectService");this.projectStore=this.projectStore||_1ec0.resolve("epi.storeregistry").get("epi.cms.project");this._createCommands();var _1ec6=function(id){if(this.currentProject&&this.currentProject.id===id){this._markCurentProjectAsDeleted();}}.bind(this);var _1ec7=function(_1ec8){if(this.currentProject&&this.currentProject.id===_1ec8.id){this.set("currentProject",_1ec8);}}.bind(this);this.own(this.projectService.on("project-removed",_1ec6),this.projectService.on("project-updated",_1ec7));when(this.getCurrentContext()).then(this.contextChanged.bind(this));},initialize:function(){return when(this.projectService.getCurrentProject()).then(lang.hitch(this,function(_1ec9){this._changeAttrValue("currentProject",_1ec9,false);this.set("overviewButtonVisible",!!_1ec9);}));},contentContextChanged:function(_1eca,_1ecb){this.inherited(arguments);if(this.get("currentProject")){var self=this;this.projectService.exists(this.currentProject.id).then(function(_1ecc){if(!_1ecc){self.emit("currentProjectDoesNotExists");}});}},_markCurentProjectAsDeleted:function(){var _1ecd=lang.clone(this.currentProject);_1ecd.isDeleted=true;this.set("currentProject",_1ecd,false);this.set("overviewButtonVisible",false);},contextChanged:function(_1ece,_1ecf){this.inherited(arguments);if(_1ece&&_1ece.type==="epi.cms.project"){var _1ed0=parseInt(_1ece.id,10);when(this.projectStore.get(_1ed0)).then(lang.hitch(this,function(_1ed1){if(_1ecf&&_1ecf.sender&&_1ecf.sender._requestContext){this.emit("animateToolbar");}this.set("currentProject",_1ed1);}));}},_currentProjectSetter:function(_1ed2,_1ed3){if(epi.areEqual(this.currentProject,_1ed2)){return;}this.set("overviewButtonVisible",!!_1ed2);this.currentProject=_1ed2;var _1ed4=new _1ebb().resolve();if(_1ed3||_1ed3===undefined){_1ed4=this.projectService.setCurrentProject(_1ed2);}_1ed4.then(lang.hitch(this,"getCurrentContext")).then(function(_1ed5){if(_1ed5.type!=="epi.cms.project"&&_1ed5.currentMode===undefined){topic.publish("/epi/shell/context/request",{uri:_1ed5.versionAgnosticUri},{sender:this});}});},showProjectOverview:function(_1ed6){var _1ed7="epi.cms.project:///"+_1ed6;topic.publish("/epi/shell/context/request",{uri:_1ed7},{sender:this});},getCommands:function(){return this.commands;},addProject:function(_1ed8){this.projectStore.add(_1ed8).then(lang.hitch(this,function(value){this.set("currentProject",value);})).otherwise(_1ec5.forXhr);},getProject:function(){return this.get("currentProject");},updateProject:function(_1ed9){this.projectStore.put(_1ed9).then(lang.hitch(this,"set","currentProject")).otherwise(_1ec5.forXhr);},reactivateProject:function(){if(!this.currentProject){return new _1ebb().resolve();}return this.projectService.reactivateProject(this.currentProject.id);},removeProject:function(){if(!this.currentProject){return new _1ebb().resolve();}return this.projectStore.remove(this.currentProject.id).then(lang.hitch(this,function(){this.set("currentProject",null);}));},_createCommands:function(){var _1eda={model:this,category:"context",propertiesToWatch:["currentProject"]},_1edb=this.own(new _1ec2(_1eda),new _1ec3(_1eda),new _1ec4(_1eda));this.set("commands",_1edb);}});});},"url:epi-cms/project/templates/ProjectModeToolbar.html":"<div class=\"epi-project-mode-toolbar\">\n\t<span data-dojo-attach-point=\"projectIconNode\" class=\"dijitReset dijitInline epi-project-mode-toolbar__icon-node\">\n\t\t<span class=\"dijitReset dijitInline dijitIcon epi-iconProject epi-icon--inverted\"></span>\n    </span>\n    <span data-dojo-attach-point=\"projectLabelNode\" class=\"dijitInline\">${localizations.label}</span>\n    <span data-dojo-attach-point=\"projectSelectorNode\"></span>\n    <span class=\"dijitInline epi-project-mode-toolbar__warning-label\">${localizations.projectdoesnotexists.currentprojectdoesnotexists}</span>\n    <span data-dojo-attach-point=\"contextMenu\" class=\"epi-project-mode-toolbar__contextmenu\"></span>\n    <span data-dojo-attach-point=\"projectOverviewButtonNode\"></span>\n</div>\n","url:epi-cms/project/templates/CurrentProjectDoesNotExistsWarning.html":"<div class=\"epi-project-mode-project-deleted-warning\">${warning}</div>\n<p>${description}</p>","epi-cms/project/ProjectChangesComponent":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/when","epi/shell/command/_WidgetCommandBinderMixin","./_ProjectView","./viewmodels/ProjectChangesComponentViewModel","dojo/text!./templates/ProjectChangesComponent.html","epi/i18n!epi/cms/nls/episerver.cms.components.project.changes","dijit/DropDownMenu","dijit/form/Button","dijit/form/DropDownButton","dijit/Toolbar","./ProjectItemList"],function(_1edc,lang,_1edd,_1ede,_1edf,on,when,_1ee0,_1ee1,_1ee2,_1ee3,res){return _1edc([_1ee1,_1ee0],{modelBindingMap:{projectItemQuery:["projectItemQuery"],projectItemSortOrder:["projectItemSortOrder"],dndEnabled:["dndEnabled"],contentLanguage:["contentLanguage"]},res:res,templateString:_1ee3,"class":"epi-project-changes-component",layout:function(){this.inherited(arguments);this.itemList.resize(this._contentBox,this._contentBox);},_createViewModel:function(){return new _1ee2();}});});},"epi-cms/project/viewmodels/ProjectChangesComponentViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","./_ProjectViewModel"],function(_1ee4,lang,_1ee5){return _1ee4([_1ee5],{_sortOrderProfileKey:"epi.project-changes-sort-order",postscript:function(){this.inherited(arguments);this.own(this.projectService.on("currentProjectChanged",lang.hitch(this,this._projectChanged)));},refreshProject:function(){if(!this.selectedProject){this._updateHasProject();}this.inherited(arguments);},_createProjectCommands:function(){return {};},_createProjectItemCommands:function(){var _1ee6=this.inherited(arguments),_1ee7={};Object.keys(_1ee6).forEach(function(key){var _1ee8=_1ee6[key];switch(key){case "refreshProjectItems":break;case "sortProjectItems":_1ee8.set({category:"projectButton",iconClass:"epi-iconSort"});break;case "readyToPublishProjectItem":_1ee7.primaryReadyToPublishProjectItem=lang.delegate(_1ee8,{iconClass:"epi-iconCheckmark",category:null});break;default:_1ee7[key+"_context"]=lang.delegate(_1ee8,{category:"context"});}});return lang.mixin(_1ee6,_1ee7);},_projectChanged:function(_1ee9){this.set("selectedProject",_1ee9);},_updateSelectedProjectDependencies:function(_1eea){var _1eeb=false,_1eec=null,_1eed=this.isProjectModeEnabled();if(_1eea){_1eeb=(_1eed&&_1eea.status!=="publishing")||_1eea.status==="active"||_1eea.status==="publishfailed";_1eec={projectId:_1eea.id};}this.set({dndEnabled:_1eeb,projectItemQuery:_1eec});}});});},"url:epi-cms/project/templates/ProjectChangesComponent.html":"<div>\n    <div data-dojo-type=\"epi-cms/project/ProjectItemList\"\n         data-dojo-attach-point=\"itemList\"\n         data-dojo-props=\"commandSource: this.model, listItemType: 'card-compact', res: this.res\">\n        <section data-epi-section=\"toolbarSection\">\n            <div data-dojo-attach-point=\"toolbarGroupNode\" class=\"epi-floatRight\"></div>\n        </section>\n        <section data-epi-section=\"listContainer\">\n            <div data-dojo-attach-point=\"placeholderNode\" class=\"epi-project-gadget__placeholder dijitHidden\"></div>\n        </section>\n    </div>\n</div>\n","epi-cms/widget/CategorySelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-style","dojo/query","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","dijit/Tooltip","epi-cms/widget/_HasChildDialogMixin","epi-cms/widget/CategorySelectorDialog","epi/shell/widget/_ValueRequiredMixin","epi/dependency","epi/epi","epi/shell/widget/dialog/Dialog","dojo/text!./templates/CategorySelector.html","epi/i18n!epi/cms/nls/episerver.cms.widget.CategorySelector"],function(array,_1eee,lang,all,_1eef,_1ef0,_1ef1,_1ef2,query,_1ef3,_1ef4,_1ef5,_1ef6,_1ef7,_1ef8,_1ef9,_1efa,_1efb,epi,_1efc,_1efd,res){return _1eee([_1ef4,_1ef3,_1ef5,_1ef8,_1efa],{templateString:_1efd,localization:res,multiple:true,value:null,store:null,_categories:null,_categoriesParentsName:{},onChange:function(value){},postMixInProperties:function(){this.inherited(arguments);if(!this.store){var _1efe=_1efb.resolve("epi.storeregistry");this.store=_1efe.get("epi.cms.category");}},destroy:function(){this.inherited(arguments);if(this._updateDisplayPromise){this._updateDisplayPromise.cancel();this._updateDisplayPromise=null;}},destroyDescendants:function(){if(this._tooltip){this._tooltip.destroy();delete this._tooltip;}this.inherited(arguments);},_setValueAttr:function(value){if(!lang.isArray(value)){value=[value];}var _1eff=array.filter(value,function(v){return !!v;});this._setValueAndFireOnChange(_1eff);if(_1eff.length>0){this._set("value",_1eff);}else{this._set("value",null);}this._started&&this.validate();},_setValueAndFireOnChange:function(value){if(epi.areEqual(this._categories,value)){return;}this._categories=value;this.onChange(this._categories);this._updateDisplayNode();},_getValueAttr:function(){return this._categories;},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1ef2.set(this.button.domNode,"display",value?"none":"");_1ef0.toggle(this.domNode,"dijitReadOnly",value);},focus:function(){this.button.focus();},_createCategoryButton:function(_1f00){if(query("div[data-epi-category-id="+_1f00.id+"]",this.categoriesGroupContainer).length!==0){return;}var _1f01=_1ef1.create("div",{"class":"dijitReset dijitLeft dijitInputField dijitInputContainer epi-categoryButton"});var _1f02=_1ef1.create("div",{"class":"dijitInline epi-resourceName"});var _1f03=_1ef1.create("div",{"class":"dojoxEllipsis",innerHTML:_1f00.description});_1ef1.place(_1f03,_1f02);_1ef1.place(_1f02,_1f01);this._tooltip=new _1ef7({connectId:_1f03,label:this._getCategoryPath(_1f00)});var _1f04=_1ef1.create("div",{"class":"epi-removeButton",innerHTML:"&nbsp;"});_1eef.set(_1f04,"data-epi-category-id",_1f00.id);var _1f05=_1f04.onClick?"onClick":"onclick";if(!this.readOnly){this.connect(_1f04,_1f05,lang.hitch(this,this._onRemoveClick));_1ef1.place(_1f04,_1f02);}else{_1ef1.place(_1ef1.create("span",{innerHTML:"&nbsp;"}),_1f02);}_1ef1.place(_1f01,this.categoriesGroupContainer);},_getCategoryPath:function(_1f06){if(!_1f06.parentsNameCollection||_1f06.parentsNameCollection.length===1){return "";}var path=_1f06.parentsNameCollection[1];for(var i=2;i<_1f06.parentsNameCollection.length;i++){path=path+"/"+_1f06.parentsNameCollection[i];}return path;},_createNoCategoriesChosenSpan:function(){_1ef1.create("div",{innerHTML:this.localization.nocategorieschosen,"class":"epi-categoriesGroup__message"},this.categoriesGroupContainer,"only");},_updateDisplayNode:function(){this.categoriesGroupContainer.innerHTML="";if(!this._categories||this._categories.length===0){this._createNoCategoriesChosenSpan();return;}this._categoriesParentsName={};var _1f07=[];this._categories.forEach(function(_1f08){_1f07.push(this.store.refresh(_1f08));},this);this._updateDisplayPromise=all(_1f07).then(lang.hitch(this,function(_1f09){this._updateDisplayPromise=null;_1f09.forEach(function(_1f0a){if(_1f0a&&_1f0a.visible){this._categoriesParentsName[_1f0a.id]=_1f0a.parentsNameCollection;this._createCategoryButton(_1f0a);}else{var _1f0b=this._categories.indexOf(_1f0a.id);if(_1f0b!==-1){this._categories.splice(_1f0b,1);}}if(this._categories.length===0){this._createNoCategoriesChosenSpan();}},this);}));},_onRemoveClick:function(arg){if(!this._categories){return;}var _1f0c=parseInt(_1eef.get(arg.target,"data-epi-category-id"),10);var _1f0d=this._categories.indexOf(_1f0c);if(_1f0d===-1){return;}var _1f0e=lang.clone(this._categories);_1f0e.splice(_1f0d,1);this.set("value",_1f0e);},_getCategoriesParentsNameClone:function(){var _1f0f={};array.forEach(this._categories,lang.hitch(this,function(_1f10){_1f0f[_1f10]=this._categoriesParentsName[_1f10];}));return _1f0f;},_onShow:function(){this.categorySelectorDialog.set("value",lang.clone(this._categories));this.categorySelectorDialog.set("selectedCategoriesData",this._getCategoriesParentsNameClone());this.isShowingChildDialog=true;this.categorySelectorDialog.onShow();},_onExecute:function(){var _1f11=this.categorySelectorDialog.get("value");this.set("value",_1f11);},_isEmptyArray:function(array){return !array||array.length===0;},_onDialogHide:function(){this.focus();this.isShowingChildDialog=false;},_createDialog:function(){this.categorySelectorDialog=new _1ef9({rootCategory:this.root});this.dialog=new _1efc({title:this.localization.popuptitle,content:this.categorySelectorDialog,destroyOnHide:false,dialogClass:"epi-dialog-portrait"});this.own(this.dialog);this.connect(this.dialog,"onExecute","_onExecute");this.connect(this.dialog,"onShow","_onShow");this.connect(this.dialog,"onHide","_onDialogHide");this.dialog.startup();},_onButtonClick:function(){if(!this.dialog){this._createDialog();}this.dialog.show(true);}});});},"epi-cms/widget/CategorySelectorDialog":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","dijit/form/Button","epi","epi/dependency","epi-cms/widget/CategoryTree"],function(array,_1f12,lang,_1f13,_1f14,_1f15,_1f16,epi,_1f17,_1f18){return _1f12([_1f14,_1f13,_1f15],{templateString:"<div class=\"epi-categorySelectorDialog\">                             <div data-dojo-attach-point=\"categoryTree\" data-dojo-type=\"epi-cms/widget/CategoryTree\" data-dojo-props=\"rootCategory: ${rootCategory}\"></div>                         </div>",selectedCategoriesData:null,_selectedCategoryIds:null,rootCategory:null,onShow:function(){if(!this._selectedCategoryIds&&!this.categoryTree){return;}this.categoryTree.set("selectedNodeIds",this._selectedCategoryIds);this.categoryTree.set("selectedNodeData",this.selectedCategoriesData);},_setValueAttr:function(value){this._selectedCategoryIds=value;if(!this._selectedCategoryIds){this._selectedCategoryIds=[];}},_getValueAttr:function(){return this.categoryTree.get("selectedNodeIds");}});});},"epi-cms/widget/CategoryTree":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dijit/Tree","epi","epi-cms/widget/_CategoryTreeNode","epi-cms/widget/CategoryTreeStoreModel"],function(array,_1f19,lang,Tree,epi,_1f1a,_1f1b){return _1f19([Tree],{showRoot:false,selectedNodeIds:null,selectedNodeData:null,constructor:function(){this.selectedNodeIds=[];this.selectedNodeData={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new _1f1b({rootCategory:this.rootCategory});this.persist=false;}},postCreate:function(){this.inherited(arguments);this.connect(this,"onOpen",lang.hitch(this,this._onNodeOpen));this.connect(this,"onClose",lang.hitch(this,this._onNodeClose));this.watch("selectedNodeData",lang.hitch(this,this._loadSelectedNodes));},startup:function(){if(this._started){return;}this.inherited(arguments);this.dndController.singular=true;},buildNodeFromTemplate:function(args){return new _1f1a(args);},getTooltip:function(item){var _1f1c=this.model.getTooltip||this.model.getLabel;return _1f1c?_1f1c(item):this.inherited(arguments);},getNodeById:function(_1f1d){var nodes=this.getNodesByItem(_1f1d.toString());if(!nodes){return null;}return nodes[0];},_getTotalSelectedNodes:function(_1f1e,_1f1f,_1f20){if(!_1f1e||!_1f1e.item||!_1f1e.item.hasChildren||!lang.isArray(_1f1f)||_1f1f.length===0||!_1f20){return 0;}var _1f21=0,_1f22=[],_1f23=[],_1f24=lang.clone(_1f1e.item.parentsNameCollection);var _1f25=function(_1f26){if(lang.isArray(_1f26)&&_1f26.length>0){_1f26.pop();}};_1f24[_1f24.length-1]=_1f1e.item.name;array.forEach(_1f1f,function(_1f27){_1f22=lang.clone(_1f20[_1f27]);_1f25(_1f22);_1f23=lang.clone(_1f22);lang.mixin(_1f23,_1f24);if(lang.isArray(_1f22)&&epi.areEqual(_1f22,_1f23)){_1f21++;}},this);return _1f21;},_setTotalSelectedNodes:function(_1f28){if(_1f28){_1f28.set("totalSelectedNodes",this._getTotalSelectedNodes(_1f28,this.selectedNodeIds,this.selectedNodeData));array.forEach(_1f28.getChildren(),function(_1f29){if(_1f29&&_1f29.item&&_1f29.item.hasChildren){if(_1f29.isExpanded){this._setTotalSelectedNodes(_1f29);}else{_1f29.set("totalSelectedNodes",this._getTotalSelectedNodes(_1f29,this.selectedNodeIds,this.selectedNodeData));}}},this);}},_loadSelectedNodes:function(){this.expandChildrenDeferred.then(lang.hitch(this,function(){this.set("toggleSelectNodes",this.rootNode,this.selectedNodeIds);this._setTotalSelectedNodes(this.rootNode);}));},_onNodeCreated:function(node){node.set("totalSelectedNodes",this._getTotalSelectedNodes(node,this.selectedNodeIds,this.selectedNodeData));},_onNodeSelectChanged:function(_1f2a,item){if(!this.getNodeById(item.id)){return;}var index=this.selectedNodeIds.indexOf(item.id),exist=index!==-1;if(_1f2a&&!exist){this.selectedNodeIds.push(item.id);this.selectedNodeData[item.id]=item.parentsNameCollection;}if(!_1f2a&&exist){this.selectedNodeIds.splice(index,1);this.selectedNodeData[item.id]={};}},_onNodeOpen:function(item,node){this.set("toggleSelectNodes",node,this.selectedNodeIds);this._setTotalSelectedNodes(node);},_onNodeClose:function(item,node){this._setTotalSelectedNodes(node);},_setToggleSelectNodesAttr:function(_1f2b,_1f2c){if(!_1f2b||!lang.isArray(_1f2c)){return;}var _1f2d=false;array.forEach(_1f2b.getChildren(),function(_1f2e){if(_1f2e){_1f2d=_1f2c.indexOf(_1f2e.item.id)!==-1;_1f2e.set("checked",_1f2d);if(_1f2e.hasChildren()){this.set("toggleSelectNodes",_1f2e,_1f2c);}}},this);},_createTreeNode:function(args){var node=this.buildNodeFromTemplate(args);node.connect(node,"onNodeSelectChanged",lang.hitch(this,function(_1f2f,item){this._onNodeSelectChanged(_1f2f,item);}));this._onNodeCreated(node);return node;}});});},"epi-cms/widget/_CategoryTreeNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/keys","dojo/text!./templates/_CategoryTreeNode.html","dijit/_TemplatedMixin","dijit/form/CheckBox","epi","epi-cms/widget/_ContentTreeNode"],function(_1f30,lang,_1f31,_1f32,keys,_1f33,_1f34,_1f35,epi,_1f36){return _1f30([_1f36,_1f34],{templateString:_1f33,_checkbox:null,checked:false,postCreate:function(){this.inherited(arguments);_1f31.add(this.iconNode,"dijitHidden");this._checkbox=this._createCheckbox();},_createCheckbox:function(){if(!this.item.selectable){return;}var _1f37=_1f32.create("span",{"class":"epi-checkboxNode dijitTreeExpando"});var _1f38=new _1f35({name:"checkboxCategory",value:this.item.id,tabIndex:-1,checked:false,onChange:lang.hitch(this,function(_1f39){this.onNodeSelectChanged(_1f39,this.item);})});_1f38.placeAt(_1f37);_1f32.place(_1f37,this.expandoNode,"after");return _1f38;},onNodeSelectChanged:function(_1f3a,item){},_onLabelClick:function(){if(!this._checkbox){return;}this.set("checked",!this._checkbox.checked);},_onLabelKeyUp:function(evt){if(evt.keyCode===keys.SPACE||evt.keyCode===keys.ENTER){this._onLabelClick();}},_setCheckedAttr:function(_1f3b){if(!this._checkbox){return;}this._set("checked",_1f3b);this._checkbox.set("checked",_1f3b);},_setTotalSelectedNodesAttr:function(_1f3c){var _1f3d=this.tree.model.getLabel(this.item),_1f3e=!this.isExpanded&&_1f3c>0;this.labelNode.innerHTML=_1f3e?_1f3d+" ("+_1f3c+")":_1f3d;}});});},"url:epi-cms/widget/templates/_CategoryTreeNode.html":"<div class=\"dijitTreeNode epi-categoryTreeNode\" role=\"presentation\">\n    <a href=\"#\" tabIndex=\"-1\" data-dojo-attach-point=\"rowNode\" class=\"dijitTreeRow\" role=\"presentation\">\n        <div data-dojo-attach-point=\"indentNode\" class=\"dijitInline\"></div>\n        <span data-dojo-attach-point=\"contentNode\" class=\"dijitTreeContent\" role=\"presentation\">\n            <span data-dojo-attach-point=\"expandoNode\" class=\"dijitTreeExpando\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"expandoNodeText\" class=\"dijitExpandoText\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"iconNode\" class=\"dijitIcon dijitTreeIcon\" role=\"presentation\"></span>\n            <span data-dojo-attach-point=\"labelNode\" class=\"dijitTreeLabel epi-categoryTreeLabel\" role=\"treeitem\"\n                  tabindex=\"-1\" aria-selected=\"false\" data-dojo-attach-event=\"onclick:_onLabelClick, keyup:_onLabelKeyUp\">\n            </span>\n        </span>\n    </a>\n    <div data-dojo-attach-point=\"containerNode\" class=\"dijitTreeContainer\" role=\"presentation\" style=\"display: none;\"></div>\n</div>","epi-cms/widget/CategoryTreeStoreModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","dojox/html/entities","epi/dependency","epi/routes"],function(_1f3f,lang,when,_1f40,_1f41,_1f42){return _1f3f(null,{store:null,rootCategory:undefined,constructor:function(args){lang.mixin(this,args);if(!this.store){var _1f43=_1f41.resolve("epi.storeregistry");this.store=_1f43.get("epi.cms.category");}},getRoot:function(_1f44){when(this.store.get(this.rootCategory),_1f44);},mayHaveChildren:function(item){return item.hasChildren;},getChildren:function(_1f45,_1f46){var id=this.getIdentity(_1f45),_1f47=this.store.query({id:id,query:"getchildren"});_1f47.then(function(_1f48){_1f45.children=_1f48;_1f46(_1f48);});},getIdentity:function(item){return this.store.getIdentity(item);},getLabel:function(item){return _1f40.encode(item.description);}});});},"url:epi-cms/widget/templates/CategorySelector.html":"<div class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer epi-categorySelector\" id=\"widget_${id}\">\n    <div data-dojo-attach-point=\"categoriesGroupContainer\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode epi-categoriesGroup\">\n    </div> \n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" class=\"epi-categoriesSelectorButton\" data-dojo-props=\"label:'+'\"></div>\n</div>","epi-cms/widget/ContentSelector":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/string","dojo/when","dijit/focus","dijit/form/Button","epi/dependency","epi/shell/TypeDescriptorManager","epi/shell/widget/dialog/Dialog","epi-cms/core/ContentReference","epi-cms/contentediting/ContentActionSupport","epi-cms/widget/ContentSelectorDialog","epi-cms/widget/_SelectorBase","epi/i18n!epi/cms/nls/episerver.cms.widget.contentselector"],function(array,_1f49,lang,_1f4a,_1f4b,_1f4c,_1f4d,when,_1f4e,_1f4f,_1f50,_1f51,_1f52,_1f53,_1f54,_1f55,_1f56,_1f57){return _1f49([_1f56],{roots:null,value:null,required:false,missingMessage:_1f57.requiredmessage,tooltipPosition:[],contentLink:null,previewUrl:null,canSelectOwnerContent:false,accessLevel:_1f54.accessLevel.Read,showAllLanguages:true,showSearchBox:true,searchArea:null,_setDisabledAttr:function(value){this.inherited(arguments);this.button.set("disabled",value);this._set("disabled",value);},buildRendering:function(){var _1f58=this.name?(this.name.replace(/"/g,"&quot;")):"";this.input=_1f4c.create("input",{type:"hidden",name:_1f58});this.inherited(arguments);this.domNode.appendChild(this.input);},postMixInProperties:function(){this.inherited(arguments);var _1f59=_1f50.resolve("epi.storeregistry");this._store=_1f59.get("epi.cms.content.light");var _1f5a=this.contentRepositoryDescriptors||_1f50.resolve("epi.cms.contentRepositoryDescriptors");var _1f5b=_1f5a[this.repositoryKey];if(_1f5b&&!this.roots){this.roots=_1f5b.roots;}if(_1f5b&&!this.searchArea){this.searchArea=_1f5b.searchArea;}},postCreate:function(){this.inherited(arguments);if(!this.value){this._updateDisplayNode(null);}},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1f4b.set(this.button.domNode,"display",value?"none":"");_1f4b.set(this.clearButton,"display",value?"none":"");_1f4a.toggle(this.domNode,"dijitReadOnly",value);},_setValueAttr:function(value){this._setValueAndFireOnChange(value);},_getDialog:function(){if(this.dialog&&this.dialog.domNode){return this.dialog;}var title=_1f57.title;if(this.allowedTypes&&this.allowedTypes.length===1){var name=_1f51.getResourceValue(this.allowedTypes[0],"name");if(name){title=_1f4d.substitute(_1f57.format,[name]);}}this.contentSelectorDialog=new _1f55({canSelectOwnerContent:this.canSelectOwnerContent,showButtons:false,roots:this.roots,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes,showAllLanguages:this.showAllLanguages,showSearchBox:this.showSearchBox,searchArea:this.searchArea});this.dialog=new _1f52({title:title,dialogClass:"epi-dialog-portrait",content:this.contentSelectorDialog});this.dialog.own(this.contentSelectorDialog);this.connect(this.contentSelectorDialog,"onChange","_setDialogButtonState");this.connect(this.dialog,"onExecute","_onDialogExecute");this.connect(this.dialog,"onHide","_onDialogHide");return this.dialog;},_isContentAllowed:function(_1f5c){var _1f5d=_1f51.getValidAcceptedTypes([_1f5c],this.allowedTypes,this.restrictedTypes);return !!_1f5d.length;},_onButtonClick:function(){when(this._getContentData(this.contentLink),lang.hitch(this,function(_1f5e){this.canSelectOwnerContent=this.canSelectOwnerContent&&_1f5e&&this._isContentAllowed(_1f5e.typeIdentifier);var _1f5f=this._getDialog();this.isShowingChildDialog=true;var _1f60;if(this.value){_1f60=this._convertValueToContentReference(this.value);}if(_1f60){_1f60=_1f60.createVersionUnspecificReference().toString();}this.contentSelectorDialog.set("value",_1f60);_1f5f.show();}));},_onDialogExecute:function(){var value=this.contentSelectorDialog.get("value");this._setValueAndFireOnChange(value);},_convertValueToContentReference:function(value){return new _1f53(value);},_setValueAndFireOnChange:function(value){var _1f61=value==="-"?this.contentLink:value;this.set("permanentLink",null);this.set("previewUrl",null);this._valueChangedPromise=when(this._getContentData(_1f61),lang.hitch(this,function(_1f62){this._valueChangedPromise=null;var _1f63=this.value!==_1f61;this.value=_1f61;this.input.value=this.value;this._started&&this.validate();this._updateDisplayNode(_1f62);if(_1f63){this.onChange(_1f61);}if(_1f62){this.set("permanentLink",_1f62.permanentLink);this.set("previewUrl",_1f62.previewUrl);}}));},_getContentData:function(_1f64){if(!_1f64){return null;}return this._store.get(_1f64);},_onFocus:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},_onBlur:function(){if(this.get("disabled")){return;}this.inherited(arguments);this.validate();},focus:function(){if(!this.button.disabled&&this.button.focusNode&&this.button.focusNode.focus){try{_1f4e.focus(this.button.focusNode);}catch(e){}}},_updateDisplayNode:function(_1f65){this.inherited(arguments);if(_1f65){this.set("selectedContentLink",new _1f53(_1f65.contentLink).id);}else{this.set("selectedContentName",_1f57.helptext);this.set("selectedContentLink","");}},reset:function(){this.set("value",null);},_setDialogButtonState:function(_1f66){var self=this;if(!_1f66){return;}when(self._store.get(_1f66),function(_1f67){self.dialog.definitionConsumer.setItemProperty(self.dialog._okButtonName,"disabled",!_1f54.hasAccess(_1f67.accessMask,self.accessLevel));});}});});},"epi-cms/widget/_SelectorBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/Deferred","dojo/dom-class","dojo/dom-style","dojo/dom-prop","dojo/query","dojo/when","dijit/_CssStateMixin","dijit/_TemplatedMixin","dijit/_Widget","dijit/_WidgetsInTemplateMixin","epi/dependency","epi/i18n","epi/shell/widget/_ValueRequiredMixin","epi-cms/widget/_Droppable","epi-cms/widget/_HasClearButton","epi-cms/widget/_HasChildDialogMixin","dojo/text!./templates/_SelectorBase.html"],function(_1f68,lang,_1f69,_1f6a,_1f6b,_1f6c,_1f6d,query,when,_1f6e,_1f6f,_1f70,_1f71,_1f72,i18n,_1f73,_1f74,_1f75,_1f76,_1f77){return _1f68([_1f70,_1f6f,_1f71,_1f6e,_1f75,_1f76,_1f74,_1f73],{templateString:_1f77,roots:null,value:null,required:false,missingMessage:"",tooltipPosition:[],canSelectOwnerContent:false,contentRepositoryDescriptors:null,allowedDndTypes:[],_valueChangedPromise:null,_setSelectedContentNameAttr:function(value){_1f6d.set(this.selectedContentNameNode,"textContent",value);this._updateDisplayNodeTitle();},_setSelectedContentLinkAttr:function(value){_1f6d.set(this.selectedContentLinkNode,"innerHtml",value);this._updateDisplayNodeTitle();},_updateDisplayNodeTitle:function(){this.resourceName.title=this.resourceName.textContent.trim();},postCreate:function(){this.inherited(arguments);this.own(_1f69.after(this,"onDrop",lang.hitch(this,this.focus)));},postMixInProperties:function(){this.inherited(arguments);if(!this.contentRepositoryDescriptors){this.contentRepositoryDescriptors=_1f72.resolve("epi.cms.contentRepositoryDescriptors");}if(!this.roots&&this.repositoryKey){var _1f78=this.contentRepositoryDescriptors[this.repositoryKey];this.roots=_1f78.roots;}},destroy:function(_1f79){this.inherited(arguments);if(this._valueChangedPromise){this._valueChangedPromise.cancel();this._valueChangedPromise=null;}},_setReadOnlyAttr:function(value){this._set("readOnly",value);_1f6c.set(this.button.domNode,"display",value?"none":"");_1f6c.set(this.clearButton,"display",value?"none":"");_1f6b.toggle(this.domNode,"dijitReadOnly",value);},_getDialog:function(){},_onButtonClick:function(){if(!this.dialog){this.dialog=this._getDialog();this.dialog.startup();this.own(_1f69.after(this.dialog,"onExecute",lang.hitch(this,this._onDialogExecute)));this.own(_1f69.after(this.dialog,"onShow",lang.hitch(this,this._onDialogShow)));this.own(_1f69.after(this.dialog,"onHide",lang.hitch(this,this._onDialogHide)));this.own(this.dialog);}this.dialog.show();},_onDialogShow:function(){this.isShowingChildDialog=true;},_onDialogExecute:function(){},_onDialogHide:function(){this.isShowingChildDialog=false;this.focus();},_onBlur:function(){this.inherited(arguments);this.validate();},focus:function(){this.button.focus();},onChange:function(value){},_updateDisplayNode:function(_1f7a){if(_1f7a){_1f6b.remove(this.domNode,"epi-noValue");_1f6b.remove(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName",_1f7a.name);}else{_1f6b.add(this.domNode,"epi-noValue");_1f6b.add(this.resourceName,"dijitPlaceHolder");this.set("selectedContentName","");}},_setDialogButtonState:function(_1f7b){}});});},"epi-cms/widget/_Droppable":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","epi/shell/dnd/Target"],function(_1f7c,lang,when,_1f7d){return _1f7c(null,{dropAreaNode:null,allowedDndTypes:null,postCreate:function(){this.inherited(arguments);var _1f7e=this.own(new _1f7d(this.dropAreaNode,{accept:this.allowedDndTypes,reject:this.restrictedDndTypes,createItemOnDrop:false,readOnly:this.readOnly,skipForm:true}))[0];this.connect(_1f7e,"onDropData","_onDropData");},onDropping:function(){},onDrop:function(){},_onDropData:function(_1f7f,_1f80,nodes,copy){var _1f81=_1f7f?(_1f7f.length?_1f7f[0]:_1f7f):null;if(_1f81){this.onDropping();when(_1f81.data,lang.hitch(this,function(_1f82){var value;if(this.dndSourcePropertyName){value=_1f82[this.dndSourcePropertyName];}else{value=_1f82;}this.set("value",value);this.onDrop();}));}}});});},"epi-cms/widget/_HasClearButton":function(){define(["epi","dojo","dijit"],function(epi,dojo,dijit){return dojo.declare(null,{postCreate:function(){this.inherited(arguments);var _1f83=this.clearButton.onClick?"onClick":"onclick";dojo.connect(this.clearButton,_1f83,dojo.hitch(this,this.clearValue));},clearValue:function(){if(this.readOnly){return;}var value=this.getEmptyValue();this.set("value",value);},getEmptyValue:function(){return null;}});});},"url:epi-cms/widget/templates/_SelectorBase.html":"<div data-dojo-attach-point=\"inputContainer\" class=\"dijitReset dijitInputField dijitInputContainer dijitInline epi-resourceInputContainer\" id=\"widget_${id}\">\n    <div data-dojo-attach-point=\"displayNode, dropAreaNode, stateNode\" class=\"dijit dijitReset dijitInline dijitInlineTable dijitLeft dijitTextBox displayNode\">\n        <div class=\"dijitReset dijitLeft dijitInputField dijitInputContainer\">\n            <div data-dojo-attach-point=\"clearButton\" class=\"epi-clearButton\">&nbsp;</div>\n            <div data-dojo-attach-point=\"resourceName\" class=\"dijitInline epi-resourceName dojoxEllipsis\" >\n                <span data-dojo-attach-point=\"selectedContentNameNode\"></span> <span data-dojo-attach-point=\"selectedContentLinkNode\"></span>\n            </div>\n        </div>\n    </div>\n    <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-event=\"onClick: _onButtonClick\" data-dojo-attach-point=\"button\" data-dojo-props=\"label:'...'\"></div>\n</div>","epi-cms/widget/overlay/ContentArea":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/aspect","dojo/dnd/Manager","dojo/dom-attr","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/json","dojo/on","dojo/query","dijit/_Container","dijit/registry","epi","epi/shell/widget/overlay/Item","epi/shell/dnd/Source","epi/shell/dnd/_MarkerSource","epi-cms/core/ContentReference","epi-cms/widget/overlay/Block","epi-cms/contentediting/editors/ContentBlockEditor","epi-cms/widget/command/CreateContentFromSelector","epi-cms/contentediting/viewmodel/ContentAreaViewModel","epi-cms/contentediting/viewmodel/ContentBlockViewModel","epi-cms/contentediting/editors/_TextWithActionLinksMixin","dojo/text!../templates/ContentArea.html"],function(array,_1f84,lang,_1f85,_1f86,_1f87,_1f88,_1f89,_1f8a,json,on,query,_1f8b,_1f8c,epi,Item,_1f8d,_1f8e,_1f8f,Block,_1f90,_1f91,_1f92,_1f93,_1f94,_1f95){return _1f84([Item,_1f8b,_1f94],{templateString:_1f95,layout:"",defaultWatchKey:"",allowedDndTypes:null,blockClass:Block,modelClass:_1f92,dndSourceClass:_1f84([_1f8d,_1f8e]),dndSourceSettings:null,allowedTypes:null,restrictedTypes:null,_supressValueChanged:false,constructor:function(){this._watches={};},postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new this.modelClass();}this.model.set("value",lang.clone(this.contentModel.get(this.name)));this.own(this.contentModel.watch(this.name,lang.hitch(this,function(name,_1f96,value){if(epi.areEqual(value,this.model.get("value"))){return;}this.refresh();})));this._pendingPersonalizations=[];this._ownerContentLink=this.contentModel.get("icontent_contentlink");},buildRendering:function(){this.inherited(arguments);this.setupActionLinks(this.actionsNodeControls);},postCreate:function(){this.inherited(arguments);this.own(on(this.model,"changed",lang.hitch(this,function(){if(!this._started||this._supressValueChanged){return;}this._onChildrenChanged();if(this._pendingPersonalizations.length>0){this._pendingPersonalizations=[];this.onClick(this);}})));this._setupDirectionality();this._setupBlocks();},destroy:function(){this.inherited(arguments);for(var i in this._watches){this._watches[i].remove();}this._watches={};this._source.destroy();if(this.textWithLinks){this.textWithLinks.destroy();this.textWithLinks=null;}},isCreateLinkVisible:function(){return this.model.canCreateBlock(this.allowedTypes,this.restrictedTypes);},_setHasChildrenAttr:function(value){this._set("hasChildren",value);},_getMinHeightAttr:function(){return _1f8a.get(this.sourceItemNode,"minHeight");},onValueChange:function(_1f97){},updatePosition:function(_1f98){if(!this.canUpdatePosition()){return false;}var _1f99=this.inherited(arguments),_1f9a,_1f9b,_1f9c,_1f9d;if(this.hasChildren){this._setupDirectionality();this._positionBlocks();}_1f9c=this.get("minHeight");_1f8a.set(this.sourceItemNode,"minHeight","");_1f9a=Math.floor(_1f89.position(this.actionsNodeControls,false).h);_1f9b=_1f9a>0?_1f9a:this.get("actionNodeHeight")||0;_1f9d=Math.floor(_1f89.position(this.sourceItemNode,false).h);if(_1f9b===0){this._clearPosition();return _1f99;}_1f9b&&(this.set("actionNodeHeight",_1f9b));_1f8a.set(this.sourceItemNode,"minHeight",(_1f9d+_1f9b)+"px");_1f8a.set(this.actionsNodeControls,"marginTop",(_1f9d)+"px");if(_1f9c===_1f9d+_1f9b){return _1f99;}return true;},refresh:function(){this._actionNodeHeight=null;this.destroyDescendants();this._source.clearItems();if(this._source.anchor){_1f88.destroy(this._source.anchor);}for(var i in this._watches){this._watches[i].remove();}this._watches={};this._supressValueChanged=true;this.model.set("value",lang.clone(this.contentModel.get(this.name)));this._setupBlocks();this.inherited(arguments);this._supressValueChanged=false;},_setupDnd:function(){var _1f9e=lang.mixin({_skipStartup:true,creator:lang.hitch(this,"_creator"),copyOnly:false,alwaysCopy:false,dropParent:this.containerNode,type:this.allowedDndTypes,accept:this.allowedDndTypes,reject:this.restrictedDndTypes,singular:true,propertyName:this.name},this.dndSourceSettings||{});this._source=new this.dndSourceClass(this.domNode,_1f9e);this._source.defaultCheckAcceptance=this._source.checkAcceptance;this._source.checkAcceptance=lang.hitch(this,this._checkAcceptance);this.own(_1f85.after(this._source,"onDropData",lang.hitch(this,"_onDrop"),true));this.own(_1f85.before(this._source,"delItem",lang.hitch(this,"_onDndItemRemoved"),true));},_creator:function(item){var node=_1f88.create("div"),_1f9f;if(typeof item.getNormalizedData=="function"){_1f9f=item.getNormalizedData();}_1f9f=_1f9f?_1f9f.data:item;return {node:node,type:this.allowedDndTypes,data:_1f9f};},_setupBlocks:function(){var _1fa0=this._getBlockNodes();array.forEach(_1fa0,this._createBlock,this);this.set("hasChildren",_1fa0.length>0);},_createBlock:function(node){var id=_1f87.get(node,"data-epi-block-id"),info=json.parse(_1f87.get(node,"data-epi-block-personalization")),_1fa1=info?info.contentGroup:this.defaultWatchKey,model=this.model;if(_1fa1){model=model.getChild({name:_1fa1});}var _1fa2=model&&model.getChild(lang.mixin({contentLink:new _1f8f(id).createVersionUnspecificReference().toString()},info));if(!_1fa2){return;}var block=new this.blockClass({disabled:this.disabled,viewModel:_1fa2,sourceItemNode:node});this.addChild(block);this._watches["block_"+id+"_ensurePersonalization"]=_1fa2.watch("ensurePersonalization",lang.hitch(this,function(_1fa3,_1fa4,_1fa5){var index=array.indexOf(this._pendingPersonalizations,_1fa2);if(_1fa5){if(index<0){this._pendingPersonalizations.push(_1fa2);}}else{if(index>0){this._pendingPersonalizations.splice(index,1);}}}));_1fa2.set("visible",true);this._source.setItem(block.domNode.id,{name:_1fa2.name,data:_1fa2,type:this.allowedDndTypes});},_onChildrenChanged:function(){this.onValueChange({propertyName:this.name,value:this.model.get("value")});},_positionBlocks:function(){var _1fa6=this.getChildren(),_1fa7=[],_1fa8=this.get("position");array.forEach(_1fa6,function(_1fa9,i){var _1faa,_1fab,_1fac;if(!_1fa7[i]){_1fa7[i]=_1f89.position(_1fa9.sourceItemNode,false);}_1faa=_1fa7[i];_1faa.x-=_1fa8.x;_1faa.y-=_1fa8.y;_1fa9.resize(_1faa);},this);},_checkAcceptance:function(_1fad,nodes){if(this.readOnly||nodes===undefined){return false;}var _1fae=_1f8c.getEnclosingWidget(nodes[0]);if(_1fae.isInstanceOf(_1f90)){return false;}return this._source.defaultCheckAcceptance(_1fad,nodes);},_getBlockNodes:function(){var _1faf=query("[data-epi-block-id]",this.sourceItemNode);var _1fb0=query("[data-epi-block-id] [data-epi-block-id]",this.sourceItemNode);return array.filter(_1faf,function(node){return _1fb0.indexOf(node)===-1;});},_setupDirectionality:function(){var _1fb1;if(/vertical|horizontal/.test(this.layout)){_1fb1=this.layout==="horizontal";}else{_1fb1=array.some(this._getBlockNodes(),function(node){var style=_1f8a.getComputedStyle(node),_1fb2=/left|right/.test(style.cssFloat),_1fb3=/inline|inline-block/.test(style.display);return _1fb2||_1fb3;});}this._source.setHorizontal(_1fb1);},executeAction:function(_1fb4){if(_1fb4==="createnewblock"){var _1fb5=new _1f91({creatingTypeIdentifier:"episerver.core.blockdata",createAsLocalAsset:true,treatAsSecondaryView:true,autoPublish:true,allowedTypes:this.allowedTypes,restrictedTypes:this.restrictedTypes});_1fb5.set("model",{save:lang.hitch(this,function(block){var value=lang.clone(this.model.get("value"),true)||[];value.push(block);this.onValueChange({propertyName:this._source.propertyName,value:value});})});_1fb5.execute();}else{this.inherited(arguments);}},_onDrop:function(data,_1fb6,nodes,_1fb7){var model=this.model,_1fb8=this._source;if(_1fb8.anchor===_1fb8.targetAnchor){return;}var index=array.indexOf(_1fb8.getAllNodes(),_1fb8.targetAnchor)+(_1fb8.before?-1:1),_1fb9=array.filter(model.getChildren(),function(child){return child.get("visible");});index=model.indexOf(_1fb9[index-1])+1;if(!lang.isArray(data)){data=[data];}if(_1fb8===_1fb6&&!_1fb7){model.modify(function(){array.forEach(data,function(item,i){var data=item.data;if(data.contentGroup){data=model.getChild({name:data.contentGroup});}model.move(data,index+i);});});}else{model.modify(function(){array.forEach(data,function(item,i){var block=new _1f93(item.data);model.addChild(block,index+i);});});}},_onDndItemRemoved:function(key){var data=this._source.getItem(key);if(!lang.isArray(data)){data=[data];}this.model.modify(function(){array.forEach(data,function(item){this.model.removeChild(item.data);},this);},this);}});});},"epi/shell/dnd/_MarkerSource":function(){define("epi/shell/dnd/_MarkerSource",["dojo/_base/array","dojo/_base/declare","dojo/has","dojo/dnd/Manager","dojo/dnd/Source","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style"],function(array,_1fba,has,_1fbb,_1fbc,_1fbd,_1fbe,_1fbf,_1fc0){return _1fba(null,{_markerNode:null,markerTemplateString:"<div class=\"dojoDndItem-marker\"><div class=\"epi-dndDropMarker\"></div></div>",markerDelay:150,markOnlyAllowedDropLocations:false,_calculatedCurrent:false,destroy:function(){this.inherited(arguments);this.targetAnchorSibling=null;if(this._markerNode){_1fbe.destroy(this._markerNode);this._markerNode=null;}},setHorizontal:function(_1fc1){_1fbd.toggle(this.node,"dojoDndHorizontal",_1fc1);this.horizontal=_1fc1;},onMouseOver:function(e){this.inherited(arguments);this._calculatedCurrent=false;},onMouseMove:function(e){if(this.isDragging&&this.targetState==="Disabled"){return;}_1fbc.superclass.onMouseMove.call(this,e);var m=_1fbb.manager();var _1fc2=has("mac")?"metaKey":"ctrlKey";if(!this.isDragging){if(this.mouseDown&&this.isSource&&(Math.abs(e.pageX-this._lastX)>this.delay||Math.abs(e.pageY-this._lastY)>this.delay)){var nodes=this.getSelectedNodes();if(nodes.length){m.startDrag(this,nodes,this.copyState(e[_1fc2],true));}}}if(this.isDragging){var _1fc3=false;if(this.current&&!this._calculatedCurrent){if(!this.targetBox||this.targetAnchor!==this.current){this.targetBox=_1fbf.position(this.current,true);}if(this.horizontal){_1fc3=(e.pageX-this.targetBox.x)<(this.targetBox.w/2);}else{_1fc3=(e.pageY-this.targetBox.y)<(this.targetBox.h/2);}}else{_1fc3=this._calculateCurrent({x:e.pageX,y:e.pageY});}if(this.current!==this.targetAnchor||_1fc3!==this.before){this._markTargetAnchor(_1fc3);m.canDrop(!this.current||m.source!==this||!this.markOnlyAllowedDropLocations||!(this.current.id in this.selection));}}},_calculateCurrent:function(point){var _1fc4=[],_1fc5,_1fc6;function _1fc7(_1fc8,_1fc9){function _1fca(value){return value*value;};return Math.sqrt(_1fca(_1fc8.x-_1fc9.x)+_1fca(_1fc8.y-_1fc9.y));};this.getAllNodes().forEach(function(node){var pos=_1fbf.position(node);pos.x2=pos.x+pos.w;pos.xCentered=pos.x+pos.w/2;pos.y2=pos.y+pos.h;pos.yCentered=pos.y+pos.h/2;if(this.horizontal){_1fc4.push({node:node,before:true,x:pos.x,y:pos.yCentered},{node:node,before:false,x:pos.x2,y:pos.yCentered});}else{_1fc4.push({node:node,before:true,x:pos.xCentered,y:pos.y},{node:node,before:false,x:pos.xCentered,y:pos.y2});}},this);array.forEach(_1fc4,function(value){value.distance=_1fc7(point,value);if(!_1fc5||value.distance<_1fc6){_1fc5=value;_1fc6=value.distance;}},this);if(_1fc5){this.current=_1fc5.node;this._calculatedCurrent=true;return _1fc5.before;}return false;},_markTargetAnchor:function(_1fcb){var _1fcc=true,_1fcd=true;if(this.current===this.targetAnchor&&this.before===_1fcb){return;}if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this.targetAnchor=this.current;this.targetBox=null;this.before=_1fcb;if(this.targetAnchor){this.targetAnchorSibling=_1fcb?this.targetAnchor.previousSibling:this.targetAnchor.nextSibling;if(!(this.targetAnchorSibling&&this.targetAnchorSibling.nodeType===1&&_1fbd.contains(this.targetAnchorSibling,"dojoDndItem"))){this.targetAnchorSibling=null;}if(this.markOnlyAllowedDropLocations){_1fcc=!(this.targetAnchor.id in this.selection);_1fcd=!this.targetAnchorSibling||!(this.targetAnchorSibling.id in this.selection);}if(_1fcc&&_1fcd){this._addItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling&&_1fcc&&_1fcd){this._addItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(_1fcc&&_1fcd);}else{this._positionMarker(false);}},_unmarkTargetAnchor:function(){if(this.targetAnchor){this._removeItemClass(this.targetAnchor,this.before?"Before":"After");}if(this.targetAnchorSibling){this._removeItemClass(this.targetAnchorSibling,!this.before?"Before":"After");}this._positionMarker(false);this.targetAnchor=this.targetAnchorSibling=this.targetBox=null;this.before=true;},_positionMarker:function(_1fce){var _1fcf=this._markerNode,_1fd0,_1fd1,_1fd2,style,top,left,_1fd3,width,gap=-1;if(_1fce){_1fd0=_1fbf.position(this.targetAnchor,false);_1fd1=this.targetAnchorSibling?_1fbf.position(this.targetAnchorSibling,false):{h:0,w:0};_1fd2=_1fbf.position(this.node,false);if(this.horizontal){if(this.before){left=_1fd0.x-_1fd2.x;if(this.targetAnchorSibling){gap=(_1fd0.x-_1fd1.x-_1fd1.w)/2;}if(gap>=0){left-=gap;}}else{left=_1fd0.x+_1fd0.w-_1fd2.x;if(this.targetAnchorSibling){gap=(_1fd1.x-_1fd0.x-_1fd0.w)/2;}if(gap>=0){left+=gap;}}_1fd3=gap>=0?Math.max(_1fd0.h,_1fd1.h):_1fd0.h;style={display:"block",top:_1fd0.y-_1fd2.y+"px",left:left+"px",height:_1fd3+"px"};}else{if(this.before){top=_1fd0.y-_1fd2.y;if(this.targetAnchorSibling){gap=(_1fd0.y-_1fd1.y-_1fd1.h)/2;}if(gap>=0){top-=gap;}}else{top=_1fd0.y+_1fd0.h-_1fd2.y;if(this.targetAnchorSibling){gap=(_1fd1.x-_1fd0.x-_1fd0.w)/2;}if(gap>=0){top-=gap;}}width=gap>=0?Math.max(_1fd0.w,_1fd1.w):_1fd0.w;style={display:"block",top:top+"px",width:width+"px"};}}else{style={display:"none"};}if(!_1fcf){_1fcf=this._markerNode=_1fbe.place(this.markerTemplateString,this.node);_1fc0.set(_1fcf,style);}else{setTimeout(function(){_1fc0.set(_1fcf,style);},this.markerDelay);}}});});},"epi-cms/contentediting/editors/ContentBlockEditor":function(){define(["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/event","dojo/dom-attr","dojo/dom-class","dojo/dom-style","dojo/html","dojo/NodeList-dom","dojo/query","dijit/_Widget","dijit/_TemplatedMixin","dijit/popup","dojox/html/ellipsis","epi/shell/widget/_ModelBindingMixin","epi-cms/contentediting/editors/ContentBlockEditorViewModel","epi/i18n!epi/cms/nls/episerver.cms.widget.blockcontextmenu","dojo/text!./templates/ContentBlockEditor.html","dojo/NodeList-manipulate"],function(_1fd4,_1fd5,event,_1fd6,_1fd7,_1fd8,html,_1fd9,query,_1fda,_1fdb,pm,_1fdc,_1fdd,_1fde,res,_1fdf){return _1fd4([_1fda,_1fdb,_1fdd],{templateString:_1fdf,model:null,contextMenu:null,isDraggable:true,modelBindingMap:{contentLink:["contentLink"],name:["name"],contentGroup:["contentGroup"],roleIdentities:["roleIdentities"],selected:["selected"]},_setSelectedAttr:function(_1fe0){this.inherited(arguments);_1fd7.toggle(this.itemNode,"epi-content-block-editor-node-selected",_1fe0);_1fd8.set(this.iconNodeMenu,"visibility",_1fe0?"visible":"hidden");},_setNameAttr:function(value){this.inherited(arguments);query(this.labelNode).text(value);_1fd6.set(this.iconNodeMenu,"title",res.settingstooltip);},postMixInProperties:function(){this.inherited(arguments);this.model=this.model||new _1fde(this.modelData);},_setIsDraggableAttr:function(_1fe1){this._set("isDraggable",_1fe1);if(this.isDraggable){_1fd7.add(this.domNode,"dojoDndItem");}else{_1fd7.remove(this.domNode,"dojoDndItem");}},_onClick:function(evt){event.stop(evt);this.contextMenu&&pm.close(this.contextMenu);this.model.set("selected",!this.model.selected);},_onContextMenu:function(evt){event.stop(evt);this.contextMenu&&this.contextMenu.scheduleOpen(evt.target,null,{x:evt.pageX,y:evt.pageY});}});});},"epi-cms/contentediting/editors/ContentBlockEditorViewModel":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","epi-cms/widget/viewmodel/ContentStatusViewModel"],function(_1fe2,lang,_1fe3,_1fe4){return _1fe2([_1fe3,_1fe4],{contentLink:"",contentGroup:"",roleIdentities:null,selected:false,name:"",index:0,getValue:function(){return {contentLink:this.contentLink,name:this.name,contentGroup:this.contentGroup,roleIdentities:this.roleIdentities};}});});},"url:epi-cms/contentediting/editors/templates/ContentBlockEditor.html":"<div class=\"epi-content-block-editor\">\n    <a href=\"#\" data-dojo-attach-point=\"itemNode\" style=\"display: block;\" data-dojo-attach-event=\"onclick:_onClick\">\n        <span data-dojo-attach-point=\"contentNode\" class=\"epi-content-block-node\">\n            <span data-dojo-attach-point=\"labelNode\" class=\"dojoxEllipsis\"></span>\n            <span data-dojo-attach-point=\"extraIconsContainer\" class=\"epi-floatRight\">\n                <span data-dojo-attach-point=\"iconNodeMenu\" class=\"epi-iconContextMenu\" style=\"visibility: hidden;\" data-dojo-attach-event=\"onclick:_onContextMenu\"></span>\n            </span>\n        </span>\n    </a>\n</div>","url:epi-cms/widget/templates/ContentArea.html":"<div class=\"epi-overlay-blockarea\">\n\t<div class=\"epi-overlay-item-container\">\n\t\t<div class=\"epi-overlay-bracket\"></div>\n\t</div>\n\t<div data-dojo-attach-point=\"containerNode\" class=\"epi-overlay-blockarea-container\"></div>\n\t<div data-dojo-attach-point=\"actionsNode\" class=\"epi-overlay-blockarea-actionscontainer\">\n\t\t<div data-dojo-attach-point=\"actionsNodeControls\" class=\"epi-overlay-blockarea-actions\"></div>\n\t</div>\n</div>","epi-cms/widget/overlay/ItemCollection":function(){define(["dojo/_base/declare","dojo/_base/lang","epi-cms/contentediting/viewmodel/ItemCollectionViewModel","epi-cms/widget/overlay/Property"],function(_1fe5,lang,_1fe6,_1fe7){return _1fe5([_1fe7],{modelType:"epi-cms/contentediting/viewmodel/ItemCollectionViewModel",model:null,postMixInProperties:function(){this.inherited(arguments);this._setupAllowedTypes();this._setupModel(this.contentModel.get(this.name));this.own(this.contentModel.watch(this.name,lang.hitch(this,function(name,_1fe8,_1fe9){this.model.set("data",_1fe9);})));},onDrop:function(_1fea,value){this.model.addTo(value,null,false);},_setupModel:function(data){require([this.modelType],lang.hitch(this,function(_1feb){this.model=new _1feb(data,this.modelParams);this.own(this.model.on("changed",lang.hitch(this,function(_1fec){this.onValueChange({propertyName:this.name,value:this.model.get("value")});})));}));},_setupAllowedTypes:function(){var _1fed=this.modelParams.itemConverterKey,_1fee=this.modelParams.customTypeIdentifier;this.allowedDndTypes=this.allowedDndTypes||[];if(_1fed){this.allowedDndTypes=this.allowedDndTypes.map(function(type){return type+"."+_1fed;});}if(_1fee){this.allowedDndTypes.unshift(_1fee);}}});});},"epi-cms/widget/ReadOnlyDateTimeEditor":function(){define(["dojo/_base/declare","dijit/_Widget","dijit/_TemplatedMixin","epi/datetime","dojo/text!./templates/ReadOnlyDateTimeEditor.html"],function(_1fef,_1ff0,_1ff1,_1ff2,_1ff3){return _1fef([_1ff0,_1ff1],{templateString:_1ff3,value:null,_setValueAttr:function(value){this._set("value",value);if(value){this.valueNode.innerHTML=_1ff2.toUserFriendlyHtml(value);}}});});},"url:epi-cms/widget/templates/ReadOnlyDateTimeEditor.html":"<div class=\"dijitReset dijitInline epi-previewableTextBox-wrapper\">\n    <span data-dojo-attach-point=\"valueNode\" class=\"epi-previewableTextBox-text dijitInline\"></span>\n</div>","epi-cms/widget/UrlContentSelector":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/lang","dojo/when","epi","epi/Url","epi-cms/core/ContentReference","epi-cms/core/PermanentLinkHelper","epi-cms/widget/ContentSelector"],function(_1ff4,_1ff5,lang,when,epi,Url,_1ff6,_1ff7,_1ff8){return _1ff4([_1ff8],{_contentData:null,_isValueInitilized:false,_setValueAndFireOnChange:function(value){var _1ff9;if(this._valueChangedPromise){this._valueChangedPromise.cancel("");this._valueChangedPromise=null;}if(!value){this._updateDisplayNode(null);_1ff9=this.value!==value;this.value=value;this._contentData=null;if(_1ff9&&this._isValueInitilized){this.onChange(value);}this._started&&this.validate();this._isValueInitilized=true;return;}when(this._getContentByPermanentLink(value),lang.hitch(this,function(_1ffa){this._updateDisplayNode(_1ffa);var _1ffb=_1ffa.permanentLink;this._started&&this.validate();_1ff9=!epi.areEqual(this.value,_1ffb);this.value=_1ffb;if(this._isValueInitilized&&_1ff9){this.onChange(_1ffb);}this._isValueInitilized=true;}));},_convertValueToContentReference:function(value){if(this._contentData){return new _1ff6(this._contentData.contentLink);}return null;},_getContentByPermanentLink:function(value){if(epi.areEqual(this.value,value)&&this._contentData){return this._contentData;}this._valueChangedPromise=new _1ff5();when(_1ff7.getContent(value,{allLanguages:true}),lang.hitch(this,function(_1ffc){this._contentData=_1ffc;if(this._valueChangedPromise){this._valueChangedPromise.resolve(_1ffc);}}));return this._valueChangedPromise.promise;}});});},"epi-cms/widget/UrlSelector":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/when","dojo/aspect","dojo/Deferred","epi/shell/widget/_ModelBindingMixin","epi/shell/widget/dialog/Dialog","epi/Url","epi-cms/widget/LinkEditor","epi-cms/widget/_SelectorBase","epi-cms/core/PermanentLinkHelper","epi/i18n!epi/cms/nls/episerver.cms.widget.editlink"],function(_1ffd,lang,_1ffe,_1fff,when,_2000,_2001,_2002,_2003,Url,_2004,_2005,_2006,res){return _1ffd([_2005,_2002],{resource:res,linkHelper:_2006,postMixInProperties:function(){this.inherited(arguments);if(!this.model&&this.modelClassName){var _2007=_1ffd(this.modelClassName);this.model=new _2007();}},startup:function(){if(this._started){return;}this.inherited(arguments);!this.value&&this.set("value",null);},isValid:function(){return (!this.required||(!this.get("isEmpty")));},_onDialogShow:function(){this.inherited(arguments);var link=this.get("value");this.dialogContent.set("value",{href:link});},_onDialogExecute:function(){var _2008=this.dialogContent.get("value");this.set("value",_2008.href);},_getDialog:function(){this.dialogContent=new _2004({modelType:this.metadata.additionalValues["modelType"],hiddenFields:["text","title","target","language"]});this.own(this.dialogContent);return new _2003({title:this._getTitle(),dialogClass:"epi-dialog-portrait",content:this.dialogContent,destroyOnHide:false,defaultActionsVisible:false});},_setValueAttr:function(value){if(!value){this.set("isEmpty",true);this._setValueAndFireOnChange(null);return;}this.set("isEmpty",false);this._setValueAndFireOnChange(value);},_setValueAndFireOnChange:function(value){var _2009=this.get("value");this._set("value",value);var _200a=true;if(!_2009&&!value){_200a=false;}else{if(value&&value===_2009){_200a=false;}}if(_200a){this.onChange(value);}if(this._valueChangedPromise){this._valueChangedPromise.cancel("");this._valueChangedPromise=null;}if(value){this._getLinkName(value).then(lang.hitch(this,this._updateDisplayNode));}else{this._updateDisplayNode(null);}},_getLinkName:function(value){this._valueChangedPromise=new _2001();when(this.linkHelper.getContent(value,{allLanguages:true}),lang.hitch(this,function(_200b){var _200c={name:_200b?_200b.name:value};if(this._valueChangedPromise){this._valueChangedPromise.resolve(_200c);}}));return this._valueChangedPromise.promise;},_getTitle:function(){return lang.replace(this.value?this.resource.title.template.edit:this.resource.title.template.create,this.resource.title.action);}});});},"epi-cms/widget/XFormEditor":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/when","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/query","dojo/html","dijit/focus","dijit/form/Button","epi/shell/widget/dialog/Dialog","epi/dependency","epi-cms/legacy/LegacyFormEditor","epi-cms/_ContentContextMixin","epi-cms/legacy/LegacyDialogPopup","epi/routes","epi-cms/widget/XFormPropertyWidget","epi/i18n!epi/cms/nls/episerver.cms.legacy.legacyformeditor","epi/i18n!epi/cms/nls/episerver.cms.widget.xformeditor"],function(_200d,event,lang,when,_200e,_200f,_2010,query,html,_2011,_2012,_2013,_2014,_2015,_2016,_2017,_2018,_2019,res,_201a){return _200d([_2015,_2016],{localization:lang.mixin(res,_201a),destroyOnHide:true,editorWidgetClass:_2019,store:null,templateString:"            <div class=\"dijit dijitReset dijitInline dijitLeft dijitInputContainer epi-xFormEditor\">                <div data-dojo-attach-point=\"output\" data-dojo-type=\"dijit/form/TextBox\" value=\"${localization.helptext}\"></div>                <div data-dojo-type=\"dijit/form/Button\" data-dojo-attach-point=\"openButton\" data-dojo-attach-event=\"onClick: openEditor\" data-dojo-props=\"label:'${localization.buttonlabel}'\"></div>                <a href=\"#\" data-dojo-attach-point=\"viewDataLink\" data-dojo-attach-event=\"click: _openViewDataDialog\" title=\"${localization.viewdata.tooltip}\" class=\"disabled\">${localization.viewdata.text}</a>            </div>",postMixInProperties:function(){this.inherited(arguments);var _201b=_2014.resolve("epi.storeregistry");this.store=this.store||_201b.get("epi.cms.xform");},destroy:function(){this.inherited(arguments);if(this._updateDisplayPromise){this._updateDisplayPromise.cancel();this._updateDisplayPromise=null;}},openEditor:function(){this.inherited(arguments);this.onFocus();},_createDialog:function(){if(this.contentLink){lang.mixin(this.params,{contentLink:this.contentLink});}else{when(this.getCurrentContext(),lang.hitch(this,function(_201c){lang.mixin(this.params,{contentLink:_201c.id});}));}this.inherited(arguments);},_openViewDataDialog:function(evt){event.stop(evt);if(_200e.contains(this.viewDataLink,"disabled")){return;}this._showFormDataDialog("Edit/XFormViewData.aspx",this.contentLink,this.value);},_onCancel:function(){this.inherited(arguments);this.setDisplayValue(this.value);},_onDialogCancel:function(){this.inherited(arguments);this.setDisplayValue(this.value);},_showFormDataDialog:function(path,_201d,_201e){var route=_2018.getActionPath({id:_201d,path:path,moduleArea:"LegacyCMS",IsInLegacyWrapper:true,formid:_201e}),_201f=new _2017({url:route,dialogArguments:window.document,showCancelButton:true,features:{width:750,height:300},autoFit:true,showLoadingOverlay:false});this.connect(_201f,"onLoad",function(_2020){if(!_2020){return;}var h1=query("h1[class=\"EP-prefix\"]",_2020.containerIframe.contentDocument.body);_2010.create("span",{innerHTML:this.localization.viewdata.forms+" >"},h1.parent()[0],"first");var _2021=query("select[id$=\"SelectForm\"]",_2020.containerIframe.contentDocument.body);if(_2021){_200f.set(_2021.parent()[0],"display","none");}var _2022=query("input[type=\"checkbox\"][id$=\"ShowResultFromAllPages\"]",_2020.containerIframe.contentDocument.body);if(_2022){_200f.set(_2022.parent()[0],"display","none");}});_201f.show();},_setDisplayTextAndValue:function(value){this.output.set("value",value);this.output.set("title",value);},setDisplayValue:function(value){if(!value){this._setDisplayTextAndValue(this.localization.helptext);_200e.add(this.viewDataLink,"disabled");return;}this._updateDisplayPromise=when(this.store.query({id:value}),lang.hitch(this,function(_2023){this._updateDisplayPromise=null;if(_2023&&_2023.name){this._setDisplayTextAndValue(_2023.name);this.contentLink&&_200e.remove(this.viewDataLink,"disabled");}else{this.set("value",null);}}));}});});},"epi-cms/widget/XFormPropertyWidget":function(){define(["dojo/_base/declare","dojo/_base/lang","epi/epi","epi/routes","epi-cms/legacy/LegacyDialogWrapper","epi-cms/core/ContentReference","epi/i18n!epi/cms/nls/episerver.cms.widget.xformeditor"],function(_2024,lang,epi,_2025,_2026,_2027,res){return _2024([_2026],{title:res.selectform,onChange:function(_2028){},postMixInProperties:function(){this.features=lang.mixin({width:800,height:400},this.editorFeatures);this.autoFit=true;this.connect(this,"onCallback","_onCallback");this.inherited(arguments);},startup:function(){this.inherited(arguments);this.set("url",this._buildIframeUrl());},onCancel:function(){},_buildIframeUrl:function(){var _2029={moduleArea:"LegacyCMS",path:"edit/XFormSelect.aspx",epslanguage:this.contentLanguage,propertyname:this.fullName};lang.mixin(_2029,{pageId:new _2027(this.contentLink).createVersionUnspecificReference().id,form:this.value?this.value:""});return _2025.getActionPath(_2029);},_onCallback:function(_202a){var _202b=_202a?_202a.id:null;if(!epi.areEqual(this.value,_202b)&&_202a!==null){this.value=_202b;this.onChange(_202b);}else{this.onCancel();}}});});},"*now":function(r){r(["dojo/i18n!*preload*epi-cms/nls/widgets*[\"ar\",\"ca\",\"cs\",\"da\",\"de\",\"el\",\"en-gb\",\"en-us\",\"es-es\",\"fi-fi\",\"fr-fr\",\"he-il\",\"hu\",\"it-it\",\"ja-jp\",\"ko-kr\",\"nl-nl\",\"nb\",\"pl\",\"pt-br\",\"pt-pt\",\"ru\",\"sk\",\"sl\",\"sv\",\"th\",\"tr\",\"zh-tw\",\"zh-cn\",\"ROOT\"]"]);}}});