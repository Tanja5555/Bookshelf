//>>built
require({cache:{"url:epi-packaging/templates/RestartSite.htm":"<div style=\"display: none;\" class=\"restartContainer\">\r\n    <span>${res.restartrequiredmessage}</span>\r\n    <input type=\"button\" dojoAttachPoint=\"restartButton\" data-dojo-type=\"dijit/form/Button\" label=\"${res.restartbuttonlabel}\"/>\r\n</div>"}});define("epi-packaging/RestartSite",["dojo","dijit","epi/routes","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojox/widget/Standby","epi/shell/XhrWrapper","dojo/text!./templates/RestartSite.htm","epi/i18n!epi/packaging/nls/EPiServer.Packaging.UI.RestartSite"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _1.declare([_4,_5,_6],{res:_a,templateString:_9,pingTimeout:5000,restartUrl:null,checkStatusUrl:null,antiForgeryData:null,_restartStandby:null,constructor:function(){if(_3){this.restartUrl=_3.getActionPath({moduleArea:"EPiServer.Packaging.UI",controller:"AddOns",action:"Restart"});this.checkStatusUrl=_3.getActionPath({moduleArea:"EPiServer.Packaging.UI",controller:"AddOns",action:"CheckRestartRequired"});}this._xhr=new _8();},postMixInProperties:function(){if(!this.restartUrl){console.error("restartUrl is not specified");}if(!this.checkStatusUrl){console.error("checkStatusUrl is not specified");}this.inherited(arguments);},startup:function(){_1.connect(this.restartButton,"onClick",this,function(){this._requestRestart();});this.inherited(arguments);},hide:function(){_1.style(this.domNode,"display","none");},show:function(){_1.style(this.domNode,"display","block");},showIfRestartRequired:function(){var _b={};this.antiForgeryData.AddAntiforgeryToken(_b);this._xhr.xhrPost({content:_b,url:this.checkStatusUrl,handleAs:"json",load:_1.hitch(this,function(_c){if(!_c){return;}else{if(_c.restartRequired==true){this.show();}else{this.hide();}this.onRestartCheckComplete(_c.restartRequired==true);}}),error:_1.hitch(this,function(_d,_e){_1.publish("onServerError",[_e]);this.hide();})});},onRestartFinished:function(){},onRestartCheckComplete:function(_f){},_requestRestart:function(){if(!this._restartStandby){this._restartStandby=new _7({target:this.domNode});document.body.appendChild(this._restartStandby.domNode);this._restartStandby.startup();}this._restartStandby.show();var _10={};this.antiForgeryData.AddAntiforgeryToken(_10);this._xhr.xhrPost({content:_10,url:this.restartUrl,handleAs:"json",load:_1.hitch(this,function(_11,_12){if(_11.restartRequired){this.counter=0;this._ping();}else{this._restartStandby.hide();alert(this.res.restartfailedmessage);}}),error:_1.hitch(this,function(err,_13){this._restartStandby.hide();_1.publish("onServerError",[_13]);}),handle:function(){}});},_ping:function(){this.counter++;if(this.counter>100){this._restartStandby.hide();return;}setTimeout(_1.hitch(this,function(){var _14={};this.antiForgeryData.AddAntiforgeryToken(_14);this._xhr.xhrPost({content:_14,url:this.checkStatusUrl,handleAs:"json",load:_1.hitch(this,function(_15,_16){if(_15.restartRequired==true){this._ping();}else{this._restartStandby.hide();this.hide();this.onRestartFinished();}}),error:_1.hitch(this,function(err,_17){if(_17.xhr.status==500){this._restartStandby.hide();_1.publish("onServerError",[_17]);}else{this._ping();}})});}),this.pingTimeout);}});});